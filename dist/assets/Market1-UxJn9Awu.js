import{b as U,a as x,j as e}from"./index-2aihh3Fa.js";import{r as c,b as $}from"./vendor-5dkO6nAt.js";import{f as q,u as Y,s as Q}from"./subscriptions-Bz0m9fb1.js";import{u as T}from"./useWalletAxios-DQ4T3cxR.js";import"./firebase-DMFzVTL_.js";import"./utils-B2rxisVD.js";const z=new Intl.NumberFormat("en-ZA");function k(n){if(typeof n=="number"&&Number.isFinite(n))return n;if(n==null)return 0;const b=String(n),d=Number(b.replace(/[^0-9.]/g,""));return Number.isFinite(d)?d:0}function p(n){return z.format(Math.round(n))}function O(){const[n,b]=c.useState([]),[d,D]=c.useState(""),[V,g]=c.useState(!0),[M,f]=c.useState(()=>new Set),[r,u]=c.useState({open:!1,service:null,working:!1,error:"",success:""}),[X,w]=c.useState(()=>new Set),h=$(),y=c.useMemo(()=>sessionStorage.getItem("tenantId")||"vendor",[]),{wallet:o,loading:N,eligible:m,redeemCredits:S}=T(),v=c.useCallback(async()=>{g(!0);const{data:a}=await U.get("/api/data/services",{params:{q:d||void 0,page:1,pageSize:40,featured:"true"}});b(Array.isArray(a.items)?a.items:[]),g(!1)},[d]),P=c.useRef(!1);c.useEffect(()=>{P.current||(P.current=!0,v())},[]),c.useEffect(()=>{(async()=>{try{if(!x.currentUser)return;const a=await q(),i=new Set(a.filter(s=>(s.type||"service")==="service").map(s=>String(s.serviceId)));f(i)}catch{}})()},[y]),c.useEffect(()=>{if(!r.open||typeof document>"u")return;const{body:a}=document;if(a)return a.classList.add("modal-open"),()=>a.classList.remove("modal-open")},[r.open]);async function C(a){try{if(!x.currentUser){h("/login",{replace:!0,state:{from:window.location?.pathname||"/"}});return}const i=String(a);M.has(i)?(await Y(i),f(t=>{const l=new Set(t);return l.delete(i),l})):(await Q(i),f(t=>{const l=new Set(t);return l.add(i),l}))}catch{}}function R(a){if(!x.currentUser){h("/login",{replace:!0,state:{from:window.location?.pathname||"/"}});return}u({open:!0,service:a,working:!1,error:m?"":"My Wallet is only available to startup, vendor, and admin accounts.",success:""})}function A(){u({open:!1,service:null,working:!1,error:"",success:""})}async function F(){const a=r.service;if(!a)return;if(!m){u(s=>({...s,error:"Your account does not have voucher access yet."}));return}if(!o){u(s=>({...s,error:"We could not load your wallet. Please try again."}));return}const i=k(a.price);if(i<=0){u(s=>({...s,success:"This listing does not require voucher credits.",error:""}));return}if(!o||o.balance<i){u(s=>({...s,error:"You do not have enough voucher credits for this listing."}));return}u(s=>({...s,working:!0,error:"",success:""}));try{const s=await S(i,{description:`Listing purchase: ${a.title||"Marketplace service"}`,reference:`listing-${a.id||"unknown"}`,metadata:{serviceId:a.id||null,vendor:a.vendor||null,category:a.category||null}});if(!s.success){u(t=>({...t,working:!1,error:s.error||"Unable to redeem vouchers."}));return}w(t=>{const l=new Set(t);return l.add(String(a.id)),l}),u(t=>({...t,working:!1,error:"",success:`Voucher applied! Remaining balance: ${p(s.wallet?.balance||0)} credits.`}))}catch{u(t=>({...t,working:!1,error:"Unable to redeem vouchers."}))}}function I(){if(!r.open||!r.service)return null;const a=r.service,i=k(a.price),s=o?.balance??0,t=Math.max(0,i-s),l=r.working||N||!m||!o||i<=0||s<i;return e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"modal fade show d-block",tabIndex:-1,role:"dialog","aria-modal":"true",children:e.jsxDEV("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxDEV("div",{className:"modal-content",children:[e.jsxDEV("div",{className:"modal-header",children:[e.jsxDEV("h5",{className:"modal-title",children:"Redeem voucher credits"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:198,columnNumber:17},this),e.jsxDEV("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:A},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:199,columnNumber:17},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:197,columnNumber:15},this),e.jsxDEV("div",{className:"modal-body",children:[e.jsxDEV("h6",{className:"mb-1",children:a.title},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:202,columnNumber:17},this),e.jsxDEV("p",{className:"text-muted mb-3",children:a.description||"Marketplace listing"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:203,columnNumber:17},this),e.jsxDEV("dl",{className:"row mb-0",children:[e.jsxDEV("dt",{className:"col-6",children:"Listing price"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:205,columnNumber:19},this),e.jsxDEV("dd",{className:"col-6 text-end",children:["R ",p(i)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:206,columnNumber:19},this),e.jsxDEV("dt",{className:"col-6",children:"Wallet balance"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:207,columnNumber:19},this),e.jsxDEV("dd",{className:"col-6 text-end",children:["R ",p(s)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:208,columnNumber:19},this),e.jsxDEV("dt",{className:"col-6",children:"After redeeming"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:209,columnNumber:19},this),e.jsxDEV("dd",{className:"col-6 text-end",children:["R ",p(Math.max(0,s-i))]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:210,columnNumber:19},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:204,columnNumber:17},this),!m&&e.jsxDEV("div",{className:"alert alert-warning mt-3 mb-0",children:"My Wallet is only available to startup, vendor, and admin accounts."},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:213,columnNumber:19},this),m&&o&&t>0&&e.jsxDEV("div",{className:"alert alert-warning mt-3 mb-0",children:["You need an additional ",p(t)," credits to redeem this listing."]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:216,columnNumber:19},this),r.error&&e.jsxDEV("div",{className:"alert alert-danger mt-3 mb-0",children:r.error},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:221,columnNumber:19},this),r.success&&e.jsxDEV("div",{className:"alert alert-success mt-3 mb-0",children:r.success},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:224,columnNumber:19},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:201,columnNumber:15},this),e.jsxDEV("div",{className:"modal-footer d-flex justify-content-between",children:[e.jsxDEV("button",{type:"button",className:"btn btn-outline-secondary",onClick:A,disabled:r.working,children:"Close"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:228,columnNumber:17},this),e.jsxDEV("button",{type:"button",className:"btn btn-primary",onClick:()=>void F(),disabled:l,children:r.working?"Processingâ€¦":"Redeem now"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:231,columnNumber:17},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:227,columnNumber:15},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:196,columnNumber:13},this)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:195,columnNumber:11},this)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:194,columnNumber:9},this),e.jsxDEV("div",{className:"modal-backdrop fade show"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:243,columnNumber:9},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:193,columnNumber:7},this)}return e.jsxDEV("div",{className:"container py-4",children:[e.jsxDEV("div",{className:"d-flex align-items-end justify-content-between mb-3",children:[e.jsxDEV("div",{children:[e.jsxDEV("h1",{className:"h4 mb-1",children:"Featured Marketplace"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:252,columnNumber:11},this),e.jsxDEV("small",{className:"text-muted",children:"Discover services from trusted vendors"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:253,columnNumber:11},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:251,columnNumber:9},this),e.jsxDEV("div",{className:"d-flex gap-2",children:[e.jsxDEV("input",{className:"form-control",placeholder:"Searchâ€¦",value:d,onChange:a=>D(a.target.value)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:256,columnNumber:11},this),e.jsxDEV("button",{className:"btn btn-primary",onClick:v,children:"Search"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:257,columnNumber:11},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:255,columnNumber:9},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:250,columnNumber:7},this),m&&o&&e.jsxDEV("div",{className:"alert alert-primary d-flex justify-content-between align-items-center",children:[e.jsxDEV("span",{children:[e.jsxDEV("strong",{children:"My Wallet:"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:266,columnNumber:13},this)," ",p(o.balance)," credits available."]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:265,columnNumber:11},this),e.jsxDEV("button",{className:"btn btn-sm btn-outline-light",onClick:()=>h("/wallet"),children:"View wallet"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:268,columnNumber:11},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:264,columnNumber:9},this),V?e.jsxDEV("p",{children:"Loadingâ€¦"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:275,columnNumber:9},this):e.jsxDEV("div",{className:"row g-3",children:[n.length===0&&e.jsxDEV("p",{className:"text-muted",children:"No featured services yet."},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:278,columnNumber:34},this),n.map(a=>{const i=k(a.price),s=String(a.id),t=X.has(s),l=M.has(s),j=o?.balance??0,E=m&&o&&i>j,L=t?"Redeemed":m?"Redeem":"Select",W=t?"btn btn-success btn-sm":"btn btn-outline-primary btn-sm";return e.jsxDEV("div",{className:"col-12 col-md-6 col-lg-4",children:e.jsxDEV("div",{className:"card h-100",children:e.jsxDEV("div",{className:"card-body d-flex flex-column",children:[e.jsxDEV("div",{className:"d-flex justify-content-between align-items-start gap-2",children:[e.jsxDEV("h5",{className:"card-title mb-0",children:a.title},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:294,columnNumber:23},this),a.isFeatured&&e.jsxDEV("span",{className:"badge text-bg-success",children:"Featured"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:295,columnNumber:40},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:293,columnNumber:21},this),e.jsxDEV("div",{className:"text-muted mb-2",children:[a.category," Â· ",a.vendor]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:297,columnNumber:21},this),e.jsxDEV("p",{className:"flex-grow-1",children:a.description||"Quality service for SMMEs."},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:298,columnNumber:21},this),e.jsxDEV("div",{className:"d-flex flex-column gap-2",children:[e.jsxDEV("strong",{children:["R ",p(i)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:300,columnNumber:23},this),m&&o&&e.jsxDEV("small",{className:E?"text-danger":"text-success",children:E?`Short by ${p(i-j)} credits`:"Covered by your voucher balance"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:302,columnNumber:25},this),e.jsxDEV("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxDEV("button",{className:W,onClick:()=>R(a),disabled:N||t,children:N?"Checking walletâ€¦":L},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:309,columnNumber:25},this),e.jsxDEV("button",{className:l?"btn btn-sm btn-secondary":"btn btn-sm btn-primary",onClick:()=>C(a.id),children:l?"Subscribed":"Subscribe"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:316,columnNumber:25},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:308,columnNumber:23},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:299,columnNumber:21},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:292,columnNumber:19},this)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:291,columnNumber:17},this)},s,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:290,columnNumber:15},this)})]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:277,columnNumber:9},this),I()]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:249,columnNumber:5},this)}export{O as default};
