import{j as e,a as b}from"./index-DF1eAVL0.js";import{i as X,b as y,r as c}from"./vendor-5dkO6nAt.js";import"./firebase-Dn3N7aYH.js";import"./utils-B2rxisVD.js";const q=()=>{const[t]=X(),d=y(),[C,l]=c.useState(!0),[A,o]=c.useState(null),[a,D]=c.useState(null),[h,u]=c.useState(!1),N=c.useMemo(()=>t.toString(),[t]);c.useEffect(()=>{let s=!1;return(async()=>{try{const r=b.currentUser;if(!r){s||(o("Please sign in to authorize"),l(!1));return}const n=new URLSearchParams(N),x=n.get("client_id"),P=n.get("redirect_uri"),j=n.get("response_type"),O=n.get("scope"),v=n.get("state"),g=n.get("code_challenge"),k=n.get("code_challenge_method");if(!x||!P||!j||!O){s||(o("Invalid authorization request - missing required parameters"),l(!1));return}const i=new URL("/api/oauth/authorize",window.location.origin);i.searchParams.set("client_id",x),i.searchParams.set("redirect_uri",P),i.searchParams.set("response_type",j),i.searchParams.set("scope",O),v&&i.searchParams.set("state",v),g&&i.searchParams.set("code_challenge",g),k&&i.searchParams.set("code_challenge_method",k);const V=await r.getIdToken(),f=await fetch(i.toString(),{headers:{Authorization:`Bearer ${V}`}}),p=await f.json();if(!f.ok){s||(o(p.message||"Failed to load authorization request"),l(!1));return}if(f.redirected||p.redirect){window.location.href=p.redirect;return}s||(D(p.data),l(!1))}catch(r){console.error("Load consent error:",r),s||(o("Failed to load authorization request"),l(!1))}})(),()=>{s=!0}},[N]);const E=async()=>{try{u(!0);const m=await b.currentUser.getIdToken(),n=await(await fetch("/api/oauth/authorize",{method:"POST",headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"},body:JSON.stringify({client_id:t.get("client_id"),redirect_uri:t.get("redirect_uri"),scope:t.get("scope"),state:t.get("state"),code_challenge:t.get("code_challenge"),approved:!0})})).json();n.success&&n.redirect?window.location.href=n.redirect:(o(n.message||"Failed to authorize"),u(!1))}catch(s){console.error("Approve error:",s),o("Failed to process authorization"),u(!1)}},M=async()=>{try{u(!0);const m=await b.currentUser.getIdToken(),n=await(await fetch("/api/oauth/authorize",{method:"POST",headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"},body:JSON.stringify({client_id:t.get("client_id"),redirect_uri:t.get("redirect_uri"),scope:t.get("scope"),state:t.get("state"),approved:!1})})).json();n.redirect?window.location.href=n.redirect:d("/")}catch(s){console.error("Deny error:",s),d("/")}};return C?e.jsxDEV("div",{className:"oauth-consent",children:e.jsxDEV("div",{className:"consent-container",children:e.jsxDEV("div",{className:"loading",children:"Loading authorization request..."},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:173,columnNumber:11},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:172,columnNumber:9},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:171,columnNumber:7},void 0):A?e.jsxDEV("div",{className:"oauth-consent",children:e.jsxDEV("div",{className:"consent-container",children:e.jsxDEV("div",{className:"error-state",children:[e.jsxDEV("h2",{children:"Authorization Error"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:184,columnNumber:13},void 0),e.jsxDEV("p",{children:A},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:185,columnNumber:13},void 0),e.jsxDEV("button",{onClick:()=>d("/"),className:"btn-primary",children:"Return Home"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:186,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:183,columnNumber:11},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:182,columnNumber:9},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:181,columnNumber:7},void 0):a?e.jsxDEV("div",{className:"oauth-consent",children:e.jsxDEV("div",{className:"consent-container",children:[e.jsxDEV("div",{className:"consent-header",children:[e.jsxDEV("div",{className:"app-icon",children:"🔐"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:203,columnNumber:11},void 0),e.jsxDEV("h1",{children:"Authorization Request"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:204,columnNumber:11},void 0),e.jsxDEV("p",{className:"user-info",children:["Signing in as ",e.jsxDEV("strong",{children:a.user.email},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:206,columnNumber:27},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:205,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:202,columnNumber:9},void 0),e.jsxDEV("div",{className:"client-info",children:[e.jsxDEV("h2",{children:a.client.name},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:211,columnNumber:11},void 0),a.client.description&&e.jsxDEV("p",{className:"client-description",children:a.client.description},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:213,columnNumber:13},void 0),e.jsxDEV("p",{className:"permission-intro",children:"This application is requesting permission to:"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:215,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:210,columnNumber:9},void 0),e.jsxDEV("div",{className:"scopes-list",children:a.requestedScopes.map(s=>e.jsxDEV("div",{className:"scope-item",children:[e.jsxDEV("span",{className:"scope-icon",children:"✓"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:223,columnNumber:15},void 0),e.jsxDEV("div",{className:"scope-details",children:[e.jsxDEV("div",{className:"scope-name",children:s.scope},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:225,columnNumber:17},void 0),e.jsxDEV("div",{className:"scope-description",children:s.description},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:226,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:224,columnNumber:15},void 0)]},s.scope,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:222,columnNumber:13},void 0))},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:220,columnNumber:9},void 0),e.jsxDEV("div",{className:"consent-actions",children:[e.jsxDEV("button",{onClick:M,disabled:h,className:"btn-secondary",children:"Deny"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:233,columnNumber:11},void 0),e.jsxDEV("button",{onClick:E,disabled:h,className:"btn-primary",children:h?"Authorizing...":"Authorize"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:240,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:232,columnNumber:9},void 0),e.jsxDEV("div",{className:"consent-footer",children:e.jsxDEV("p",{children:["By authorizing, you allow ",e.jsxDEV("strong",{children:a.client.name},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:251,columnNumber:39},void 0)," to access your account information according to the permissions listed above. You can revoke this authorization at any time from your account settings."]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:250,columnNumber:11},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:249,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:201,columnNumber:7},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/OAuth/OAuthConsent.jsx",lineNumber:200,columnNumber:5},void 0):null};export{q as default};
