import{a as c,j as a,b as V,x as S}from"./index-CYmZDqTW.js";import{b as D,u as j,r as m}from"./vendor-5dkO6nAt.js";import{G as M,j as X,u as f,m as C,h as I}from"./firebase-DMFzVTL_.js";import{u as T}from"./useVendor-BCODJPhI.js";import"./utils-B2rxisVD.js";const G="/api/data/vendors";function R(){const N=D(),{search:P}=j(),{vendor:u,ensureVendorId:A,refresh:y}=T(),w=m.useMemo(()=>new URLSearchParams(P).get("next")||"/profile-vendor",[P]),[i,x]=m.useState({company:"",website:"",phone:"",email:"",password:"",agree:!1}),[p,d]=m.useState(!1),[v,r]=m.useState("");m.useEffect(()=>{c.currentUser?.email&&x(e=>({...e,email:c.currentUser.email}))},[]);function n(e,s){x(t=>({...t,[e]:s}))}async function h(e){try{await V.post("/api/users",{email:e,tenantId:"vendor",role:"member"})}catch{}try{sessionStorage.setItem("tenantId","vendor"),sessionStorage.setItem("role",sessionStorage.getItem("role")||"member")}catch{}}async function b(e){try{const s={id:e.id,name:e.name,contactEmail:e.contactEmail,email:e.contactEmail,ownerUid:e.id,phone:e.phone||"",website:e.website||"",kycStatus:e.kycStatus||"pending",categories:e.categories||[]};await V.post(G,s);try{await S({action:"VENDOR_CREATE",userEmail:e.contactEmail,targetType:"vendor",targetId:e.id,metadata:{name:e.name}})}catch{}}catch(s){const t=s?.response?.data?.message||s?.message||"Failed to save vendor profile";throw new Error(t)}}async function g(){try{await y?.(),await A?.()}finally{N(w,{replace:!0})}}async function E(){if(r(""),!i.agree){r("Please agree to the Terms and Privacy Policy.");return}d(!0);try{const e=new M,{user:s}=await X(c,e),t={id:s.uid,name:i.company||s.displayName||"Vendor",contactEmail:(s.email||"").toLowerCase(),phone:i.phone,website:i.website};if(i.company)try{await f(s,{displayName:i.company})}catch{}await b(t),await h(t.contactEmail),await g()}catch(e){const s=e?.code||"";r(s==="auth/popup-closed-by-user"?"Google sign-in was closed before completing.":e?.message||"Google sign-in failed")}finally{d(!1)}}async function k(e){if(e.preventDefault(),r(""),!i.agree){r("Please agree to the Terms and Privacy Policy.");return}d(!0);try{const{user:s}=await C(c,i.email,i.password);i.company&&await f(s,{displayName:i.company});const t={id:s.uid,name:i.company||(s.email?s.email.split("@")[0]:"Vendor"),contactEmail:(s.email||i.email).toLowerCase(),phone:i.phone,website:i.website};await b(t),await h(t.contactEmail),await g()}catch(s){const t=s?.code||"";if(t==="auth/email-already-in-use")try{const{user:l}=await I(c,i.email,i.password);if(i.company)try{await f(l,{displayName:i.company})}catch{}const o={id:l.uid,name:i.company||(l.email?l.email.split("@")[0]:"Vendor"),contactEmail:(l.email||i.email).toLowerCase(),phone:i.phone,website:i.website};await b(o),await h(o.contactEmail),await g()}catch(l){const o=l?.code||"";r(o==="auth/wrong-password"?"Email already registered. The password is incorrect. Please sign in or reset your password.":o==="auth/user-disabled"?"This account is disabled. Please contact support.":o==="auth/user-not-found"?"This email is registered with a different sign-in method. Try 'Continue with Google'.":l?.message||"Unable to sign in to existing account.")}else r(t==="auth/weak-password"?"Password is too weak. Please use at least 8 characters.":s?.message||"Sign up failed")}finally{d(!1)}}return a.jsxDEV("div",{className:"container py-4",style:{maxWidth:760},children:[a.jsxDEV("h1",{className:"h3 mb-2",children:"Become a Vendor"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:223,columnNumber:7},this),a.jsxDEV("p",{className:"text-secondary",children:"Create your vendor profile to list services on the marketplace. After signing up you’ll be redirected to your vendor workspace."},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:224,columnNumber:7},this),v&&a.jsxDEV("div",{className:"alert alert-danger",children:v},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:229,columnNumber:15},this),a.jsxDEV("div",{className:"card mb-3",children:[a.jsxDEV("div",{className:"card-header fw-semibold",children:"Vendor details"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:232,columnNumber:9},this),a.jsxDEV("div",{className:"card-body",children:[a.jsxDEV("form",{onSubmit:k,children:[a.jsxDEV("div",{className:"row g-3",children:[a.jsxDEV("div",{className:"col-md-6",children:[a.jsxDEV("label",{className:"form-label",children:"Company / Brand"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:237,columnNumber:17},this),a.jsxDEV("input",{className:"form-control",value:i.company,onChange:e=>n("company",e.target.value),placeholder:"e.g., 22 On Sloane",required:!0},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:238,columnNumber:17},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:236,columnNumber:15},this),a.jsxDEV("div",{className:"col-md-6",children:[a.jsxDEV("label",{className:"form-label",children:"Website"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:247,columnNumber:17},this),a.jsxDEV("input",{className:"form-control",value:i.website,onChange:e=>n("website",e.target.value),placeholder:"https://your-site.co.za"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:248,columnNumber:17},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:246,columnNumber:15},this),a.jsxDEV("div",{className:"col-md-6",children:[a.jsxDEV("label",{className:"form-label",children:"Work Email"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:257,columnNumber:17},this),a.jsxDEV("input",{type:"email",className:"form-control",value:i.email,onChange:e=>n("email",e.target.value),placeholder:"name@company.com",required:!0},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:258,columnNumber:17},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:256,columnNumber:15},this),a.jsxDEV("div",{className:"col-md-6",children:[a.jsxDEV("label",{className:"form-label",children:"Phone"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:268,columnNumber:17},this),a.jsxDEV("input",{className:"form-control",value:i.phone,onChange:e=>n("phone",e.target.value),placeholder:"+27 …"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:269,columnNumber:17},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:267,columnNumber:15},this),a.jsxDEV("div",{className:"col-md-6",children:[a.jsxDEV("label",{className:"form-label",children:"Password"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:278,columnNumber:17},this),a.jsxDEV("input",{type:"password",className:"form-control",value:i.password,onChange:e=>n("password",e.target.value),minLength:8,placeholder:"Minimum 8 characters",required:!0},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:279,columnNumber:17},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:277,columnNumber:15},this),a.jsxDEV("div",{className:"col-12 d-flex align-items-center gap-2 mt-2",children:[a.jsxDEV("input",{id:"agree",type:"checkbox",className:"form-check-input",checked:i.agree,onChange:e=>n("agree",!!e.target.checked)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:291,columnNumber:17},this),a.jsxDEV("label",{htmlFor:"agree",className:"form-check-label",children:["I agree to the ",a.jsxDEV("a",{href:"/terms-condition",target:"_blank",rel:"noreferrer",children:"Terms"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:299,columnNumber:34},this)," and"," ",a.jsxDEV("a",{href:"/privacy",target:"_blank",rel:"noreferrer",children:"Privacy Policy"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:300,columnNumber:19},this),"."]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:298,columnNumber:17},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:290,columnNumber:15},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:235,columnNumber:13},this),a.jsxDEV("div",{className:"d-flex gap-2 mt-3",children:[a.jsxDEV("button",{className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",type:"submit",disabled:p||!i.agree||!i.company||!i.email||!i.password||i.password.length<8,children:p?"Creating…":"Create account"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:306,columnNumber:15},this),a.jsxDEV("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>N(-1),children:"Cancel"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:313,columnNumber:15},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:305,columnNumber:13},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:234,columnNumber:11},this),a.jsxDEV("div",{className:"text-center my-3 text-muted",children:"or"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:323,columnNumber:11},this),a.jsxDEV("div",{className:"d-grid",children:a.jsxDEV("button",{className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-600 bg-hover-primary-800 radius-8 px-12 py-6",onClick:E,disabled:p||!i.company||!i.agree,title:"Continue with Google",children:p?"Please wait…":"Continue with Google"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:326,columnNumber:13},this)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:325,columnNumber:11},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:233,columnNumber:9},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:231,columnNumber:7},this),u?.vendorId&&a.jsxDEV("div",{className:"alert alert-info",children:["Signed in as ",a.jsxDEV("strong",{children:u.name||u.email},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:340,columnNumber:24},this),". Vendor ID:"," ",a.jsxDEV("code",{children:u.vendorId},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:341,columnNumber:11},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:339,columnNumber:9},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/VendorSignupPage.tsx",lineNumber:222,columnNumber:5},this)}export{R as default};
