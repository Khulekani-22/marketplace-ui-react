import{c as pe,r as b,b as h,a as P,j as a,w as he}from"./index-DaarVqB8.js";import{M as ge}from"./MasterLayout-2uOgNMve.js";import{a as re}from"./appData-vWFasogN.js";import"./iconify-CVdOCQR-.js";const _="/api/lms",$="vendor_profile_working_v1",F="vendor_profile_undo_v1",ne="vendor_profile_history_cache_v1";function J(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return null}}function M(e){return JSON.parse(JSON.stringify(e))}function oe(){return Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,8)}function ie(e){const l=new Date(e);return isNaN(l)?"â€”":l.toLocaleString()}function fe(e){var y,g,j,N,i,L;const l=((e==null?void 0:e.contactEmail)||(e==null?void 0:e.email)||"").toLowerCase();return{id:String((e==null?void 0:e.vendorId)||(e==null?void 0:e.id)||""),name:(e==null?void 0:e.name)||"",contactEmail:l,ownerUid:(e==null?void 0:e.ownerUid)||"",phone:(e==null?void 0:e.phone)||"",website:(e==null?void 0:e.website)||"",description:(e==null?void 0:e.description)||"",logoUrl:(e==null?void 0:e.logoUrl)||(e==null?void 0:e.logo)||"",bannerUrl:(e==null?void 0:e.bannerUrl)||"",country:(e==null?void 0:e.country)||"",city:(e==null?void 0:e.city)||"",addressLine:(e==null?void 0:e.addressLine)||"",socials:{twitter:((y=e==null?void 0:e.socials)==null?void 0:y.twitter)||"",linkedin:((g=e==null?void 0:e.socials)==null?void 0:g.linkedin)||"",facebook:((j=e==null?void 0:e.socials)==null?void 0:j.facebook)||"",instagram:((N=e==null?void 0:e.socials)==null?void 0:N.instagram)||"",youtube:((i=e==null?void 0:e.socials)==null?void 0:i.youtube)||"",github:((L=e==null?void 0:e.socials)==null?void 0:L.github)||""},categories:Array.isArray(e==null?void 0:e.categories)?e.categories:[],tags:Array.isArray(e==null?void 0:e.tags)?e.tags:[],foundedYear:(e==null?void 0:e.foundedYear)||"",teamSize:(e==null?void 0:e.teamSize)||"",registrationNo:(e==null?void 0:e.registrationNo)||"",status:((e==null?void 0:e.status)||"pending").toLowerCase(),kycStatus:(e==null?void 0:e.kycStatus)||"pending"}}function H(e,l={}){const y=((e==null?void 0:e.email)||(e==null?void 0:e.contactEmail)||l.email||"").toLowerCase(),g=(e==null?void 0:e.socials)??{};return{id:String((e==null?void 0:e.id)??(e==null?void 0:e.vendorId)??l.vendorId??oe()),vendorId:String((e==null?void 0:e.vendorId)??(e==null?void 0:e.id)??l.vendorId??""),name:(e==null?void 0:e.name)??(e==null?void 0:e.companyName)??(e==null?void 0:e.vendor)??l.name??"",contactEmail:y,ownerUid:(e==null?void 0:e.ownerUid)??(e==null?void 0:e.uid)??l.uid??"",website:(e==null?void 0:e.website)??"",phone:(e==null?void 0:e.phone)??"",country:(e==null?void 0:e.country)??"",city:(e==null?void 0:e.city)??"",addressLine:(e==null?void 0:e.addressLine)??"",logoUrl:(e==null?void 0:e.logoUrl)??(e==null?void 0:e.logo)??"",bannerUrl:(e==null?void 0:e.bannerUrl)??"",description:(e==null?void 0:e.description)??"",categories:Array.isArray(e==null?void 0:e.categories)?e.categories:[],tags:Array.isArray(e==null?void 0:e.tags)?e.tags:[],foundedYear:(e==null?void 0:e.foundedYear)??"",teamSize:(e==null?void 0:e.teamSize)??"",registrationNo:(e==null?void 0:e.registrationNo)??"",status:((e==null?void 0:e.status)||"pending").toLowerCase(),socials:{twitter:g.twitter??"",linkedin:g.linkedin??"",facebook:g.facebook??"",instagram:g.instagram??"",youtube:g.youtube??"",github:g.github??""},lastUpdated:(e==null?void 0:e.lastUpdated)??""}}function xe(e,l){if(!e)return null;const y=((l==null?void 0:l.email)||"").toLowerCase(),g=[Array.isArray(e.startups)&&e.startups,Array.isArray(e.vendors)&&e.vendors,Array.isArray(e.companies)&&e.companies,Array.isArray(e.profiles)&&e.profiles].filter(Boolean);for(const j of g){const N=j.find(i=>(i==null?void 0:i.ownerUid)&&i.ownerUid===(l==null?void 0:l.uid)||(i==null?void 0:i.email)&&String(i.email).toLowerCase()===y||(i==null?void 0:i.contactEmail)&&String(i.contactEmail).toLowerCase()===y||(l==null?void 0:l.vendorId)&&(String(i==null?void 0:i.vendorId)===String(l.vendorId)||String(i==null?void 0:i.id)===String(l.vendorId)));if(N)return H(N,l)}return null}function we(){var v,ee,ae,se,te;const{vendor:e,ensureVendorId:l,refresh:y}=pe(),g=b.useMemo(()=>sessionStorage.getItem("tenantId")||"vendor",[]),[j,N]=b.useState(()=>J(localStorage.getItem($))??re),[i,L]=b.useState(()=>J(localStorage.getItem(ne))??[]),[w,E]=b.useState(!1),[q,S]=b.useState(""),[G,k]=b.useState(""),[K,V]=b.useState(""),[W,le]=b.useState(!0),A=b.useRef([]);function Q(s){const r=[s,...A.current||[]].slice(0,10);A.current=r,localStorage.setItem(F,JSON.stringify(r))}function X(){var n;const s=(n=A.current)!=null&&n.length?A.current:J(localStorage.getItem(F))??[];if(!s.length)return;const r=s.shift();A.current=s,localStorage.setItem(F,JSON.stringify(s)),N(r),localStorage.setItem($,JSON.stringify(r))}function Y(s){Q(j),N(s),localStorage.setItem($,JSON.stringify(s))}b.useEffect(()=>{let s=!0;return(async()=>{var r,n;E(!0);try{await l();let m=re;try{const o=await((n=(r=h.currentUser)==null?void 0:r.getIdToken)==null?void 0:n.call(r)),p=await fetch(`${_}/live`,{headers:{"x-tenant-id":g,"cache-control":"no-cache",...o?{Authorization:`Bearer ${o}`}:{}}});s&&p.ok&&(m=await p.json())}catch{}try{const o=await P.get("/api/data/vendors").then(U=>U.data||[]),p=M(m);p.startups=Array.isArray(p.startups)?p.startups:[],o.forEach(U=>{const u=H(U),C=p.startups.findIndex(I=>String(I.vendorId||I.id)===u.vendorId);C>=0?p.startups[C]={...p.startups[C],...u}:p.startups.push(u)}),m=p}catch{}Y(m),await O()}catch{}finally{s&&E(!1)}})(),()=>{s=!1}},[g]);async function O(){var s,r;try{const n=await((r=(s=h.currentUser)==null?void 0:s.getIdToken)==null?void 0:r.call(s)),o=(await fetch(`${_}/checkpoints`,{headers:{"x-tenant-id":g,...n?{Authorization:`Bearer ${n}`}:{}}}).then(p=>p.ok?p.json():{items:[]})).items??[];L(o),localStorage.setItem(ne,JSON.stringify(o.slice(0,2)))}catch{}}const f=b.useMemo(()=>{var r,n,m;const s={uid:(r=h.currentUser)==null?void 0:r.uid,email:((n=h.currentUser)==null?void 0:n.email)||(e==null?void 0:e.email)||"",name:((m=h.currentUser)==null?void 0:m.displayName)||(e==null?void 0:e.name)||"",vendorId:(e==null?void 0:e.vendorId)||""};return xe(j,s)||H({},s)},[j,e==null?void 0:e.vendorId,(v=h.currentUser)==null?void 0:v.uid,(ee=h.currentUser)==null?void 0:ee.email]),[t,T]=b.useState(()=>f);b.useEffect(()=>{T(f)},[f==null?void 0:f.vendorId]);const d=!h.currentUser,R=((f==null?void 0:f.status)||"").toLowerCase(),z=((f==null?void 0:f.kycStatus)||"").toLowerCase(),D=R==="active"||z==="approved",ce=R==="pending"||z==="pending",B=R==="suspended"||z==="rejected";function x(s,r){T(n=>({...n,[s]:r}))}function de(s,r){T(n=>({...n,socials:{...n.socials,[s]:r}}))}async function me(s){var r,n;try{const m=await((n=(r=h.currentUser)==null?void 0:r.getIdToken)==null?void 0:n.call(r)),o=await fetch(`${_}/checkpoints`,{method:"POST",headers:{"Content-Type":"application/json","x-tenant-id":g,...m?{Authorization:`Bearer ${m}`}:{}},body:JSON.stringify({message:s||"Vendor profile update",data:j})});if(!o.ok)throw new Error(await o.text());k("Checkpoint saved"),await O(),V("")}catch(m){S((m==null?void 0:m.message)||"Failed to save checkpoint")}}async function Z(){var U,u,C,I;if(S(""),k(""),d){S("You need to sign in first.");return}if(!t.name.trim()){S("Vendor name is required.");return}const s=M(j);Q(s);const r=M(j);r.startups=Array.isArray(r.startups)?r.startups:[];const n=String(t.vendorId||t.id||(e==null?void 0:e.vendorId)||((U=h.currentUser)==null?void 0:U.uid)||oe()),m=(t.contactEmail||((u=h.currentUser)==null?void 0:u.email)||"").toLowerCase(),o={...t,id:n,vendorId:n,ownerUid:((C=h.currentUser)==null?void 0:C.uid)||t.ownerUid||"",contactEmail:m,email:m,lastUpdated:new Date().toISOString()},p=r.startups.findIndex(c=>String(c.vendorId)===n||String(c.id)===n||c.email&&String(c.email).toLowerCase()===m);p>=0?r.startups[p]={...r.startups[p],...o}:r.startups.push(o),W&&Array.isArray(r.services)&&(r.services=r.services.map(c=>String(c.vendorId||"")===n?{...c,vendor:o.name}:c));try{E(!0);const c=fe(o);c.id?await P.put(`/api/data/vendors/${encodeURIComponent(c.id)}`,c):await P.post("/api/data/vendors",c);try{await he({action:"VENDOR_UPSERT",userEmail:(I=h.currentUser)==null?void 0:I.email,targetType:"vendor",targetId:n,metadata:{name:o.name}})}catch{}Y(r),k("Profile saved to live."),await(y==null?void 0:y()),await O(),window.scrollTo({top:0,behavior:"smooth"})}catch(c){S((c==null?void 0:c.message)||"Save failed"),Y(s)}finally{E(!1)}}async function ue(){var s,r,n,m;S(""),k("");try{const o=h.currentUser;if(!o)throw new Error("Please sign in");const p=(o.email||"").toLowerCase(),u=(await P.get("/api/data/startups").then(c=>c.data||[])).find(c=>c.ownerUid&&c.ownerUid===o.uid||(c.contactEmail||c.email||"").toLowerCase()===p);if(!u){S("No startup profile found to import.");return}const C=[u.elevatorPitch||"",u.productsServices||""].filter(Boolean).join(`

`),I={...t,name:t.name||u.name||"",description:t.description||C,contactEmail:(t.contactEmail||u.contactEmail||p).toLowerCase(),phone:t.phone||u.phone||"",website:t.website||u.website||"",country:t.country||u.country||"",city:t.city||u.city||"",addressLine:t.addressLine||u.addressLine||"",categories:(s=t.categories)!=null&&s.length?t.categories:Array.isArray(u.categories)?u.categories:[],tags:(r=t.tags)!=null&&r.length?t.tags:Array.isArray(u.tags)?u.tags:[],teamSize:t.teamSize||String(u.employeeCount||"")};T(I),k("Imported details from your Startup profile. Review and Save changes."),window.scrollTo({top:0,behavior:"smooth"})}catch(o){S(((m=(n=o==null?void 0:o.response)==null?void 0:n.data)==null?void 0:m.message)||(o==null?void 0:o.message)||"Import failed")}}return a.jsx(ge,{children:a.jsxs("div",{className:"container py-4",style:{maxWidth:980},children:[a.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"h4 mb-0",children:"My Vendor Profile"}),a.jsxs("div",{className:"text-muted small",children:["Signed in as"," ",a.jsx("strong",{children:f.name||((ae=h.currentUser)==null?void 0:ae.displayName)||"Vendor"})," ","Â· ",f.contactEmail||((se=h.currentUser)==null?void 0:se.email)||"email not set",a.jsx("span",{className:`badge ms-2 text-bg-${D?"success":B?"danger":"warning"}`,children:D?"Approved":B?"Suspended":"Pending"})]}),a.jsxs("div",{className:"text-muted small",children:["Vendor ID:"," ",f.vendorId?a.jsx("code",{children:f.vendorId}):"pending"]}),D&&a.jsxs("div",{className:"alert alert-success mt-3 mb-0",children:["Your vendor account is approved. You can now submit listings to the marketplace.",a.jsxs("div",{className:"mt-2 d-flex gap-2",children:[a.jsx("a",{className:"btn btn-primary btn-sm",href:"/listings-vendors",children:"+ Submit new listing"}),a.jsx("a",{className:"btn btn-outline-secondary btn-sm",href:"/listings-vendors-mine",children:"View my listings"})]})]}),ce&&a.jsx("div",{className:"alert alert-warning mt-3 mb-0",children:"Your vendor account is pending approval. Please complete your profile details and wait for an admin to approve your account. Youâ€™ll be able to submit listings once approved."}),B&&a.jsx("div",{className:"alert alert-danger mt-3 mb-0",children:"Your vendor account is suspended. You cannot submit listings. Please contact support if you believe this is an error."})]}),a.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[a.jsx("button",{className:"btn btn-outline-secondary",onClick:X,disabled:w,children:"Undo"}),a.jsx("button",{className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:Z,disabled:w||d,title:"Save changes to live",children:w?"Savingâ€¦":"Save changes"})]})]}),d&&a.jsx("div",{className:"alert alert-warning",children:"Please sign in to manage your vendor profile."}),q&&a.jsx("div",{className:"alert alert-danger",children:q}),G&&a.jsx("div",{className:"alert alert-success",children:G}),a.jsxs("div",{className:"row g-3",children:[a.jsxs("div",{className:"col-lg-8",children:[a.jsx("div",{className:"d-flex justify-content-end mb-2",children:a.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:ue,disabled:w||d,title:"Import company details from your Startup profile",children:"Import from Startup Profile"})}),a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"card-header fw-semibold",children:"Company details"}),a.jsx("div",{className:"card-body",children:a.jsxs("div",{className:"row g-3",children:[a.jsxs("div",{className:"col-md-8",children:[a.jsx("label",{className:"form-label",children:"Company / Vendor name"}),a.jsx("input",{className:"form-control",value:t.name,onChange:s=>x("name",s.target.value),placeholder:"e.g., Acme Studio",disabled:d,required:!0})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsx("label",{className:"form-label",children:"Contact email"}),a.jsx("input",{className:"form-control",value:t.contactEmail,onChange:s=>x("contactEmail",s.target.value.toLowerCase()),placeholder:"you@company.com",disabled:d})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Website"}),a.jsx("input",{className:"form-control",value:t.website,onChange:s=>x("website",s.target.value),placeholder:"https://â€¦",disabled:d})]}),a.jsxs("div",{className:"col-md-3",children:[a.jsx("label",{className:"form-label",children:"Phone"}),a.jsx("input",{className:"form-control",value:t.phone,onChange:s=>x("phone",s.target.value),placeholder:"+27â€¦",disabled:d})]}),a.jsxs("div",{className:"col-md-3",children:[a.jsx("label",{className:"form-label",children:"Founded (year)"}),a.jsx("input",{className:"form-control",value:t.foundedYear,onChange:s=>x("foundedYear",s.target.value),placeholder:"2021",disabled:d})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsx("label",{className:"form-label",children:"Country"}),a.jsx("input",{className:"form-control",value:t.country,onChange:s=>x("country",s.target.value),placeholder:"South Africa",disabled:d})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsx("label",{className:"form-label",children:"City"}),a.jsx("input",{className:"form-control",value:t.city,onChange:s=>x("city",s.target.value),placeholder:"Cape Town",disabled:d})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsx("label",{className:"form-label",children:"Team size"}),a.jsx("input",{className:"form-control",value:t.teamSize,onChange:s=>x("teamSize",s.target.value),placeholder:"1â€“10",disabled:d})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Company reg. number"}),a.jsx("input",{className:"form-control",value:t.registrationNo,onChange:s=>x("registrationNo",s.target.value),placeholder:"(optional)",disabled:d})]}),a.jsxs("div",{className:"col-md-6 d-none",children:[a.jsx("label",{className:"form-label",children:"Status"}),a.jsxs("select",{className:"form-select",value:t.status,onChange:s=>x("status",s.target.value),disabled:d,children:[a.jsx("option",{value:"active",children:"active"}),a.jsx("option",{value:"pending",children:"pending"}),a.jsx("option",{value:"suspended",children:"suspended"})]})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Logo URL"}),a.jsx("input",{className:"form-control",value:t.logoUrl,onChange:s=>x("logoUrl",s.target.value),placeholder:"https://â€¦",disabled:d})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Banner URL"}),a.jsx("input",{className:"form-control",value:t.bannerUrl,onChange:s=>x("bannerUrl",s.target.value),placeholder:"https://â€¦",disabled:d})]}),a.jsxs("div",{className:"col-12",children:[a.jsx("label",{className:"form-label",children:"Description"}),a.jsx("textarea",{className:"form-control",rows:4,value:t.description,onChange:s=>x("description",s.target.value),placeholder:"Tell buyers what you do, problems you solve, and why you're different.",disabled:d})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Categories (comma-separated)"}),a.jsx("input",{className:"form-control",value:t.categories.join(", "),onChange:s=>x("categories",s.target.value.split(",").map(r=>r.trim()).filter(Boolean)),placeholder:"Design, Branding",disabled:d})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Tags (comma-separated)"}),a.jsx("input",{className:"form-control",value:t.tags.join(", "),onChange:s=>x("tags",s.target.value.split(",").map(r=>r.trim()).filter(Boolean)),placeholder:"logos, identity, saas",disabled:d})]}),a.jsx("div",{className:"col-12",children:a.jsx("div",{className:"row g-3",children:[["twitter","Twitter"],["linkedin","LinkedIn"],["facebook","Facebook"],["instagram","Instagram"],["youtube","YouTube"],["github","GitHub"]].map(([s,r])=>a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:r}),a.jsx("input",{className:"form-control",value:t.socials[s],onChange:n=>de(s,n.target.value),placeholder:`https://${s}.com/...`,disabled:d})]},s))})}),a.jsxs("div",{className:"col-12 d-flex align-items-center gap-2",children:[a.jsx("input",{id:"propagateName",type:"checkbox",className:"form-check-input",checked:W,onChange:s=>le(!!s.target.checked),disabled:d}),a.jsx("label",{htmlFor:"propagateName",className:"form-check-label",children:"Update my display name on all existing listings"})]}),a.jsxs("div",{className:"col-12 d-flex gap-2 mt-2",children:[a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:X,disabled:w,children:"Undo"}),a.jsx("button",{type:"button",className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:Z,disabled:w||d,children:w?"Savingâ€¦":"Save changes"})]}),t.lastUpdated&&a.jsxs("div",{className:"form-text mt-1",children:["Last updated: ",ie(t.lastUpdated)]})]})})]})]}),a.jsxs("div",{className:"col-lg-4",children:[a.jsxs("div",{className:"card mb-3",children:[a.jsx("div",{className:"card-header fw-semibold",children:"Preview"}),a.jsxs("div",{className:"card-body",children:[a.jsxs("div",{className:"d-flex align-items-center gap-3",children:[a.jsx("img",{src:t.logoUrl||"/assets/images/placeholder-1x1.png",alt:"logo",style:{width:64,height:64,objectFit:"cover",borderRadius:8}}),a.jsxs("div",{children:[a.jsx("div",{className:"fw-semibold",children:t.name||"Vendor"}),a.jsx("div",{className:"text-muted small",children:t.contactEmail||((te=h.currentUser)==null?void 0:te.email)||"email"}),a.jsx("div",{className:"small",children:t.website?a.jsx("a",{href:t.website,target:"_blank",rel:"noreferrer",children:t.website}):"website"})]})]}),t.bannerUrl&&a.jsx("div",{className:"mt-3",children:a.jsx("img",{src:t.bannerUrl,alt:"banner",className:"w-100",style:{maxHeight:140,objectFit:"cover",borderRadius:8}})}),a.jsxs("div",{className:"mt-3 small text-muted",children:["Categories: ",t.categories.join(", ")||"â€”",a.jsx("br",{}),"Tags: ",t.tags.join(", ")||"â€”"]})]})]}),a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"card-header fw-semibold d-flex align-items-center justify-content-between",children:a.jsx("span",{children:"Version control"})}),a.jsxs("div",{className:"card-body",children:[a.jsxs("div",{className:"d-flex gap-2 mb-2",children:[a.jsx("input",{className:"form-control",placeholder:"Checkpoint message",value:K,onChange:s=>V(s.target.value)}),a.jsx("button",{className:"btn btn-outline-primary",onClick:()=>me(K),disabled:w||d,children:"Save checkpoint"})]}),a.jsxs("div",{className:"list-group list-group-flush",children:[!(i!=null&&i.length)&&a.jsx("div",{className:"text-muted small",children:"No checkpoints yet. Create one after saving changes."}),i==null?void 0:i.slice(0,6).map(s=>a.jsxs("div",{className:"list-group-item",children:[a.jsx("div",{className:"fw-semibold",children:s.message||"(no message)"}),a.jsx("div",{className:"text-muted small",children:ie(s.ts)}),a.jsx("div",{className:"d-flex gap-2 mt-1",children:a.jsx("a",{className:"btn btn-sm btn-outline-secondary",href:`${_}/checkpoints/${s.id}`,target:"_blank",rel:"noreferrer",children:"Download snapshot"})})]},s.id))]}),a.jsx("div",{className:"form-text mt-2",children:"Checkpoints snapshot the whole marketplace data (including your profile) on the server."})]})]})]})]})]})})}export{we as default};
