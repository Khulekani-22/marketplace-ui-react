const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BannerInnerTwo-CJRU4obc.js","assets/index-C9a1Nhcx.js","assets/index-BXSesTeZ.css"])))=>i.map(i=>d[i]);
import{r as g,a as we,f as T,b as Se,j as e,R as Z,w as _,c as L,_ as Ce,d as Ie}from"./index-C9a1Nhcx.js";import{M as Ee}from"./MasterLayout-DrERsAgF.js";import"./iconify-53c4nGdq.js";const Ae="/api/lms",ke=Z.lazy(()=>Ce(()=>import("./BannerInnerTwo-CJRU4obc.js"),__vite__mapDeps([0,1,2]))),ne="listings_admin_draft_v1",X="listings_admin_undo_v1",me="listings_admin_history_cache_v1";function P(a){try{return typeof a=="string"?JSON.parse(a):a}catch{return null}}function M(a){return JSON.parse(JSON.stringify(a))}function ce(){return Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,8)}function Te(a){return new Date(a).toLocaleString()}function Le(a=[]){const o=a.length,u=a.reduce((b,C)=>{const y=(C.status||"unknown").toLowerCase();return b[y]=(b[y]||0)+1,b},{}),h=a.filter(b=>!!b.isFeatured).length,j=new Set(a.map(b=>(b.category||"").trim()).filter(Boolean)).size;return{total:o,featured:h,categories:j,byStatus:u}}function ue(a){const o=a.vendorId||a.id||a.uid||(a.email?a.email.toLowerCase():ce());return{id:o,vendorId:a.vendorId||o,companyName:a.companyName||a.name||a.displayName||"",name:a.name||a.companyName||"",email:(a.email||a.contactEmail||"").toLowerCase(),website:a.website||"",phone:a.phone||a.phoneNumber||"",avatar:a.avatar||a.logoUrl||"",status:(a.status||"").toLowerCase(),kycStatus:(a.kycStatus||"").toLowerCase(),raw:a}}function Oe(a){const o=[Array.isArray(a==null?void 0:a.startups)&&a.startups,Array.isArray(a==null?void 0:a.vendors)&&a.vendors,Array.isArray(a==null?void 0:a.companies)&&a.companies,Array.isArray(a==null?void 0:a.profiles)&&a.profiles].filter(Boolean);return le(o.flat().map(ue))}function le(a=[]){const o=new Map;return a.forEach(u=>{const h=(u.email||"").toLowerCase()||u.vendorId||u.id;if(h)if(!o.has(h))o.set(h,u);else{const b={...o.get(h)};for(const[C,y]of Object.entries(u))y==null||y===""||(b[C]=y);o.set(h,b)}}),Array.from(o.values())}function $e(a=[]){const o={},u={};return a.forEach(h=>{o[h.vendorId]=h,h.email&&(u[h.email]=h)}),{byId:o,byEmail:u}}function ie(a){var o;return{id:a.id??ce(),title:a.title??"",category:a.category??"",vendor:a.vendor??a.vendorName??"",vendorId:a.vendorId??"",contactEmail:(a.contactEmail||a.email||"").toLowerCase(),price:typeof a.price=="number"?a.price:Number(a.price||0),rating:typeof a.rating=="number"?a.rating:Number(a.rating||0),reviewCount:typeof a.reviewCount=="number"?a.reviewCount:Number(a.reviewCount||((o=a.reviews)==null?void 0:o.length)||0),imageUrl:a.imageUrl??a.thumbnail??"",aiHint:a.aiHint??"",listingType:a.listingType??"service",status:a.status??"approved",isFeatured:!!a.isFeatured,description:a.description??"",reviews:Array.isArray(a.reviews)?a.reviews:[]}}function Re(){var de;const a=g.useMemo(()=>sessionStorage.getItem("tenantId")||"vendor",[]),[o,u]=g.useState(()=>P(localStorage.getItem(ne))??we),h=g.useMemo(()=>((o==null?void 0:o.services)||[]).map(ie),[o]),[j,b]=g.useState(()=>Oe(o));g.useEffect(()=>{let t=!0;return(async()=>{try{const r=await T.get("/api/data/vendors").then(i=>i.data||[]),n=Array.isArray(r)?le(r.map(ue)):[];t&&b(i=>le([...i||[],...n]))}catch{}})(),()=>{t=!1}},[a]);const{byId:C,byEmail:y}=g.useMemo(()=>$e(j),[j]);o!=null&&o.startups;const[O,D]=g.useState(()=>JSON.stringify(o,null,2)),[B,K]=g.useState("visual"),[F,k]=g.useState(!1),[W,Y]=g.useState(null),[c,w]=g.useState(null),J=g.useRef([]),[ee,S]=g.useState(()=>P(localStorage.getItem(me))??[]),te=g.useMemo(()=>["All",...Array.from(new Set(h.map(r=>(r.category||"").trim()).filter(Boolean)))],[h]),[U,ae]=g.useState("All"),[m,N]=g.useState("All"),[I,se]=g.useState(""),[G,$]=g.useState(((de=h[0])==null?void 0:de.id)||""),V=g.useMemo(()=>h.filter(t=>!(U!=="All"&&(t.category||"").trim()!==U||m!=="All"&&(t.status||"").toLowerCase()!==m||I&&!`${t.title} ${t.vendor} ${t.vendorId} ${t.contactEmail} ${t.category}`.toLowerCase().includes(I.toLowerCase()))),[h,U,m,I]),f=g.useMemo(()=>h.find(t=>t.id===G),[h,G]);function s(t){Y(t),setTimeout(()=>Y(null),2500)}function d(t){const r=P(localStorage.getItem(X))??[];r.unshift(t);const n=r.slice(0,10);localStorage.setItem(X,JSON.stringify(n)),J.current=n}function x(t){d(o),u(t),D(JSON.stringify(t,null,2)),localStorage.setItem(ne,JSON.stringify(t))}function re(t){var i,l;if(!f)return;const r=M(o),n=r.services.findIndex(p=>p.id===f.id);if(n>=0){r.services[n]={...ie(r.services[n]),...t},x(r);try{const p=f.status;typeof t.status<"u"&&t.status!==p?_({action:"LISTING_STATUS_CHANGE",userEmail:(i=L.currentUser)==null?void 0:i.email,targetType:"listing",targetId:f.id,metadata:{from:p,to:t.status,title:f.title}}):_({action:"LISTING_UPDATE",userEmail:(l=L.currentUser)==null?void 0:l.email,targetType:"listing",targetId:f.id,metadata:{patch:t}})}catch{}}}function q(){var i;const t=prompt("Service title?");if(!t)return;const r=M(o),n=Math.max(0,...r.services.map(l=>Number(l.id)).filter(l=>!Number.isNaN(l)))+1;r.services.push(ie({id:String(n),title:t,vendor:"",vendorId:"",contactEmail:"",category:"",price:0,rating:0,reviewCount:0,imageUrl:"",listingType:"service",status:"approved",isFeatured:!1,description:"",aiHint:"",reviews:[]})),x(r),$(String(n));try{_({action:"LISTING_CREATE",userEmail:(i=L.currentUser)==null?void 0:i.email,targetType:"listing",targetId:String(n),metadata:{title:t}})}catch{}}function Q(){var n;if(!f)return;const t=M(o),r=M(f);r.id=ce(),r.title=`${r.title} (Copy)`,t.services.push(r),x(t),$(r.id);try{_({action:"LISTING_DUPLICATE",userEmail:(n=L.currentUser)==null?void 0:n.email,targetType:"listing",targetId:r.id,metadata:{sourceId:f.id,title:r.title}})}catch{}}function he(){var r,n;if(!f||!window.confirm(`Delete "${f.title}"?`))return;const t=M(o);t.services=t.services.filter(i=>i.id!==f.id),x(t),$(((r=t.services[0])==null?void 0:r.id)||"");try{_({action:"LISTING_DELETE",userEmail:(n=L.currentUser)==null?void 0:n.email,targetType:"listing",targetId:f.id,metadata:{title:f.title}})}catch{}}function pe(){const t=J.current.length>0?J.current:P(localStorage.getItem(X))??[];if(!t.length)return;const r=t.shift();J.current=t,localStorage.setItem(X,JSON.stringify(t)),u(r),D(JSON.stringify(r,null,2))}const{appData:oe}=Se();g.useEffect(()=>{(async()=>{var t,r;k(!0);try{const n=oe;n&&Object.keys(n).length&&(u(n),D(JSON.stringify(n,null,2)),localStorage.setItem(ne,JSON.stringify(n)),$(((r=(t=n==null?void 0:n.services)==null?void 0:t[0])==null?void 0:r.id)||"")),await z()}catch{}finally{k(!1)}})()},[oe]);async function z(){try{const r=(await T.get("/api/lms/checkpoints").then(n=>n.data)).items??[];S(r),localStorage.setItem(me,JSON.stringify(r.slice(0,2)))}catch{}}async function ge(){var t,r,n;w(null),k(!0);try{const i=await((r=(t=L.currentUser)==null?void 0:t.getIdToken)==null?void 0:r.call(t));let l=o;try{const p=await T.get("/api/lms/live").then(E=>E.data),v=M(o),H=Object.fromEntries(((p==null?void 0:p.services)||[]).map(E=>[String(E.id),E]));v.services=(v.services||[]).map(E=>{const A=H[String(E.id)];return A?{...E,reviews:Array.isArray(A.reviews)?A.reviews:E.reviews,reviewCount:typeof A.reviewCount=="number"?A.reviewCount:Number(A.reviewCount||(Array.isArray(A.reviews)?A.reviews.length:0)||E.reviewCount||0),rating:typeof A.rating=="number"?A.rating:Number(A.rating||E.rating||0),lastReviewedAt:A.lastReviewedAt||E.lastReviewedAt}:E}),l=v,x(v)}catch{}await T.put("/api/lms/publish",{data:l}),s("Published listings to live");try{await _({action:"LISTINGS_PUBLISH",userEmail:(n=L.currentUser)==null?void 0:n.email,targetType:"appData",targetId:"services",metadata:{count:h.length}})}catch{}await z()}catch(i){w(i.message||"Publish failed")}finally{k(!1)}}async function xe(t){var r;try{await T.post("/api/lms/checkpoints",{message:t||"",data:o}),s("Checkpoint saved");try{await _({action:"LISTINGS_CHECKPOINT",userEmail:(r=L.currentUser)==null?void 0:r.email,targetType:"services",targetId:"checkpoint",metadata:{message:t||""}})}catch{}await z()}catch(n){w(n.message||"Failed to save checkpoint")}}async function be(t){if(window.confirm("Restore this snapshot to LIVE appData.json?"))try{await T.post(`/api/lms/restore/${t}`),s("Restored snapshot"),await z();const r=await T.get("/api/lms/live").then(n=>n.data);x(r)}catch(r){w(r.message||"Restore failed")}}async function ve(){var t;if(window.confirm("Delete ALL checkpoints on the server?"))try{await T.delete("/api/lms/checkpoints"),s("Cleared history");try{await _({action:"LISTINGS_HISTORY_CLEAR",userEmail:(t=L.currentUser)==null?void 0:t.email,targetType:"services",targetId:"history"})}catch{}await z()}catch(r){w(r.message||"Failed to clear")}}const R=Le(h);function fe(t){const r=t.vendorId&&C[t.vendorId],n=t.contactEmail&&y[t.contactEmail],i=r||n||null,l=(i==null?void 0:i.companyName)||(i==null?void 0:i.name)||t.vendor||t.contactEmail||"—",p=(i==null?void 0:i.email)||t.contactEmail||"",v=(i==null?void 0:i.vendorId)||t.vendorId||"",H=v?`/profile-vendor?vendorId=${encodeURIComponent(v)}`:null;return{v:i,name:l,email:p,vendorId:v,profileHref:H}}function je(t){return!t||typeof t!="object"?"File is not valid JSON.":Array.isArray(t.services)?null:"JSON must include an array: services[]."}async function ye(t){var n,i,l;w(null);const r=(n=t.target.files)==null?void 0:n[0];if(r)try{const p=await r.text(),v=P(p),H=je(v);if(H){w(H);return}x(v),$(((l=(i=v==null?void 0:v.services)==null?void 0:i[0])==null?void 0:l.id)||""),s(`Imported ${r.name}`)}catch(p){w("Import failed: "+((p==null?void 0:p.message)||"unknown error"))}finally{t.target.value=""}}function Ne(){try{const t=new Blob([JSON.stringify(o,null,2)],{type:"application/json;charset=utf-8"}),r=URL.createObjectURL(t),n=document.createElement("a");n.href=r;const i=new Date().toISOString().replace(/[:.]/g,"-");n.download=`appData-${a}-${i}.json`,document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(r),s("Exported current working copy")}catch(t){w("Export failed: "+((t==null?void 0:t.message)||"unknown error"))}}return e.jsx(Ee,{children:e.jsxs("div",{className:"container py-4",children:[e.jsx(Z.Suspense,{fallback:null,children:e.jsx("div",{className:"row mb-3",children:e.jsx(ke,{})})}),e.jsxs("div",{className:"row g-3 mb-3",children:[e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 bg-animated-gradient text-center p-3",children:[e.jsx("i",{className:"bi bi-bag-check text-primary fs-3 mb-2"}),e.jsx("h6",{className:"fw-bold mb-0",children:R.total}),e.jsx("small",{className:"text-muted",children:"Services"})]})}),e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 text-center p-3",children:[e.jsx("i",{className:"bi bi-grid text-success fs-3 mb-2"}),e.jsx("h6",{className:"fw-bold mb-0",children:R.categories}),e.jsx("small",{className:"text-muted",children:"Categories"})]})}),e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 text-center p-3",children:[e.jsx("i",{className:"bi bi-star-fill text-warning fs-3 mb-2"}),e.jsx("h6",{className:"fw-bold mb-0",children:R.featured}),e.jsx("small",{className:"text-muted",children:"Featured"})]})}),e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 p-3",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-flag text-danger fs-4","aria-hidden":"true"}),e.jsx("div",{className:"fw-semibold",children:"Status"})]}),e.jsxs("span",{className:"badge text-bg-light",children:[Object.values(R.byStatus||{}).reduce((t,r)=>t+r,0)," total"]})]}),(()=>{var i;const t=l=>l==="approved"?"success":l==="pending"?"warning":l==="rejected"?"danger":"secondary",r=Object.entries(R.byStatus||{}),n=r.reduce((l,[,p])=>l+p,0);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"progress",style:{height:10},"aria-label":"Status proportions",children:r.map(([l,p])=>{const v=n?Math.round(p/n*100):0;return e.jsx("div",{className:`progress-bar bg-${t(l)}`,role:"progressbar",style:{width:`${v}%`},"aria-label":`${l} ${v}%`,"aria-valuenow":v,"aria-valuemin":0,"aria-valuemax":100,title:`${l}: ${p} (${v}%)`},l)})}),e.jsx("div",{className:"d-flex flex-wrap gap-2 mt-3",children:r.length?r.map(([l,p])=>e.jsxs("span",{className:`d-inline-flex align-items-center gap-2 px-2 py-1 rounded-pill border border-${t(l)} text-${t(l)} bg-${t(l)}-subtle small`,title:`${l}: ${p}`,"aria-label":`${l}: ${p}`,children:[e.jsx("i",{className:`bi ${l==="approved"?"bi-check-circle":l==="pending"?"bi-hourglass-split":l==="rejected"?"bi-x-octagon":"bi-dot"} `,"aria-hidden":"true"}),e.jsx("span",{className:"text-capitalize",children:l}),e.jsx("span",{className:"badge text-bg-light",children:p})]},l)):e.jsx("span",{className:"text-muted small",children:"No status data"})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsx("small",{className:"text-muted",children:"Total Approved: "}),e.jsxs("span",{className:"fw-semibold",children:[n?Math.round((((i=R.byStatus)==null?void 0:i.approved)??0)/n*100):0,"%"]})]})]})})()]})})]}),e.jsxs("div",{className:"pt-4 d-flex gap-2 mb-3",children:[e.jsxs("label",{className:"btn btn-light mb-0 d-none",children:["Import JSON",e.jsx("input",{type:"file",accept:"application/json",hidden:!0,onChange:ye})]}),e.jsx("button",{className:"btn rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-primary-700 text-hover-white",onClick:Ne,children:"Export Current"}),e.jsx("button",{className:"btn rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-primary-700 text-hover-white",disabled:F,onClick:async()=>{w(null),k(!0);try{const t=await T.get("/api/lms/live").then(i=>i.data),r=M(o),n=Object.fromEntries(((t==null?void 0:t.services)||[]).map(i=>[String(i.id),i]));r.services=(r.services||[]).map(i=>{const l=n[String(i.id)];return l?{...i,reviews:Array.isArray(l.reviews)?l.reviews:i.reviews,reviewCount:typeof l.reviewCount=="number"?l.reviewCount:Number(l.reviewCount||(Array.isArray(l.reviews)?l.reviews.length:0)||i.reviewCount||0),rating:typeof l.rating=="number"?l.rating:Number(l.rating||i.rating||0),lastReviewedAt:l.lastReviewedAt||i.lastReviewedAt}:i}),x(r),s("Synced reviews from live")}catch(t){w(t.message||"Failed to sync reviews")}finally{k(!1)}},title:"Fetch live data and merge review counts and lists",children:"Sync reviews from live"}),e.jsx("button",{className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:ge,disabled:F,title:"Write working copy to live appData.json on the server",children:F?"Publishing…":"Publish to live"})]}),W&&e.jsx("div",{className:"alert alert-success py-2",children:W}),c&&e.jsx("div",{className:"alert alert-danger py-2",children:c}),e.jsx(_e,{onSave:xe,onClear:ve,onUndo:pe,disabled:F}),e.jsxs("div",{className:"d-flex gap-3",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("ul",{className:"nav nav-tabs mb-3",children:[e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${B==="visual"?"active":""}`,onClick:()=>K("visual"),children:"Visual editor"})}),e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${B==="json"?"active":""}`,onClick:()=>K("json"),children:"JSON editor"})})]}),B==="json"?e.jsx(Ue,{text:O,setText:D,onApply:()=>{const t=P(O);if(!t){w("Invalid JSON");return}x(t),s("Applied JSON to working copy")}}):e.jsx(Me,{services:h,vendors:j,vendorsById:C,vendorsByEmail:y,resolveVendor:fe,category:U,setCategory:ae,status:m,setStatus:N,allCategories:te,search:I,setSearch:se,filtered:V,selectedId:G,setSelectedId:$,selected:f,addService:q,duplicateService:Q,deleteService:he,updateService:re})]}),e.jsx("div",{style:{width:380},children:e.jsx(De,{items:ee,onRestore:be})})]})]})})}function _e({onSave:a,onClear:o,onUndo:u,disabled:h}){const[j,b]=g.useState("");return e.jsxs("div",{className:"d-flex align-items-center gap-2 mb-3",children:[e.jsx("input",{className:"form-control",placeholder:"Checkpoint message (e.g. 'Tweaked pricing & featured items')",value:j,onChange:C=>b(C.target.value)}),e.jsx("button",{className:"btn btn-sm rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:()=>a(j),disabled:h,children:"Save checkpoint"}),e.jsx("button",{className:"btn btn-sm rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-danger-700 text-hover-white",onClick:o,children:"Clear history"}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:u,children:"Undo"})]})}function Ue({text:a,setText:o,onApply:u}){return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header fw-semibold",children:"Working copy (JSON)"}),e.jsxs("div",{className:"card-body",children:[e.jsx("textarea",{value:a,onChange:h=>o(h.target.value),rows:22,spellCheck:!1,className:"form-control font-monospace"}),e.jsxs("div",{className:"d-flex justify-content-between mt-2",children:[e.jsxs("small",{className:"text-muted",children:["Tip: Press ",e.jsx("kbd",{children:"⌘/Ctrl"}),"+",e.jsx("kbd",{children:"A"})," then ",e.jsx("kbd",{children:"⌘/Ctrl"}),"+",e.jsx("kbd",{children:"C"})," to copy."]}),e.jsx("button",{className:"btn btn-outline-primary",onClick:u,children:"Apply JSON"})]})]})]})}function Me(a){const{services:o,vendors:u,vendorsById:h,vendorsByEmail:j,resolveVendor:b,category:C,setCategory:y,status:O,setStatus:D,allCategories:B,search:K,setSearch:F,filtered:k,selectedId:W,setSelectedId:Y,selected:c,addService:w,duplicateService:J,deleteService:ee,updateService:S}=a,te=g.useMemo(()=>{const s=d=>d.status==="active"||d.kycStatus==="approved";return u.filter(s).map(d=>({id:d.vendorId,label:`${d.companyName||d.name||"(unnamed)"}${d.email?" — "+d.email:""}`}))},[u]);function U(s){const d=h[s];S({vendorId:s||"",vendor:d&&(d.companyName||d.name)||"",contactEmail:(d==null?void 0:d.email)||(c==null?void 0:c.contactEmail)||""})}const ae=Z.useMemo(()=>{if(!c)return"";if(c.vendorId)return c.vendorId;const s=(c.contactEmail||"").toLowerCase(),d=s?j[s]:null;return(d==null?void 0:d.vendorId)||""},[c,j]),m=c?b(c):null,[N,I]=Z.useState({open:!1,subject:"",content:"",sending:!1,err:null,done:!1}),{syncMessagesToLive:se,refresh:G}=Ie();function $(){if(!c)return;const s=`Listing feedback: ${c.title}`,d=`Hello ${(m==null?void 0:m.name)||"Vendor"},

Regarding your listing "${c.title}" (ID: ${c.id}).

Reason / guidance:
- 

Please update and resubmit when ready.

Regards,
Admin`;I({open:!0,subject:s,content:d,sending:!1,err:null,done:!1})}function V(){I({open:!1,subject:"",content:"",sending:!1,err:null,done:!1})}async function f(s){var d;if((d=s==null?void 0:s.preventDefault)==null||d.call(s),!(!c||!N.content.trim())){I(x=>({...x,sending:!0,err:null}));try{await T.post("/api/messages",{listingId:c.id,listingTitle:c.title,vendorId:c.vendorId||"",vendorEmail:(m==null?void 0:m.email)||"",subject:N.subject,content:N.content}),I(x=>({...x,sending:!1,done:!0}));try{await G(),await se()}catch{}setTimeout(()=>V(),1200)}catch(x){I(re=>{var q,Q;return{...re,sending:!1,err:((Q=(q=x==null?void 0:x.response)==null?void 0:q.data)==null?void 0:Q.message)||(x==null?void 0:x.message)||"Failed to send"}})}}}return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"fw-semibold",children:"Visual editor"}),e.jsx("span",{className:"text-muted small",children:"CRUD for services (listings)"})]}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row g-2 align-items-end mb-3",children:[e.jsxs("div",{className:"col-12 col-md-3",children:[e.jsx("label",{className:"form-label",children:"Category"}),e.jsx("select",{className:"form-select",value:C,onChange:s=>y(s.target.value),children:B.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"col-12 col-md-3",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsx("select",{className:"form-select",value:O,onChange:s=>D(s.target.value),children:["All","approved","pending","rejected"].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"col",children:[e.jsx("label",{className:"form-label",children:"Search"}),e.jsx("input",{className:"form-control",placeholder:"Title, vendor, email, vendorId, category…",value:K,onChange:s=>F(s.target.value)})]}),e.jsx("div",{className:"col-auto",children:e.jsx("button",{className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6 w-100",onClick:w,children:"+ Add service"})}),e.jsx("div",{className:"col-auto",children:e.jsx("button",{className:"btn rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-primary-700 text-hover-white w-100",onClick:J,disabled:!c,children:"Duplicate"})}),e.jsx("div",{className:"col-auto",children:e.jsx("button",{className:"btn btn-danger-500 rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-danger-700 text-hover-white w-100",onClick:ee,disabled:!c,children:"Delete"})})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-4",children:[e.jsxs("div",{className:"list-group mb-2",style:{maxHeight:420,overflow:"auto"},children:[k.map(s=>{const d=b(s);return e.jsxs("button",{className:"list-group-item list-group-item-action d-flex justify-content-between align-items-center "+(W===s.id?"active":""),onClick:()=>Y(s.id),title:d.email||"",children:[e.jsxs("span",{className:"text-truncate",children:[s.title,e.jsx("span",{className:"text-muted",children:" · "}),e.jsx("span",{className:"text-truncate",children:d.name})]}),d.profileHref?e.jsx("a",{className:"badge bg-light text-dark text-decoration-none",href:d.profileHref,target:"_blank",rel:"noreferrer",onClick:x=>x.stopPropagation(),title:"Open vendor profile",children:d.vendorId}):e.jsx("span",{className:"badge bg-light text-dark",children:s.category||"—"})]},s.id)}),!k.length&&e.jsx("div",{className:"text-muted small p-2",children:"No services match your filters."})]}),e.jsxs("div",{className:"small text-muted",children:["Showing ",k.length," of ",o.length]})]}),e.jsx("div",{className:"col",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Title"}),e.jsx("input",{className:"form-control",value:c.title,onChange:s=>S({title:s.target.value})})]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Category"}),e.jsx("input",{className:"form-control",value:c.category||"",onChange:s=>S({category:s.target.value})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Listing type"}),e.jsxs("select",{className:"form-select",value:c.listingType||"service",onChange:s=>S({listingType:s.target.value}),children:[e.jsx("option",{value:"service",children:"Service"}),e.jsx("option",{value:"saas",children:"SaaS"})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsxs("select",{className:"form-select",value:c.status||"approved",onChange:s=>S({status:s.target.value}),children:[e.jsx("option",{value:"approved",children:"approved"}),e.jsx("option",{value:"pending",children:"pending"}),e.jsx("option",{value:"rejected",children:"rejected"})]})]})]}),e.jsxs("div",{className:"row g-3 mt-1",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Bind to vendor (by company or email)"}),e.jsxs("select",{className:"form-select",value:ae,onChange:s=>U(s.target.value),children:[e.jsx("option",{value:"",children:"—"}),te.map(s=>e.jsx("option",{value:s.id,children:s.label},s.id))]}),e.jsxs("div",{className:"form-text",children:["Saves both ",e.jsx("code",{children:"vendorId"})," and display"," ",e.jsx("code",{children:"vendor"})," name on the listing."]})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Contact email"}),e.jsx("input",{className:"form-control",value:c.contactEmail||"",onChange:s=>S({contactEmail:s.target.value.toLowerCase()}),onBlur:()=>{if(!c)return;const s=(c.contactEmail||"").toLowerCase(),d=s?j[s]:null;d&&c.vendorId!==d.vendorId&&U(d.vendorId)}})]}),e.jsx("div",{className:"col-md-3 d-flex align-items-end",children:m!=null&&m.profileHref?e.jsx("a",{className:"btn btn-outline-primary w-100",href:m.profileHref,target:"_blank",rel:"noreferrer",title:"Open vendor profile",children:"View profile"}):e.jsx("button",{className:"btn btn-outline-secondary w-100",disabled:!0,children:"No profile linked"})})]}),e.jsxs("div",{className:"row g-3 mt-1",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Price (R)"}),e.jsx("input",{type:"number",min:"0",className:"form-control",value:Number(c.price||0),onChange:s=>S({price:Number(s.target.value||0)})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Rating (0–5)"}),e.jsx("input",{type:"number",min:"0",max:"5",step:"0.1",className:"form-control",value:Number(c.rating||0),onChange:s=>S({rating:Number(s.target.value||0)})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Review count"}),e.jsx("input",{type:"number",min:"0",className:"form-control",value:Number(c.reviewCount||0),onChange:s=>S({reviewCount:Number(s.target.value||0)})})]})]}),e.jsxs("div",{className:"row g-3 mt-1",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsx("label",{className:"form-label",children:"Image URL"}),e.jsx("input",{className:"form-control",value:c.imageUrl||"",onChange:s=>S({imageUrl:s.target.value})})]}),e.jsx("div",{className:"col-md-4 d-flex align-items-end gap-3",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{id:"isFeatured",type:"checkbox",className:"form-check-input",checked:!!c.isFeatured,onChange:s=>S({isFeatured:!!s.target.checked})}),e.jsx("label",{htmlFor:"isFeatured",className:"form-check-label",children:"Featured"})]})})]}),e.jsxs("div",{className:"mb-3 mt-2",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("textarea",{className:"form-control",rows:4,value:c.description||"",onChange:s=>S({description:s.target.value})})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("div",{className:"text-secondary small",children:["Vendor: ",e.jsx("strong",{children:(m==null?void 0:m.name)||"Unknown"}),m!=null&&m.email?` · ${m.email}`:""]}),e.jsx("div",{children:e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:$,disabled:!(m!=null&&m.email)&&!(c!=null&&c.vendorId),children:"Message Vendor"})})]}),e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("div",{className:"text-muted small mb-1",children:"Card preview"}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("img",{src:c.imageUrl||"/assets/images/placeholder-4x3.png",alt:"",style:{width:120,height:72,objectFit:"cover",borderRadius:6}}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:c.title||"Untitled service"}),e.jsxs("div",{className:"text-muted small",children:[(m==null?void 0:m.name)||"Vendor",m!=null&&m.email?` · ${m.email}`:""]}),e.jsxs("div",{className:"small",children:["R",Number(c.price||0).toLocaleString()," · ★"," ",Number(c.rating||0).toFixed(1)]})]})]})]})]}):e.jsx("div",{className:"text-muted mt-2",children:"Select a service to edit details."})})]})]}),N.open&&e.jsx("div",{className:"position-fixed top-0 start-0 w-100 h-100",style:{background:"rgba(0,0,0,0.5)",zIndex:1070},onClick:s=>s.target===s.currentTarget&&V(),children:e.jsxs("div",{className:"card",style:{maxWidth:560,margin:"10vh auto"},children:[e.jsxs("div",{className:"card-header d-flex align-items-center justify-content-between",children:[e.jsx("h6",{className:"mb-0",children:"Message Vendor"}),e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:V,children:"Close"})]}),e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:"card-body",children:[N.err&&e.jsx("div",{className:"alert alert-danger py-2 mb-2",children:N.err}),N.done&&e.jsx("div",{className:"alert alert-success py-2 mb-2",children:"Sent"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Subject"}),e.jsx("input",{className:"form-control",value:N.subject,onChange:s=>I(d=>({...d,subject:s.target.value}))})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Message"}),e.jsx("textarea",{className:"form-control",rows:6,value:N.content,onChange:s=>I(d=>({...d,content:s.target.value}))}),e.jsxs("div",{className:"text-secondary small mt-1",children:["To: ",(m==null?void 0:m.email)||(c==null?void 0:c.vendorId)||"Vendor"]})]})]}),e.jsxs("div",{className:"card-footer d-flex justify-content-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:V,disabled:N.sending,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:N.sending||!N.content.trim(),children:N.sending?"Sending…":"Send"})]})]})]})})]})}function De({items:a,onRestore:o}){return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header fw-semibold d-flex justify-content-between",children:[e.jsx("span",{children:"Version history"}),e.jsx("span",{className:"text-muted small",children:"Latest checkpoints"})]}),e.jsxs("div",{className:"list-group list-group-flush",children:[!(a!=null&&a.length)&&e.jsxs("div",{className:"list-group-item text-muted small",children:["No checkpoints yet.",e.jsx("div",{className:"mt-1",children:"Offline cache keeps the two most recent checkpoints."})]}),a==null?void 0:a.map(u=>{var h,j,b,C,y,O;return e.jsx("div",{className:"list-group-item",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:u.message||"(no message)"}),e.jsx("div",{className:"text-muted small",children:Te(u.ts)}),e.jsxs("div",{className:"text-muted small",children:["Δ Cohorts: ",((h=u.delta)==null?void 0:h.cohorts)>=0?"+":"",((j=u.delta)==null?void 0:j.cohorts)??0," · Δ Courses:"," ",((b=u.delta)==null?void 0:b.courses)>=0?"+":"",((C=u.delta)==null?void 0:C.courses)??0," · Δ Lessons:"," ",((y=u.delta)==null?void 0:y.lessons)>=0?"+":"",((O=u.delta)==null?void 0:O.lessons)??0]})]}),e.jsxs("div",{className:"d-flex align-items-start gap-2",children:[e.jsx("button",{className:"btn btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6 btn-sm",title:"Restore snapshot to LIVE",onClick:()=>o(u.id),children:"Restore"}),e.jsx("a",{className:"btn btn-outline-secondary btn-sm",title:"Download snapshot JSON",href:`${Ae}/checkpoints/${u.id}`,target:"_blank",rel:"noreferrer",children:"Download"})]})]})},u.id)})]})]})}export{Re as default};
