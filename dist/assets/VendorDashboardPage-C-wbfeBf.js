import{e as ie,r as d,d as le,c as ce,b as de,j as e,L as f}from"./index-7-v0jUWh.js";import{M as oe}from"./MasterLayout-SmJzx4r8.js";import{B as me}from"./Breadcrumb-BBtNR4li.js";import{R as w}from"./react-apexcharts.min-CfTKFunt.js";import"./iconify-BSamAZK7.js";import"./index-ybDnfyPp.js";function pe(){var $,q,z,T,G,H,Q,W;const{vendor:s}=(($=ie)==null?void 0:$())||{vendor:null};s!=null&&s.vendorId||s!=null&&s.id||s!=null&&s.ownerUid||s!=null&&s.email;const J=d.useMemo(()=>sessionStorage.getItem("tenantId")||"vendor",[]),[n,K]=d.useState(null),[D,k]=d.useState(""),[p,P]=d.useState(!1),[j,X]=d.useState([]),[L,Y]=d.useState({}),[o,Z]=d.useState({monthly:{},quarterly:{},annual:{}}),[R,_]=d.useState(6),{appData:U}=le();d.useEffect(()=>{(async()=>{var t;if(k(""),!!s){P(!0);try{const a=U||ce,h=Array.isArray(a==null?void 0:a.services)?a.services:[],u=(s==null?void 0:s.vendorId)||(s==null?void 0:s.id)||"",i=((s==null?void 0:s.email)||(s==null?void 0:s.contactEmail)||"").toLowerCase(),r=((s==null?void 0:s.name)||"").toLowerCase(),m=h.filter(l=>{const c=String(l.vendorId||""),g=(l.contactEmail||l.email||"").toLowerCase(),x=(l.vendor||"").toLowerCase();return c&&u&&c===u||!c&&(x===r||!!i&&g===i)});X(m);const ae=m.reduce((l,c)=>{const g=(c.status||"approved").toLowerCase();return l[g]=(l[g]||0)+1,l},{}),ne=m.reduce((l,c)=>l+(Number(c.reviewCount||(Array.isArray(c.reviews)?c.reviews.length:0))||0),0),I=m.map(l=>Number(l.rating||0)).filter(l=>!Number.isNaN(l)),re=I.length?I.reduce((l,c)=>l+c,0)/I.length:0;K({listingStats:{total:m.length,byStatus:ae},reviewStats:{totalReviews:ne,avgRating:re},subscription:{plan:(s==null?void 0:s.subscriptionPlan)||"Free",status:((s==null?void 0:s.status)||(s==null?void 0:s.kycStatus)||"pending").toLowerCase()}});try{const l={email:((s==null?void 0:s.email)||(s==null?void 0:s.contactEmail)||"").toLowerCase(),uid:(s==null?void 0:s.ownerUid)||"",name:(s==null?void 0:s.name)||""},c=(s==null?void 0:s.vendorId)||(s==null?void 0:s.id)||"me",x=(await de.get(`/api/data/vendors/${encodeURIComponent(c)}/stats`,{params:l,suppressToast:!0,suppressErrorLog:!0})).data||{};Y(((t=x==null?void 0:x.subscriptionStats)==null?void 0:t.byService)||{}),Z((x==null?void 0:x.salesTime)||{monthly:{},quarterly:{},annual:{}})}catch{}}catch(a){k((a==null?void 0:a.message)||"Failed to load vendor listings")}finally{P(!1)}}})()},[J,s,U]);const C=((q=n==null?void 0:n.listingStats)==null?void 0:q.byStatus)||{},ee=((z=n==null?void 0:n.listingStats)==null?void 0:z.total)||0,se=((T=n==null?void 0:n.reviewStats)==null?void 0:T.totalReviews)||0,M=Number(((G=n==null?void 0:n.reviewStats)==null?void 0:G.avgRating)||0).toFixed(1),te=((H=n==null?void 0:n.subscription)==null?void 0:H.plan)||"Free",A=((Q=n==null?void 0:n.subscription)==null?void 0:Q.status)||"pending",b=(t,a)=>{try{return getComputedStyle(document.documentElement).getPropertyValue(t).trim()||a}catch{return a}},N=b("--primary-600","#487FFF"),y=b("--success-600","#45B369"),v=b("--warning-600","#FF9F29"),V=b("--neutral-400","#94A3B8"),S=b("--border-300","#D1D5DB"),F=d.useMemo(()=>{const t=Object.entries((o==null?void 0:o.monthly)||{});if(!t.length)return null;const a=t.sort((r,m)=>r[0]>m[0]?1:-1).slice(-R),h=a.map(([r])=>r),u=a.map(([,r])=>Number((r==null?void 0:r.count)||0)),i=a.map(([,r])=>Number((r==null?void 0:r.revenue)||0));return{categories:h,series:[{name:"Orders",type:"column",data:u},{name:"Revenue (R)",type:"line",data:i}],options:{chart:{id:"vendor-monthly-sales",stacked:!1,toolbar:{show:!1}},stroke:{width:[0,3]},dataLabels:{enabled:!1},xaxis:{categories:h},yaxis:[{title:{text:"Orders"},labels:{formatter:r=>Math.round(r)}},{opposite:!0,title:{text:"Revenue (R)"},labels:{formatter:r=>`R ${Number(r).toLocaleString()}`}}],colors:[N,y],tooltip:{shared:!0,y:{formatter:(r,{seriesIndex:m})=>m===0?`${Math.round(r)} orders`:`R ${Number(r).toLocaleString()}`}},legend:{position:"top"},grid:{borderColor:S,strokeDashArray:4}}}},[o==null?void 0:o.monthly,R,N,y,S]),O=d.useMemo(()=>{const a=(j||[]).map(i=>({name:i.title||"Untitled",id:String(i.id),value:Number(L[String(i.id)]||0)})).filter(i=>i.value>0).sort((i,r)=>i.value<r.value?1:-1).slice(0,5);if(!a.length)return null;const h=a.map(i=>i.name),u=a.map(i=>i.value);return{categories:h,series:[{name:"Subscribers",data:u}],options:{chart:{id:"vendor-subs-by-service",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:6,horizontal:!0}},dataLabels:{enabled:!1},xaxis:{categories:h,labels:{formatter:i=>Math.round(Number(i))}},colors:[v],grid:{borderColor:S,strokeDashArray:4}}}},[j,L,v,S]),B=d.useMemo(()=>{var i,r,m;const t=Number((((i=n==null?void 0:n.listingStats)==null?void 0:i.byStatus)||{}).approved||0),a=Number((((r=n==null?void 0:n.listingStats)==null?void 0:r.byStatus)||{}).pending||0),h=Number((((m=n==null?void 0:n.listingStats)==null?void 0:m.byStatus)||{}).rejected||0);return t+a+h?{series:[t,a,h],options:{labels:["Approved","Pending","Rejected"],colors:[y,v,V],chart:{type:"donut",toolbar:{show:!1}},legend:{position:"bottom"},dataLabels:{enabled:!1}}}:null},[(W=n==null?void 0:n.listingStats)==null?void 0:W.byStatus,y,v,V]),E=d.useMemo(()=>{const t=Number(M||0);if(!t||Number.isNaN(t))return null;const a=Math.max(0,Math.min(100,t/5*100));return{series:[Number(a.toFixed(0))],options:{chart:{type:"radialBar",sparkline:{enabled:!0}},plotOptions:{radialBar:{hollow:{size:"65%"},dataLabels:{name:{show:!1},value:{formatter:()=>`${t.toFixed(1)}★`,fontSize:"18px"}}}},colors:[N]}}},[M,N]);return e.jsxs(oe,{children:[e.jsx(me,{title:"Vendor Home"}),!1,D&&e.jsx("div",{className:"alert alert-danger",children:D}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-4",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsx("h6",{className:"mb-0",children:"Listings"}),e.jsx(f,{to:"/listings-vendors-mine",className:"btn btn-sm btn-outline-primary",children:"View"})]}),e.jsx("div",{className:"display-6 fw-bold mt-2",children:ee}),e.jsxs("div",{className:"mt-2 text-secondary small",children:[e.jsxs("span",{className:"me-3",children:["Approved: ",e.jsx("strong",{children:C.approved||0})]}),e.jsxs("span",{className:"me-3",children:["Pending: ",e.jsx("strong",{children:C.pending||0})]}),e.jsxs("span",{children:["Rejected: ",e.jsx("strong",{children:C.rejected||0})]})]}),e.jsxs("div",{className:"mt-3 d-flex gap-2",children:[e.jsx(f,{to:"/listings-vendors",className:"btn btn-sm btn-primary",children:"Create listing"}),e.jsx(f,{to:"/profile-vendor",className:"btn btn-sm btn-outline-secondary",children:"Edit profile"})]})]})})}),e.jsx("div",{className:"col-md-4",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsx("h6",{className:"mb-0",children:"Reviews"}),e.jsxs("span",{className:"badge bg-primary-subtle text-primary-700",children:["Avg ",M,"★"]})]}),e.jsx("div",{className:"display-6 fw-bold mt-2",children:se}),e.jsx("div",{className:"mt-2 text-secondary small",children:"Total review count across your listings."})]})})}),e.jsx("div",{className:"col-md-4",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsx("h6",{className:"mb-0",children:"Subscription"}),e.jsx("span",{className:`badge text-bg-${A==="active"?"success":A==="pending"?"warning":"secondary"}`,children:A})]}),e.jsx("div",{className:"display-6 fw-bold mt-2",children:te}),e.jsx("div",{className:"mt-2 text-secondary small",children:"Upgrade coming soon."})]})})})]}),e.jsxs("div",{className:"row g-3 mt-3",children:[e.jsx("div",{className:"col-lg-8",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("h6",{className:"mb-0",children:"Monthly Sales"}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("span",{className:"text-secondary small",children:"Orders vs Revenue"}),e.jsxs("select",{className:"form-select form-select-sm w-auto bg-base border text-secondary-light",value:R,onChange:t=>_(Number(t.target.value)),"aria-label":"Select time range",children:[e.jsx("option",{value:3,children:"Last 3 months"}),e.jsx("option",{value:6,children:"Last 6 months"}),e.jsx("option",{value:12,children:"Last 12 months"})]})]})]}),F?e.jsx(w,{options:F.options,series:F.series,type:"line",height:300}):e.jsx("div",{className:"text-secondary",children:"No monthly sales yet."})]})})}),e.jsx("div",{className:"col-lg-4",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"mb-2",children:"Listing Status"}),B?e.jsx(w,{options:B.options,series:B.series,type:"donut",height:300}):e.jsx("div",{className:"text-secondary",children:"No listings yet."})]})})})]}),e.jsxs("div",{className:"row g-3 mt-3",children:[e.jsx("div",{className:"col-lg-8",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"mb-2",children:"Top Services by Subscribers"}),O?e.jsx(w,{options:O.options,series:O.series,type:"bar",height:300}):e.jsx("div",{className:"text-secondary",children:"No subscribers yet."})]})})}),e.jsx("div",{className:"col-lg-4",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body d-flex flex-column align-items-center justify-content-center",children:[e.jsx("h6",{className:"mb-2",children:"Average Rating"}),E?e.jsx(w,{options:E.options,series:E.series,type:"radialBar",height:250}):e.jsx("div",{className:"text-secondary",children:"No ratings yet."})]})})})]}),e.jsxs("div",{className:"card mt-3",children:[e.jsxs("div",{className:"card-header d-flex align-items-center justify-content-between",children:[e.jsx("h6",{className:"mb-0",children:"My Listings"}),e.jsx(f,{to:"/listings-vendors-mine",className:"btn btn-sm btn-outline-secondary",children:"See all"})]}),e.jsxs("div",{className:"card-body",children:[!p&&j.length===0&&e.jsx("div",{className:"text-secondary",children:"No listings yet. Create your first one."}),p&&e.jsx("div",{className:"text-secondary",children:"Loading listings…"}),!p&&j.length>0&&e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table mb-0 align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Rating"}),e.jsx("th",{children:"Reviews"}),e.jsx("th",{children:"Subscribers"})]})}),e.jsx("tbody",{children:j.slice(0,6).map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.title||"Untitled"}),e.jsx("td",{children:e.jsx("span",{className:"badge text-bg-light text-capitalize",children:(t.status||"approved").toLowerCase()})}),e.jsx("td",{children:t.category||"—"}),e.jsxs("td",{children:[Number(t.rating||0).toFixed(1),"★"]}),e.jsx("td",{children:Number(t.reviewCount||(Array.isArray(t.reviews)?t.reviews.length:0)||0)}),e.jsx("td",{children:Number(L[String(t.id)]||0)})]},t.id))})]})})]})]}),e.jsxs("div",{className:"row g-3 mt-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"mb-2",children:"Monthly Sales"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Month"}),e.jsx("th",{className:"text-end",children:"Orders"}),e.jsx("th",{className:"text-end",children:"Revenue (R)"})]})}),e.jsxs("tbody",{children:[Object.entries(o.monthly||{}).sort((t,a)=>t[0]<a[0]?1:-1).slice(0,6).map(([t,a])=>e.jsxs("tr",{children:[e.jsx("td",{children:t}),e.jsx("td",{className:"text-end",children:a.count||0}),e.jsx("td",{className:"text-end",children:Number(a.revenue||0).toLocaleString()})]},t)),Object.keys(o.monthly||{}).length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-secondary",children:"No completed sales yet."})})]})]})})]})})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"mb-2",children:"Quarterly Sales"}),e.jsxs("ul",{className:"list-unstyled mb-0",children:[Object.entries(o.quarterly||{}).sort((t,a)=>t[0]<a[0]?1:-1).slice(0,4).map(([t,a])=>e.jsxs("li",{className:"d-flex justify-content-between",children:[e.jsx("span",{children:t}),e.jsxs("span",{children:["R ",Number(a.revenue||0).toLocaleString()]})]},t)),Object.keys(o.quarterly||{}).length===0&&e.jsx("li",{className:"text-secondary",children:"No data"})]})]})})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"mb-2",children:"Annual Sales"}),e.jsxs("ul",{className:"list-unstyled mb-0",children:[Object.entries(o.annual||{}).sort((t,a)=>t[0]<a[0]?1:-1).slice(0,3).map(([t,a])=>e.jsxs("li",{className:"d-flex justify-content-between",children:[e.jsx("span",{children:t}),e.jsxs("span",{children:["R ",Number(a.revenue||0).toLocaleString()]})]},t)),Object.keys(o.annual||{}).length===0&&e.jsx("li",{className:"text-secondary",children:"No data"})]})]})})})]}),p&&e.jsx("div",{className:"text-secondary mt-3",children:"Loading stats…"})]})}export{pe as default};
