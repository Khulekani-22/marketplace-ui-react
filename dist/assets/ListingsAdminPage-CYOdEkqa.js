import{f as ke,a as N,j as e,M as Le,w as A,c as k,u as Te}from"./index-DgAHpWmH.js";import{r as m,R as ce}from"./vendor-DW3XjTa1.js";import"./firebase-ARhtPVQA.js";import"./utils-B2rxisVD.js";const me="/api/lms",re="listings_admin_draft_v1",X="listings_admin_undo_v1",oe="listings_admin_history_cache_v1";function J(s){try{return typeof s=="string"?JSON.parse(s):s}catch{return null}}function L(s){return JSON.parse(JSON.stringify(s))}function le(){return Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,8)}function Re(s){return new Date(s).toLocaleString()}function Oe(s=[]){const u=s.length,l=s.reduce((v,w)=>{const j=(w.status||"unknown").toLowerCase();return v[j]=(v[j]||0)+1,v},{}),p=s.filter(v=>!!v.isFeatured).length,g=new Set(s.map(v=>(v.category||"").trim()).filter(Boolean)).size;return{total:u,featured:p,categories:g,byStatus:l}}function ue(s){const u=s.vendorId||s.id||s.uid||(s.email?s.email.toLowerCase():le());return{id:u,vendorId:s.vendorId||u,companyName:s.companyName||s.name||s.displayName||"",name:s.name||s.companyName||"",email:(s.email||s.contactEmail||"").toLowerCase(),website:s.website||"",phone:s.phone||s.phoneNumber||"",avatar:s.avatar||s.logoUrl||"",status:(s.status||"").toLowerCase(),kycStatus:(s.kycStatus||"").toLowerCase(),raw:s}}function de(s){const u=[Array.isArray(s?.startups)&&s.startups,Array.isArray(s?.vendors)&&s.vendors,Array.isArray(s?.companies)&&s.companies,Array.isArray(s?.profiles)&&s.profiles].filter(Boolean);return ie(u.flat().map(ue))}function ie(s=[]){const u=new Map;return s.forEach(l=>{const p=(l.email||"").toLowerCase()||l.vendorId||l.id;if(p)if(!u.has(p))u.set(p,l);else{const v={...u.get(p)};for(const[w,j]of Object.entries(l))j==null||j===""||(v[w]=j);u.set(p,v)}}),Array.from(u.values())}function $e(s=[]){const u={},l={};return s.forEach(p=>{u[p.vendorId]=p,p.email&&(l[p.email]=p)}),{byId:u,byEmail:l}}function ne(s){return{id:s.id??le(),title:s.title??"",category:s.category??"",vendor:s.vendor??s.vendorName??"",vendorId:s.vendorId??"",contactEmail:(s.contactEmail||s.email||"").toLowerCase(),price:typeof s.price=="number"?s.price:Number(s.price||0),rating:typeof s.rating=="number"?s.rating:Number(s.rating||0),reviewCount:typeof s.reviewCount=="number"?s.reviewCount:Number(s.reviewCount||s.reviews?.length||0),imageUrl:s.imageUrl??s.thumbnail??"",aiHint:s.aiHint??"",listingType:s.listingType??"service",status:s.status??"approved",isFeatured:!!s.isFeatured,description:s.description??"",reviews:Array.isArray(s.reviews)?s.reviews:[]}}function Pe(){const s=m.useMemo(()=>sessionStorage.getItem("tenantId")||"vendor",[]),{syncNow:u}=ke(),[l,p]=m.useState(()=>J(localStorage.getItem(re))??{startups:[],vendors:[],companies:[],services:[]}),g=m.useMemo(()=>(l?.services||[]).map(ne),[l]),[v,w]=m.useState(()=>de(l));m.useEffect(()=>{let t=!0;return(async()=>{try{const n=await N.get("/api/data/vendors",{suppressToast:!0,suppressErrorLog:!0}).then(r=>r.data||[]),i=Array.isArray(n)?ie(n.map(ue)):[];t&&w(r=>ie([...r||[],...i]))}catch{}})(),()=>{t=!1}},[s]);const{byId:j,byEmail:V}=m.useMemo(()=>$e(v),[v]),[G,R]=m.useState(()=>JSON.stringify(l,null,2)),[H,z]=m.useState("visual"),[S,K]=m.useState(!0),[T,c]=m.useState(!1),[W,Y]=m.useState(""),[O,f]=m.useState(!1),[q,P]=m.useState(null),[Q,h]=m.useState(null),b=m.useRef([]),[C,Z]=m.useState(()=>J(localStorage.getItem(oe))??[]),ee=m.useMemo(()=>["All",...Array.from(new Set(g.map(n=>(n.category||"").trim()).filter(Boolean)))],[g]),[$,U]=m.useState("All"),[M,a]=m.useState("All"),[o,B]=m.useState(""),[te,_]=m.useState(g[0]?.id||""),he=m.useMemo(()=>g.filter(t=>!($!=="All"&&(t.category||"").trim()!==$||M!=="All"&&(t.status||"").toLowerCase()!==M||o&&!`${t.title} ${t.vendor} ${t.vendorId} ${t.contactEmail} ${t.category}`.toLowerCase().includes(o.toLowerCase()))),[g,$,M,o]),y=m.useMemo(()=>g.find(t=>t.id===te),[g,te]);function E(t){P(t),setTimeout(()=>P(null),2500)}function pe(t){const n=J(localStorage.getItem(X))??[];n.unshift(t);const i=n.slice(0,10);localStorage.setItem(X,JSON.stringify(i)),b.current=i}function I(t){pe(l),p(t),R(JSON.stringify(t,null,2)),localStorage.setItem(re,JSON.stringify(t))}function ge(t){if(!y)return;const n=L(l),i=n.services.findIndex(r=>r.id===y.id);if(i>=0){n.services[i]={...ne(n.services[i]),...t},I(n);try{const r=y.status;typeof t.status<"u"&&t.status!==r?A({action:"LISTING_STATUS_CHANGE",userEmail:k.currentUser?.email,targetType:"listing",targetId:y.id,metadata:{from:r,to:t.status,title:y.title}}):A({action:"LISTING_UPDATE",userEmail:k.currentUser?.email,targetType:"listing",targetId:y.id,metadata:{patch:t}})}catch{}}}function ve(){const t=prompt("Service title?");if(!t)return;const n=L(l),i=Math.max(0,...n.services.map(r=>Number(r.id)).filter(r=>!Number.isNaN(r)))+1;n.services.push(ne({id:String(i),title:t,vendor:"",vendorId:"",contactEmail:"",category:"",price:0,rating:0,reviewCount:0,imageUrl:"",listingType:"service",status:"approved",isFeatured:!1,description:"",aiHint:"",reviews:[]})),I(n),_(String(i));try{A({action:"LISTING_CREATE",userEmail:k.currentUser?.email,targetType:"listing",targetId:String(i),metadata:{title:t}})}catch{}}function xe(){if(!y)return;const t=L(l),n=L(y);n.id=le(),n.title=`${n.title} (Copy)`,t.services.push(n),I(t),_(n.id);try{A({action:"LISTING_DUPLICATE",userEmail:k.currentUser?.email,targetType:"listing",targetId:n.id,metadata:{sourceId:y.id,title:n.title}})}catch{}}function be(){if(!y||!window.confirm(`Delete "${y.title}"?`))return;const t=L(l);t.services=t.services.filter(n=>n.id!==y.id),I(t),_(t.services[0]?.id||"");try{A({action:"LISTING_DELETE",userEmail:k.currentUser?.email,targetType:"listing",targetId:y.id,metadata:{title:y.title}})}catch{}}function fe(){const t=b.current.length>0?b.current:J(localStorage.getItem(X))??[];if(!t.length)return;const n=t.shift();b.current=t,localStorage.setItem(X,JSON.stringify(t)),p(n),R(JSON.stringify(n,null,2))}const D=m.useCallback(async()=>{try{const n=(await N.get("/api/lms/checkpoints",{suppressToast:!0,suppressErrorLog:!0}).then(i=>i.data)).items??[];Z(n),localStorage.setItem(oe,JSON.stringify(n.slice(0,2)))}catch{}},[]),se=m.useCallback(async({silent:t}={})=>{t?c(!0):K(!0),Y("");try{let n=null;try{const{data:i}=await N.get(`${me}/live`,{headers:{"x-tenant-id":s,"cache-control":"no-cache"},suppressToast:!0,suppressErrorLog:!0});i&&typeof i=="object"&&Object.keys(i).length&&(n=i)}catch(i){const r=i?.response?.data?.message||i?.message||"Failed to fetch latest listings";Y(r)}if(n){const i=L(n);p(i),R(JSON.stringify(i,null,2)),localStorage.setItem(re,JSON.stringify(i));const r=i?.services?.[0];_(r?String(r.id):""),w(de(i))}await D()}finally{t?c(!1):K(!1)}},[s,D]);m.useEffect(()=>{se({silent:!1}).catch(()=>{})},[se]);async function ye(){h(null),f(!0);try{let t=l;try{const n=await N.get("/api/lms/live").then(d=>d.data),i=L(l),r=Object.fromEntries((n?.services||[]).map(d=>[String(d.id),d]));i.services=(i.services||[]).map(d=>{const x=r[String(d.id)];return x?{...d,reviews:Array.isArray(x.reviews)?x.reviews:d.reviews,reviewCount:typeof x.reviewCount=="number"?x.reviewCount:Number(x.reviewCount||(Array.isArray(x.reviews)?x.reviews.length:0)||d.reviewCount||0),rating:typeof x.rating=="number"?x.rating:Number(x.rating||d.rating||0),lastReviewedAt:x.lastReviewedAt||d.lastReviewedAt}:d}),t=i,I(i)}catch{}await N.put("/api/lms/publish",{data:t});try{await u()}catch{}E("Published listings to live");try{await A({action:"LISTINGS_PUBLISH",userEmail:k.currentUser?.email,targetType:"appData",targetId:"services",metadata:{count:g.length}})}catch{}await D()}catch(t){h(t.message||"Publish failed")}finally{f(!1)}}async function je(t){try{await N.post("/api/lms/checkpoints",{message:t||"",data:l}),E("Checkpoint saved");try{await A({action:"LISTINGS_CHECKPOINT",userEmail:k.currentUser?.email,targetType:"services",targetId:"checkpoint",metadata:{message:t||""}})}catch{}await D()}catch(n){h(n.message||"Failed to save checkpoint")}}async function Ne(t){if(window.confirm("Restore this snapshot to LIVE appData.json?"))try{await N.post(`/api/lms/restore/${t}`),E("Restored snapshot"),await D();const n=await N.get("/api/lms/live").then(i=>i.data);I(n);try{await u()}catch{}}catch(n){h(n.message||"Restore failed")}}async function we(){if(window.confirm("Delete ALL checkpoints on the server?"))try{await N.delete("/api/lms/checkpoints"),E("Cleared history");try{await A({action:"LISTINGS_HISTORY_CLEAR",userEmail:k.currentUser?.email,targetType:"services",targetId:"history"})}catch{}await D()}catch(t){h(t.message||"Failed to clear")}}const F=Oe(g);function Se(t){const n=t.vendorId&&j[t.vendorId],i=t.contactEmail&&V[t.contactEmail],r=n||i||null,d=r?.companyName||r?.name||t.vendor||t.contactEmail||"â€”",x=r?.email||t.contactEmail||"",ae=r?.vendorId||t.vendorId||"",Ae=ae?`/profile-vendor?vendorId=${encodeURIComponent(ae)}`:null;return{v:r,name:d,email:x,vendorId:ae,profileHref:Ae}}function Ce(t){return!t||typeof t!="object"?"File is not valid JSON.":Array.isArray(t.services)?null:"JSON must include an array: services[]."}async function Ie(t){h(null);const n=t.target.files?.[0];if(n)try{const i=await n.text(),r=J(i),d=Ce(r);if(d){h(d);return}I(r),_(r?.services?.[0]?.id||""),E(`Imported ${n.name}`)}catch(i){h("Import failed: "+(i?.message||"unknown error"))}finally{t.target.value=""}}function Ee(){try{const t=new Blob([JSON.stringify(l,null,2)],{type:"application/json;charset=utf-8"}),n=URL.createObjectURL(t),i=document.createElement("a");i.href=n;const r=new Date().toISOString().replace(/[:.]/g,"-");i.download=`appData-${s}-${r}.json`,document.body.appendChild(i),i.click(),i.remove(),URL.revokeObjectURL(n),E("Exported current working copy")}catch(t){h("Export failed: "+(t?.message||"unknown error"))}}return e.jsx(Le,{children:e.jsxs("div",{className:"container py-4",children:[e.jsxs("div",{className:"row g-3 mb-3",children:[e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 bg-animated-gradient text-center p-3",children:[e.jsx("i",{className:"bi bi-bag-check text-primary fs-3 mb-2"}),e.jsx("h6",{className:"fw-bold mb-0",children:F.total}),e.jsx("small",{className:"text-muted",children:"Services"})]})}),e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 text-center p-3",children:[e.jsx("i",{className:"bi bi-grid text-success fs-3 mb-2"}),e.jsx("h6",{className:"fw-bold mb-0",children:F.categories}),e.jsx("small",{className:"text-muted",children:"Categories"})]})}),e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 text-center p-3",children:[e.jsx("i",{className:"bi bi-star-fill text-warning fs-3 mb-2"}),e.jsx("h6",{className:"fw-bold mb-0",children:F.featured}),e.jsx("small",{className:"text-muted",children:"Featured"})]})}),e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 p-3",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-flag text-danger fs-4","aria-hidden":"true"}),e.jsx("div",{className:"fw-semibold",children:"Status"})]}),e.jsxs("span",{className:"badge text-bg-light",children:[Object.values(F.byStatus||{}).reduce((t,n)=>t+n,0)," total"]})]}),(()=>{const t=r=>r==="approved"?"success":r==="pending"?"warning":r==="rejected"?"danger":"secondary",n=Object.entries(F.byStatus||{}),i=n.reduce((r,[,d])=>r+d,0);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"progress",style:{height:10},"aria-label":"Status proportions",children:n.map(([r,d])=>{const x=i?Math.round(d/i*100):0;return e.jsx("div",{className:`progress-bar bg-${t(r)}`,role:"progressbar",style:{width:`${x}%`},"aria-label":`${r} ${x}%`,"aria-valuenow":x,"aria-valuemin":0,"aria-valuemax":100,title:`${r}: ${d} (${x}%)`},r)})}),e.jsx("div",{className:"d-flex flex-wrap gap-2 mt-3",children:n.length?n.map(([r,d])=>e.jsxs("span",{className:`d-inline-flex align-items-center gap-2 px-2 py-1 rounded-pill border border-${t(r)} text-${t(r)} bg-${t(r)}-subtle small`,title:`${r}: ${d}`,"aria-label":`${r}: ${d}`,children:[e.jsx("i",{className:`bi ${r==="approved"?"bi-check-circle":r==="pending"?"bi-hourglass-split":r==="rejected"?"bi-x-octagon":"bi-dot"} `,"aria-hidden":"true"}),e.jsx("span",{className:"text-capitalize",children:r}),e.jsx("span",{className:"badge text-bg-light",children:d})]},r)):e.jsx("span",{className:"text-muted small",children:"No status data"})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsx("small",{className:"text-muted",children:"Total Approved: "}),e.jsxs("span",{className:"fw-semibold",children:[i?Math.round((F.byStatus?.approved??0)/i*100):0,"%"]})]})]})})()]})})]}),e.jsxs("div",{className:"pt-4 d-flex gap-2 mb-3",children:[e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>se({silent:!0}),disabled:S||T,children:T?"Refreshingâ€¦":S?"Loadingâ€¦":"Refresh data"}),e.jsxs("label",{className:"btn btn-light mb-0 d-none",children:["Import JSON",e.jsx("input",{type:"file",accept:"application/json",hidden:!0,onChange:Ie})]}),e.jsx("button",{className:"btn rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-primary-700 text-hover-white",onClick:Ee,children:"Export Current"}),e.jsx("button",{className:"btn rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-primary-700 text-hover-white",disabled:O||S||T,onClick:async()=>{h(null),f(!0);try{const t=await N.get("/api/lms/live",{headers:{"x-tenant-id":s,"cache-control":"no-cache"},suppressToast:!0,suppressErrorLog:!0}).then(r=>r.data),n=L(l),i=Object.fromEntries((t?.services||[]).map(r=>[String(r.id),r]));n.services=(n.services||[]).map(r=>{const d=i[String(r.id)];return d?{...r,reviews:Array.isArray(d.reviews)?d.reviews:r.reviews,reviewCount:typeof d.reviewCount=="number"?d.reviewCount:Number(d.reviewCount||(Array.isArray(d.reviews)?d.reviews.length:0)||r.reviewCount||0),rating:typeof d.rating=="number"?d.rating:Number(d.rating||r.rating||0),lastReviewedAt:d.lastReviewedAt||r.lastReviewedAt}:r}),I(n),E("Synced reviews from live")}catch(t){h(t.message||"Failed to sync reviews")}finally{f(!1)}},title:"Fetch live data and merge review counts and lists",children:"Sync reviews from live"}),e.jsx("button",{className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:ye,disabled:O||S||T,title:"Write working copy to live appData.json on the server",children:O?"Publishingâ€¦":"Publish to live"})]}),W&&e.jsx("div",{className:"alert alert-warning py-2",children:W}),q&&e.jsx("div",{className:"alert alert-success py-2",children:q}),Q&&e.jsx("div",{className:"alert alert-danger py-2",children:Q}),e.jsx(Ue,{onSave:je,onClear:we,onUndo:fe,disabled:O||S||T}),e.jsxs("div",{className:"d-flex gap-3",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("ul",{className:"nav nav-tabs mb-3",children:[e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${H==="visual"?"active":""}`,onClick:()=>z("visual"),children:"Visual editor"})}),e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${H==="json"?"active":""}`,onClick:()=>z("json"),children:"JSON editor"})})]}),H==="json"?e.jsx(Me,{text:G,setText:R,onApply:()=>{const t=J(G);if(!t){h("Invalid JSON");return}I(t),E("Applied JSON to working copy")}}):e.jsx(_e,{services:g,vendors:v,vendorsById:j,vendorsByEmail:V,resolveVendor:Se,category:$,setCategory:U,status:M,setStatus:a,allCategories:ee,search:o,setSearch:B,filtered:he,selectedId:te,setSelectedId:_,selected:y,addService:ve,duplicateService:xe,deleteService:be,updateService:ge})]}),e.jsx("div",{style:{width:380},children:e.jsx(De,{items:C,onRestore:Ne})})]})]})})}function Ue({onSave:s,onClear:u,onUndo:l,disabled:p}){const[g,v]=m.useState("");return e.jsxs("div",{className:"d-flex align-items-center gap-2 mb-3",children:[e.jsx("input",{className:"form-control",placeholder:"Checkpoint message (e.g. 'Tweaked pricing & featured items')",value:g,onChange:w=>v(w.target.value)}),e.jsx("button",{className:"btn btn-sm rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:()=>s(g),disabled:p,children:"Save checkpoint"}),e.jsx("button",{className:"btn btn-sm rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-danger-700 text-hover-white",onClick:u,children:"Clear history"}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:l,children:"Undo"})]})}function Me({text:s,setText:u,onApply:l}){return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header fw-semibold",children:"Working copy (JSON)"}),e.jsxs("div",{className:"card-body",children:[e.jsx("textarea",{value:s,onChange:p=>u(p.target.value),rows:22,spellCheck:!1,className:"form-control font-monospace"}),e.jsxs("div",{className:"d-flex justify-content-between mt-2",children:[e.jsxs("small",{className:"text-muted",children:["Tip: Press ",e.jsx("kbd",{children:"âŒ˜/Ctrl"}),"+",e.jsx("kbd",{children:"A"})," then ",e.jsx("kbd",{children:"âŒ˜/Ctrl"}),"+",e.jsx("kbd",{children:"C"})," to copy."]}),e.jsx("button",{className:"btn btn-outline-primary",onClick:l,children:"Apply JSON"})]})]})]})}function _e(s){const{services:u,vendors:l,vendorsById:p,vendorsByEmail:g,resolveVendor:v,category:w,setCategory:j,status:V,setStatus:G,allCategories:R,search:H,setSearch:z,filtered:S,selectedId:K,setSelectedId:T,selected:c,addService:W,duplicateService:Y,deleteService:O,updateService:f}=s,q=m.useMemo(()=>{const a=o=>o.status==="active"||o.kycStatus==="approved";return l.filter(a).map(o=>({id:o.vendorId,label:`${o.companyName||o.name||"(unnamed)"}${o.email?" â€” "+o.email:""}`}))},[l]);function P(a){const o=p[a];f({vendorId:a||"",vendor:o&&(o.companyName||o.name)||"",contactEmail:o?.email||c?.contactEmail||""})}const Q=ce.useMemo(()=>{if(!c)return"";if(c.vendorId)return c.vendorId;const a=(c.contactEmail||"").toLowerCase();return(a?g[a]:null)?.vendorId||""},[c,g]),h=c?v(c):null,[b,C]=ce.useState({open:!1,subject:"",content:"",sending:!1,err:null,done:!1}),{syncMessagesToLive:Z,refresh:ee}=Te();function $(){if(!c)return;const a=`Listing feedback: ${c.title}`,o=`Hello ${h?.name||"Vendor"},

Regarding your listing "${c.title}" (ID: ${c.id}).

Reason / guidance:
- 

Please update and resubmit when ready.

Regards,
Admin`;C({open:!0,subject:a,content:o,sending:!1,err:null,done:!1})}function U(){C({open:!1,subject:"",content:"",sending:!1,err:null,done:!1})}async function M(a){if(a?.preventDefault?.(),!(!c||!b.content.trim())){C(o=>({...o,sending:!0,err:null}));try{await N.post("/api/messages",{listingId:c.id,listingTitle:c.title,vendorId:c.vendorId||"",vendorEmail:h?.email||"",subject:b.subject,content:b.content}),C(o=>({...o,sending:!1,done:!0}));try{await ee({force:!0}),await Z()}catch{}setTimeout(()=>U(),1200)}catch(o){C(B=>({...B,sending:!1,err:o?.response?.data?.message||o?.message||"Failed to send"}))}}}return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"fw-semibold",children:"Visual editor"}),e.jsx("span",{className:"text-muted small",children:"CRUD for services (listings)"})]}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row g-2 align-items-end mb-3",children:[e.jsxs("div",{className:"col-12 col-md-3",children:[e.jsx("label",{className:"form-label",children:"Category"}),e.jsx("select",{className:"form-select",value:w,onChange:a=>j(a.target.value),children:R.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"col-12 col-md-3",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsx("select",{className:"form-select",value:V,onChange:a=>G(a.target.value),children:["All","approved","pending","rejected"].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"col",children:[e.jsx("label",{className:"form-label",children:"Search"}),e.jsx("input",{className:"form-control",placeholder:"Title, vendor, email, vendorId, categoryâ€¦",value:H,onChange:a=>z(a.target.value)})]}),e.jsx("div",{className:"col-auto",children:e.jsx("button",{className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6 w-100",onClick:W,children:"+ Add service"})}),e.jsx("div",{className:"col-auto",children:e.jsx("button",{className:"btn rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-primary-700 text-hover-white w-100",onClick:Y,disabled:!c,children:"Duplicate"})}),e.jsx("div",{className:"col-auto",children:e.jsx("button",{className:"btn btn-danger-500 rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-danger-700 text-hover-white w-100",onClick:O,disabled:!c,children:"Delete"})})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-4",children:[e.jsxs("div",{className:"list-group mb-2",style:{maxHeight:420,overflow:"auto"},children:[S.map(a=>{const o=v(a);return e.jsxs("button",{className:"list-group-item list-group-item-action d-flex justify-content-between align-items-center "+(K===a.id?"active":""),onClick:()=>T(a.id),title:o.email||"",children:[e.jsxs("span",{className:"text-truncate",children:[a.title,e.jsx("span",{className:"text-muted",children:" Â· "}),e.jsx("span",{className:"text-truncate",children:o.name})]}),o.profileHref?e.jsx("a",{className:"badge bg-light text-dark text-decoration-none",href:o.profileHref,target:"_blank",rel:"noreferrer",onClick:B=>B.stopPropagation(),title:"Open vendor profile",children:o.vendorId}):e.jsx("span",{className:"badge bg-light text-dark",children:a.category||"â€”"})]},a.id)}),!S.length&&e.jsx("div",{className:"text-muted small p-2",children:"No services match your filters."})]}),e.jsxs("div",{className:"small text-muted",children:["Showing ",S.length," of ",u.length]})]}),e.jsx("div",{className:"col",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Title"}),e.jsx("input",{className:"form-control",value:c.title,onChange:a=>f({title:a.target.value})})]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Category"}),e.jsx("input",{className:"form-control",value:c.category||"",onChange:a=>f({category:a.target.value})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Listing type"}),e.jsxs("select",{className:"form-select",value:c.listingType||"service",onChange:a=>f({listingType:a.target.value}),children:[e.jsx("option",{value:"service",children:"Service"}),e.jsx("option",{value:"saas",children:"SaaS"})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsxs("select",{className:"form-select",value:c.status||"approved",onChange:a=>f({status:a.target.value}),children:[e.jsx("option",{value:"approved",children:"approved"}),e.jsx("option",{value:"pending",children:"pending"}),e.jsx("option",{value:"rejected",children:"rejected"})]})]})]}),e.jsxs("div",{className:"row g-3 mt-1",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Bind to vendor (by company or email)"}),e.jsxs("select",{className:"form-select",value:Q,onChange:a=>P(a.target.value),children:[e.jsx("option",{value:"",children:"â€”"}),q.map(a=>e.jsx("option",{value:a.id,children:a.label},a.id))]}),e.jsxs("div",{className:"form-text",children:["Saves both ",e.jsx("code",{children:"vendorId"})," and display"," ",e.jsx("code",{children:"vendor"})," name on the listing."]})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Contact email"}),e.jsx("input",{className:"form-control",value:c.contactEmail||"",onChange:a=>f({contactEmail:a.target.value.toLowerCase()}),onBlur:()=>{if(!c)return;const a=(c.contactEmail||"").toLowerCase(),o=a?g[a]:null;o&&c.vendorId!==o.vendorId&&P(o.vendorId)}})]}),e.jsx("div",{className:"col-md-3 d-flex align-items-end",children:h?.profileHref?e.jsx("a",{className:"btn btn-outline-primary w-100",href:h.profileHref,target:"_blank",rel:"noreferrer",title:"Open vendor profile",children:"View profile"}):e.jsx("button",{className:"btn btn-outline-secondary w-100",disabled:!0,children:"No profile linked"})})]}),e.jsxs("div",{className:"row g-3 mt-1",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Price (R)"}),e.jsx("input",{type:"number",min:"0",className:"form-control",value:Number(c.price||0),onChange:a=>f({price:Number(a.target.value||0)})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Rating (0â€“5)"}),e.jsx("input",{type:"number",min:"0",max:"5",step:"0.1",className:"form-control",value:Number(c.rating||0),onChange:a=>f({rating:Number(a.target.value||0)})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Review count"}),e.jsx("input",{type:"number",min:"0",className:"form-control",value:Number(c.reviewCount||0),onChange:a=>f({reviewCount:Number(a.target.value||0)})})]})]}),e.jsxs("div",{className:"row g-3 mt-1",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsx("label",{className:"form-label",children:"Image URL"}),e.jsx("input",{className:"form-control",value:c.imageUrl||"",onChange:a=>f({imageUrl:a.target.value})})]}),e.jsx("div",{className:"col-md-4 d-flex align-items-end gap-3",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{id:"isFeatured",type:"checkbox",className:"form-check-input",checked:!!c.isFeatured,onChange:a=>f({isFeatured:!!a.target.checked})}),e.jsx("label",{htmlFor:"isFeatured",className:"form-check-label",children:"Featured"})]})})]}),e.jsxs("div",{className:"mb-3 mt-2",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("textarea",{className:"form-control",rows:4,value:c.description||"",onChange:a=>f({description:a.target.value})})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("div",{className:"text-secondary small",children:["Vendor: ",e.jsx("strong",{children:h?.name||"Unknown"}),h?.email?` Â· ${h.email}`:""]}),e.jsx("div",{children:e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:$,disabled:!h?.email&&!c?.vendorId,children:"Message Vendor"})})]}),e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("div",{className:"text-muted small mb-1",children:"Card preview"}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("img",{src:c.imageUrl||"/assets/images/placeholder-4x3.png",alt:"",style:{width:120,height:72,objectFit:"cover",borderRadius:6}}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:c.title||"Untitled service"}),e.jsxs("div",{className:"text-muted small",children:[h?.name||"Vendor",h?.email?` Â· ${h.email}`:""]}),e.jsxs("div",{className:"small",children:["R",Number(c.price||0).toLocaleString()," Â· â˜…"," ",Number(c.rating||0).toFixed(1)]})]})]})]})]}):e.jsx("div",{className:"text-muted mt-2",children:"Select a service to edit details."})})]})]}),b.open&&e.jsx("div",{className:"position-fixed top-0 start-0 w-100 h-100",style:{background:"rgba(0,0,0,0.5)",zIndex:1070},onClick:a=>a.target===a.currentTarget&&U(),children:e.jsxs("div",{className:"card",style:{maxWidth:560,margin:"10vh auto"},children:[e.jsxs("div",{className:"card-header d-flex align-items-center justify-content-between",children:[e.jsx("h6",{className:"mb-0",children:"Message Vendor"}),e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:U,children:"Close"})]}),e.jsxs("form",{onSubmit:M,children:[e.jsxs("div",{className:"card-body",children:[b.err&&e.jsx("div",{className:"alert alert-danger py-2 mb-2",children:b.err}),b.done&&e.jsx("div",{className:"alert alert-success py-2 mb-2",children:"Sent"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Subject"}),e.jsx("input",{className:"form-control",value:b.subject,onChange:a=>C(o=>({...o,subject:a.target.value}))})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Message"}),e.jsx("textarea",{className:"form-control",rows:6,value:b.content,onChange:a=>C(o=>({...o,content:a.target.value}))}),e.jsxs("div",{className:"text-secondary small mt-1",children:["To: ",h?.email||c?.vendorId||"Vendor"]})]})]}),e.jsxs("div",{className:"card-footer d-flex justify-content-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:U,disabled:b.sending,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:b.sending||!b.content.trim(),children:b.sending?"Sendingâ€¦":"Send"})]})]})]})})]})}function De({items:s,onRestore:u}){return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header fw-semibold d-flex justify-content-between",children:[e.jsx("span",{children:"Version history"}),e.jsx("span",{className:"text-muted small",children:"Latest checkpoints"})]}),e.jsxs("div",{className:"list-group list-group-flush",children:[!s?.length&&e.jsxs("div",{className:"list-group-item text-muted small",children:["No checkpoints yet.",e.jsx("div",{className:"mt-1",children:"Offline cache keeps the two most recent checkpoints."})]}),s?.map(l=>e.jsx("div",{className:"list-group-item",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:l.message||"(no message)"}),e.jsx("div",{className:"text-muted small",children:Re(l.ts)}),e.jsxs("div",{className:"text-muted small",children:["Î” Cohorts: ",l.delta?.cohorts>=0?"+":"",l.delta?.cohorts??0," Â· Î” Courses:"," ",l.delta?.courses>=0?"+":"",l.delta?.courses??0," Â· Î” Lessons:"," ",l.delta?.lessons>=0?"+":"",l.delta?.lessons??0]})]}),e.jsxs("div",{className:"d-flex align-items-start gap-2",children:[e.jsx("button",{className:"btn btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6 btn-sm",title:"Restore snapshot to LIVE",onClick:()=>u(l.id),children:"Restore"}),e.jsx("a",{className:"btn btn-outline-secondary btn-sm",title:"Download snapshot JSON",href:`${me}/checkpoints/${l.id}`,target:"_blank",rel:"noreferrer",children:"Download"})]})]})},l.id))]})]})}export{Pe as default};
