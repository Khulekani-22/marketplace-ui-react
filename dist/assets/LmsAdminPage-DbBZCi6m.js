import{b as S,j as e}from"./index-Bn5LcKgl.js";import{r as m}from"./vendor-DW3XjTa1.js";import"./firebase-BBiW2ZCr.js";import"./utils-B2rxisVD.js";const V="lms_admin_draft_v1",_="lms_admin_undo_v1",B="lms_admin_history_cache_v1",y="/api/lms";function T(n){try{return typeof n=="string"?JSON.parse(n):n}catch{return null}}function N(n){return JSON.parse(JSON.stringify(n))}function he(n){return new Date(n).toLocaleString()}function ue(n){const o=Array.isArray(n?.cohorts)?n.cohorts.length:0,r=n?.cohorts?.reduce((h,a)=>h+(Array.isArray(a.courses)?a.courses.length:0),0)??0,d=n?.cohorts?.reduce((h,a)=>h+(Array.isArray(a.courses)?a.courses.reduce((p,x)=>p+(Array.isArray(x.lessons)?x.lessons.length:0),0):0),0)??0;return{cohorts:o,courses:r,lessons:d}}function Ce(){const n=m.useMemo(()=>sessionStorage.getItem("tenantId")||"vendor",[]),[o,r]=m.useState(()=>T(localStorage.getItem(V))??{cohorts:[],bookings:[],events:[],forumThreads:[],jobs:[],mentorshipSessions:[],messageThreads:[],services:[],leads:[],startups:[]}),[d,h]=m.useState(()=>JSON.stringify(o,null,2)),[a,p]=m.useState("visual"),[x,w]=m.useState(!1),[R,C]=m.useState(null),[D,v]=m.useState(null),k=m.useRef([]),[$,M]=m.useState(()=>T(localStorage.getItem(B))??[]),L=m.useMemo(()=>Array.isArray(o?.cohorts)?o.cohorts:[],[o]),[O,I]=m.useState(L[0]?.id??""),l=m.useMemo(()=>L.find(s=>s.id===O),[L,O]),[E,H]=m.useState(""),[u,U]=m.useState(null),j=m.useMemo(()=>l?.courses?.find(s=>s.id===u),[l,u]);function K(s){const t=T(localStorage.getItem(_))??[];t.unshift(s);const i=t.slice(0,10);localStorage.setItem(_,JSON.stringify(i)),k.current=i}function f(s){K(o),r(s),h(JSON.stringify(s,null,2)),localStorage.setItem(V,JSON.stringify(s))}function z(){const s=k.current.length?k.current:T(localStorage.getItem(_))??[];if(!s.length)return;const t=s.shift();k.current=s,localStorage.setItem(_,JSON.stringify(s)),r(t),h(JSON.stringify(t,null,2))}function A(s){C(s),setTimeout(()=>C(null),2500)}m.useEffect(()=>{(async()=>{try{w(!0);const{data:s}=await S.get(`${y}/live`,{headers:{"x-tenant-id":n,"cache-control":"no-cache"},suppressToast:!0,suppressErrorLog:!0});s&&(r(s),h(JSON.stringify(s,null,2)),localStorage.setItem(V,JSON.stringify(s)),I(s?.cohorts?.[0]?.id??"")),await J()}catch(s){console.warn("Init load failed:",s)}finally{w(!1)}})()},[]);async function J(){try{const{data:s}=await S.get(`${y}/checkpoints`,{headers:{"x-tenant-id":n,"cache-control":"no-cache"},suppressToast:!0,suppressErrorLog:!0}),t=Array.isArray(s?.items)?s.items:[];M(t),localStorage.setItem(B,JSON.stringify(t.slice(0,2)))}catch{}}async function Y(s){const t=s.target.files?.[0];if(t)try{const i=await t.text(),c=JSON.parse(i);f(c),A("Imported JSON into working copy")}catch{v("Invalid JSON file")}finally{s.target.value=""}}function q(){const s=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),t=URL.createObjectURL(s),i=document.createElement("a");i.download=`lms-working-copy-${Date.now()}.json`,i.href=t,i.click(),URL.revokeObjectURL(t)}async function G(){v(null),w(!0);try{await S.put(`${y}/publish`,{data:o},{headers:{"Content-Type":"application/json","x-tenant-id":n}}),A("Published to live"),await J()}catch(s){v(s.message||"Publish failed")}finally{w(!1)}}async function Q(s){v(null);try{await S.post(`${y}/checkpoints`,{message:s||"",data:o},{headers:{"Content-Type":"application/json","x-tenant-id":n}}),A("Checkpoint saved"),await J()}catch(t){v(t.message||"Failed to save checkpoint")}}async function X(s){if(window.confirm("Restore this snapshot to LIVE? This will overwrite appData.json."))try{await S.post(`${y}/restore/${s}`,null,{headers:{"x-tenant-id":n}}),A("Restored and published"),await J();try{const{data:t}=await S.get(`${y}/live`,{headers:{"x-tenant-id":n,"cache-control":"no-cache"},suppressToast:!0,suppressErrorLog:!0});t&&f(t)}catch{}}catch(t){v(t.message||"Restore failed")}}async function Z(){if(window.confirm("Clear ALL checkpoints on the server?"))try{await S.delete(`${y}/checkpoints`,{headers:{"x-tenant-id":n}}),A("Cleared history"),await J()}catch(s){v(s.message||"Failed to clear")}}function ee(){const s=prompt("Cohort name?");if(!s)return;const t=s.toLowerCase().replace(/\s+/g,"-"),i=N(o);i.cohorts=i.cohorts||[],i.cohorts.push({id:t,name:s,courses:[]}),f(i),I(t)}function se(){if(!l)return;const s=prompt("New cohort name:",l.name||"");if(!s)return;const t=N(o),i=t.cohorts.find(c=>c.id===l.id);i.name=s,f(t)}function te(){if(!l||!window.confirm(`Delete cohort "${l.name}"?`))return;const s=N(o);s.cohorts=s.cohorts.filter(t=>t.id!==l.id),f(s),I(s.cohorts[0]?.id??""),U(null)}function ne(){if(!l)return;const s=prompt("Course title?");if(!s)return;const t=(l.courses?.length||0)+1+"",i=N(o),c=i.cohorts.find(b=>b.id===l.id);c.courses=c.courses||[],c.courses.push({id:t,title:s,description:"",videoThumbnail:"",aiHint:"",lessons:[]}),f(i)}function oe(){if(!j||!l)return;const s=N(o),t=s.cohorts.find(c=>c.id===l.id),i=N(j);i.id=(t.courses.length+1).toString(),i.title=i.title+" (Copy)",t.courses.push(i),f(s)}function ie(){if(!j||!l||!window.confirm(`Delete "${j.title}"?`))return;const s=N(o),t=s.cohorts.find(i=>i.id===l.id);t.courses=t.courses.filter(i=>i.id!==j.id),f(s),U(null)}function ae(s,t){const i=N(o),b=i.cohorts.find(g=>g.id===l.id).courses.find(g=>g.id===j.id);b[s]=t,f(i)}function re(){if(!j)return;const s=prompt("Lesson title?");if(!s)return;const t=N(o),c=t.cohorts.find(g=>g.id===l.id).courses.find(g=>g.id===j.id);c.lessons=c.lessons||[];const b=c.lessons.length+1;c.lessons.push({id:`${c.id}-${String.fromCharCode(96+b)}`,title:s,duration:"15 min",completed:!1}),f(t)}function le(s,t){const i=N(o),b=i.cohorts.find(g=>g.id===l.id).courses.find(g=>g.id===j.id);b.lessons[s]={...b.lessons[s],...t},f(i)}function ce(s){if(!j)return;const t=N(o);t.cohorts.find(b=>b.id===l.id).courses.find(b=>b.id===j.id).lessons.splice(s,1),f(t)}const P=ue(o),de=l?.courses?.filter(s=>s.title.toLowerCase().includes(E.toLowerCase()))??[];return e.jsxs("div",{className:"container py-4",children:[e.jsx("style",{children:`
        .history-item{ padding: .75rem 1rem; }
        .item-actions{ opacity: 0; transition: opacity .15s ease; }
        .history-item:hover .item-actions{ opacity: 1; }
        .pill{ padding:.25rem .5rem; border-radius:9999px; font-weight:600; font-size:.75rem; }
        .pill-low{ background:#fde2e0; color:#b42318; }     /* red-ish */
        .pill-med{ background:#eadcfb; color:#5925dc; }    /* purple-ish */
        .pill-high{ background:#d1fadf; color:#067647; }   /* green-ish */
        .pill-none{ background:#e9ecef; color:#495057; }
        .icon{ width:20px; height:20px; margin-right:.5rem; opacity:.8 }
        .btn-icon{ width:36px; height:36px; display:inline-flex; align-items:center; justify-content:center; }
      `}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("h1",{className:"display-6 mb-0",children:"LMS Admin"}),e.jsxs("div",{className:"text-muted small",children:["Cohorts: ",P.cohorts," Â· Courses: ",P.courses," Â· Lessons: ",P.lessons]})]}),e.jsxs("p",{className:"text-secondary",children:["Manage cohorts, courses and lessons. Draft persists in ",e.jsx("code",{children:"localStorage"}),". Checkpoints live on the server (with a 2-item offline cache)."]}),e.jsxs("div",{className:"d-flex gap-2 mb-3",children:[e.jsxs("label",{className:"btn btn-light mb-0",children:["Import JSON",e.jsx("input",{type:"file",accept:"application/json",hidden:!0,onChange:Y})]}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:q,children:"Export Current"}),e.jsx("button",{className:"btn btn-success",onClick:G,disabled:x,title:"Write working copy to live appData.json on the server",children:x?"Publishingâ€¦":"Publish to live"})]}),R&&e.jsx("div",{className:"alert alert-success py-2",children:R}),D&&e.jsx("div",{className:"alert alert-danger py-2",children:D}),e.jsx(me,{onSave:Q,onClear:Z,onUndo:z,disabled:x}),e.jsxs("div",{className:"d-flex gap-3",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("ul",{className:"nav nav-tabs mb-3",children:[e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${a==="visual"?"active":""}`,onClick:()=>p("visual"),children:"Visual editor"})}),e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${a==="json"?"active":""}`,onClick:()=>p("json"),children:"JSON editor"})})]}),a==="json"?e.jsx(xe,{text:d,setText:h,onApply:()=>{const s=T(d);if(!s){v("Invalid JSON");return}f(s),A("Applied JSON to working copy")}}):e.jsx(pe,{data:o,cohortId:O,setCohortId:I,currentCohort:l,courseSearch:E,setCourseSearch:H,filteredCourses:de,selectedCourseId:u,setSelectedCourseId:U,selectedCourse:j,addCohort:ee,renameCohort:se,deleteCohort:te,addCourse:ne,duplicateCourse:oe,deleteCourse:ie,updateCourseField:ae,addLesson:re,updateLesson:le,deleteLesson:ce})]}),e.jsx("div",{style:{width:420},children:e.jsx(je,{items:$,onRestore:X})})]})]})}function me({onSave:n,onClear:o,onUndo:r,disabled:d}){const[h,a]=m.useState("");return e.jsx("div",{className:"card mb-3",children:e.jsxs("div",{className:"card-body d-flex align-items-center gap-2 py-2",children:[e.jsx(F,{className:"icon"}),e.jsx("input",{className:"form-control",placeholder:"Checkpoint message (e.g. 'Added AWS serverless module')",value:h,onChange:p=>a(p.target.value)}),e.jsx("button",{className:"btn btn-primary",onClick:()=>n(h),disabled:d,title:"Save checkpoint",children:"Save"}),e.jsx("button",{className:"btn btn-outline-secondary btn-icon",onClick:r,title:"Undo",children:"â†¶"}),e.jsx("button",{className:"btn btn-outline-danger btn-icon",onClick:o,title:"Clear history",children:"ðŸ—‘"})]})})}function xe({text:n,setText:o,onApply:r}){return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header fw-semibold",children:"Working copy (JSON)"}),e.jsxs("div",{className:"card-body",children:[e.jsx("textarea",{value:n,onChange:d=>o(d.target.value),rows:22,spellCheck:!1,className:"form-control font-monospace"}),e.jsxs("div",{className:"d-flex justify-content-between mt-2",children:[e.jsxs("small",{className:"text-muted",children:["Tip: Press ",e.jsx("kbd",{children:"âŒ˜/Ctrl"}),"+",e.jsx("kbd",{children:"A"})," then ",e.jsx("kbd",{children:"âŒ˜/Ctrl"}),"+",e.jsx("kbd",{children:"C"})," to copy."]}),e.jsx("button",{className:"btn btn-outline-primary",onClick:r,children:"Apply JSON"})]})]})]})}function pe(n){const{data:o,cohortId:r,setCohortId:d,currentCohort:h,courseSearch:a,setCourseSearch:p,filteredCourses:x,selectedCourseId:w,setSelectedCourseId:R,selectedCourse:C,addCohort:D,renameCohort:v,deleteCohort:k,addCourse:$,duplicateCourse:M,deleteCourse:L,updateCourseField:O,addLesson:I,updateLesson:l,deleteLesson:E}=n,H=o?.cohorts??[];return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header d-flex justify-content-between",children:[e.jsx("span",{className:"fw-semibold",children:"Visual editor"}),e.jsx("span",{className:"text-muted small",children:"Friendly CRUD for cohorts, courses & lessons"})]}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2 mb-3",children:[e.jsx("label",{className:"fw-medium me-2",children:"Cohort"}),e.jsx("select",{className:"form-select",style:{maxWidth:320},value:r,onChange:u=>d(u.target.value),children:H.map(u=>e.jsx("option",{value:u.id,children:u.name||u.id},u.id))}),e.jsx("button",{className:"btn btn-outline-primary",onClick:D,children:"+ Add cohort"}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:v,disabled:!h,children:"Rename"}),e.jsx("button",{className:"btn btn-outline-danger",onClick:k,disabled:!h,children:"Delete"})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-4",children:[e.jsx("label",{className:"fw-medium",children:"Courses"}),e.jsx("input",{className:"form-control mb-2",placeholder:"Search",value:a,onChange:u=>p(u.target.value)}),e.jsxs("div",{className:"list-group mb-2",style:{maxHeight:360,overflow:"auto"},children:[x.map(u=>e.jsx("button",{className:"list-group-item list-group-item-action "+(w===u.id?"active":""),onClick:()=>R(u.id),children:u.title},u.id)),!x.length&&e.jsx("div",{className:"text-muted small p-2",children:"No courses."})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-outline-primary",onClick:$,disabled:!h,children:"+ Add course"}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:M,disabled:!C,children:"Duplicate"}),e.jsx("button",{className:"btn btn-outline-danger",onClick:L,disabled:!C,children:"Delete"})]})]}),e.jsx("div",{className:"col",children:C?e.jsx(fe,{course:C,updateCourseField:O,addLesson:I,updateLesson:l,deleteLesson:E}):e.jsx("div",{className:"text-muted mt-2",children:"Select a course to edit details and lessons."})})]})]})]})}function fe({course:n,updateCourseField:o,addLesson:r,updateLesson:d,deleteLesson:h}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Title"}),e.jsx("input",{className:"form-control",value:n.title||"",onChange:a=>o("title",a.target.value)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("textarea",{className:"form-control",rows:3,value:n.description||"",onChange:a=>o("description",a.target.value)})]}),e.jsxs("div",{className:"row g-3 mb-3",children:[e.jsxs("div",{className:"col",children:[e.jsx("label",{className:"form-label",children:"Video thumbnail URL"}),e.jsx("input",{className:"form-control",value:n.videoThumbnail||"",onChange:a=>o("videoThumbnail",a.target.value)})]}),e.jsxs("div",{className:"col",children:[e.jsx("label",{className:"form-label",children:"AI hint (optional)"}),e.jsx("input",{className:"form-control",value:n.aiHint||"",onChange:a=>o("aiHint",a.target.value)})]})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsx("h6",{className:"mb-2",children:"Lessons"}),e.jsx("button",{className:"btn btn-outline-primary btn-sm",onClick:r,children:"+ Add lesson"})]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:80},children:"ID"}),e.jsx("th",{children:"Title"}),e.jsx("th",{style:{width:120},children:"Duration"}),e.jsx("th",{style:{width:100},children:"Completed"}),e.jsx("th",{style:{width:70}})]})}),e.jsxs("tbody",{children:[n.lessons?.map((a,p)=>e.jsxs("tr",{children:[e.jsx("td",{children:a.id}),e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm",value:a.title||"",onChange:x=>d(p,{title:x.target.value})})}),e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm",value:a.duration||"",onChange:x=>d(p,{duration:x.target.value})})}),e.jsx("td",{children:e.jsx("input",{type:"checkbox",className:"form-check-input",checked:!!a.completed,onChange:x=>d(p,{completed:!!x.target.checked})})}),e.jsx("td",{className:"text-end",children:e.jsx("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>h(p),children:"Delete"})})]},a.id||p)),!n.lessons?.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-muted small",children:"No lessons yet."})})]})]})})]})}function je({items:n,onRestore:o}){return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header fw-semibold d-flex justify-content-between",children:[e.jsx("span",{children:"Version history"}),e.jsx("span",{className:"text-muted small",children:"Showing latest checkpoints"})]}),n?.length?e.jsx("div",{className:"list-group list-group-flush",children:n.map(r=>{const d=be(r.delta);return e.jsx("div",{className:"list-group-item history-item",children:e.jsxs("div",{className:"d-flex align-items-start justify-content-between gap-3",children:[e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx(F,{className:"icon"}),e.jsxs("div",{className:"text-truncate",style:{maxWidth:220},children:[e.jsx("div",{className:"fw-semibold text-truncate",children:r.message||"(no message)"}),e.jsx("div",{className:"text-muted small",children:he(r.ts)}),e.jsxs("div",{className:"text-muted small",children:["Î” Cohorts: ",W(r.delta?.cohorts)," Â· Î” Courses: ",W(r.delta?.courses)," Â· Î” Lessons: ",W(r.delta?.lessons)]})]})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("span",{className:`pill ${d.className}`,children:d.label}),e.jsxs("div",{className:"item-actions",children:[e.jsx("button",{className:"btn btn-outline-primary btn-sm",title:"Restore snapshot to LIVE",onClick:()=>o(r.id),children:"Restore"}),e.jsx("a",{className:"btn btn-outline-secondary btn-sm ms-1",title:"Download snapshot JSON",href:`${y}/checkpoints/${r.id}`,target:"_blank",rel:"noreferrer",children:"Download"})]})]})]})},r.id)})}):e.jsx("div",{className:"list-group list-group-flush",children:e.jsxs("div",{className:"list-group-item text-muted small",children:["No checkpoints yet.",e.jsx("div",{className:"mt-1",children:"Offline cache keeps the two most recent checkpoints."})]})})]})}function W(n){const o=Number(n||0);return(o>=0?"+":"")+o}function be(n){const o=Math.abs(n?.cohorts||0)+Math.abs(n?.courses||0)+Math.abs(n?.lessons||0);return o===0?{label:"No change",className:"pill-none"}:o<=2?{label:"Low",className:"pill-low"}:o<=5?{label:"Medium",className:"pill-med"}:{label:"High",className:"pill-high"}}function F({className:n}){return e.jsxs("svg",{className:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[e.jsx("circle",{cx:"12",cy:"12",r:"9",strokeWidth:"1.6"}),e.jsx("path",{d:"M12 7v5l3 2",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})]})}export{Ce as default};
