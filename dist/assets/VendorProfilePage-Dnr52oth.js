import{m as ne,i as ie,a as j,c as h,j as e,M as oe,w as le}from"./index-D_DTgdmv.js";import{r as d}from"./vendor-DW3XjTa1.js";import"./firebase-ARhtPVQA.js";import"./utils-B2rxisVD.js";const L="/api/lms",O="vendor_profile_working_v1",T="vendor_profile_undo_v1",Q="vendor_profile_history_cache_v1";function R(a){try{return typeof a=="string"?JSON.parse(a):a}catch{return null}}function D(a){return JSON.parse(JSON.stringify(a))}function Z(){return Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,8)}function X(a){const l=new Date(a);return isNaN(l)?"—":l.toLocaleString()}function ce(a){const l=(a?.contactEmail||a?.email||"").toLowerCase();return{id:String(a?.vendorId||a?.id||""),name:a?.name||"",contactEmail:l,ownerUid:a?.ownerUid||"",phone:a?.phone||"",website:a?.website||"",description:a?.description||"",logoUrl:a?.logoUrl||a?.logo||"",bannerUrl:a?.bannerUrl||"",country:a?.country||"",city:a?.city||"",addressLine:a?.addressLine||"",socials:{twitter:a?.socials?.twitter||"",linkedin:a?.socials?.linkedin||"",facebook:a?.socials?.facebook||"",instagram:a?.socials?.instagram||"",youtube:a?.socials?.youtube||"",github:a?.socials?.github||""},categories:Array.isArray(a?.categories)?a.categories:[],tags:Array.isArray(a?.tags)?a.tags:[],foundedYear:a?.foundedYear||"",teamSize:a?.teamSize||"",registrationNo:a?.registrationNo||"",status:(a?.status||"pending").toLowerCase(),kycStatus:a?.kycStatus||"pending"}}function F(a,l={}){const v=(a?.email||a?.contactEmail||l.email||"").toLowerCase(),p=a?.socials??{};return{id:String(a?.id??a?.vendorId??l.vendorId??Z()),vendorId:String(a?.vendorId??a?.id??l.vendorId??""),name:a?.name??a?.companyName??a?.vendor??l.name??"",contactEmail:v,ownerUid:a?.ownerUid??a?.uid??l.uid??"",website:a?.website??"",phone:a?.phone??"",country:a?.country??"",city:a?.city??"",addressLine:a?.addressLine??"",logoUrl:a?.logoUrl??a?.logo??"",bannerUrl:a?.bannerUrl??"",description:a?.description??"",categories:Array.isArray(a?.categories)?a.categories:[],tags:Array.isArray(a?.tags)?a.tags:[],foundedYear:a?.foundedYear??"",teamSize:a?.teamSize??"",registrationNo:a?.registrationNo??"",status:(a?.status||"pending").toLowerCase(),socials:{twitter:p.twitter??"",linkedin:p.linkedin??"",facebook:p.facebook??"",instagram:p.instagram??"",youtube:p.youtube??"",github:p.github??""},lastUpdated:a?.lastUpdated??""}}function de(a,l){if(!a)return null;const v=(l?.email||"").toLowerCase(),p=[Array.isArray(a.startups)&&a.startups,Array.isArray(a.vendors)&&a.vendors,Array.isArray(a.companies)&&a.companies,Array.isArray(a.profiles)&&a.profiles].filter(Boolean);for(const N of p){const w=N.find(m=>m?.ownerUid&&m.ownerUid===l?.uid||m?.email&&String(m.email).toLowerCase()===v||m?.contactEmail&&String(m.contactEmail).toLowerCase()===v||l?.vendorId&&(String(m?.vendorId)===String(l.vendorId)||String(m?.id)===String(l.vendorId)));if(w)return F(w,l)}return null}function ge(){const{vendor:a,ensureVendorId:l,refresh:v}=ne(),p=d.useMemo(()=>sessionStorage.getItem("tenantId")||"vendor",[]),[N,w]=d.useState(()=>R(localStorage.getItem(O))??{startups:[],vendors:[],companies:[],services:[]}),m=ie(sessionStorage.getItem("role")),[z,B]=d.useState(()=>m?R(localStorage.getItem(Q))??[]:[]),[y,U]=d.useState(!1),[J,b]=d.useState(""),[$,S]=d.useState(""),[M,H]=d.useState(""),[q,ee]=d.useState(!0),C=d.useRef([]),E=d.useCallback(s=>{const r=[s,...C.current||[]].slice(0,10);C.current=r,localStorage.setItem(T,JSON.stringify(r))},[]),G=d.useCallback(()=>{const s=C.current?.length?C.current:R(localStorage.getItem(T))??[];if(!s.length)return;const r=s.shift();C.current=s,localStorage.setItem(T,JSON.stringify(s)),w(r),localStorage.setItem(O,JSON.stringify(r))},[]),I=d.useCallback(s=>{w(r=>(E(r),localStorage.setItem(O,JSON.stringify(s)),s))},[E]),k=d.useCallback(async()=>{if(!m){B([]);return}try{const{data:s}=await j.get(`${L}/checkpoints`,{headers:{"x-tenant-id":p,"cache-control":"no-cache"}}),r=Array.isArray(s?.items)?s.items:[];B(r),localStorage.setItem(Q,JSON.stringify(r.slice(0,2)))}catch{}},[m,p]);d.useEffect(()=>{let s=!0;return(async()=>{U(!0);try{await l();let r={startups:[],vendors:[],companies:[],services:[]};try{const{data:c}=await j.get(`${L}/live`,{headers:{"x-tenant-id":p,"cache-control":"no-cache"}});s&&c&&(r=c)}catch{}try{const c=await j.get("/api/data/vendors").then(g=>g.data||[]),n=D(r);n.startups=Array.isArray(n.startups)?n.startups:[],c.forEach(g=>{const x=F(g),i=n.startups.findIndex(W=>String(W.vendorId||W.id)===x.vendorId);i>=0?n.startups[i]={...n.startups[i],...x}:n.startups.push(x)}),r=n}catch{}I(r),m&&await k()}catch{}finally{s&&U(!1)}})(),()=>{s=!1}},[p,m,l,I,k]);const f=d.useMemo(()=>{const s={uid:h.currentUser?.uid,email:h.currentUser?.email||a?.email||"",name:h.currentUser?.displayName||a?.name||"",vendorId:a?.vendorId||""};return de(N,s)||F({},s)},[N,a?.vendorId,h.currentUser?.uid,h.currentUser?.email]),[t,A]=d.useState(()=>f);d.useEffect(()=>{A(f)},[f]);const o=!h.currentUser,_=(f?.status||"").toLowerCase(),P=(f?.kycStatus||"").toLowerCase(),V=_==="active"||P==="approved",ae=_==="pending"||P==="pending",Y=_==="suspended"||P==="rejected";function u(s,r){A(c=>({...c,[s]:r}))}function se(s,r){A(c=>({...c,socials:{...c.socials,[s]:r}}))}async function te(s){if(!m){b("Only administrators can save checkpoints.");return}try{await j.post(`${L}/checkpoints`,{message:s||"Vendor profile update",data:N},{headers:{"Content-Type":"application/json","x-tenant-id":p}}),S("Checkpoint saved"),await k(),H("")}catch(r){b(r?.message||"Failed to save checkpoint")}}async function K(){if(b(""),S(""),o){b("You need to sign in first.");return}if(!t.name.trim()){b("Vendor name is required.");return}const s=D(N);E(s);const r=D(N);r.startups=Array.isArray(r.startups)?r.startups:[];const c=String(t.vendorId||t.id||a?.vendorId||h.currentUser?.uid||Z()),n=(t.contactEmail||h.currentUser?.email||"").toLowerCase(),g={...t,id:c,vendorId:c,ownerUid:h.currentUser?.uid||t.ownerUid||"",contactEmail:n,email:n,lastUpdated:new Date().toISOString()},x=r.startups.findIndex(i=>String(i.vendorId)===c||String(i.id)===c||i.email&&String(i.email).toLowerCase()===n);x>=0?r.startups[x]={...r.startups[x],...g}:r.startups.push(g),q&&Array.isArray(r.services)&&(r.services=r.services.map(i=>String(i.vendorId||"")===c?{...i,vendor:g.name}:i));try{U(!0);const i=ce(g);i.id?await j.put(`/api/data/vendors/${encodeURIComponent(i.id)}`,i):await j.post("/api/data/vendors",i);try{await le({action:"VENDOR_UPSERT",userEmail:h.currentUser?.email,targetType:"vendor",targetId:c,metadata:{name:g.name}})}catch{}I(r),S("Profile saved to live."),await v?.(),await k(),window.scrollTo({top:0,behavior:"smooth"})}catch(i){b(i?.message||"Save failed"),I(s)}finally{U(!1)}}async function re(){b(""),S("");try{const s=h.currentUser;if(!s)throw new Error("Please sign in");const r=(s.email||"").toLowerCase(),n=(await j.get("/api/data/startups").then(i=>i.data||[])).find(i=>i.ownerUid&&i.ownerUid===s.uid||(i.contactEmail||i.email||"").toLowerCase()===r);if(!n){b("No startup profile found to import.");return}const g=[n.elevatorPitch||"",n.productsServices||""].filter(Boolean).join(`

`),x={...t,name:t.name||n.name||"",description:t.description||g,contactEmail:(t.contactEmail||n.contactEmail||r).toLowerCase(),phone:t.phone||n.phone||"",website:t.website||n.website||"",country:t.country||n.country||"",city:t.city||n.city||"",addressLine:t.addressLine||n.addressLine||"",categories:t.categories?.length?t.categories:Array.isArray(n.categories)?n.categories:[],tags:t.tags?.length?t.tags:Array.isArray(n.tags)?n.tags:[],teamSize:t.teamSize||String(n.employeeCount||"")};A(x),S("Imported details from your Startup profile. Review and Save changes."),window.scrollTo({top:0,behavior:"smooth"})}catch(s){b(s?.response?.data?.message||s?.message||"Import failed")}}return e.jsx(oe,{children:e.jsxs("div",{className:"container py-4",style:{maxWidth:980},children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"h4 mb-0",children:"My Vendor Profile"}),e.jsxs("div",{className:"text-muted small",children:["Signed in as"," ",e.jsx("strong",{children:f.name||h.currentUser?.displayName||"Vendor"})," ","· ",f.contactEmail||h.currentUser?.email||"email not set",e.jsx("span",{className:`badge ms-2 text-bg-${V?"success":Y?"danger":"warning"}`,children:V?"Approved":Y?"Suspended":"Pending"})]}),e.jsxs("div",{className:"text-muted small",children:["Vendor ID:"," ",f.vendorId?e.jsx("code",{children:f.vendorId}):"pending"]}),V&&e.jsxs("div",{className:"alert alert-success mt-3 mb-0",children:["Your vendor account is approved. You can now submit listings to the marketplace.",e.jsxs("div",{className:"mt-2 d-flex gap-2",children:[e.jsx("a",{className:"btn btn-primary btn-sm",href:"/listings-vendors",children:"+ Submit new listing"}),e.jsx("a",{className:"btn btn-outline-secondary btn-sm",href:"/listings-vendors-mine",children:"View my listings"})]})]}),ae&&e.jsx("div",{className:"alert alert-warning mt-3 mb-0",children:"Your vendor account is pending approval. Please complete your profile details and wait for an admin to approve your account. You’ll be able to submit listings once approved."}),Y&&e.jsx("div",{className:"alert alert-danger mt-3 mb-0",children:"Your vendor account is suspended. You cannot submit listings. Please contact support if you believe this is an error."})]}),e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn btn-outline-secondary",onClick:G,disabled:y,children:"Undo"}),e.jsx("button",{className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:K,disabled:y||o,title:"Save changes to live",children:y?"Saving…":"Save changes"})]})]}),o&&e.jsx("div",{className:"alert alert-warning",children:"Please sign in to manage your vendor profile."}),J&&e.jsx("div",{className:"alert alert-danger",children:J}),$&&e.jsx("div",{className:"alert alert-success",children:$}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-lg-8",children:[e.jsx("div",{className:"d-flex justify-content-end mb-2",children:e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:re,disabled:y||o,title:"Import company details from your Startup profile",children:"Import from Startup Profile"})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header fw-semibold",children:"Company details"}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsx("label",{className:"form-label",children:"Company / Vendor name"}),e.jsx("input",{className:"form-control",value:t.name,onChange:s=>u("name",s.target.value),placeholder:"e.g., Acme Studio",disabled:o,required:!0})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Contact email"}),e.jsx("input",{className:"form-control",value:t.contactEmail,onChange:s=>u("contactEmail",s.target.value.toLowerCase()),placeholder:"you@company.com",disabled:o})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Website"}),e.jsx("input",{className:"form-control",value:t.website,onChange:s=>u("website",s.target.value),placeholder:"https://…",disabled:o})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Phone"}),e.jsx("input",{className:"form-control",value:t.phone,onChange:s=>u("phone",s.target.value),placeholder:"+27…",disabled:o})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Founded (year)"}),e.jsx("input",{className:"form-control",value:t.foundedYear,onChange:s=>u("foundedYear",s.target.value),placeholder:"2021",disabled:o})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Country"}),e.jsx("input",{className:"form-control",value:t.country,onChange:s=>u("country",s.target.value),placeholder:"South Africa",disabled:o})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"City"}),e.jsx("input",{className:"form-control",value:t.city,onChange:s=>u("city",s.target.value),placeholder:"Cape Town",disabled:o})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Team size"}),e.jsx("input",{className:"form-control",value:t.teamSize,onChange:s=>u("teamSize",s.target.value),placeholder:"1–10",disabled:o})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Company reg. number"}),e.jsx("input",{className:"form-control",value:t.registrationNo,onChange:s=>u("registrationNo",s.target.value),placeholder:"(optional)",disabled:o})]}),e.jsxs("div",{className:"col-md-6 d-none",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsxs("select",{className:"form-select",value:t.status,onChange:s=>u("status",s.target.value),disabled:o,children:[e.jsx("option",{value:"active",children:"active"}),e.jsx("option",{value:"pending",children:"pending"}),e.jsx("option",{value:"suspended",children:"suspended"})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Logo URL"}),e.jsx("input",{className:"form-control",value:t.logoUrl,onChange:s=>u("logoUrl",s.target.value),placeholder:"https://…",disabled:o})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Banner URL"}),e.jsx("input",{className:"form-control",value:t.bannerUrl,onChange:s=>u("bannerUrl",s.target.value),placeholder:"https://…",disabled:o})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("textarea",{className:"form-control",rows:4,value:t.description,onChange:s=>u("description",s.target.value),placeholder:"Tell buyers what you do, problems you solve, and why you're different.",disabled:o})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Categories (comma-separated)"}),e.jsx("input",{className:"form-control",value:t.categories.join(", "),onChange:s=>u("categories",s.target.value.split(",").map(r=>r.trim()).filter(Boolean)),placeholder:"Design, Branding",disabled:o})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Tags (comma-separated)"}),e.jsx("input",{className:"form-control",value:t.tags.join(", "),onChange:s=>u("tags",s.target.value.split(",").map(r=>r.trim()).filter(Boolean)),placeholder:"logos, identity, saas",disabled:o})]}),e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"row g-3",children:[["twitter","Twitter"],["linkedin","LinkedIn"],["facebook","Facebook"],["instagram","Instagram"],["youtube","YouTube"],["github","GitHub"]].map(([s,r])=>e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:r}),e.jsx("input",{className:"form-control",value:t.socials[s],onChange:c=>se(s,c.target.value),placeholder:`https://${s}.com/...`,disabled:o})]},s))})}),e.jsxs("div",{className:"col-12 d-flex align-items-center gap-2",children:[e.jsx("input",{id:"propagateName",type:"checkbox",className:"form-check-input",checked:q,onChange:s=>ee(!!s.target.checked),disabled:o}),e.jsx("label",{htmlFor:"propagateName",className:"form-check-label",children:"Update my display name on all existing listings"})]}),e.jsxs("div",{className:"col-12 d-flex gap-2 mt-2",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:G,disabled:y,children:"Undo"}),e.jsx("button",{type:"button",className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:K,disabled:y||o,children:y?"Saving…":"Save changes"})]}),t.lastUpdated&&e.jsxs("div",{className:"form-text mt-1",children:["Last updated: ",X(t.lastUpdated)]})]})})]})]}),e.jsxs("div",{className:"col-lg-4",children:[e.jsxs("div",{className:"card mb-3",children:[e.jsx("div",{className:"card-header fw-semibold",children:"Preview"}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsx("img",{src:t.logoUrl||"/assets/images/placeholder-1x1.png",alt:"logo",style:{width:64,height:64,objectFit:"cover",borderRadius:8}}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:t.name||"Vendor"}),e.jsx("div",{className:"text-muted small",children:t.contactEmail||h.currentUser?.email||"email"}),e.jsx("div",{className:"small",children:t.website?e.jsx("a",{href:t.website,target:"_blank",rel:"noreferrer",children:t.website}):"website"})]})]}),t.bannerUrl&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:t.bannerUrl,alt:"banner",className:"w-100",style:{maxHeight:140,objectFit:"cover",borderRadius:8}})}),e.jsxs("div",{className:"mt-3 small text-muted",children:["Categories: ",t.categories.join(", ")||"—",e.jsx("br",{}),"Tags: ",t.tags.join(", ")||"—"]})]})]}),m&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header fw-semibold d-flex align-items-center justify-content-between",children:e.jsx("span",{children:"Version control"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex gap-2 mb-2",children:[e.jsx("input",{className:"form-control",placeholder:"Checkpoint message",value:M,onChange:s=>H(s.target.value)}),e.jsx("button",{className:"btn btn-outline-primary",onClick:()=>te(M),disabled:y||o,children:"Save checkpoint"})]}),e.jsxs("div",{className:"list-group list-group-flush",children:[!z?.length&&e.jsx("div",{className:"text-muted small",children:"No checkpoints yet. Create one after saving changes."}),z?.slice(0,6).map(s=>e.jsxs("div",{className:"list-group-item",children:[e.jsx("div",{className:"fw-semibold",children:s.message||"(no message)"}),e.jsx("div",{className:"text-muted small",children:X(s.ts)}),e.jsx("div",{className:"d-flex gap-2 mt-1",children:e.jsx("a",{className:"btn btn-sm btn-outline-secondary",href:`${L}/checkpoints/${s.id}`,target:"_blank",rel:"noreferrer",children:"Download snapshot"})})]},s.id))]}),e.jsx("div",{className:"form-text mt-2",children:"Checkpoints snapshot the whole marketplace data (including your profile) on the server."})]})]})]})]})]})})}export{ge as default};
