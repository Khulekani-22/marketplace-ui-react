import{v as Se,b as E,c as Ee,B as k,j as s}from"./index-C5j_b7F9.js";import{r as o,L as ke}from"./vendor-5dkO6nAt.js";import{I as j}from"./MasterLayout-Dn-yiizh.js";function B(t,c=80){return t?t.length>c?`${t.slice(0,c)}â€¦`:t:""}function G(t){return`https://ui-avatars.com/api/?name=${encodeURIComponent(t||"User")}&background=059669&color=fff`}function J(t){const c=t?.from||{},y=t?.timestamp||t?.date||new Date().toISOString();return{id:String(t?.id||y),senderId:c?.uid||c?.email,senderName:c?.name||c?.email||"User",senderEmail:c?.email,senderRole:c?.type,senderAvatar:c?.avatar,content:(t?.content??"").toString(),timestamp:y}}function K(t,c){const y=Array.isArray(t?.messages)?t.messages:[],b=t?.context||c||{},d=y.map(i=>{const A=i?.senderRole||i?.role;let N=i?.senderEmail||i?.email;if(!N){const m=(A||"").toLowerCase();m==="admin"&&b.adminEmail&&(N=b.adminEmail),m==="vendor"&&b.vendorEmail&&(N=b.vendorEmail),m==="subscriber"&&b.subscriberEmail&&(N=b.subscriberEmail)}const l=i?.date||i?.timestamp||i?.createdAt||new Date().toISOString();return{id:String(i?.id||i?.messageId||l),senderId:i?.senderId||i?.sender?.id,senderName:i?.senderName||i?.sender?.name||i?.senderId||"User",senderEmail:N,senderRole:A,senderAvatar:i?.senderAvatar||i?.sender?.avatar,content:(i?.content??i?.text??"").toString(),timestamp:l}});return d.sort((i,A)=>new Date(i.timestamp).getTime()-new Date(A.timestamp).getTime()),d}function be(t){const c=new Map;t.forEach(b=>{if(!b)return;const d=String(b.threadId||b.id||b.subject||`legacy-${Date.now()}`);c.has(d)||c.set(d,[]),c.get(d).push(b)});const y=[];for(const[b,d]of c.entries()){d.sort((l,m)=>new Date(l?.timestamp||l?.date||0).getTime()-new Date(m?.timestamp||m?.date||0).getTime());const i=d[0],A=d[d.length-1]||i,N=[];i?.from&&N.push({id:i.from.uid||i.from.email||i.from.name,name:i.from.name||i.from.email,email:i.from.email,role:i.from.type}),i?.to&&N.push({id:i.to.uid||i.to.email||i.to.name,name:i.to.name||i.to.email,email:i.to.email,role:i.to.type}),y.push({id:b,kind:"legacy",subject:A?.subject||i?.subject||"Conversation",lastMessageSnippet:B(A?.content||""),lastMessageAt:A?.timestamp||A?.date,participants:N,legacy:{user1:N[0]?.email,user2:N[1]?.email},raw:d})}return y}function De(t){const c=Array.isArray(t?.messages)?[...t.messages]:[],y=t?.lastMessage||c[c.length-1]||{},b=Array.isArray(t?.participants)?t.participants.map(m=>({id:m?.id||m?.email||m?.name,name:m?.name||m?.id||"Participant",email:m?.email,role:m?.role})):[],d=t?.context||{},i={id:String(t?.id||t?.threadId||d.threadId||`thread-${Date.now()}`),kind:"thread",subject:t?.subject||d.listingTitle||d.serviceTitle||"Conversation",lastMessageSnippet:B(t?.lastMessage?.snippet||y?.snippet||y?.content||""),lastMessageAt:y?.date||y?.timestamp||t?.updatedAt||t?.createdAt,unreadCount:typeof t?.unreadCount=="number"?t.unreadCount:void 0,participants:b,context:d,raw:t},A=d.vendorEmail,N=d.adminEmail,l=d.subscriberEmail;if(A){const m=i.participants.find(P=>(P?.role||"").toLowerCase()==="vendor"||(P?.id||"").startsWith("vendor:"));m&&!m.email&&(m.email=A)}if(N){const m=i.participants.find(P=>(P?.role||"").toLowerCase()==="admin");m&&!m.email&&(m.email=N)}if(l){const m=i.participants.find(P=>(P?.role||"").toLowerCase()==="subscriber");m&&!m.email&&(m.email=l)}return i}const Xe=({userEmail:t,userName:c})=>{const[y,b]=o.useState([]),[d,i]=o.useState([]),[A,N]=o.useState("inbox"),[l,m]=o.useState(null),[P,D]=o.useState([]),[h,he]=o.useState(()=>{try{return Se()}catch{return null}}),[ge,Z]=o.useState(!0),[w,ee]=o.useState(!1),[C,se]=o.useState(""),[F,T]=o.useState(!1),[R,O]=o.useState(""),[z,ae]=o.useState(""),[ie,te]=o.useState(!1),[ne,re]=o.useState([]),[V,oe]=o.useState(""),[xe,U]=o.useState(!1);o.useEffect(()=>{F&&E.get("/api/users/all-contacts").then(e=>re(e.data.items||[])).catch(()=>re([]))},[F]);const le=o.useRef(null),me=o.useCallback(()=>{le.current?.scrollIntoView({behavior:"smooth"})},[]);o.useEffect(()=>{me()},[P,me]),o.useEffect(()=>{Ee().then(e=>he(e)).catch(()=>{})},[]),o.useEffect(()=>{if(t&&d.length){const e=d.find(a=>a.email&&a.email.toLowerCase()===t.toLowerCase());m(e||{id:`direct:${t}`,threadId:"",name:c||t,email:t,avatar:G(c||t),status:"Direct Message",type:"thread",lastMessageSnippet:"",lastMessageAt:void 0,unreadCount:0,thread:{id:"",kind:"thread",subject:c||t,lastMessageSnippet:"",participants:[{name:c||t,email:t},{name:h&&typeof h=="object"&&"name"in h&&typeof h.name=="string"?h.name:"",email:h?.email||void 0}],context:{},raw:{}},isInbox:!0,isSent:!1})}},[t,c,d,h]);const ce=o.useCallback(e=>{const a=(h?.email||"").toLowerCase(),r=(h?.uid||"").toLowerCase(),u=n=>{if(!n)return"";const x=n.toLowerCase(),v=x.split(":");return v[v.length-1]||x},g=n=>{const x=Array.isArray(n?.messages)?n.messages:Array.isArray(n)?n:[];let v=!1,L=!1;for(const p of x){const Q=(p?.senderEmail||p?.email||p?.from?.email||"").toLowerCase(),Y=(p?.senderId||p?.sender?.id||p?.from?.uid||p?.from?.id||"").toString().toLowerCase(),$=u(p?.senderId||p?.sender?.id||p?.from?.uid||p?.from?.id||null),S=[],_=[p?.recipientEmail,p?.receiverEmail,p?.toEmail,p?.targetEmail,p?.to?.email,p?.recipient?.email,p?.to?.[0]?.email,p?.recipients?.[0]?.email];for(const f of _)typeof f=="string"&&f.includes("@")&&S.push(f.toLowerCase());if(Array.isArray(p?.to))for(const f of p.to)typeof f=="string"&&f.includes("@")?S.push(f.toLowerCase()):f&&typeof f=="object"&&typeof f.email=="string"&&S.push(f.email.toLowerCase());if(Array.isArray(p?.recipients))for(const f of p.recipients)typeof f=="string"&&f.includes("@")?S.push(f.toLowerCase()):f&&typeof f=="object"&&typeof f.email=="string"&&S.push(f.email.toLowerCase());a&&Q===a&&(v=!0),r&&$&&($===r||Y.endsWith(`:${r}`))&&(v=!0),a&&S.includes(a)&&(L=!0)}return{hasSent:v,matchesInbox:L}};return e.map(n=>{const x=n.participants||[],v=x.map(M=>(M?.email||"").toLowerCase()).filter(Boolean),L=x.map(M=>u(M?.id)).filter(Boolean),p=x.map(M=>(M?.id||"").toLowerCase()).filter(Boolean),{hasSent:Q,matchesInbox:Y}=g(n.raw),$=Object.values(n.context||{}).flatMap(M=>typeof M=="string"&&M.includes("@")?[M.toLowerCase()]:[]).filter(Boolean),_=!!a&&v.includes(a)||!!r&&(L.some(M=>M===r)||p.some(M=>M.endsWith(`:${r}`)))||!!a&&$.includes(a)||Y,f=Q;let I=x.find(M=>(M?.email||"").toLowerCase()!==a);!I&&x.length&&(I=x[0]);const pe=I?.name||I?.email||n.subject||"Conversation",ve=I?.email||(n.legacy?[n.legacy.user1,n.legacy.user2].find(M=>(M||"").toLowerCase()!==a):void 0),Pe=G(pe),fe=(n.kind==="thread"?n.context?.type||"active":"legacy conversation").replace(/[-_]/g," ");return{id:`${n.kind}:${n.id}`,threadId:n.id,name:pe,email:ve,avatar:Pe,status:fe.charAt(0).toUpperCase()+fe.slice(1),type:n.kind,lastMessageSnippet:B(n.lastMessageSnippet||""),lastMessageAt:n.lastMessageAt,unreadCount:n.unreadCount,thread:n,isInbox:_,isSent:f}}).sort((n,x)=>{const v=n.lastMessageAt?new Date(n.lastMessageAt).getTime():0;return(x.lastMessageAt?new Date(x.lastMessageAt).getTime():0)-v})},[h]),X=o.useCallback(async({silent:e=!1}={})=>{e||Z(!0);try{const r=(await E.get("/api/messages",{params:{limit:100}})).data;let u=[];Array.isArray(r?.items)?u=r.items.map(De):Array.isArray(r?.messages)?u=be(r.messages):Array.isArray(r)&&(u=be(r)),b(u);const g=ce(u);return i(g),g}catch(a){if(console.error("Error fetching messages:",a),!e){const r=a?.response?.data?.message||"Failed to load messages";k.error(r)}return b([]),i([]),[]}finally{e||Z(!1)}},[ce]);o.useEffect(()=>{X()},[X]);const W=o.useCallback(async e=>{if(m(e),e.type==="thread"){if(!e.threadId){D([]);return}try{const a=await E.get(`/api/messages/${e.threadId}`),r=a.data&&a.data.id?a.data:e.thread.raw,u=K(r,e.thread.context);D(u)}catch(a){console.error("Error fetching thread conversation:",a);const r=K(e.thread.raw,e.thread.context);D(r),k.error("Unable to refresh conversation; showing cached messages.")}}else{const a=e.thread.legacy?.user1,r=e.thread.legacy?.user2||e.email;if(!a||!r){D([]);return}try{const u=await E.get("/api/messages/conversation",{params:{user1:a,user2:r,limit:100}}),n=(Array.isArray(u.data?.conversation)?u.data.conversation:[]).map(J).sort((x,v)=>new Date(x.timestamp).getTime()-new Date(v.timestamp).getTime());D(n)}catch(u){console.error("Error fetching legacy conversation:",u),k.error("Unable to load conversation");const g=Array.isArray(e.thread.raw)?e.thread.raw.map(J):[];g.sort((n,x)=>new Date(n.timestamp).getTime()-new Date(x.timestamp).getTime()),D(g)}}},[]),Ne=o.useCallback(async e=>{if(e.preventDefault(),!l||!C.trim()||w)return;const a=C.trim();ee(!0);try{if(l.type==="thread"&&l.threadId)await E.post("/api/messages/reply",{threadId:l.threadId,content:a});else{const g=l.email||l.thread.legacy?.user2;if(!g)throw new Error("Missing recipient email");const n=l.thread?.subject||`Message to ${l.name}`;await E.post("/api/messages",{to:g,subject:n,content:a,priority:"normal"})}se("");const r=await X({silent:!0});let u=r.find(g=>g.threadId===l.threadId&&g.type===l.type);if(!u&&l.email){const g=l.email.toLowerCase();u=r.find(n=>n.email&&n.email.toLowerCase()===g)}u&&await W(u),k.success("Message sent")}catch(r){console.error("Error sending message:",r);const u=r?.response?.data?.message||r?.message||"Failed to send message";k.error(u)}finally{ee(!1)}},[l,C,w,X,W]),Me=o.useCallback(e=>{if(e.type==="thread"){const a=K(e.thread.raw,e.thread.context);return a.length?a[a.length-1]:null}if(Array.isArray(e.thread.raw)){const a=e.thread.raw.map(J).sort((r,u)=>new Date(r.timestamp).getTime()-new Date(u.timestamp).getTime());return a.length?a[a.length-1]:null}return null},[]),Ae=o.useCallback(e=>e.unreadCount||0,[]),ue=o.useMemo(()=>G(h?.email||"User"),[h]),q=o.useMemo(()=>h?.email||"User",[h]),ye=o.useMemo(()=>h?.role||"member",[h]),H=o.useCallback(e=>{const a=(h?.email||"").toLowerCase();return a?!!(e.senderEmail&&e.senderEmail.toLowerCase()===a||e.senderId&&e.senderId.toLowerCase().includes(a)||e.senderRole?.toLowerCase()==="admin"&&h?.role==="admin"):!1},[h]),de=o.useCallback(e=>{if(!e)return"";const a=new Date(e);return Number.isFinite(a.getTime())?a.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):""},[]);return ge?s.jsxDEV("div",{className:"d-flex justify-content-center align-items-center",style:{height:"400px"},children:s.jsxDEV("div",{className:"spinner-border text-primary",role:"status",children:s.jsxDEV("span",{className:"visually-hidden",children:"Loading..."},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:653,columnNumber:11},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:652,columnNumber:9},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:651,columnNumber:7},void 0):s.jsxDEV("div",{className:"chat-wrapper",children:[s.jsxDEV("div",{className:"chat-sidebar card",children:[s.jsxDEV("div",{className:"chat-sidebar-single active top-profile",children:[s.jsxDEV("div",{className:"img",children:s.jsxDEV("img",{src:ue,alt:"Current user"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:664,columnNumber:13},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:663,columnNumber:11},void 0),s.jsxDEV("div",{className:"info",children:[s.jsxDEV("h6",{className:"text-md mb-0",children:q},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:667,columnNumber:13},void 0),s.jsxDEV("p",{className:"mb-0 text-capitalize",children:ye},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:668,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:666,columnNumber:11},void 0),s.jsxDEV("div",{className:"action d-flex flex-column align-items-end",children:[s.jsxDEV("button",{type:"button",className:"btn btn-primary btn-sm mb-2",onClick:()=>T(!0),children:[s.jsxDEV(j,{icon:"mdi:plus"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:676,columnNumber:15},void 0)," Compose"]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:671,columnNumber:13},void 0),s.jsxDEV("div",{className:"btn-group",children:[s.jsxDEV("button",{type:"button",className:"text-secondary-light text-xl","data-bs-toggle":"dropdown","data-bs-display":"static","aria-expanded":"false",children:s.jsxDEV(j,{icon:"bi:three-dots"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:686,columnNumber:17},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:679,columnNumber:15},void 0),s.jsxDEV("ul",{className:"dropdown-menu dropdown-menu-lg-end border",children:s.jsxDEV("li",{children:s.jsxDEV(ke,{to:"/chat-profile",className:"dropdown-item rounded text-secondary-light bg-hover-neutral-200 text-hover-neutral-900 d-flex align-items-center gap-2",children:[s.jsxDEV(j,{icon:"fluent:person-32-regular"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:694,columnNumber:21},void 0),"Profile"]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:690,columnNumber:19},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:689,columnNumber:17},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:688,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:678,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:670,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:662,columnNumber:9},void 0),s.jsxDEV("div",{className:"d-flex justify-content-center my-2",children:[s.jsxDEV("button",{className:`btn btn-sm ${A==="inbox"?"btn-primary":"btn-outline-primary"} mx-1`,onClick:()=>N("inbox"),children:"Inbox"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:704,columnNumber:11},void 0),s.jsxDEV("button",{className:`btn btn-sm ${A==="sent"?"btn-primary":"btn-outline-primary"} mx-1`,onClick:()=>N("sent"),children:"Sent"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:710,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:703,columnNumber:9},void 0),s.jsxDEV("div",{className:"chat-search",children:s.jsxDEV("form",{children:[s.jsxDEV("input",{type:"text",name:"chatSearch",placeholder:"Search here..."},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:720,columnNumber:13},void 0),s.jsxDEV(j,{icon:"iconoir:search",className:"search-icon"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:721,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:719,columnNumber:11},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:718,columnNumber:9},void 0),s.jsxDEV("div",{className:"chat-all-list",children:d.filter(e=>A==="inbox"?e.isInbox:e.isSent).map(e=>{const a=Me(e),r=Ae(e),u=a?B(a.content,30):"No messages yet",g=a?de(a.timestamp):"";return s.jsxDEV("div",{className:`chat-sidebar-single ${l?.id===e.id?"active":""}`,onClick:()=>{W(e)},style:{cursor:"pointer"},children:[s.jsxDEV("div",{className:"img",children:s.jsxDEV("img",{src:e.avatar,alt:e.name},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:746,columnNumber:21},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:745,columnNumber:19},void 0),s.jsxDEV("div",{className:"info",children:[s.jsxDEV("h6",{className:"text-sm mb-1",children:e.name},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:749,columnNumber:21},void 0),s.jsxDEV("p",{className:"mb-0 text-xs",children:u},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:750,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:748,columnNumber:19},void 0),s.jsxDEV("div",{className:"action text-end",children:[s.jsxDEV("p",{className:"mb-0 text-neutral-400 text-xs lh-1",children:g},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:753,columnNumber:21},void 0),r>0&&s.jsxDEV("span",{className:"w-16-px h-16-px text-xs rounded-circle bg-warning-main text-white d-inline-flex align-items-center justify-content-center",children:r},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:755,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:752,columnNumber:19},void 0)]},e.id,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:737,columnNumber:17},void 0)})},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:725,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:661,columnNumber:7},void 0),s.jsxDEV("div",{className:"chat-main card",children:[l?s.jsxDEV(s.Fragment,{children:[s.jsxDEV("div",{className:"chat-sidebar-single active mb-2",children:[s.jsxDEV("div",{className:"img",children:s.jsxDEV("img",{src:l.avatar,alt:l.name},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:772,columnNumber:17},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:771,columnNumber:15},void 0),s.jsxDEV("div",{className:"info",children:[s.jsxDEV("h6",{className:"text-md mb-0",children:l.name},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:775,columnNumber:17},void 0),s.jsxDEV("p",{className:"mb-0 text-xs",children:l.email},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:776,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:774,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:770,columnNumber:13},void 0),s.jsxDEV("div",{className:"chat-message-list",style:{maxHeight:"400px",overflowY:"auto"},children:[P.length>0?P.map((e,a)=>s.jsxDEV("div",{className:`chat-message-single ${H(e)?"from-current-user":""}`,style:{marginBottom:12},children:[s.jsxDEV("div",{className:"d-flex align-items-center mb-1",children:[s.jsxDEV("img",{src:H(e)?ue:l.avatar,alt:"avatar",style:{width:32,height:32,borderRadius:"50%",marginRight:8}},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:785,columnNumber:23},void 0),s.jsxDEV("span",{className:"fw-bold",children:H(e)?q:l.name},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:786,columnNumber:23},void 0),s.jsxDEV("span",{className:"ms-2 text-muted",style:{fontSize:"0.85em"},children:de(e.timestamp)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:787,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:784,columnNumber:21},void 0),s.jsxDEV("div",{className:"chat-message-content card p-2",children:e.content},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:789,columnNumber:21},void 0)]},e.id||a,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:783,columnNumber:19},void 0)):s.jsxDEV("div",{className:"text-center text-muted py-4",children:"No messages yet"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:793,columnNumber:17},void 0),s.jsxDEV("div",{ref:le},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:795,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:780,columnNumber:13},void 0),s.jsxDEV("form",{className:"chat-message-box mt-3",onSubmit:Ne,children:s.jsxDEV("div",{className:"input-group",children:[s.jsxDEV("input",{type:"text",className:"form-control",placeholder:"Type your message...",value:C,onChange:e=>se(e.target.value),disabled:w,required:!0},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:800,columnNumber:17},void 0),s.jsxDEV("button",{type:"submit",className:"btn btn-primary",disabled:w||!C.trim(),children:w?"Sending...":s.jsxDEV(j,{icon:"mdi:send"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:810,columnNumber:45},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:809,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:799,columnNumber:15},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:798,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:768,columnNumber:11},void 0):s.jsxDEV("div",{className:"d-flex flex-column align-items-center justify-content-center h-100 text-center",children:[s.jsxDEV(j,{icon:"fluent:chat-48-regular",className:"text-primary",style:{fontSize:"4rem"}},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:817,columnNumber:13},void 0),s.jsxDEV("h5",{className:"mt-3 mb-2",children:"Select a conversation"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:818,columnNumber:13},void 0),s.jsxDEV("p",{className:"text-muted",children:"Choose a contact from the sidebar to start messaging"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:819,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:816,columnNumber:11},void 0),F&&s.jsxDEV("div",{className:"modal-backdrop show",style:{zIndex:1050},children:s.jsxDEV("div",{className:"modal d-block",tabIndex:-1,role:"dialog",style:{zIndex:1060},children:s.jsxDEV("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:s.jsxDEV("div",{className:"modal-content",children:[s.jsxDEV("div",{className:"modal-header",children:[s.jsxDEV("h5",{className:"modal-title",children:"Compose New Message"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:829,columnNumber:21},void 0),s.jsxDEV("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>T(!1)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:830,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:828,columnNumber:19},void 0),s.jsxDEV("form",{onSubmit:async e=>{if(e.preventDefault(),!(!R.trim()||!z.trim())){te(!0);try{await E.post("/api/messages",{to:R.trim(),subject:`Message from ${q}`,content:z.trim(),priority:"normal"}),O(""),ae(""),T(!1),k.success("Message sent"),await X({silent:!0})}catch(a){k.error(a?.response?.data?.message||"Failed to send message")}finally{te(!1)}}},children:[s.jsxDEV("div",{className:"modal-body",children:[s.jsxDEV("div",{className:"mb-3",children:[s.jsxDEV("label",{className:"form-label",children:"Recipient Email"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:858,columnNumber:25},void 0),s.jsxDEV("div",{style:{position:"relative"},children:[s.jsxDEV("input",{type:"email",className:"form-control",value:R,onChange:e=>{O(e.target.value),oe(e.target.value),U(!0)},onFocus:()=>U(!0),onBlur:()=>setTimeout(()=>U(!1),150),autoComplete:"off",required:!0},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:860,columnNumber:27},void 0),xe&&V.trim()&&s.jsxDEV("div",{style:{position:"absolute",zIndex:100,top:"100%",left:0,right:0,background:"#fff",border:"1px solid #ddd",maxHeight:200,overflowY:"auto",borderRadius:4},children:[ne.filter(e=>e.email&&e.email.toLowerCase().includes(V.toLowerCase())||e.name&&e.name.toLowerCase().includes(V.toLowerCase())).slice(0,10).map((e,a)=>s.jsxDEV("div",{style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid #eee"},onMouseDown:()=>{O(e.email),oe(e.email),U(!1)},children:[s.jsxDEV("span",{style:{fontWeight:500},children:e.name},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:892,columnNumber:37},void 0),s.jsxDEV("span",{style:{color:"#888",marginLeft:8},children:e.email},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:893,columnNumber:37},void 0),s.jsxDEV("span",{style:{color:"#aaa",marginLeft:8,fontSize:"0.9em"},children:["(",e.role,")"]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:894,columnNumber:37},void 0)]},e.email+a,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:883,columnNumber:35},void 0)),ne.filter(e=>e.email&&e.email.toLowerCase().includes(V.toLowerCase())||e.name&&e.name.toLowerCase().includes(V.toLowerCase())).length===0&&s.jsxDEV("div",{style:{padding:"8px 12px",color:"#888"},children:"No matches found"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:901,columnNumber:33},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:875,columnNumber:29},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:859,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:857,columnNumber:23},void 0),s.jsxDEV("div",{className:"mb-3",children:[s.jsxDEV("label",{className:"form-label",children:"Message"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:908,columnNumber:25},void 0),s.jsxDEV("textarea",{className:"form-control",rows:4,value:z,onChange:e=>ae(e.target.value),required:!0},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:909,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:907,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:856,columnNumber:21},void 0),s.jsxDEV("div",{className:"modal-footer",children:[s.jsxDEV("button",{type:"button",className:"btn btn-secondary",onClick:()=>T(!1),children:"Cancel"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:919,columnNumber:23},void 0),s.jsxDEV("button",{type:"submit",className:"btn btn-primary",disabled:ie||!R.trim()||!z.trim(),children:ie?"Sending...":"Send"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:922,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:918,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:832,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:827,columnNumber:17},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:826,columnNumber:15},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:825,columnNumber:13},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:824,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:766,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:660,columnNumber:5},void 0)};export{Xe as M};
