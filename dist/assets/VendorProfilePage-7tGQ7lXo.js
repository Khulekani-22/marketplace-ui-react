import{p as me,r as b,n as x,l as R,j as a}from"./index-ABHAGoNh.js";import{M as ue}from"./MasterLayout-D28aQefB.js";import{a as te}from"./appData-Ck9xqmoN.js";import"./iconify-DPO5xaW3.js";const L="/api/lms",$="vendor_profile_working_v1",B="vendor_profile_undo_v1",re="vendor_profile_history_cache_v1";function F(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return null}}function J(e){return JSON.parse(JSON.stringify(e))}function ie(){return Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,8)}function ne(e){const l=new Date(e);return isNaN(l)?"—":l.toLocaleString()}function he(e){var f,u,j,N,n,I;const l=((e==null?void 0:e.contactEmail)||(e==null?void 0:e.email)||"").toLowerCase();return{id:String((e==null?void 0:e.vendorId)||(e==null?void 0:e.id)||""),name:(e==null?void 0:e.name)||"",contactEmail:l,ownerUid:(e==null?void 0:e.ownerUid)||"",phone:(e==null?void 0:e.phone)||"",website:(e==null?void 0:e.website)||"",description:(e==null?void 0:e.description)||"",logoUrl:(e==null?void 0:e.logoUrl)||(e==null?void 0:e.logo)||"",bannerUrl:(e==null?void 0:e.bannerUrl)||"",country:(e==null?void 0:e.country)||"",city:(e==null?void 0:e.city)||"",addressLine:(e==null?void 0:e.addressLine)||"",socials:{twitter:((f=e==null?void 0:e.socials)==null?void 0:f.twitter)||"",linkedin:((u=e==null?void 0:e.socials)==null?void 0:u.linkedin)||"",facebook:((j=e==null?void 0:e.socials)==null?void 0:j.facebook)||"",instagram:((N=e==null?void 0:e.socials)==null?void 0:N.instagram)||"",youtube:((n=e==null?void 0:e.socials)==null?void 0:n.youtube)||"",github:((I=e==null?void 0:e.socials)==null?void 0:I.github)||""},categories:Array.isArray(e==null?void 0:e.categories)?e.categories:[],tags:Array.isArray(e==null?void 0:e.tags)?e.tags:[],foundedYear:(e==null?void 0:e.foundedYear)||"",teamSize:(e==null?void 0:e.teamSize)||"",registrationNo:(e==null?void 0:e.registrationNo)||"",status:((e==null?void 0:e.status)||"pending").toLowerCase(),kycStatus:(e==null?void 0:e.kycStatus)||"pending"}}function M(e,l={}){const f=((e==null?void 0:e.email)||(e==null?void 0:e.contactEmail)||l.email||"").toLowerCase(),u=(e==null?void 0:e.socials)??{};return{id:String((e==null?void 0:e.id)??(e==null?void 0:e.vendorId)??l.vendorId??ie()),vendorId:String((e==null?void 0:e.vendorId)??(e==null?void 0:e.id)??l.vendorId??""),name:(e==null?void 0:e.name)??(e==null?void 0:e.companyName)??(e==null?void 0:e.vendor)??l.name??"",contactEmail:f,ownerUid:(e==null?void 0:e.ownerUid)??(e==null?void 0:e.uid)??l.uid??"",website:(e==null?void 0:e.website)??"",phone:(e==null?void 0:e.phone)??"",country:(e==null?void 0:e.country)??"",city:(e==null?void 0:e.city)??"",addressLine:(e==null?void 0:e.addressLine)??"",logoUrl:(e==null?void 0:e.logoUrl)??(e==null?void 0:e.logo)??"",bannerUrl:(e==null?void 0:e.bannerUrl)??"",description:(e==null?void 0:e.description)??"",categories:Array.isArray(e==null?void 0:e.categories)?e.categories:[],tags:Array.isArray(e==null?void 0:e.tags)?e.tags:[],foundedYear:(e==null?void 0:e.foundedYear)??"",teamSize:(e==null?void 0:e.teamSize)??"",registrationNo:(e==null?void 0:e.registrationNo)??"",status:((e==null?void 0:e.status)||"pending").toLowerCase(),socials:{twitter:u.twitter??"",linkedin:u.linkedin??"",facebook:u.facebook??"",instagram:u.instagram??"",youtube:u.youtube??"",github:u.github??""},lastUpdated:(e==null?void 0:e.lastUpdated)??""}}function pe(e,l){if(!e)return null;const f=((l==null?void 0:l.email)||"").toLowerCase(),u=[Array.isArray(e.startups)&&e.startups,Array.isArray(e.vendors)&&e.vendors,Array.isArray(e.companies)&&e.companies,Array.isArray(e.profiles)&&e.profiles].filter(Boolean);for(const j of u){const N=j.find(n=>(n==null?void 0:n.ownerUid)&&n.ownerUid===(l==null?void 0:l.uid)||(n==null?void 0:n.email)&&String(n.email).toLowerCase()===f||(n==null?void 0:n.contactEmail)&&String(n.contactEmail).toLowerCase()===f||(l==null?void 0:l.vendorId)&&(String(n==null?void 0:n.vendorId)===String(l.vendorId)||String(n==null?void 0:n.id)===String(l.vendorId)));if(N)return M(N,l)}return null}function je(){var Z,v,ee,ae,se;const{vendor:e,ensureVendorId:l,refresh:f}=me(),u=b.useMemo(()=>sessionStorage.getItem("tenantId")||"public",[]),[j,N]=b.useState(()=>F(localStorage.getItem($))??te),[n,I]=b.useState(()=>F(localStorage.getItem(re))??[]),[y,A]=b.useState(!1),[H,U]=b.useState(""),[q,E]=b.useState(""),[G,K]=b.useState(""),[W,le]=b.useState(!0),k=b.useRef([]);function V(s){const t=[s,...k.current||[]].slice(0,10);k.current=t,localStorage.setItem(B,JSON.stringify(t))}function Q(){var i;const s=(i=k.current)!=null&&i.length?k.current:F(localStorage.getItem(B))??[];if(!s.length)return;const t=s.shift();k.current=s,localStorage.setItem(B,JSON.stringify(s)),N(t),localStorage.setItem($,JSON.stringify(t))}function _(s){V(j),N(s),localStorage.setItem($,JSON.stringify(s))}b.useEffect(()=>{let s=!0;return(async()=>{var t,i;A(!0);try{await l();let c=te;try{const g=await((i=(t=x.currentUser)==null?void 0:t.getIdToken)==null?void 0:i.call(t)),m=await fetch(`${L}/live`,{headers:{"x-tenant-id":u,"cache-control":"no-cache",...g?{Authorization:`Bearer ${g}`}:{}}});s&&m.ok&&(c=await m.json())}catch{}try{const g=await R.get("/api/data/vendors").then(w=>w.data||[]),m=J(c);m.startups=Array.isArray(m.startups)?m.startups:[],g.forEach(w=>{const S=M(w),C=m.startups.findIndex(d=>String(d.vendorId||d.id)===S.vendorId);C>=0?m.startups[C]={...m.startups[C],...S}:m.startups.push(S)}),c=m}catch{}_(c),await T()}catch{}finally{s&&A(!1)}})(),()=>{s=!1}},[u]);async function T(){var s,t;try{const i=await((t=(s=x.currentUser)==null?void 0:s.getIdToken)==null?void 0:t.call(s)),g=(await fetch(`${L}/checkpoints`,{headers:{"x-tenant-id":u,...i?{Authorization:`Bearer ${i}`}:{}}}).then(m=>m.ok?m.json():{items:[]})).items??[];I(g),localStorage.setItem(re,JSON.stringify(g.slice(0,2)))}catch{}}const h=b.useMemo(()=>{var t,i,c;const s={uid:(t=x.currentUser)==null?void 0:t.uid,email:((i=x.currentUser)==null?void 0:i.email)||(e==null?void 0:e.email)||"",name:((c=x.currentUser)==null?void 0:c.displayName)||(e==null?void 0:e.name)||"",vendorId:(e==null?void 0:e.vendorId)||""};return pe(j,s)||M({},s)},[j,e==null?void 0:e.vendorId,(Z=x.currentUser)==null?void 0:Z.uid,(v=x.currentUser)==null?void 0:v.email]),[r,Y]=b.useState(()=>h);b.useEffect(()=>{Y(h)},[h==null?void 0:h.vendorId]);const o=!x.currentUser,P=((h==null?void 0:h.status)||"").toLowerCase(),O=((h==null?void 0:h.kycStatus)||"").toLowerCase(),D=P==="active"||O==="approved",oe=P==="pending"||O==="pending",z=P==="suspended"||O==="rejected";function p(s,t){Y(i=>({...i,[s]:t}))}function ce(s,t){Y(i=>({...i,socials:{...i.socials,[s]:t}}))}async function de(s){var t,i;try{const c=await((i=(t=x.currentUser)==null?void 0:t.getIdToken)==null?void 0:i.call(t)),g=await fetch(`${L}/checkpoints`,{method:"POST",headers:{"Content-Type":"application/json","x-tenant-id":u,...c?{Authorization:`Bearer ${c}`}:{}},body:JSON.stringify({message:s||"Vendor profile update",data:j})});if(!g.ok)throw new Error(await g.text());E("Checkpoint saved"),await T(),K("")}catch(c){U((c==null?void 0:c.message)||"Failed to save checkpoint")}}async function X(){var w,S,C;if(U(""),E(""),o){U("You need to sign in first.");return}if(!r.name.trim()){U("Vendor name is required.");return}const s=J(j);V(s);const t=J(j);t.startups=Array.isArray(t.startups)?t.startups:[];const i=String(r.vendorId||r.id||(e==null?void 0:e.vendorId)||((w=x.currentUser)==null?void 0:w.uid)||ie()),c=(r.contactEmail||((S=x.currentUser)==null?void 0:S.email)||"").toLowerCase(),g={...r,id:i,vendorId:i,ownerUid:((C=x.currentUser)==null?void 0:C.uid)||r.ownerUid||"",contactEmail:c,email:c,lastUpdated:new Date().toISOString()},m=t.startups.findIndex(d=>String(d.vendorId)===i||String(d.id)===i||d.email&&String(d.email).toLowerCase()===c);m>=0?t.startups[m]={...t.startups[m],...g}:t.startups.push(g),W&&Array.isArray(t.services)&&(t.services=t.services.map(d=>String(d.vendorId||"")===i?{...d,vendor:g.name}:d));try{A(!0);const d=he(g);d.id?await R.put(`/api/data/vendors/${encodeURIComponent(d.id)}`,d):await R.post("/api/data/vendors",d),_(t),E("Profile saved to live."),await(f==null?void 0:f()),await T(),window.scrollTo({top:0,behavior:"smooth"})}catch(d){U((d==null?void 0:d.message)||"Save failed"),_(s)}finally{A(!1)}}return a.jsx(ue,{children:a.jsxs("div",{className:"container py-4",style:{maxWidth:980},children:[a.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"h4 mb-0",children:"My Vendor Profile"}),a.jsxs("div",{className:"text-muted small",children:["Signed in as"," ",a.jsx("strong",{children:h.name||((ee=x.currentUser)==null?void 0:ee.displayName)||"Vendor"})," ","· ",h.contactEmail||((ae=x.currentUser)==null?void 0:ae.email)||"email not set",a.jsx("span",{className:`badge ms-2 text-bg-${D?"success":z?"danger":"warning"}`,children:D?"Approved":z?"Suspended":"Pending"})]}),a.jsxs("div",{className:"text-muted small",children:["Vendor ID:"," ",h.vendorId?a.jsx("code",{children:h.vendorId}):"pending"]}),D&&a.jsxs("div",{className:"alert alert-success mt-3 mb-0",children:["Your vendor account is approved. You can now submit listings to the marketplace.",a.jsxs("div",{className:"mt-2 d-flex gap-2",children:[a.jsx("a",{className:"btn btn-primary btn-sm",href:"/listings-vendors",children:"+ Submit new listing"}),a.jsx("a",{className:"btn btn-outline-secondary btn-sm",href:"/listings-vendors-mine",children:"View my listings"})]})]}),oe&&a.jsx("div",{className:"alert alert-warning mt-3 mb-0",children:"Your vendor account is pending approval. Please complete your profile details and wait for an admin to approve your account. You’ll be able to submit listings once approved."}),z&&a.jsx("div",{className:"alert alert-danger mt-3 mb-0",children:"Your vendor account is suspended. You cannot submit listings. Please contact support if you believe this is an error."})]}),a.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[a.jsx("button",{className:"btn btn-outline-secondary",onClick:Q,disabled:y,children:"Undo"}),a.jsx("button",{className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:X,disabled:y||o,title:"Save changes to live",children:y?"Saving…":"Save changes"})]})]}),o&&a.jsx("div",{className:"alert alert-warning",children:"Please sign in to manage your vendor profile."}),H&&a.jsx("div",{className:"alert alert-danger",children:H}),q&&a.jsx("div",{className:"alert alert-success",children:q}),a.jsxs("div",{className:"row g-3",children:[a.jsx("div",{className:"col-lg-8",children:a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"card-header fw-semibold",children:"Company details"}),a.jsx("div",{className:"card-body",children:a.jsxs("div",{className:"row g-3",children:[a.jsxs("div",{className:"col-md-8",children:[a.jsx("label",{className:"form-label",children:"Company / Vendor name"}),a.jsx("input",{className:"form-control",value:r.name,onChange:s=>p("name",s.target.value),placeholder:"e.g., Acme Studio",disabled:o,required:!0})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsx("label",{className:"form-label",children:"Contact email"}),a.jsx("input",{className:"form-control",value:r.contactEmail,onChange:s=>p("contactEmail",s.target.value.toLowerCase()),placeholder:"you@company.com",disabled:o})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Website"}),a.jsx("input",{className:"form-control",value:r.website,onChange:s=>p("website",s.target.value),placeholder:"https://…",disabled:o})]}),a.jsxs("div",{className:"col-md-3",children:[a.jsx("label",{className:"form-label",children:"Phone"}),a.jsx("input",{className:"form-control",value:r.phone,onChange:s=>p("phone",s.target.value),placeholder:"+27…",disabled:o})]}),a.jsxs("div",{className:"col-md-3",children:[a.jsx("label",{className:"form-label",children:"Founded (year)"}),a.jsx("input",{className:"form-control",value:r.foundedYear,onChange:s=>p("foundedYear",s.target.value),placeholder:"2021",disabled:o})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsx("label",{className:"form-label",children:"Country"}),a.jsx("input",{className:"form-control",value:r.country,onChange:s=>p("country",s.target.value),placeholder:"South Africa",disabled:o})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsx("label",{className:"form-label",children:"City"}),a.jsx("input",{className:"form-control",value:r.city,onChange:s=>p("city",s.target.value),placeholder:"Cape Town",disabled:o})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsx("label",{className:"form-label",children:"Team size"}),a.jsx("input",{className:"form-control",value:r.teamSize,onChange:s=>p("teamSize",s.target.value),placeholder:"1–10",disabled:o})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Company reg. number"}),a.jsx("input",{className:"form-control",value:r.registrationNo,onChange:s=>p("registrationNo",s.target.value),placeholder:"(optional)",disabled:o})]}),a.jsxs("div",{className:"col-md-6 d-none",children:[a.jsx("label",{className:"form-label",children:"Status"}),a.jsxs("select",{className:"form-select",value:r.status,onChange:s=>p("status",s.target.value),disabled:o,children:[a.jsx("option",{value:"active",children:"active"}),a.jsx("option",{value:"pending",children:"pending"}),a.jsx("option",{value:"suspended",children:"suspended"})]})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Logo URL"}),a.jsx("input",{className:"form-control",value:r.logoUrl,onChange:s=>p("logoUrl",s.target.value),placeholder:"https://…",disabled:o})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Banner URL"}),a.jsx("input",{className:"form-control",value:r.bannerUrl,onChange:s=>p("bannerUrl",s.target.value),placeholder:"https://…",disabled:o})]}),a.jsxs("div",{className:"col-12",children:[a.jsx("label",{className:"form-label",children:"Description"}),a.jsx("textarea",{className:"form-control",rows:4,value:r.description,onChange:s=>p("description",s.target.value),placeholder:"Tell buyers what you do, problems you solve, and why you're different.",disabled:o})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Categories (comma-separated)"}),a.jsx("input",{className:"form-control",value:r.categories.join(", "),onChange:s=>p("categories",s.target.value.split(",").map(t=>t.trim()).filter(Boolean)),placeholder:"Design, Branding",disabled:o})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Tags (comma-separated)"}),a.jsx("input",{className:"form-control",value:r.tags.join(", "),onChange:s=>p("tags",s.target.value.split(",").map(t=>t.trim()).filter(Boolean)),placeholder:"logos, identity, saas",disabled:o})]}),a.jsx("div",{className:"col-12",children:a.jsx("div",{className:"row g-3",children:[["twitter","Twitter"],["linkedin","LinkedIn"],["facebook","Facebook"],["instagram","Instagram"],["youtube","YouTube"],["github","GitHub"]].map(([s,t])=>a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:t}),a.jsx("input",{className:"form-control",value:r.socials[s],onChange:i=>ce(s,i.target.value),placeholder:`https://${s}.com/...`,disabled:o})]},s))})}),a.jsxs("div",{className:"col-12 d-flex align-items-center gap-2",children:[a.jsx("input",{id:"propagateName",type:"checkbox",className:"form-check-input",checked:W,onChange:s=>le(!!s.target.checked),disabled:o}),a.jsx("label",{htmlFor:"propagateName",className:"form-check-label",children:"Update my display name on all existing listings"})]}),a.jsxs("div",{className:"col-12 d-flex gap-2 mt-2",children:[a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:Q,disabled:y,children:"Undo"}),a.jsx("button",{type:"button",className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:X,disabled:y||o,children:y?"Saving…":"Save changes"})]}),r.lastUpdated&&a.jsxs("div",{className:"form-text mt-1",children:["Last updated: ",ne(r.lastUpdated)]})]})})]})}),a.jsxs("div",{className:"col-lg-4",children:[a.jsxs("div",{className:"card mb-3",children:[a.jsx("div",{className:"card-header fw-semibold",children:"Preview"}),a.jsxs("div",{className:"card-body",children:[a.jsxs("div",{className:"d-flex align-items-center gap-3",children:[a.jsx("img",{src:r.logoUrl||"/assets/images/placeholder-1x1.png",alt:"logo",style:{width:64,height:64,objectFit:"cover",borderRadius:8}}),a.jsxs("div",{children:[a.jsx("div",{className:"fw-semibold",children:r.name||"Vendor"}),a.jsx("div",{className:"text-muted small",children:r.contactEmail||((se=x.currentUser)==null?void 0:se.email)||"email"}),a.jsx("div",{className:"small",children:r.website?a.jsx("a",{href:r.website,target:"_blank",rel:"noreferrer",children:r.website}):"website"})]})]}),r.bannerUrl&&a.jsx("div",{className:"mt-3",children:a.jsx("img",{src:r.bannerUrl,alt:"banner",className:"w-100",style:{maxHeight:140,objectFit:"cover",borderRadius:8}})}),a.jsxs("div",{className:"mt-3 small text-muted",children:["Categories: ",r.categories.join(", ")||"—",a.jsx("br",{}),"Tags: ",r.tags.join(", ")||"—"]})]})]}),a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"card-header fw-semibold d-flex align-items-center justify-content-between",children:a.jsx("span",{children:"Version control"})}),a.jsxs("div",{className:"card-body",children:[a.jsxs("div",{className:"d-flex gap-2 mb-2",children:[a.jsx("input",{className:"form-control",placeholder:"Checkpoint message",value:G,onChange:s=>K(s.target.value)}),a.jsx("button",{className:"btn btn-outline-primary",onClick:()=>de(G),disabled:y||o,children:"Save checkpoint"})]}),a.jsxs("div",{className:"list-group list-group-flush",children:[!(n!=null&&n.length)&&a.jsx("div",{className:"text-muted small",children:"No checkpoints yet. Create one after saving changes."}),n==null?void 0:n.slice(0,6).map(s=>a.jsxs("div",{className:"list-group-item",children:[a.jsx("div",{className:"fw-semibold",children:s.message||"(no message)"}),a.jsx("div",{className:"text-muted small",children:ne(s.ts)}),a.jsx("div",{className:"d-flex gap-2 mt-1",children:a.jsx("a",{className:"btn btn-sm btn-outline-secondary",href:`${L}/checkpoints/${s.id}`,target:"_blank",rel:"noreferrer",children:"Download snapshot"})})]},s.id))]}),a.jsx("div",{className:"form-text mt-2",children:"Checkpoints snapshot the whole marketplace data (including your profile) on the server."})]})]})]})]})]})})}export{je as default};
