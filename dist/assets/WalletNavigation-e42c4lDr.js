import{j as e,L as v,r as d,b as B,o as G,d as P}from"./index-7-v0jUWh.js";import{I as l}from"./iconify-BSamAZK7.js";const q=new Intl.NumberFormat("en-ZA"),U=new Intl.DateTimeFormat("en-ZA",{dateStyle:"medium",timeStyle:"short"});function o(s){const n=Number(s)||0;return q.format(Math.round(n))}function E(s){if(!s)return"--";try{return U.format(new Date(s))}catch{return"--"}}function z({wallet:s,loading:n=!1,eligible:t=!0,onRefresh:i,showActions:a=!0,compact:w=!1}){const m=(s==null?void 0:s.balance)??0,u=(s==null?void 0:s.startingBalance)??0,k=Math.max(0,Math.round((u-m)*100)/100),g=s!=null&&s.lastUpdated?E(s.lastUpdated):"--";return e.jsxs("div",{className:`card ${w?"p-16":"p-24"} radius-12 h-100`,children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(l,{icon:"mdi:wallet-giftcard",className:"text-xl text-primary-600 me-2"}),"Voucher Wallet"]}),i&&e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:i,disabled:n,title:"Refresh wallet",children:e.jsx(l,{icon:"mdi:refresh",className:n?"spin":""})})]}),n&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"spinner-border spinner-border-sm text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-secondary mt-2 mb-0",children:"Loading wallet balance..."})]}),!n&&!t&&e.jsxs("div",{className:"alert alert-warning mb-0",children:[e.jsx(l,{icon:"mdi:shield-alert",className:"me-2"}),"Wallet credits unlock once your profile is verified as a startup or vendor. Reach out to programme support if you need activation."]}),!n&&t&&!s&&e.jsxs("div",{className:"alert alert-danger mb-0",children:[e.jsx(l,{icon:"mdi:alert-circle",className:"me-2"}),"Could not load wallet details. Try refreshing or contact support."]}),!n&&t&&s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-primary-50 p-16 radius-12 mb-3",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"col",children:[e.jsx("span",{className:"text-sm text-secondary-light d-block mb-1",children:"Available Credits"}),e.jsxs("h3",{className:"mb-0 text-primary-600",children:["R ",o(m)]})]}),e.jsx("div",{className:"col-auto",children:e.jsx(l,{icon:"mdi:credit-card-check",className:"text-3xl text-primary-600"})})]})}),e.jsxs("div",{className:"row g-2 mb-3",children:[e.jsx("div",{className:"col-6",children:e.jsx(F,{icon:"mdi:rocket-launch-outline",label:"Initial Allocation",value:`R ${o(u)}`})}),e.jsx("div",{className:"col-6",children:e.jsx(F,{icon:"mdi:chart-line",label:"Credits Used",value:`R ${o(k)}`})})]}),e.jsx("div",{className:"mb-3",children:e.jsx(F,{icon:"mdi:clock-outline",label:"Last Activity",value:g})}),a&&e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(v,{to:"/wallet",className:"btn btn-primary flex-fill",children:[e.jsx(l,{icon:"mdi:eye",className:"me-1"}),"View Details"]}),e.jsxs(v,{to:"/market1",className:"btn btn-outline-primary flex-fill",children:[e.jsx(l,{icon:"mdi:shopping",className:"me-1"}),"Browse"]})]})]})]})}function F({icon:s,label:n,value:t}){return e.jsxs("div",{className:"d-flex align-items-center p-2 bg-light rounded",children:[e.jsx(l,{icon:s,className:"text-lg text-secondary-light me-2"}),e.jsxs("div",{className:"flex-grow-1 min-width-0",children:[e.jsx("div",{className:"text-xs text-secondary-light",children:n}),e.jsx("div",{className:"text-sm fw-medium text-truncate",children:t})]})]})}function H({transactions:s,compact:n=!1}){return s!=null&&s.length?e.jsxs("div",{className:"table-responsive",children:[e.jsxs("table",{className:"table table-hover mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"Date"}),e.jsx("th",{scope:"col",children:"Description"}),!n&&e.jsx("th",{scope:"col",children:"Type"}),e.jsx("th",{scope:"col",className:"text-end",children:"Amount"}),e.jsx("th",{scope:"col",className:"text-end",children:"Balance"})]})}),e.jsx("tbody",{children:s.slice(0,n?5:void 0).map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"text-sm",children:E(t.createdAt)})}),e.jsxs("td",{children:[e.jsx("span",{className:"text-sm",children:t.description}),t.reference&&e.jsxs("div",{className:"text-xs text-secondary-light",children:["Ref: ",t.reference]})]}),!n&&e.jsx("td",{children:e.jsx(V,{type:t.type})}),e.jsx("td",{className:"text-end",children:e.jsxs("span",{className:`text-sm fw-medium ${t.type==="credit"?"text-success":"text-danger"}`,children:[t.type==="credit"?"+":"-","R ",o(t.amount)]})}),e.jsx("td",{className:"text-end",children:e.jsxs("span",{className:"text-sm",children:["R ",o(t.balanceAfter)]})})]},t.id))})]}),n&&s.length>5&&e.jsx("div",{className:"text-center pt-3",children:e.jsxs(v,{to:"/wallet",className:"btn btn-outline-secondary btn-sm",children:["View All Transactions (",s.length,")"]})})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(l,{icon:"mdi:receipt-text-outline",className:"text-4xl text-secondary-light mb-2"}),e.jsx("p",{className:"text-secondary-light mb-0",children:"No voucher activity yet. Purchases using the marketplace will appear here."})]})}function V({type:s}){const n={credit:{icon:"mdi:plus-circle",class:"bg-success",label:"Credit"},debit:{icon:"mdi:minus-circle",class:"bg-danger",label:"Debit"},adjustment:{icon:"mdi:circle-edit-outline",class:"bg-warning",label:"Adjustment"}},{icon:t,class:i,label:a}=n[s]||{icon:"mdi:help-circle",class:"bg-secondary",label:s};return e.jsxs("span",{className:`badge ${i} d-flex align-items-center gap-1`,children:[e.jsx(l,{icon:t,className:"text-xs"}),a]})}function L(s,n){var t;if(s&&typeof s=="object"&&"response"in s){const a=(t=s.response)==null?void 0:t.data;if(typeof a=="string"&&a.trim())return a.trim();if(a&&typeof a.message=="string"&&a.message.trim())return a.message.trim()}return s instanceof Error&&s.message?s.message:n}function J({grantCredits:s,onRefresh:n,compact:t=!1,showUserLookup:i=!0,selectedUserEmail:a="",onEmailChange:w}){var W;const[m,u]=d.useState(a),[k,g]=d.useState(""),[A,C]=d.useState(""),[S,T]=d.useState(!1),[f,c]=d.useState({type:"",message:""}),[N,p]=d.useState(null),[y,x]=d.useState({loading:!1,error:""}),b=m.trim().toLowerCase();d.useEffect(()=>{a&&a!==m&&(u(a),c({type:"",message:""}),p(null),x({loading:!1,error:""}))},[a,m]);const R=r=>{u(r),w&&w(r)},D=async()=>{if(!b||!i){x({loading:!1,error:"Enter an email to preview a wallet."}),p(null);return}x({loading:!0,error:""});try{const{data:r}=await B.get("/api/wallets/admin/lookup",{params:{email:b},suppressToast:!0,suppressErrorLog:!0}),h=r!=null&&r.wallet?r.wallet:null;p(h),x({loading:!1,error:h?"":"No wallet exists yet for that user."})}catch(r){p(null),x({loading:!1,error:L(r,"Unable to fetch wallet details.")})}},I=async r=>{var $;if(r.preventDefault(),c({type:"",message:""}),!b){c({type:"danger",message:"Enter the recipient's email address."});return}const h=Number(k.replace(/[^0-9.]/g,""));if(!Number.isFinite(h)||h<=0){c({type:"danger",message:"Enter a valid credit amount."});return}if(!s){c({type:"danger",message:"Grant credits function not available."});return}T(!0);try{const j=await s({email:b,amount:h,description:A?`Admin credit: ${A.trim()}`:"Admin credit",metadata:{source:"admin-grant",note:A.trim()||void 0}});if(!j.ok){c({type:"danger",message:j.error||"Unable to grant credits."});return}g(""),C(""),c({type:"success",message:`Granted ${o(h)} credits. New balance: ${o((($=j.wallet)==null?void 0:$.balance)||0)} credits.`}),p(j.wallet||null),x({loading:!1,error:""}),n&&await n()}catch(j){c({type:"danger",message:L(j,"Unable to grant credits.")})}finally{T(!1)}},M=()=>{u(""),g(""),C(""),c({type:"",message:""}),p(null),x({loading:!1,error:""})};return e.jsxs("div",{className:`card ${t?"p-16":"p-24"} radius-12 d-flex flex-column gap-3`,children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(l,{icon:"mdi:wallet-plus",className:"text-xl text-primary-600 me-2"}),"Grant Credits"]}),e.jsx("span",{className:"badge text-bg-light text-secondary-emphasis",children:"Admin"})]}),e.jsx("p",{className:"text-secondary-light mb-0",children:"Send voucher credits to any account. Wallets are created automatically if they do not exist."}),e.jsxs("form",{className:`row g-3 ${t?"g-2":"g-3"}`,onSubmit:I,children:[e.jsxs("div",{className:t?"col-12":"col-12 col-md-5",children:[e.jsx("label",{className:"form-label text-sm text-secondary-light",children:"User Email"}),e.jsx("input",{type:"email",className:"form-control",value:m,onChange:r=>R(r.target.value),placeholder:"user@example.com",autoComplete:"off",required:!0})]}),e.jsxs("div",{className:t?"col-6":"col-12 col-md-3",children:[e.jsx("label",{className:"form-label text-sm text-secondary-light",children:"Credit Amount"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:"R"}),e.jsx("input",{type:"text",className:"form-control",value:k,onChange:r=>g(r.target.value),inputMode:"decimal",placeholder:"e.g. 5000",required:!0})]})]}),e.jsxs("div",{className:t?"col-6":"col-12 col-md-4",children:[e.jsx("label",{className:"form-label text-sm text-secondary-light",children:"Notes (optional)"}),e.jsx("input",{type:"text",className:"form-control",value:A,onChange:r=>C(r.target.value),placeholder:"Reason or reference",maxLength:120})]}),e.jsxs("div",{className:"col-12 d-flex flex-wrap gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Granting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(l,{icon:"mdi:plus-circle",className:"me-1"}),"Grant Credits"]})}),i&&e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:D,disabled:y.loading||!b,children:y.loading?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(l,{icon:"mdi:magnify",className:"me-1"}),"Preview Wallet"]})}),e.jsxs("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:M,disabled:S||y.loading,children:[e.jsx(l,{icon:"mdi:refresh",className:"me-1"}),"Clear"]})]})]}),f.message&&e.jsxs("div",{className:`alert alert-${f.type||"info"} mb-0`,children:[e.jsx(l,{icon:f.type==="success"?"mdi:check-circle":"mdi:alert-circle",className:"me-2"}),f.message]}),y.error&&!f.message&&e.jsxs("div",{className:"alert alert-warning mb-0",children:[e.jsx(l,{icon:"mdi:information",className:"me-2"}),y.error]}),N&&i&&e.jsxs("div",{className:"border border-dashed rounded-3 p-16 bg-neutral-50",children:[e.jsxs("h6",{className:"mb-2",children:[e.jsx(l,{icon:"mdi:account-cash",className:"me-2"}),"Wallet Preview"]}),e.jsxs("div",{className:"d-flex flex-wrap gap-3 text-sm",children:[e.jsxs("span",{children:[e.jsx("strong",{children:"Email:"})," ",N.email||b]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Tenant:"})," ",N.tenantId]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Balance:"})," R ",o(N.balance)]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Transactions:"})," ",((W=N.transactions)==null?void 0:W.length)||0]})]})]})]})}function K({compact:s=!1}){const n=G(),{isAdmin:t}=P(),i=[{path:"/dashboard",label:"Dashboard",icon:"mdi:view-dashboard",description:"Overview and quick actions"},{path:"/wallet",label:"Unified Wallet",icon:"mdi:wallet",description:"Complete wallet management with transaction tracking"}];return t&&i.push({path:"/admin/wallet-credits",label:"Legacy Admin",icon:"mdi:wallet-plus-outline",description:"Original admin credits interface"}),s?e.jsx("div",{className:"btn-group",role:"group",children:i.map(a=>e.jsxs(v,{to:a.path,className:`btn btn-sm ${n.pathname===a.path?"btn-primary":"btn-outline-primary"}`,title:a.description,children:[e.jsx(l,{icon:a.icon,className:"me-1"}),a.label]},a.path))}):e.jsxs("div",{className:"card p-16 radius-12 mb-4",children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx(l,{icon:"mdi:navigation",className:"me-2"}),"Wallet Management Center"]}),e.jsxs("div",{className:"alert alert-info py-2 px-3 mb-3",children:[e.jsx(l,{icon:"mdi:information",className:"me-2"}),e.jsx("strong",{children:"Enhanced Integration:"})," This unified wallet interface now includes complete admin functionality for tracking all platform user transactions."]}),e.jsx("div",{className:"d-flex flex-wrap gap-2",children:i.map(a=>e.jsxs(v,{to:a.path,className:`btn btn-sm ${n.pathname===a.path?"btn-primary":"btn-outline-primary"}`,children:[e.jsx(l,{icon:a.icon,className:"me-1"}),e.jsx("span",{children:a.label}),!s&&e.jsx("div",{className:"text-xs mt-1 opacity-75",children:a.description})]},a.path))})]})}export{J as A,H as T,K as W,z as a,o as f};
