import{v as ve,b as S,c as Pe,B as E,j as s}from"./index-DF1eAVL0.js";import{r as m,L as Se}from"./vendor-5dkO6nAt.js";import{I as k}from"./MasterLayout-CrCwD5hs.js";function U(t,c=80){return t?t.length>c?`${t.slice(0,c)}â€¦`:t:""}function Y(t){return`https://ui-avatars.com/api/?name=${encodeURIComponent(t||"User")}&background=059669&color=fff`}function _(t){const c=t?.from||{},M=t?.timestamp||t?.date||new Date().toISOString();return{id:String(t?.id||M),senderId:c?.uid||c?.email,senderName:c?.name||c?.email||"User",senderEmail:c?.email,senderRole:c?.type,senderAvatar:c?.avatar,content:(t?.content??"").toString(),timestamp:M}}function G(t,c){const M=Array.isArray(t?.messages)?t.messages:[],h=t?.context||c||{},f=M.map(i=>{const r=i?.senderRole||i?.role;let g=i?.senderEmail||i?.email;if(!g){const l=(r||"").toLowerCase();l==="admin"&&h.adminEmail&&(g=h.adminEmail),l==="vendor"&&h.vendorEmail&&(g=h.vendorEmail),l==="subscriber"&&h.subscriberEmail&&(g=h.subscriberEmail)}const y=i?.date||i?.timestamp||i?.createdAt||new Date().toISOString();return{id:String(i?.id||i?.messageId||y),senderId:i?.senderId||i?.sender?.id,senderName:i?.senderName||i?.sender?.name||i?.senderId||"User",senderEmail:g,senderRole:r,senderAvatar:i?.senderAvatar||i?.sender?.avatar,content:(i?.content??i?.text??"").toString(),timestamp:y}});return f.sort((i,r)=>new Date(i.timestamp).getTime()-new Date(r.timestamp).getTime()),f}function pe(t){const c=new Map;t.forEach(h=>{if(!h)return;const f=String(h.threadId||h.id||h.subject||`legacy-${Date.now()}`);c.has(f)||c.set(f,[]),c.get(f).push(h)});const M=[];for(const[h,f]of c.entries()){f.sort((y,l)=>new Date(y?.timestamp||y?.date||0).getTime()-new Date(l?.timestamp||l?.date||0).getTime());const i=f[0],r=f[f.length-1]||i,g=[];i?.from&&g.push({id:i.from.uid||i.from.email||i.from.name,name:i.from.name||i.from.email,email:i.from.email,role:i.from.type}),i?.to&&g.push({id:i.to.uid||i.to.email||i.to.name,name:i.to.name||i.to.email,email:i.to.email,role:i.to.type}),M.push({id:h,kind:"legacy",subject:r?.subject||i?.subject||"Conversation",lastMessageSnippet:U(r?.content||""),lastMessageAt:r?.timestamp||r?.date,participants:g,legacy:{user1:g[0]?.email,user2:g[1]?.email},raw:f})}return M}function Ee(t){const c=Array.isArray(t?.messages)?[...t.messages]:[],M=t?.lastMessage||c[c.length-1]||{},h=Array.isArray(t?.participants)?t.participants.map(l=>({id:l?.id||l?.email||l?.name,name:l?.name||l?.id||"Participant",email:l?.email,role:l?.role})):[],f=t?.context||{},i={id:String(t?.id||t?.threadId||f.threadId||`thread-${Date.now()}`),kind:"thread",subject:t?.subject||f.listingTitle||f.serviceTitle||"Conversation",lastMessageSnippet:U(t?.lastMessage?.snippet||M?.snippet||M?.content||""),lastMessageAt:M?.date||M?.timestamp||t?.updatedAt||t?.createdAt,unreadCount:typeof t?.unreadCount=="number"?t.unreadCount:void 0,participants:h,context:f,raw:t},r=f.vendorEmail,g=f.adminEmail,y=f.subscriberEmail;if(r){const l=i.participants.find(u=>(u?.role||"").toLowerCase()==="vendor"||(u?.id||"").startsWith("vendor:"));l&&!l.email&&(l.email=r)}if(g){const l=i.participants.find(u=>(u?.role||"").toLowerCase()==="admin");l&&!l.email&&(l.email=g)}if(y){const l=i.participants.find(u=>(u?.role||"").toLowerCase()==="subscriber");l&&!l.email&&(l.email=y)}return i}const Ce=({userEmail:t,userName:c})=>{const[M,h]=m.useState([]),[f,i]=m.useState("inbox"),[r,g]=m.useState(null),[y,l]=m.useState([]),[u,fe]=m.useState(()=>{try{return ve()}catch{return null}}),[be,J]=m.useState(!0),[D,K]=m.useState(!1),[j,Z]=m.useState(""),[$,L]=m.useState(!1),[I,B]=m.useState(""),[T,ee]=m.useState(""),[se,ae]=m.useState(!1),[ie,te]=m.useState([]),[w,ne]=m.useState(""),[he,R]=m.useState(!1);m.useEffect(()=>{$&&S.get("/api/users/all-contacts").then(e=>te(e.data.items||[])).catch(()=>te([]))},[$]);const re=m.useRef(null),oe=m.useCallback(()=>{re.current?.scrollIntoView({behavior:"smooth"})},[]);m.useEffect(()=>{oe()},[y,oe]),m.useEffect(()=>{Pe().then(e=>fe(e)).catch(()=>{})},[]),m.useEffect(()=>{if(t&&M.length){const e=M.find(a=>a.email&&a.email.toLowerCase()===t.toLowerCase());g(e||{id:`direct:${t}`,threadId:"",name:c||t,email:t,avatar:Y(c||t),status:"Direct Message",type:"thread",lastMessageSnippet:"",lastMessageAt:void 0,unreadCount:0,thread:{id:"",kind:"thread",subject:c||t,lastMessageSnippet:"",participants:[{name:c||t,email:t},{name:u&&typeof u=="object"&&"name"in u&&typeof u.name=="string"?u.name:"",email:u?.email||void 0}],context:{},raw:{}},isInbox:!0,isSent:!1})}},[t,c,M,u]);const le=m.useCallback(e=>{const a=(u?.email||"").toLowerCase(),o=(u?.uid||"").toLowerCase(),d=n=>{if(!n)return"";const N=n.toLowerCase(),v=N.split(":");return v[v.length-1]||N},x=n=>{const N=Array.isArray(n?.messages)?n.messages:Array.isArray(n)?n:[];let v=!1,V=!1;for(const p of N){const q=(p?.senderEmail||p?.email||p?.from?.email||"").toLowerCase(),H=(p?.senderId||p?.sender?.id||p?.from?.uid||p?.from?.id||"").toString().toLowerCase(),z=d(p?.senderId||p?.sender?.id||p?.from?.uid||p?.from?.id||null),P=[],Q=[p?.recipientEmail,p?.receiverEmail,p?.toEmail,p?.targetEmail,p?.to?.email,p?.recipient?.email,p?.to?.[0]?.email,p?.recipients?.[0]?.email];for(const b of Q)typeof b=="string"&&b.includes("@")&&P.push(b.toLowerCase());if(Array.isArray(p?.to))for(const b of p.to)typeof b=="string"&&b.includes("@")?P.push(b.toLowerCase()):b&&typeof b=="object"&&typeof b.email=="string"&&P.push(b.email.toLowerCase());if(Array.isArray(p?.recipients))for(const b of p.recipients)typeof b=="string"&&b.includes("@")?P.push(b.toLowerCase()):b&&typeof b=="object"&&typeof b.email=="string"&&P.push(b.email.toLowerCase());a&&q===a&&(v=!0),o&&z&&(z===o||H.endsWith(`:${o}`))&&(v=!0),a&&P.includes(a)&&(V=!0)}return{hasSent:v,matchesInbox:V}};return e.map(n=>{const N=n.participants||[],v=N.map(A=>(A?.email||"").toLowerCase()).filter(Boolean),V=N.map(A=>d(A?.id)).filter(Boolean),p=N.map(A=>(A?.id||"").toLowerCase()).filter(Boolean),{hasSent:q,matchesInbox:H}=x(n.raw),z=Object.values(n.context||{}).flatMap(A=>typeof A=="string"&&A.includes("@")?[A.toLowerCase()]:[]).filter(Boolean),Q=!!a&&v.includes(a)||!!o&&(V.some(A=>A===o)||p.some(A=>A.endsWith(`:${o}`)))||!!a&&z.includes(a)||H,b=q;let X=N.find(A=>(A?.email||"").toLowerCase()!==a);!X&&N.length&&(X=N[0]);const ue=X?.name||X?.email||n.subject||"Conversation",Ae=X?.email||(n.legacy?[n.legacy.user1,n.legacy.user2].find(A=>(A||"").toLowerCase()!==a):void 0),ye=Y(ue),de=(n.kind==="thread"?n.context?.type||"active":"legacy conversation").replace(/[-_]/g," ");return{id:`${n.kind}:${n.id}`,threadId:n.id,name:ue,email:Ae,avatar:ye,status:de.charAt(0).toUpperCase()+de.slice(1),type:n.kind,lastMessageSnippet:U(n.lastMessageSnippet||""),lastMessageAt:n.lastMessageAt,unreadCount:n.unreadCount,thread:n,isInbox:Q,isSent:b}}).sort((n,N)=>{const v=n.lastMessageAt?new Date(n.lastMessageAt).getTime():0;return(N.lastMessageAt?new Date(N.lastMessageAt).getTime():0)-v})},[u]),C=m.useCallback(async({silent:e=!1}={})=>{e||J(!0);try{const o=(await S.get("/api/messages",{params:{limit:100}})).data;let d=[];Array.isArray(o?.items)?d=o.items.map(Ee):Array.isArray(o?.messages)?d=pe(o.messages):Array.isArray(o)&&(d=pe(o));const x=le(d);return h(x),x}catch(a){if(console.error("Error fetching messages:",a),!e){const o=a?.response?.data?.message||"Failed to load messages";E.error(o)}return h([]),[]}finally{e||J(!1)}},[le]);m.useEffect(()=>{C()},[C]);const F=m.useCallback(async e=>{if(g(e),e.type==="thread"){if(!e.threadId){l([]);return}try{const a=await S.get(`/api/messages/${e.threadId}`),o=a.data&&a.data.id?a.data:e.thread.raw,d=G(o,e.thread.context);l(d)}catch(a){console.error("Error fetching thread conversation:",a);const o=G(e.thread.raw,e.thread.context);l(o),E.error("Unable to refresh conversation; showing cached messages.")}}else{const a=e.thread.legacy?.user1,o=e.thread.legacy?.user2||e.email;if(!a||!o){l([]);return}try{const d=await S.get("/api/messages/conversation",{params:{user1:a,user2:o,limit:100}}),n=(Array.isArray(d.data?.conversation)?d.data.conversation:[]).map(_).sort((N,v)=>new Date(N.timestamp).getTime()-new Date(v.timestamp).getTime());l(n)}catch(d){console.error("Error fetching legacy conversation:",d),E.error("Unable to load conversation");const x=Array.isArray(e.thread.raw)?e.thread.raw.map(_):[];x.sort((n,N)=>new Date(n.timestamp).getTime()-new Date(N.timestamp).getTime()),l(x)}}},[]),ge=m.useCallback(async e=>{if(e.preventDefault(),!r||!j.trim()||D)return;const a=j.trim();K(!0);try{if(r.type==="thread"&&r.threadId)await S.post("/api/messages/reply",{threadId:r.threadId,content:a});else{const x=r.email||r.thread.legacy?.user2;if(!x)throw new Error("Missing recipient email");const n=r.thread?.subject||`Message to ${r.name}`;await S.post("/api/messages",{to:x,subject:n,content:a,priority:"normal"})}Z("");const o=await C({silent:!0});let d=o.find(x=>x.threadId===r.threadId&&x.type===r.type);if(!d&&r.email){const x=r.email.toLowerCase();d=o.find(n=>n.email&&n.email.toLowerCase()===x)}d&&await F(d),E.success("Message sent")}catch(o){console.error("Error sending message:",o);const d=o?.response?.data?.message||o?.message||"Failed to send message";E.error(d)}finally{K(!1)}},[r,j,D,C,F]),xe=m.useCallback(e=>{if(e.type==="thread"){const a=G(e.thread.raw,e.thread.context);return a.length?a[a.length-1]:null}if(Array.isArray(e.thread.raw)){const a=e.thread.raw.map(_).sort((o,d)=>new Date(o.timestamp).getTime()-new Date(d.timestamp).getTime());return a.length?a[a.length-1]:null}return null},[]),Ne=m.useCallback(e=>e.unreadCount||0,[]),me=m.useMemo(()=>Y(u?.email||"User"),[u]),O=m.useMemo(()=>u?.email||"User",[u]),Me=m.useMemo(()=>u?.role||"member",[u]),W=m.useCallback(e=>{const a=(u?.email||"").toLowerCase();return a?!!(e.senderEmail&&e.senderEmail.toLowerCase()===a||e.senderId&&e.senderId.toLowerCase().includes(a)||e.senderRole?.toLowerCase()==="admin"&&u?.role==="admin"):!1},[u]),ce=m.useCallback(e=>{if(!e)return"";const a=new Date(e);return Number.isFinite(a.getTime())?a.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):""},[]);return be?s.jsxDEV("div",{className:"d-flex justify-content-center align-items-center",style:{height:"400px"},children:s.jsxDEV("div",{className:"spinner-border text-primary",role:"status",children:s.jsxDEV("span",{className:"visually-hidden",children:"Loading..."},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:650,columnNumber:11},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:649,columnNumber:9},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:648,columnNumber:7},void 0):s.jsxDEV("div",{className:"chat-wrapper",children:[s.jsxDEV("div",{className:"chat-sidebar card",children:[s.jsxDEV("div",{className:"chat-sidebar-single active top-profile",children:[s.jsxDEV("div",{className:"img",children:s.jsxDEV("img",{src:me,alt:"Current user"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:661,columnNumber:13},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:660,columnNumber:11},void 0),s.jsxDEV("div",{className:"info",children:[s.jsxDEV("h6",{className:"text-md mb-0",children:O},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:664,columnNumber:13},void 0),s.jsxDEV("p",{className:"mb-0 text-capitalize",children:Me},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:665,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:663,columnNumber:11},void 0),s.jsxDEV("div",{className:"action d-flex flex-column align-items-end",children:[s.jsxDEV("button",{type:"button",className:"btn btn-primary btn-sm mb-2",onClick:()=>L(!0),children:[s.jsxDEV(k,{icon:"mdi:plus"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:673,columnNumber:15},void 0)," Compose"]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:668,columnNumber:13},void 0),s.jsxDEV("div",{className:"btn-group",children:[s.jsxDEV("button",{type:"button",className:"text-secondary-light text-xl","data-bs-toggle":"dropdown","data-bs-display":"static","aria-expanded":"false",children:s.jsxDEV(k,{icon:"bi:three-dots"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:683,columnNumber:17},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:676,columnNumber:15},void 0),s.jsxDEV("ul",{className:"dropdown-menu dropdown-menu-lg-end border",children:s.jsxDEV("li",{children:s.jsxDEV(Se,{to:"/chat-profile",className:"dropdown-item rounded text-secondary-light bg-hover-neutral-200 text-hover-neutral-900 d-flex align-items-center gap-2",children:[s.jsxDEV(k,{icon:"fluent:person-32-regular"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:691,columnNumber:21},void 0),"Profile"]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:687,columnNumber:19},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:686,columnNumber:17},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:685,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:675,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:667,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:659,columnNumber:9},void 0),s.jsxDEV("div",{className:"d-flex justify-content-center my-2",children:[s.jsxDEV("button",{className:`btn btn-sm ${f==="inbox"?"btn-primary":"btn-outline-primary"} mx-1`,onClick:()=>i("inbox"),children:"Inbox"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:701,columnNumber:11},void 0),s.jsxDEV("button",{className:`btn btn-sm ${f==="sent"?"btn-primary":"btn-outline-primary"} mx-1`,onClick:()=>i("sent"),children:"Sent"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:707,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:700,columnNumber:9},void 0),s.jsxDEV("div",{className:"chat-search",children:s.jsxDEV("form",{children:[s.jsxDEV("input",{type:"text",name:"chatSearch",placeholder:"Search here..."},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:717,columnNumber:13},void 0),s.jsxDEV(k,{icon:"iconoir:search",className:"search-icon"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:718,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:716,columnNumber:11},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:715,columnNumber:9},void 0),s.jsxDEV("div",{className:"chat-all-list",children:M.filter(e=>f==="inbox"?e.isInbox:e.isSent).map(e=>{const a=xe(e),o=Ne(e),d=a?U(a.content,30):"No messages yet",x=a?ce(a.timestamp):"";return s.jsxDEV("div",{className:`chat-sidebar-single ${r?.id===e.id?"active":""}`,onClick:()=>{F(e)},style:{cursor:"pointer"},children:[s.jsxDEV("div",{className:"img",children:s.jsxDEV("img",{src:e.avatar,alt:e.name},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:743,columnNumber:21},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:742,columnNumber:19},void 0),s.jsxDEV("div",{className:"info",children:[s.jsxDEV("h6",{className:"text-sm mb-1",children:e.name},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:746,columnNumber:21},void 0),s.jsxDEV("p",{className:"mb-0 text-xs",children:d},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:747,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:745,columnNumber:19},void 0),s.jsxDEV("div",{className:"action text-end",children:[s.jsxDEV("p",{className:"mb-0 text-neutral-400 text-xs lh-1",children:x},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:750,columnNumber:21},void 0),o>0&&s.jsxDEV("span",{className:"w-16-px h-16-px text-xs rounded-circle bg-warning-main text-white d-inline-flex align-items-center justify-content-center",children:o},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:752,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:749,columnNumber:19},void 0)]},e.id,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:734,columnNumber:17},void 0)})},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:722,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:658,columnNumber:7},void 0),s.jsxDEV("div",{className:"chat-main card",children:[r?s.jsxDEV(s.Fragment,{children:[s.jsxDEV("div",{className:"chat-sidebar-single active mb-2",children:[s.jsxDEV("div",{className:"img",children:s.jsxDEV("img",{src:r.avatar,alt:r.name},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:769,columnNumber:17},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:768,columnNumber:15},void 0),s.jsxDEV("div",{className:"info",children:[s.jsxDEV("h6",{className:"text-md mb-0",children:r.name},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:772,columnNumber:17},void 0),s.jsxDEV("p",{className:"mb-0 text-xs",children:r.email},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:773,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:771,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:767,columnNumber:13},void 0),s.jsxDEV("div",{className:"chat-message-list",style:{maxHeight:"400px",overflowY:"auto"},children:[y.length>0?y.map((e,a)=>s.jsxDEV("div",{className:`chat-message-single ${W(e)?"from-current-user":""}`,style:{marginBottom:12},children:[s.jsxDEV("div",{className:"d-flex align-items-center mb-1",children:[s.jsxDEV("img",{src:W(e)?me:r.avatar,alt:"avatar",style:{width:32,height:32,borderRadius:"50%",marginRight:8}},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:782,columnNumber:23},void 0),s.jsxDEV("span",{className:"fw-bold",children:W(e)?O:r.name},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:783,columnNumber:23},void 0),s.jsxDEV("span",{className:"ms-2 text-muted",style:{fontSize:"0.85em"},children:ce(e.timestamp)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:784,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:781,columnNumber:21},void 0),s.jsxDEV("div",{className:"chat-message-content card p-2",children:e.content},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:786,columnNumber:21},void 0)]},e.id||a,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:780,columnNumber:19},void 0)):s.jsxDEV("div",{className:"text-center text-muted py-4",children:"No messages yet"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:790,columnNumber:17},void 0),s.jsxDEV("div",{ref:re},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:792,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:777,columnNumber:13},void 0),s.jsxDEV("form",{className:"chat-message-box mt-3",onSubmit:ge,children:s.jsxDEV("div",{className:"input-group",children:[s.jsxDEV("input",{type:"text",className:"form-control",placeholder:"Type your message...",value:j,onChange:e=>Z(e.target.value),disabled:D,required:!0},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:797,columnNumber:17},void 0),s.jsxDEV("button",{type:"submit",className:"btn btn-primary",disabled:D||!j.trim(),children:D?"Sending...":s.jsxDEV(k,{icon:"mdi:send"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:807,columnNumber:45},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:806,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:796,columnNumber:15},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:795,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:765,columnNumber:11},void 0):s.jsxDEV("div",{className:"d-flex flex-column align-items-center justify-content-center h-100 text-center",children:[s.jsxDEV(k,{icon:"fluent:chat-48-regular",className:"text-primary",style:{fontSize:"4rem"}},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:814,columnNumber:13},void 0),s.jsxDEV("h5",{className:"mt-3 mb-2",children:"Select a conversation"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:815,columnNumber:13},void 0),s.jsxDEV("p",{className:"text-muted",children:"Choose a contact from the sidebar to start messaging"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:816,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:813,columnNumber:11},void 0),$&&s.jsxDEV("div",{className:"modal-backdrop show",style:{zIndex:1050},children:s.jsxDEV("div",{className:"modal d-block",tabIndex:-1,role:"dialog",style:{zIndex:1060},children:s.jsxDEV("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:s.jsxDEV("div",{className:"modal-content",children:[s.jsxDEV("div",{className:"modal-header",children:[s.jsxDEV("h5",{className:"modal-title",children:"Compose New Message"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:826,columnNumber:21},void 0),s.jsxDEV("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>L(!1)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:827,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:825,columnNumber:19},void 0),s.jsxDEV("form",{onSubmit:async e=>{if(e.preventDefault(),!(!I.trim()||!T.trim())){ae(!0);try{await S.post("/api/messages",{to:I.trim(),subject:`Message from ${O}`,content:T.trim(),priority:"normal"}),B(""),ee(""),L(!1),E.success("Message sent"),await C({silent:!0})}catch(a){E.error(a?.response?.data?.message||"Failed to send message")}finally{ae(!1)}}},children:[s.jsxDEV("div",{className:"modal-body",children:[s.jsxDEV("div",{className:"mb-3",children:[s.jsxDEV("label",{className:"form-label",children:"Recipient Email"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:855,columnNumber:25},void 0),s.jsxDEV("div",{style:{position:"relative"},children:[s.jsxDEV("input",{type:"email",className:"form-control",value:I,onChange:e=>{B(e.target.value),ne(e.target.value),R(!0)},onFocus:()=>R(!0),onBlur:()=>setTimeout(()=>R(!1),150),autoComplete:"off",required:!0},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:857,columnNumber:27},void 0),he&&w.trim()&&s.jsxDEV("div",{style:{position:"absolute",zIndex:100,top:"100%",left:0,right:0,background:"#fff",border:"1px solid #ddd",maxHeight:200,overflowY:"auto",borderRadius:4},children:[ie.filter(e=>e.email&&e.email.toLowerCase().includes(w.toLowerCase())||e.name&&e.name.toLowerCase().includes(w.toLowerCase())).slice(0,10).map((e,a)=>s.jsxDEV("div",{style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid #eee"},onMouseDown:()=>{B(e.email),ne(e.email),R(!1)},children:[s.jsxDEV("span",{style:{fontWeight:500},children:e.name},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:889,columnNumber:37},void 0),s.jsxDEV("span",{style:{color:"#888",marginLeft:8},children:e.email},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:890,columnNumber:37},void 0),s.jsxDEV("span",{style:{color:"#aaa",marginLeft:8,fontSize:"0.9em"},children:["(",e.role,")"]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:891,columnNumber:37},void 0)]},e.email+a,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:880,columnNumber:35},void 0)),ie.filter(e=>e.email&&e.email.toLowerCase().includes(w.toLowerCase())||e.name&&e.name.toLowerCase().includes(w.toLowerCase())).length===0&&s.jsxDEV("div",{style:{padding:"8px 12px",color:"#888"},children:"No matches found"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:898,columnNumber:33},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:872,columnNumber:29},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:856,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:854,columnNumber:23},void 0),s.jsxDEV("div",{className:"mb-3",children:[s.jsxDEV("label",{className:"form-label",children:"Message"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:905,columnNumber:25},void 0),s.jsxDEV("textarea",{className:"form-control",rows:4,value:T,onChange:e=>ee(e.target.value),required:!0},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:906,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:904,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:853,columnNumber:21},void 0),s.jsxDEV("div",{className:"modal-footer",children:[s.jsxDEV("button",{type:"button",className:"btn btn-secondary",onClick:()=>L(!1),children:"Cancel"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:916,columnNumber:23},void 0),s.jsxDEV("button",{type:"submit",className:"btn btn-primary",disabled:se||!I.trim()||!T.trim(),children:se?"Sending...":"Send"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:919,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:915,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:829,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:824,columnNumber:17},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:823,columnNumber:15},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:822,columnNumber:13},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:821,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:763,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:657,columnNumber:5},void 0)};export{Ce as M};
