import{e as he,r as h,c as ne,h as ge,b as I,a as b,j as a,w as be}from"./index-BiIypJQ8.js";import{M as fe}from"./MasterLayout-R6RBQnho.js";import"./iconify-BEfBG96Y.js";const T="/api/lms",J="vendor_profile_working_v1",$="vendor_profile_undo_v1",ie="vendor_profile_history_cache_v1";function M(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return null}}function H(e){return JSON.parse(JSON.stringify(e))}function oe(){return Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,8)}function le(e){const l=new Date(e);return isNaN(l)?"—":l.toLocaleString()}function xe(e){var x,p,y,S,n,j;const l=((e==null?void 0:e.contactEmail)||(e==null?void 0:e.email)||"").toLowerCase();return{id:String((e==null?void 0:e.vendorId)||(e==null?void 0:e.id)||""),name:(e==null?void 0:e.name)||"",contactEmail:l,ownerUid:(e==null?void 0:e.ownerUid)||"",phone:(e==null?void 0:e.phone)||"",website:(e==null?void 0:e.website)||"",description:(e==null?void 0:e.description)||"",logoUrl:(e==null?void 0:e.logoUrl)||(e==null?void 0:e.logo)||"",bannerUrl:(e==null?void 0:e.bannerUrl)||"",country:(e==null?void 0:e.country)||"",city:(e==null?void 0:e.city)||"",addressLine:(e==null?void 0:e.addressLine)||"",socials:{twitter:((x=e==null?void 0:e.socials)==null?void 0:x.twitter)||"",linkedin:((p=e==null?void 0:e.socials)==null?void 0:p.linkedin)||"",facebook:((y=e==null?void 0:e.socials)==null?void 0:y.facebook)||"",instagram:((S=e==null?void 0:e.socials)==null?void 0:S.instagram)||"",youtube:((n=e==null?void 0:e.socials)==null?void 0:n.youtube)||"",github:((j=e==null?void 0:e.socials)==null?void 0:j.github)||""},categories:Array.isArray(e==null?void 0:e.categories)?e.categories:[],tags:Array.isArray(e==null?void 0:e.tags)?e.tags:[],foundedYear:(e==null?void 0:e.foundedYear)||"",teamSize:(e==null?void 0:e.teamSize)||"",registrationNo:(e==null?void 0:e.registrationNo)||"",status:((e==null?void 0:e.status)||"pending").toLowerCase(),kycStatus:(e==null?void 0:e.kycStatus)||"pending"}}function V(e,l={}){const x=((e==null?void 0:e.email)||(e==null?void 0:e.contactEmail)||l.email||"").toLowerCase(),p=(e==null?void 0:e.socials)??{};return{id:String((e==null?void 0:e.id)??(e==null?void 0:e.vendorId)??l.vendorId??oe()),vendorId:String((e==null?void 0:e.vendorId)??(e==null?void 0:e.id)??l.vendorId??""),name:(e==null?void 0:e.name)??(e==null?void 0:e.companyName)??(e==null?void 0:e.vendor)??l.name??"",contactEmail:x,ownerUid:(e==null?void 0:e.ownerUid)??(e==null?void 0:e.uid)??l.uid??"",website:(e==null?void 0:e.website)??"",phone:(e==null?void 0:e.phone)??"",country:(e==null?void 0:e.country)??"",city:(e==null?void 0:e.city)??"",addressLine:(e==null?void 0:e.addressLine)??"",logoUrl:(e==null?void 0:e.logoUrl)??(e==null?void 0:e.logo)??"",bannerUrl:(e==null?void 0:e.bannerUrl)??"",description:(e==null?void 0:e.description)??"",categories:Array.isArray(e==null?void 0:e.categories)?e.categories:[],tags:Array.isArray(e==null?void 0:e.tags)?e.tags:[],foundedYear:(e==null?void 0:e.foundedYear)??"",teamSize:(e==null?void 0:e.teamSize)??"",registrationNo:(e==null?void 0:e.registrationNo)??"",status:((e==null?void 0:e.status)||"pending").toLowerCase(),socials:{twitter:p.twitter??"",linkedin:p.linkedin??"",facebook:p.facebook??"",instagram:p.instagram??"",youtube:p.youtube??"",github:p.github??""},lastUpdated:(e==null?void 0:e.lastUpdated)??""}}function ye(e,l){if(!e)return null;const x=((l==null?void 0:l.email)||"").toLowerCase(),p=[Array.isArray(e.startups)&&e.startups,Array.isArray(e.vendors)&&e.vendors,Array.isArray(e.companies)&&e.companies,Array.isArray(e.profiles)&&e.profiles].filter(Boolean);for(const y of p){const S=y.find(n=>(n==null?void 0:n.ownerUid)&&n.ownerUid===(l==null?void 0:l.uid)||(n==null?void 0:n.email)&&String(n.email).toLowerCase()===x||(n==null?void 0:n.contactEmail)&&String(n.contactEmail).toLowerCase()===x||(l==null?void 0:l.vendorId)&&(String(n==null?void 0:n.vendorId)===String(l.vendorId)||String(n==null?void 0:n.id)===String(l.vendorId)));if(S)return V(S,l)}return null}function Se(){var ee,ae,se,te,re;const{vendor:e,ensureVendorId:l,refresh:x}=he(),p=h.useMemo(()=>sessionStorage.getItem("tenantId")||"vendor",[]),[y,S]=h.useState(()=>M(localStorage.getItem(J))??ne),n=ge(sessionStorage.getItem("role")),[j,q]=h.useState(()=>n?M(localStorage.getItem(ie))??[]:[]),[C,L]=h.useState(!1),[G,w]=h.useState(""),[K,k]=h.useState(""),[W,Q]=h.useState(""),[X,ce]=h.useState(!0),A=h.useRef([]),D=h.useCallback(s=>{const r=[s,...A.current||[]].slice(0,10);A.current=r,localStorage.setItem($,JSON.stringify(r))},[]),Z=h.useCallback(()=>{var i;const s=(i=A.current)!=null&&i.length?A.current:M(localStorage.getItem($))??[];if(!s.length)return;const r=s.shift();A.current=s,localStorage.setItem($,JSON.stringify(s)),S(r),localStorage.setItem(J,JSON.stringify(r))},[]),E=h.useCallback(s=>{S(r=>(D(r),localStorage.setItem(J,JSON.stringify(s)),s))},[D]),_=h.useCallback(async()=>{if(!n){q([]);return}try{const{data:s}=await I.get(`${T}/checkpoints`,{headers:{"x-tenant-id":p,"cache-control":"no-cache"}}),r=Array.isArray(s==null?void 0:s.items)?s.items:[];q(r),localStorage.setItem(ie,JSON.stringify(r.slice(0,2)))}catch{}},[n,p]);h.useEffect(()=>{let s=!0;return(async()=>{L(!0);try{await l();let r=ne;try{const{data:i}=await I.get(`${T}/live`,{headers:{"x-tenant-id":p,"cache-control":"no-cache"}});s&&i&&(r=i)}catch{}try{const i=await I.get("/api/data/vendors").then(m=>m.data||[]),u=H(r);u.startups=Array.isArray(u.startups)?u.startups:[],i.forEach(m=>{const N=V(m),U=u.startups.findIndex(d=>String(d.vendorId||d.id)===N.vendorId);U>=0?u.startups[U]={...u.startups[U],...N}:u.startups.push(N)}),r=u}catch{}E(r),n&&await _()}catch{}finally{s&&L(!1)}})(),()=>{s=!1}},[p,n,l,E,_]);const f=h.useMemo(()=>{var r,i,u;const s={uid:(r=b.currentUser)==null?void 0:r.uid,email:((i=b.currentUser)==null?void 0:i.email)||(e==null?void 0:e.email)||"",name:((u=b.currentUser)==null?void 0:u.displayName)||(e==null?void 0:e.name)||"",vendorId:(e==null?void 0:e.vendorId)||""};return ye(y,s)||V({},s)},[y,e==null?void 0:e.vendorId,(ee=b.currentUser)==null?void 0:ee.uid,(ae=b.currentUser)==null?void 0:ae.email]),[t,P]=h.useState(()=>f);h.useEffect(()=>{P(f)},[f]);const c=!b.currentUser,R=((f==null?void 0:f.status)||"").toLowerCase(),F=((f==null?void 0:f.kycStatus)||"").toLowerCase(),z=R==="active"||F==="approved",de=R==="pending"||F==="pending",B=R==="suspended"||F==="rejected";function g(s,r){P(i=>({...i,[s]:r}))}function me(s,r){P(i=>({...i,socials:{...i.socials,[s]:r}}))}async function ue(s){if(!n){w("Only administrators can save checkpoints.");return}try{await I.post(`${T}/checkpoints`,{message:s||"Vendor profile update",data:y},{headers:{"Content-Type":"application/json","x-tenant-id":p}}),k("Checkpoint saved"),await _(),Q("")}catch(r){w((r==null?void 0:r.message)||"Failed to save checkpoint")}}async function v(){var U,d,Y,O;if(w(""),k(""),c){w("You need to sign in first.");return}if(!t.name.trim()){w("Vendor name is required.");return}const s=H(y);D(s);const r=H(y);r.startups=Array.isArray(r.startups)?r.startups:[];const i=String(t.vendorId||t.id||(e==null?void 0:e.vendorId)||((U=b.currentUser)==null?void 0:U.uid)||oe()),u=(t.contactEmail||((d=b.currentUser)==null?void 0:d.email)||"").toLowerCase(),m={...t,id:i,vendorId:i,ownerUid:((Y=b.currentUser)==null?void 0:Y.uid)||t.ownerUid||"",contactEmail:u,email:u,lastUpdated:new Date().toISOString()},N=r.startups.findIndex(o=>String(o.vendorId)===i||String(o.id)===i||o.email&&String(o.email).toLowerCase()===u);N>=0?r.startups[N]={...r.startups[N],...m}:r.startups.push(m),X&&Array.isArray(r.services)&&(r.services=r.services.map(o=>String(o.vendorId||"")===i?{...o,vendor:m.name}:o));try{L(!0);const o=xe(m);o.id?await I.put(`/api/data/vendors/${encodeURIComponent(o.id)}`,o):await I.post("/api/data/vendors",o);try{await be({action:"VENDOR_UPSERT",userEmail:(O=b.currentUser)==null?void 0:O.email,targetType:"vendor",targetId:i,metadata:{name:m.name}})}catch{}E(r),k("Profile saved to live."),await(x==null?void 0:x()),await _(),window.scrollTo({top:0,behavior:"smooth"})}catch(o){w((o==null?void 0:o.message)||"Save failed"),E(s)}finally{L(!1)}}async function pe(){var s,r,i,u;w(""),k("");try{const m=b.currentUser;if(!m)throw new Error("Please sign in");const N=(m.email||"").toLowerCase(),d=(await I.get("/api/data/startups").then(o=>o.data||[])).find(o=>o.ownerUid&&o.ownerUid===m.uid||(o.contactEmail||o.email||"").toLowerCase()===N);if(!d){w("No startup profile found to import.");return}const Y=[d.elevatorPitch||"",d.productsServices||""].filter(Boolean).join(`

`),O={...t,name:t.name||d.name||"",description:t.description||Y,contactEmail:(t.contactEmail||d.contactEmail||N).toLowerCase(),phone:t.phone||d.phone||"",website:t.website||d.website||"",country:t.country||d.country||"",city:t.city||d.city||"",addressLine:t.addressLine||d.addressLine||"",categories:(s=t.categories)!=null&&s.length?t.categories:Array.isArray(d.categories)?d.categories:[],tags:(r=t.tags)!=null&&r.length?t.tags:Array.isArray(d.tags)?d.tags:[],teamSize:t.teamSize||String(d.employeeCount||"")};P(O),k("Imported details from your Startup profile. Review and Save changes."),window.scrollTo({top:0,behavior:"smooth"})}catch(m){w(((u=(i=m==null?void 0:m.response)==null?void 0:i.data)==null?void 0:u.message)||(m==null?void 0:m.message)||"Import failed")}}return a.jsx(fe,{children:a.jsxs("div",{className:"container py-4",style:{maxWidth:980},children:[a.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"h4 mb-0",children:"My Vendor Profile"}),a.jsxs("div",{className:"text-muted small",children:["Signed in as"," ",a.jsx("strong",{children:f.name||((se=b.currentUser)==null?void 0:se.displayName)||"Vendor"})," ","· ",f.contactEmail||((te=b.currentUser)==null?void 0:te.email)||"email not set",a.jsx("span",{className:`badge ms-2 text-bg-${z?"success":B?"danger":"warning"}`,children:z?"Approved":B?"Suspended":"Pending"})]}),a.jsxs("div",{className:"text-muted small",children:["Vendor ID:"," ",f.vendorId?a.jsx("code",{children:f.vendorId}):"pending"]}),z&&a.jsxs("div",{className:"alert alert-success mt-3 mb-0",children:["Your vendor account is approved. You can now submit listings to the marketplace.",a.jsxs("div",{className:"mt-2 d-flex gap-2",children:[a.jsx("a",{className:"btn btn-primary btn-sm",href:"/listings-vendors",children:"+ Submit new listing"}),a.jsx("a",{className:"btn btn-outline-secondary btn-sm",href:"/listings-vendors-mine",children:"View my listings"})]})]}),de&&a.jsx("div",{className:"alert alert-warning mt-3 mb-0",children:"Your vendor account is pending approval. Please complete your profile details and wait for an admin to approve your account. You’ll be able to submit listings once approved."}),B&&a.jsx("div",{className:"alert alert-danger mt-3 mb-0",children:"Your vendor account is suspended. You cannot submit listings. Please contact support if you believe this is an error."})]}),a.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[a.jsx("button",{className:"btn btn-outline-secondary",onClick:Z,disabled:C,children:"Undo"}),a.jsx("button",{className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:v,disabled:C||c,title:"Save changes to live",children:C?"Saving…":"Save changes"})]})]}),c&&a.jsx("div",{className:"alert alert-warning",children:"Please sign in to manage your vendor profile."}),G&&a.jsx("div",{className:"alert alert-danger",children:G}),K&&a.jsx("div",{className:"alert alert-success",children:K}),a.jsxs("div",{className:"row g-3",children:[a.jsxs("div",{className:"col-lg-8",children:[a.jsx("div",{className:"d-flex justify-content-end mb-2",children:a.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:pe,disabled:C||c,title:"Import company details from your Startup profile",children:"Import from Startup Profile"})}),a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"card-header fw-semibold",children:"Company details"}),a.jsx("div",{className:"card-body",children:a.jsxs("div",{className:"row g-3",children:[a.jsxs("div",{className:"col-md-8",children:[a.jsx("label",{className:"form-label",children:"Company / Vendor name"}),a.jsx("input",{className:"form-control",value:t.name,onChange:s=>g("name",s.target.value),placeholder:"e.g., Acme Studio",disabled:c,required:!0})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsx("label",{className:"form-label",children:"Contact email"}),a.jsx("input",{className:"form-control",value:t.contactEmail,onChange:s=>g("contactEmail",s.target.value.toLowerCase()),placeholder:"you@company.com",disabled:c})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Website"}),a.jsx("input",{className:"form-control",value:t.website,onChange:s=>g("website",s.target.value),placeholder:"https://…",disabled:c})]}),a.jsxs("div",{className:"col-md-3",children:[a.jsx("label",{className:"form-label",children:"Phone"}),a.jsx("input",{className:"form-control",value:t.phone,onChange:s=>g("phone",s.target.value),placeholder:"+27…",disabled:c})]}),a.jsxs("div",{className:"col-md-3",children:[a.jsx("label",{className:"form-label",children:"Founded (year)"}),a.jsx("input",{className:"form-control",value:t.foundedYear,onChange:s=>g("foundedYear",s.target.value),placeholder:"2021",disabled:c})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsx("label",{className:"form-label",children:"Country"}),a.jsx("input",{className:"form-control",value:t.country,onChange:s=>g("country",s.target.value),placeholder:"South Africa",disabled:c})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsx("label",{className:"form-label",children:"City"}),a.jsx("input",{className:"form-control",value:t.city,onChange:s=>g("city",s.target.value),placeholder:"Cape Town",disabled:c})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsx("label",{className:"form-label",children:"Team size"}),a.jsx("input",{className:"form-control",value:t.teamSize,onChange:s=>g("teamSize",s.target.value),placeholder:"1–10",disabled:c})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Company reg. number"}),a.jsx("input",{className:"form-control",value:t.registrationNo,onChange:s=>g("registrationNo",s.target.value),placeholder:"(optional)",disabled:c})]}),a.jsxs("div",{className:"col-md-6 d-none",children:[a.jsx("label",{className:"form-label",children:"Status"}),a.jsxs("select",{className:"form-select",value:t.status,onChange:s=>g("status",s.target.value),disabled:c,children:[a.jsx("option",{value:"active",children:"active"}),a.jsx("option",{value:"pending",children:"pending"}),a.jsx("option",{value:"suspended",children:"suspended"})]})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Logo URL"}),a.jsx("input",{className:"form-control",value:t.logoUrl,onChange:s=>g("logoUrl",s.target.value),placeholder:"https://…",disabled:c})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Banner URL"}),a.jsx("input",{className:"form-control",value:t.bannerUrl,onChange:s=>g("bannerUrl",s.target.value),placeholder:"https://…",disabled:c})]}),a.jsxs("div",{className:"col-12",children:[a.jsx("label",{className:"form-label",children:"Description"}),a.jsx("textarea",{className:"form-control",rows:4,value:t.description,onChange:s=>g("description",s.target.value),placeholder:"Tell buyers what you do, problems you solve, and why you're different.",disabled:c})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Categories (comma-separated)"}),a.jsx("input",{className:"form-control",value:t.categories.join(", "),onChange:s=>g("categories",s.target.value.split(",").map(r=>r.trim()).filter(Boolean)),placeholder:"Design, Branding",disabled:c})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Tags (comma-separated)"}),a.jsx("input",{className:"form-control",value:t.tags.join(", "),onChange:s=>g("tags",s.target.value.split(",").map(r=>r.trim()).filter(Boolean)),placeholder:"logos, identity, saas",disabled:c})]}),a.jsx("div",{className:"col-12",children:a.jsx("div",{className:"row g-3",children:[["twitter","Twitter"],["linkedin","LinkedIn"],["facebook","Facebook"],["instagram","Instagram"],["youtube","YouTube"],["github","GitHub"]].map(([s,r])=>a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:r}),a.jsx("input",{className:"form-control",value:t.socials[s],onChange:i=>me(s,i.target.value),placeholder:`https://${s}.com/...`,disabled:c})]},s))})}),a.jsxs("div",{className:"col-12 d-flex align-items-center gap-2",children:[a.jsx("input",{id:"propagateName",type:"checkbox",className:"form-check-input",checked:X,onChange:s=>ce(!!s.target.checked),disabled:c}),a.jsx("label",{htmlFor:"propagateName",className:"form-check-label",children:"Update my display name on all existing listings"})]}),a.jsxs("div",{className:"col-12 d-flex gap-2 mt-2",children:[a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:Z,disabled:C,children:"Undo"}),a.jsx("button",{type:"button",className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:v,disabled:C||c,children:C?"Saving…":"Save changes"})]}),t.lastUpdated&&a.jsxs("div",{className:"form-text mt-1",children:["Last updated: ",le(t.lastUpdated)]})]})})]})]}),a.jsxs("div",{className:"col-lg-4",children:[a.jsxs("div",{className:"card mb-3",children:[a.jsx("div",{className:"card-header fw-semibold",children:"Preview"}),a.jsxs("div",{className:"card-body",children:[a.jsxs("div",{className:"d-flex align-items-center gap-3",children:[a.jsx("img",{src:t.logoUrl||"/assets/images/placeholder-1x1.png",alt:"logo",style:{width:64,height:64,objectFit:"cover",borderRadius:8}}),a.jsxs("div",{children:[a.jsx("div",{className:"fw-semibold",children:t.name||"Vendor"}),a.jsx("div",{className:"text-muted small",children:t.contactEmail||((re=b.currentUser)==null?void 0:re.email)||"email"}),a.jsx("div",{className:"small",children:t.website?a.jsx("a",{href:t.website,target:"_blank",rel:"noreferrer",children:t.website}):"website"})]})]}),t.bannerUrl&&a.jsx("div",{className:"mt-3",children:a.jsx("img",{src:t.bannerUrl,alt:"banner",className:"w-100",style:{maxHeight:140,objectFit:"cover",borderRadius:8}})}),a.jsxs("div",{className:"mt-3 small text-muted",children:["Categories: ",t.categories.join(", ")||"—",a.jsx("br",{}),"Tags: ",t.tags.join(", ")||"—"]})]})]}),n&&a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"card-header fw-semibold d-flex align-items-center justify-content-between",children:a.jsx("span",{children:"Version control"})}),a.jsxs("div",{className:"card-body",children:[a.jsxs("div",{className:"d-flex gap-2 mb-2",children:[a.jsx("input",{className:"form-control",placeholder:"Checkpoint message",value:W,onChange:s=>Q(s.target.value)}),a.jsx("button",{className:"btn btn-outline-primary",onClick:()=>ue(W),disabled:C||c,children:"Save checkpoint"})]}),a.jsxs("div",{className:"list-group list-group-flush",children:[!(j!=null&&j.length)&&a.jsx("div",{className:"text-muted small",children:"No checkpoints yet. Create one after saving changes."}),j==null?void 0:j.slice(0,6).map(s=>a.jsxs("div",{className:"list-group-item",children:[a.jsx("div",{className:"fw-semibold",children:s.message||"(no message)"}),a.jsx("div",{className:"text-muted small",children:le(s.ts)}),a.jsx("div",{className:"d-flex gap-2 mt-1",children:a.jsx("a",{className:"btn btn-sm btn-outline-secondary",href:`${T}/checkpoints/${s.id}`,target:"_blank",rel:"noreferrer",children:"Download snapshot"})})]},s.id))]}),a.jsx("div",{className:"form-text mt-2",children:"Checkpoints snapshot the whole marketplace data (including your profile) on the server."})]})]})]})]})]})})}export{Se as default};
