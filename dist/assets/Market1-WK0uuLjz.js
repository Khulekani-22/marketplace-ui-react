import{b as W,a as k,j as e}from"./index-C_y_1zWD.js";import{r as o,b as U}from"./vendor-5dkO6nAt.js";import{f as $,u as q,s as Y}from"./subscriptions-6h7sIMBl.js";import{u as Q}from"./useWalletAxios-DYU42ogV.js";import"./firebase-DMFzVTL_.js";import"./utils-B2rxisVD.js";const T=new Intl.NumberFormat("en-ZA");function g(c){if(typeof c=="number"&&Number.isFinite(c))return c;if(c==null)return 0;const b=String(c),d=Number(b.replace(/[^0-9.]/g,""));return Number.isFinite(d)?d:0}function p(c){return T.format(Math.round(c))}function K(){const[c,b]=o.useState([]),[d,E]=o.useState(""),[D,M]=o.useState(!0),[v,f]=o.useState(()=>new Set),[r,u]=o.useState({open:!1,service:null,working:!1,error:"",success:""}),[V,X]=o.useState(()=>new Set),h=U(),w=o.useMemo(()=>sessionStorage.getItem("tenantId")||"vendor",[]),{wallet:n,loading:N,eligible:m,redeemCredits:y}=Q(),x=o.useCallback(async()=>{M(!0);const{data:a}=await W.get("/api/data/services",{params:{q:d||void 0,page:1,pageSize:40,featured:"true"}});b(Array.isArray(a.items)?a.items:[]),M(!1)},[d]);o.useEffect(()=>{x()},[x]),o.useEffect(()=>{(async()=>{try{if(!k.currentUser)return;const a=await $(),i=new Set(a.filter(s=>(s.type||"service")==="service").map(s=>String(s.serviceId)));f(i)}catch{}})()},[w]),o.useEffect(()=>{if(!r.open||typeof document>"u")return;const{body:a}=document;if(a)return a.classList.add("modal-open"),()=>a.classList.remove("modal-open")},[r.open]);async function S(a){try{if(!k.currentUser){h("/login",{replace:!0,state:{from:window.location?.pathname||"/"}});return}const i=String(a);v.has(i)?(await q(i),f(t=>{const l=new Set(t);return l.delete(i),l})):(await Y(i),f(t=>{const l=new Set(t);return l.add(i),l}))}catch{}}function C(a){if(!k.currentUser){h("/login",{replace:!0,state:{from:window.location?.pathname||"/"}});return}u({open:!0,service:a,working:!1,error:m?"":"My Wallet is only available to startup, vendor, and admin accounts.",success:""})}function P(){u({open:!1,service:null,working:!1,error:"",success:""})}async function R(){const a=r.service;if(!a)return;if(!m){u(s=>({...s,error:"Your account does not have voucher access yet."}));return}if(!n){u(s=>({...s,error:"We could not load your wallet. Please try again."}));return}const i=g(a.price);if(i<=0){u(s=>({...s,success:"This listing does not require voucher credits.",error:""}));return}if(!n||n.balance<i){u(s=>({...s,error:"You do not have enough voucher credits for this listing."}));return}u(s=>({...s,working:!0,error:"",success:""}));try{const s=await y(i,{description:`Listing purchase: ${a.title||"Marketplace service"}`,reference:`listing-${a.id||"unknown"}`,metadata:{serviceId:a.id||null,vendor:a.vendor||null,category:a.category||null}});if(!s.success){u(t=>({...t,working:!1,error:s.error||"Unable to redeem vouchers."}));return}X(t=>{const l=new Set(t);return l.add(String(a.id)),l}),u(t=>({...t,working:!1,error:"",success:`Voucher applied! Remaining balance: ${p(s.wallet?.balance||0)} credits.`}))}catch{u(t=>({...t,working:!1,error:"Unable to redeem vouchers."}))}}function F(){if(!r.open||!r.service)return null;const a=r.service,i=g(a.price),s=n?.balance??0,t=Math.max(0,i-s),l=r.working||N||!m||!n||i<=0||s<i;return e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"modal fade show d-block",tabIndex:-1,role:"dialog","aria-modal":"true",children:e.jsxDEV("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxDEV("div",{className:"modal-content",children:[e.jsxDEV("div",{className:"modal-header",children:[e.jsxDEV("h5",{className:"modal-title",children:"Redeem voucher credits"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:192,columnNumber:17},this),e.jsxDEV("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:P},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:193,columnNumber:17},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:191,columnNumber:15},this),e.jsxDEV("div",{className:"modal-body",children:[e.jsxDEV("h6",{className:"mb-1",children:a.title},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:196,columnNumber:17},this),e.jsxDEV("p",{className:"text-muted mb-3",children:a.description||"Marketplace listing"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:197,columnNumber:17},this),e.jsxDEV("dl",{className:"row mb-0",children:[e.jsxDEV("dt",{className:"col-6",children:"Listing price"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:199,columnNumber:19},this),e.jsxDEV("dd",{className:"col-6 text-end",children:["R ",p(i)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:200,columnNumber:19},this),e.jsxDEV("dt",{className:"col-6",children:"Wallet balance"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:201,columnNumber:19},this),e.jsxDEV("dd",{className:"col-6 text-end",children:["R ",p(s)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:202,columnNumber:19},this),e.jsxDEV("dt",{className:"col-6",children:"After redeeming"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:203,columnNumber:19},this),e.jsxDEV("dd",{className:"col-6 text-end",children:["R ",p(Math.max(0,s-i))]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:204,columnNumber:19},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:198,columnNumber:17},this),!m&&e.jsxDEV("div",{className:"alert alert-warning mt-3 mb-0",children:"My Wallet is only available to startup, vendor, and admin accounts."},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:207,columnNumber:19},this),m&&n&&t>0&&e.jsxDEV("div",{className:"alert alert-warning mt-3 mb-0",children:["You need an additional ",p(t)," credits to redeem this listing."]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:210,columnNumber:19},this),r.error&&e.jsxDEV("div",{className:"alert alert-danger mt-3 mb-0",children:r.error},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:215,columnNumber:19},this),r.success&&e.jsxDEV("div",{className:"alert alert-success mt-3 mb-0",children:r.success},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:218,columnNumber:19},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:195,columnNumber:15},this),e.jsxDEV("div",{className:"modal-footer d-flex justify-content-between",children:[e.jsxDEV("button",{type:"button",className:"btn btn-outline-secondary",onClick:P,disabled:r.working,children:"Close"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:222,columnNumber:17},this),e.jsxDEV("button",{type:"button",className:"btn btn-primary",onClick:()=>void R(),disabled:l,children:r.working?"Processing…":"Redeem now"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:225,columnNumber:17},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:221,columnNumber:15},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:190,columnNumber:13},this)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:189,columnNumber:11},this)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:188,columnNumber:9},this),e.jsxDEV("div",{className:"modal-backdrop fade show"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:237,columnNumber:9},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:187,columnNumber:7},this)}return e.jsxDEV("div",{className:"container py-4",children:[e.jsxDEV("div",{className:"d-flex align-items-end justify-content-between mb-3",children:[e.jsxDEV("div",{children:[e.jsxDEV("h1",{className:"h4 mb-1",children:"Featured Marketplace"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:246,columnNumber:11},this),e.jsxDEV("small",{className:"text-muted",children:"Discover services from trusted vendors"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:247,columnNumber:11},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:245,columnNumber:9},this),e.jsxDEV("div",{className:"d-flex gap-2",children:[e.jsxDEV("input",{className:"form-control",placeholder:"Search…",value:d,onChange:a=>E(a.target.value)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:250,columnNumber:11},this),e.jsxDEV("button",{className:"btn btn-primary",onClick:x,children:"Search"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:251,columnNumber:11},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:249,columnNumber:9},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:244,columnNumber:7},this),m&&n&&e.jsxDEV("div",{className:"alert alert-primary d-flex justify-content-between align-items-center",children:[e.jsxDEV("span",{children:[e.jsxDEV("strong",{children:"My Wallet:"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:260,columnNumber:13},this)," ",p(n.balance)," credits available."]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:259,columnNumber:11},this),e.jsxDEV("button",{className:"btn btn-sm btn-outline-light",onClick:()=>h("/wallet"),children:"View wallet"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:262,columnNumber:11},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:258,columnNumber:9},this),D?e.jsxDEV("p",{children:"Loading…"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:269,columnNumber:9},this):e.jsxDEV("div",{className:"row g-3",children:[c.length===0&&e.jsxDEV("p",{className:"text-muted",children:"No featured services yet."},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:272,columnNumber:34},this),c.map(a=>{const i=g(a.price),s=String(a.id),t=V.has(s),l=v.has(s),A=n?.balance??0,j=m&&n&&i>A,I=t?"Redeemed":m?"Redeem":"Select",L=t?"btn btn-success btn-sm":"btn btn-outline-primary btn-sm";return e.jsxDEV("div",{className:"col-12 col-md-6 col-lg-4",children:e.jsxDEV("div",{className:"card h-100",children:e.jsxDEV("div",{className:"card-body d-flex flex-column",children:[e.jsxDEV("div",{className:"d-flex justify-content-between align-items-start gap-2",children:[e.jsxDEV("h5",{className:"card-title mb-0",children:a.title},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:288,columnNumber:23},this),a.isFeatured&&e.jsxDEV("span",{className:"badge text-bg-success",children:"Featured"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:289,columnNumber:40},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:287,columnNumber:21},this),e.jsxDEV("div",{className:"text-muted mb-2",children:[a.category," · ",a.vendor]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:291,columnNumber:21},this),e.jsxDEV("p",{className:"flex-grow-1",children:a.description||"Quality service for SMMEs."},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:292,columnNumber:21},this),e.jsxDEV("div",{className:"d-flex flex-column gap-2",children:[e.jsxDEV("strong",{children:["R ",p(i)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:294,columnNumber:23},this),m&&n&&e.jsxDEV("small",{className:j?"text-danger":"text-success",children:j?`Short by ${p(i-A)} credits`:"Covered by your voucher balance"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:296,columnNumber:25},this),e.jsxDEV("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxDEV("button",{className:L,onClick:()=>C(a),disabled:N||t,children:N?"Checking wallet…":I},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:303,columnNumber:25},this),e.jsxDEV("button",{className:l?"btn btn-sm btn-secondary":"btn btn-sm btn-primary",onClick:()=>S(a.id),children:l?"Subscribed":"Subscribe"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:310,columnNumber:25},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:302,columnNumber:23},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:293,columnNumber:21},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:286,columnNumber:19},this)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:285,columnNumber:17},this)},s,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:284,columnNumber:15},this)})]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:271,columnNumber:9},this),F()]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/Market1.tsx",lineNumber:243,columnNumber:5},this)}export{K as default};
