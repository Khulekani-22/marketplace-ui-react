import{r,b as y,j as e,c as v}from"./index-C9a1Nhcx.js";import{M as N}from"./MasterLayout-DrERsAgF.js";import{B as S}from"./Breadcrumb-DiuFWBhu.js";import{f as M,u as w}from"./subscriptions-BsRBstXm.js";import"./iconify-53c4nGdq.js";function A(){const[h,d]=r.useState(!0),[u,o]=r.useState([]),[g,b]=r.useState(""),[x,f]=r.useState({}),p=r.useMemo(()=>sessionStorage.getItem("tenantId")||"vendor",[]),{appData:c}=y();r.useEffect(()=>{let s=!1;async function a(){d(!0),b("");try{if(!v.currentUser){o([]),d(!1);return}const i=await M(),l=new Set(i.filter(n=>(n.type||"service")==="service").map(n=>String(n.serviceId))),m=(Array.isArray(c==null?void 0:c.services)?c.services:[]).filter(n=>l.has(String(n.id)));s||o(m)}catch(i){s||b((i==null?void 0:i.message)||"Failed to load subscriptions")}finally{s||d(!1)}}return a(),()=>{s=!0}},[p]);async function j(s){var i,l;const a=String(s);f(t=>({...t,[a]:!0}));try{await w(a),o(t=>t.filter(m=>String(m.id)!==a))}catch(t){alert(((l=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:l.message)||(t==null?void 0:t.message)||"Failed to unsubscribe")}finally{f(t=>({...t,[a]:!1}))}}return e.jsxs(N,{children:[e.jsx(S,{title:"My Subscriptions"}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[g&&e.jsx("div",{className:"alert alert-danger",children:g}),h?e.jsx("div",{children:"Loading…"}):e.jsxs("div",{className:"row g-3",children:[u.length===0&&e.jsx("div",{className:"col-12 text-secondary",children:"No subscriptions yet."}),u.map(s=>e.jsx("div",{className:"col-12 col-md-6 col-lg-4",children:e.jsxs("div",{className:"card h-100",children:[e.jsx("img",{src:s.imageUrl||"/assets/images/services/placeholder.png",className:"card-img-top",alt:s.title||"Listing",style:{maxHeight:160,objectFit:"cover"}}),e.jsxs("div",{className:"card-body d-flex flex-column",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsx("h6",{className:"card-title mb-1",children:s.title||"Listing"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-secondary",title:"Notifications (soon)",disabled:!0,children:e.jsx("i",{className:"ri-notification-3-line"})})]}),e.jsxs("div",{className:"text-muted small mb-2",children:[s.category||"General"," · ",s.vendor||""]}),s.description&&e.jsxs("p",{className:"flex-grow-1 text-secondary small",children:[s.description.slice(0,140),s.description.length>140?"…":""]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-auto",children:[e.jsxs("strong",{children:["R ",Number(s.price||0).toLocaleString()]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("span",{className:"badge bg-neutral-200 text-neutral-900",children:["★ ",Number(s.rating||0).toFixed(1)]}),e.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>j(s.id),disabled:!!x[String(s.id)],children:x[String(s.id)]?"Removing…":"Unsubscribe"})]})]})]})]})},String(s.id)))]})]})})]})}export{A as default};
