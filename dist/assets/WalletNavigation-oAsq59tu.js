import{j as e,I as n,a as I,f as M}from"./index-DgAHpWmH.js";import{L as v,r as d,u as B}from"./vendor-DW3XjTa1.js";const G=new Intl.NumberFormat("en-ZA"),P=new Intl.DateTimeFormat("en-ZA",{dateStyle:"medium",timeStyle:"short"});function o(s){const t=Number(s)||0;return G.format(Math.round(t))}function $(s){if(!s)return"--";try{return P.format(new Date(s))}catch{return"--"}}function O({wallet:s,loading:t=!1,eligible:a=!0,onRefresh:r,showActions:l=!0,compact:w=!1}){const m=s?.balance??0,u=s?.startingBalance??0,k=Math.max(0,Math.round((u-m)*100)/100),g=s?.lastUpdated?$(s.lastUpdated):"--";return e.jsxs("div",{className:`card ${w?"p-16":"p-24"} radius-12 h-100`,children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(n,{icon:"mdi:wallet-giftcard",className:"text-xl text-primary-600 me-2"}),"Voucher Wallet"]}),r&&e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:r,disabled:t,title:"Refresh wallet",children:e.jsx(n,{icon:"mdi:refresh",className:t?"spin":""})})]}),t&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"spinner-border spinner-border-sm text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-secondary mt-2 mb-0",children:"Loading wallet balance..."})]}),!t&&!a&&e.jsxs("div",{className:"alert alert-warning mb-0",children:[e.jsx(n,{icon:"mdi:shield-alert",className:"me-2"}),"Wallet credits unlock once your profile is verified as a startup or vendor. Reach out to programme support if you need activation."]}),!t&&a&&!s&&e.jsxs("div",{className:"alert alert-danger mb-0",children:[e.jsx(n,{icon:"mdi:alert-circle",className:"me-2"}),"Could not load wallet details. Try refreshing or contact support."]}),!t&&a&&s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-primary-50 p-16 radius-12 mb-3",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"col",children:[e.jsx("span",{className:"text-sm text-secondary-light d-block mb-1",children:"Available Credits"}),e.jsxs("h3",{className:"mb-0 text-primary-600",children:["R ",o(m)]})]}),e.jsx("div",{className:"col-auto",children:e.jsx(n,{icon:"mdi:credit-card-check",className:"text-3xl text-primary-600"})})]})}),e.jsxs("div",{className:"row g-2 mb-3",children:[e.jsx("div",{className:"col-6",children:e.jsx(F,{icon:"mdi:rocket-launch-outline",label:"Initial Allocation",value:`R ${o(u)}`})}),e.jsx("div",{className:"col-6",children:e.jsx(F,{icon:"mdi:chart-line",label:"Credits Used",value:`R ${o(k)}`})})]}),e.jsx("div",{className:"mb-3",children:e.jsx(F,{icon:"mdi:clock-outline",label:"Last Activity",value:g})}),l&&e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(v,{to:"/wallet",className:"btn btn-primary flex-fill",children:[e.jsx(n,{icon:"mdi:eye",className:"me-1"}),"View Details"]}),e.jsxs(v,{to:"/market1",className:"btn btn-outline-primary flex-fill",children:[e.jsx(n,{icon:"mdi:shopping",className:"me-1"}),"Browse"]})]})]})]})}function F({icon:s,label:t,value:a}){return e.jsxs("div",{className:"d-flex align-items-center p-2 bg-light rounded",children:[e.jsx(n,{icon:s,className:"text-lg text-secondary-light me-2"}),e.jsxs("div",{className:"flex-grow-1 min-width-0",children:[e.jsx("div",{className:"text-xs text-secondary-light",children:t}),e.jsx("div",{className:"text-sm fw-medium text-truncate",children:a})]})]})}function Z({transactions:s,compact:t=!1}){return s?.length?e.jsxs("div",{className:"table-responsive",children:[e.jsxs("table",{className:"table table-hover mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"Date"}),e.jsx("th",{scope:"col",children:"Description"}),!t&&e.jsx("th",{scope:"col",children:"Type"}),e.jsx("th",{scope:"col",className:"text-end",children:"Amount"}),e.jsx("th",{scope:"col",className:"text-end",children:"Balance"})]})}),e.jsx("tbody",{children:s.slice(0,t?5:void 0).map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"text-sm",children:$(a.createdAt)})}),e.jsxs("td",{children:[e.jsx("span",{className:"text-sm",children:a.description}),a.reference&&e.jsxs("div",{className:"text-xs text-secondary-light",children:["Ref: ",a.reference]})]}),!t&&e.jsx("td",{children:e.jsx(q,{type:a.type})}),e.jsx("td",{className:"text-end",children:e.jsxs("span",{className:`text-sm fw-medium ${a.type==="credit"?"text-success":"text-danger"}`,children:[a.type==="credit"?"+":"-","R ",o(a.amount)]})}),e.jsx("td",{className:"text-end",children:e.jsxs("span",{className:"text-sm",children:["R ",o(a.balanceAfter)]})})]},a.id))})]}),t&&s.length>5&&e.jsx("div",{className:"text-center pt-3",children:e.jsxs(v,{to:"/wallet",className:"btn btn-outline-secondary btn-sm",children:["View All Transactions (",s.length,")"]})})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(n,{icon:"mdi:receipt-text-outline",className:"text-4xl text-secondary-light mb-2"}),e.jsx("p",{className:"text-secondary-light mb-0",children:"No voucher activity yet. Purchases using the marketplace will appear here."})]})}function q({type:s}){const t={credit:{icon:"mdi:plus-circle",class:"bg-success",label:"Credit"},debit:{icon:"mdi:minus-circle",class:"bg-danger",label:"Debit"},adjustment:{icon:"mdi:circle-edit-outline",class:"bg-warning",label:"Adjustment"}},{icon:a,class:r,label:l}=t[s]||{icon:"mdi:help-circle",class:"bg-secondary",label:s};return e.jsxs("span",{className:`badge ${r} d-flex align-items-center gap-1`,children:[e.jsx(n,{icon:a,className:"text-xs"}),l]})}function W(s,t){if(s&&typeof s=="object"&&"response"in s){const r=s.response?.data;if(typeof r=="string"&&r.trim())return r.trim();if(r&&typeof r.message=="string"&&r.message.trim())return r.message.trim()}return s instanceof Error&&s.message?s.message:t}function z({grantCredits:s,onRefresh:t,compact:a=!1,showUserLookup:r=!0,selectedUserEmail:l="",onEmailChange:w}){const[m,u]=d.useState(l),[k,g]=d.useState(""),[A,C]=d.useState(""),[S,T]=d.useState(!1),[f,c]=d.useState({type:"",message:""}),[N,p]=d.useState(null),[y,x]=d.useState({loading:!1,error:""}),j=m.trim().toLowerCase();d.useEffect(()=>{l&&l!==m&&(u(l),c({type:"",message:""}),p(null),x({loading:!1,error:""}))},[l,m]);const L=i=>{u(i),w&&w(i)},E=async()=>{if(!j||!r){x({loading:!1,error:"Enter an email to preview a wallet."}),p(null);return}x({loading:!0,error:""});try{const{data:i}=await I.get("/api/wallets/admin/lookup",{params:{email:j},suppressToast:!0,suppressErrorLog:!0}),h=i?.wallet?i.wallet:null;p(h),x({loading:!1,error:h?"":"No wallet exists yet for that user."})}catch(i){p(null),x({loading:!1,error:W(i,"Unable to fetch wallet details.")})}},R=async i=>{if(i.preventDefault(),c({type:"",message:""}),!j){c({type:"danger",message:"Enter the recipient's email address."});return}const h=Number(k.replace(/[^0-9.]/g,""));if(!Number.isFinite(h)||h<=0){c({type:"danger",message:"Enter a valid credit amount."});return}if(!s){c({type:"danger",message:"Grant credits function not available."});return}T(!0);try{const b=await s({email:j,amount:h,description:A?`Admin credit: ${A.trim()}`:"Admin credit",metadata:{source:"admin-grant",note:A.trim()||void 0}});if(!b.ok){c({type:"danger",message:b.error||"Unable to grant credits."});return}g(""),C(""),c({type:"success",message:`Granted ${o(h)} credits. New balance: ${o(b.wallet?.balance||0)} credits.`}),p(b.wallet||null),x({loading:!1,error:""}),t&&await t()}catch(b){c({type:"danger",message:W(b,"Unable to grant credits.")})}finally{T(!1)}},D=()=>{u(""),g(""),C(""),c({type:"",message:""}),p(null),x({loading:!1,error:""})};return e.jsxs("div",{className:`card ${a?"p-16":"p-24"} radius-12 d-flex flex-column gap-3`,children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(n,{icon:"mdi:wallet-plus",className:"text-xl text-primary-600 me-2"}),"Grant Credits"]}),e.jsx("span",{className:"badge text-bg-light text-secondary-emphasis",children:"Admin"})]}),e.jsx("p",{className:"text-secondary-light mb-0",children:"Send voucher credits to any account. Wallets are created automatically if they do not exist."}),e.jsxs("form",{className:`row g-3 ${a?"g-2":"g-3"}`,onSubmit:R,children:[e.jsxs("div",{className:a?"col-12":"col-12 col-md-5",children:[e.jsx("label",{className:"form-label text-sm text-secondary-light",children:"User Email"}),e.jsx("input",{type:"email",className:"form-control",value:m,onChange:i=>L(i.target.value),placeholder:"user@example.com",autoComplete:"off",required:!0})]}),e.jsxs("div",{className:a?"col-6":"col-12 col-md-3",children:[e.jsx("label",{className:"form-label text-sm text-secondary-light",children:"Credit Amount"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:"R"}),e.jsx("input",{type:"text",className:"form-control",value:k,onChange:i=>g(i.target.value),inputMode:"decimal",placeholder:"e.g. 5000",required:!0})]})]}),e.jsxs("div",{className:a?"col-6":"col-12 col-md-4",children:[e.jsx("label",{className:"form-label text-sm text-secondary-light",children:"Notes (optional)"}),e.jsx("input",{type:"text",className:"form-control",value:A,onChange:i=>C(i.target.value),placeholder:"Reason or reference",maxLength:120})]}),e.jsxs("div",{className:"col-12 d-flex flex-wrap gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Granting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(n,{icon:"mdi:plus-circle",className:"me-1"}),"Grant Credits"]})}),r&&e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:E,disabled:y.loading||!j,children:y.loading?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(n,{icon:"mdi:magnify",className:"me-1"}),"Preview Wallet"]})}),e.jsxs("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:D,disabled:S||y.loading,children:[e.jsx(n,{icon:"mdi:refresh",className:"me-1"}),"Clear"]})]})]}),f.message&&e.jsxs("div",{className:`alert alert-${f.type||"info"} mb-0`,children:[e.jsx(n,{icon:f.type==="success"?"mdi:check-circle":"mdi:alert-circle",className:"me-2"}),f.message]}),y.error&&!f.message&&e.jsxs("div",{className:"alert alert-warning mb-0",children:[e.jsx(n,{icon:"mdi:information",className:"me-2"}),y.error]}),N&&r&&e.jsxs("div",{className:"border border-dashed rounded-3 p-16 bg-neutral-50",children:[e.jsxs("h6",{className:"mb-2",children:[e.jsx(n,{icon:"mdi:account-cash",className:"me-2"}),"Wallet Preview"]}),e.jsxs("div",{className:"d-flex flex-wrap gap-3 text-sm",children:[e.jsxs("span",{children:[e.jsx("strong",{children:"Email:"})," ",N.email||j]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Tenant:"})," ",N.tenantId]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Balance:"})," R ",o(N.balance)]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Transactions:"})," ",N.transactions?.length||0]})]})]})]})}function H({compact:s=!1}){const t=B(),{isAdmin:a}=M(),r=[{path:"/dashboard",label:"Dashboard",icon:"mdi:view-dashboard",description:"Overview and quick actions"},{path:"/wallet",label:"Unified Wallet",icon:"mdi:wallet",description:"Complete wallet management with transaction tracking"}];return a&&r.push({path:"/admin/wallet-credits",label:"Legacy Admin",icon:"mdi:wallet-plus-outline",description:"Original admin credits interface"}),s?e.jsx("div",{className:"btn-group",role:"group",children:r.map(l=>e.jsxs(v,{to:l.path,className:`btn btn-sm ${t.pathname===l.path?"btn-primary":"btn-outline-primary"}`,title:l.description,children:[e.jsx(n,{icon:l.icon,className:"me-1"}),l.label]},l.path))}):e.jsxs("div",{className:"card p-16 radius-12 mb-4",children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx(n,{icon:"mdi:navigation",className:"me-2"}),"Wallet Management Center"]}),e.jsxs("div",{className:"alert alert-info py-2 px-3 mb-3",children:[e.jsx(n,{icon:"mdi:information",className:"me-2"}),e.jsx("strong",{children:"Enhanced Integration:"})," This unified wallet interface now includes complete admin functionality for tracking all platform user transactions."]}),e.jsx("div",{className:"d-flex flex-wrap gap-2",children:r.map(l=>e.jsxs(v,{to:l.path,className:`btn btn-sm ${t.pathname===l.path?"btn-primary":"btn-outline-primary"}`,children:[e.jsx(n,{icon:l.icon,className:"me-1"}),e.jsx("span",{children:l.label}),!s&&e.jsx("div",{className:"text-xs mt-1 opacity-75",children:l.description})]},l.path))})]})}export{z as A,Z as T,H as W,O as a,o as f};
