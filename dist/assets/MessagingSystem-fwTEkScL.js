import{g as he,a as y,b as ge,B as v,j as s,I as D}from"./index-BDu5z-7V.js";import{r,L as xe}from"./vendor-C0neu5ZX.js";function X(n,m=80){return n?n.length>m?`${n.slice(0,m)}â€¦`:n:""}function R(n){return`https://ui-avatars.com/api/?name=${encodeURIComponent(n||"User")}&background=059669&color=fff`}function U(n){const m=n?.from||{},g=n?.timestamp||n?.date||new Date().toISOString();return{id:String(n?.id||g),senderId:m?.uid||m?.email,senderName:m?.name||m?.email||"User",senderEmail:m?.email,senderRole:m?.type,senderAvatar:m?.avatar,content:(n?.content??"").toString(),timestamp:g}}function $(n,m){const g=Array.isArray(n?.messages)?n.messages:[],p=n?.context||m||{},c=g.map(i=>{const h=i?.senderRole||i?.role;let b=i?.senderEmail||i?.email;if(!b){const o=(h||"").toLowerCase();o==="admin"&&p.adminEmail&&(b=p.adminEmail),o==="vendor"&&p.vendorEmail&&(b=p.vendorEmail),o==="subscriber"&&p.subscriberEmail&&(b=p.subscriberEmail)}const u=i?.date||i?.timestamp||i?.createdAt||new Date().toISOString();return{id:String(i?.id||i?.messageId||u),senderId:i?.senderId||i?.sender?.id,senderName:i?.senderName||i?.sender?.name||i?.senderId||"User",senderEmail:b,senderRole:h,senderAvatar:i?.senderAvatar||i?.sender?.avatar,content:(i?.content??i?.text??"").toString(),timestamp:u}});return c.sort((i,h)=>new Date(i.timestamp).getTime()-new Date(h.timestamp).getTime()),c}function se(n){const m=new Map;n.forEach(p=>{if(!p)return;const c=String(p.threadId||p.id||p.subject||`legacy-${Date.now()}`);m.has(c)||m.set(c,[]),m.get(c).push(p)});const g=[];for(const[p,c]of m.entries()){c.sort((u,o)=>new Date(u?.timestamp||u?.date||0).getTime()-new Date(o?.timestamp||o?.date||0).getTime());const i=c[0],h=c[c.length-1]||i,b=[];i?.from&&b.push({id:i.from.uid||i.from.email||i.from.name,name:i.from.name||i.from.email,email:i.from.email,role:i.from.type}),i?.to&&b.push({id:i.to.uid||i.to.email||i.to.name,name:i.to.name||i.to.email,email:i.to.email,role:i.to.type}),g.push({id:p,kind:"legacy",subject:h?.subject||i?.subject||"Conversation",lastMessageSnippet:X(h?.content||""),lastMessageAt:h?.timestamp||h?.date,participants:b,legacy:{user1:b[0]?.email,user2:b[1]?.email},raw:c})}return g}function Ne(n){const m=Array.isArray(n?.messages)?[...n.messages]:[],g=n?.lastMessage||m[m.length-1]||{},p=Array.isArray(n?.participants)?n.participants.map(o=>({id:o?.id||o?.email||o?.name,name:o?.name||o?.id||"Participant",email:o?.email,role:o?.role})):[],c=n?.context||{},i={id:String(n?.id||n?.threadId||c.threadId||`thread-${Date.now()}`),kind:"thread",subject:n?.subject||c.listingTitle||c.serviceTitle||"Conversation",lastMessageSnippet:X(n?.lastMessage?.snippet||g?.snippet||g?.content||""),lastMessageAt:g?.date||g?.timestamp||n?.updatedAt||n?.createdAt,unreadCount:typeof n?.unreadCount=="number"?n.unreadCount:void 0,participants:p,context:c,raw:n},h=c.vendorEmail,b=c.adminEmail,u=c.subscriberEmail;if(h){const o=i.participants.find(N=>(N?.role||"").toLowerCase()==="vendor"||(N?.id||"").startsWith("vendor:"));o&&!o.email&&(o.email=h)}if(b){const o=i.participants.find(N=>(N?.role||"").toLowerCase()==="admin");o&&!o.email&&(o.email=b)}if(u){const o=i.participants.find(N=>(N?.role||"").toLowerCase()==="subscriber");o&&!o.email&&(o.email=u)}return i}const ve=({userEmail:n,userName:m})=>{const[g,p]=r.useState([]),[c,i]=r.useState([]),[h,b]=r.useState("inbox"),[u,o]=r.useState(null),[N,P]=r.useState([]),[f,ae]=r.useState(()=>{try{return he()}catch{return null}}),[te,F]=r.useState(!0),[B,O]=r.useState(!1),[L,ie]=r.useState(""),[I,E]=r.useState(!1),[j,T]=r.useState(""),[C,q]=r.useState(""),[H,Q]=r.useState(!1),[W,Y]=r.useState([]),[S,_]=r.useState(""),[ne,V]=r.useState(!1);r.useEffect(()=>{I&&y.get("/api/users/all-contacts").then(e=>Y(e.data.items||[])).catch(()=>Y([]))},[I]);const re=r.useRef(null),G=r.useCallback(()=>{re.current?.scrollIntoView({behavior:"smooth"})},[]);r.useEffect(()=>{G()},[N,G]),r.useEffect(()=>{ge().then(e=>ae(e)).catch(()=>{})},[]),r.useEffect(()=>{if(n&&c.length){const e=c.find(t=>t.email&&t.email.toLowerCase()===n.toLowerCase());o(e||{id:`direct:${n}`,threadId:"",name:m||n,email:n,avatar:R(m||n),status:"Direct Message",type:"thread",lastMessageSnippet:"",lastMessageAt:void 0,unreadCount:0,thread:{id:"",kind:"thread",subject:m||n,lastMessageSnippet:"",participants:[{name:m||n,email:n},{name:f&&typeof f=="object"&&"name"in f&&typeof f.name=="string"?f.name:"",email:f?.email||void 0}],context:{},raw:{}},isInbox:!0,isSent:!1})}},[n,m,c,f]);const J=r.useCallback(e=>{const t=(f?.email||"").toLowerCase();return e.map(a=>{const l=a.participants||[];let d=!1;a.raw&&Array.isArray(a.raw.messages)?d=a.raw.messages.some(x=>(x.senderEmail||x.email||"").toLowerCase()===t):Array.isArray(a.raw)&&(d=a.raw.some(x=>(x?.from?.email||"").toLowerCase()===t));const M=d,w=l.some(x=>(x.email||"").toLowerCase()===t);let A=l.find(x=>(x?.email||"").toLowerCase()!==t);!A&&l.length&&(A=l[0]);const Z=A?.name||A?.email||a.subject||"Conversation",pe=A?.email||(a.legacy?[a.legacy.user1,a.legacy.user2].find(x=>(x||"").toLowerCase()!==t):void 0),fe=R(Z),ee=(a.kind==="thread"?a.context?.type||"active":"legacy conversation").replace(/[-_]/g," ");return{id:`${a.kind}:${a.id}`,threadId:a.id,name:Z,email:pe,avatar:fe,status:ee.charAt(0).toUpperCase()+ee.slice(1),type:a.kind,lastMessageSnippet:X(a.lastMessageSnippet||""),lastMessageAt:a.lastMessageAt,unreadCount:a.unreadCount,thread:a,isInbox:w,isSent:M}}).sort((a,l)=>{const d=a.lastMessageAt?new Date(a.lastMessageAt).getTime():0;return(l.lastMessageAt?new Date(l.lastMessageAt).getTime():0)-d})},[f]),k=r.useCallback(async({silent:e=!1}={})=>{e||F(!0);try{const a=(await y.get("/api/messages",{params:{limit:100}})).data;let l=[];Array.isArray(a?.items)?l=a.items.map(Ne):Array.isArray(a?.messages)?l=se(a.messages):Array.isArray(a)&&(l=se(a)),p(l);const d=J(l);return i(d),d}catch(t){if(console.error("Error fetching messages:",t),!e){const a=t?.response?.data?.message||"Failed to load messages";v.error(a)}return p([]),i([]),[]}finally{e||F(!1)}},[J]);r.useEffect(()=>{k()},[k]);const z=r.useCallback(async e=>{if(o(e),e.type==="thread")try{const t=await y.get(`/api/messages/${e.threadId}`),a=t.data&&t.data.id?t.data:e.thread.raw,l=$(a,e.thread.context);P(l)}catch(t){console.error("Error fetching thread conversation:",t);const a=$(e.thread.raw,e.thread.context);P(a),v.error("Unable to refresh conversation; showing cached messages.")}else{const t=e.thread.legacy?.user1,a=e.thread.legacy?.user2||e.email;if(!t||!a){P([]);return}try{const l=await y.get("/api/messages/conversation",{params:{user1:t,user2:a,limit:100}}),M=(Array.isArray(l.data?.conversation)?l.data.conversation:[]).map(U).sort((w,A)=>new Date(w.timestamp).getTime()-new Date(A.timestamp).getTime());P(M)}catch(l){console.error("Error fetching legacy conversation:",l),v.error("Unable to load conversation");const d=Array.isArray(e.thread.raw)?e.thread.raw.map(U):[];d.sort((M,w)=>new Date(M.timestamp).getTime()-new Date(w.timestamp).getTime()),P(d)}}},[]),oe=r.useCallback(async e=>{if(e.preventDefault(),!u||!L.trim()||B)return;const t=L.trim();O(!0);try{if(u.type==="thread")await y.post("/api/messages/reply",{threadId:u.threadId,content:t});else{const d=u.email||u.thread.legacy?.user2;if(!d)throw new Error("Missing recipient email");const M=u.thread.subject||`Message to ${u.name}`;await y.post("/api/messages",{to:d,subject:M,content:t,priority:"normal"})}ie("");const l=(await k({silent:!0})).find(d=>d.threadId===u.threadId&&d.type===u.type);l&&await z(l),v.success("Message sent")}catch(a){console.error("Error sending message:",a);const l=a?.response?.data?.message||a?.message||"Failed to send message";v.error(l)}finally{O(!1)}},[u,L,B,k,z]),le=r.useCallback(e=>{if(e.type==="thread"){const t=$(e.thread.raw,e.thread.context);return t.length?t[t.length-1]:null}if(Array.isArray(e.thread.raw)){const t=e.thread.raw.map(U).sort((a,l)=>new Date(a.timestamp).getTime()-new Date(l.timestamp).getTime());return t.length?t[t.length-1]:null}return null},[]),me=r.useCallback(e=>e.unreadCount||0,[]),ce=r.useMemo(()=>R(f?.email||"User"),[f]),K=r.useMemo(()=>f?.email||"User",[f]),ue=r.useMemo(()=>f?.role||"member",[f]);r.useCallback(e=>{const t=(f?.email||"").toLowerCase();return t?!!(e.senderEmail&&e.senderEmail.toLowerCase()===t||e.senderId&&e.senderId.toLowerCase().includes(t)||e.senderRole?.toLowerCase()==="admin"&&f?.role==="admin"):!1},[f]);const de=r.useCallback(e=>{if(!e)return"";const t=new Date(e);return Number.isFinite(t.getTime())?t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):""},[]);return te?s.jsxDEV("div",{className:"d-flex justify-content-center align-items-center",style:{height:"400px"},children:s.jsxDEV("div",{className:"spinner-border text-primary",role:"status",children:s.jsxDEV("span",{className:"visually-hidden",children:"Loading..."},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:558,columnNumber:11},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:557,columnNumber:9},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:556,columnNumber:7},void 0):s.jsxDEV("div",{className:"chat-wrapper",children:[s.jsxDEV("div",{className:"chat-sidebar card",children:[s.jsxDEV("div",{className:"chat-sidebar-single active top-profile",children:[s.jsxDEV("div",{className:"img",children:s.jsxDEV("img",{src:ce,alt:"Current user"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:569,columnNumber:13},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:568,columnNumber:11},void 0),s.jsxDEV("div",{className:"info",children:[s.jsxDEV("h6",{className:"text-md mb-0",children:K},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:572,columnNumber:13},void 0),s.jsxDEV("p",{className:"mb-0 text-capitalize",children:ue},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:573,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:571,columnNumber:11},void 0),s.jsxDEV("div",{className:"action d-flex flex-column align-items-end",children:[s.jsxDEV("button",{type:"button",className:"btn btn-primary btn-sm mb-2",onClick:()=>E(!0),children:[s.jsxDEV(D,{icon:"mdi:plus"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:581,columnNumber:15},void 0)," Compose"]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:576,columnNumber:13},void 0),s.jsxDEV("div",{className:"btn-group",children:[s.jsxDEV("button",{type:"button",className:"text-secondary-light text-xl","data-bs-toggle":"dropdown","data-bs-display":"static","aria-expanded":"false",children:s.jsxDEV(D,{icon:"bi:three-dots"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:591,columnNumber:17},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:584,columnNumber:15},void 0),s.jsxDEV("ul",{className:"dropdown-menu dropdown-menu-lg-end border",children:s.jsxDEV("li",{children:s.jsxDEV(xe,{to:"/chat-profile",className:"dropdown-item rounded text-secondary-light bg-hover-neutral-200 text-hover-neutral-900 d-flex align-items-center gap-2",children:[s.jsxDEV(D,{icon:"fluent:person-32-regular"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:599,columnNumber:21},void 0),"Profile"]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:595,columnNumber:19},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:594,columnNumber:17},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:593,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:583,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:575,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:567,columnNumber:9},void 0),s.jsxDEV("div",{className:"d-flex justify-content-center my-2",children:[s.jsxDEV("button",{className:`btn btn-sm ${h==="inbox"?"btn-primary":"btn-outline-primary"} mx-1`,onClick:()=>b("inbox"),children:"Inbox"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:609,columnNumber:11},void 0),s.jsxDEV("button",{className:`btn btn-sm ${h==="sent"?"btn-primary":"btn-outline-primary"} mx-1`,onClick:()=>b("sent"),children:"Sent"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:615,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:608,columnNumber:9},void 0),s.jsxDEV("div",{className:"chat-search",children:s.jsxDEV("form",{children:[s.jsxDEV("input",{type:"text",name:"chatSearch",placeholder:"Search here..."},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:625,columnNumber:13},void 0),s.jsxDEV(D,{icon:"iconoir:search",className:"search-icon"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:626,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:624,columnNumber:11},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:623,columnNumber:9},void 0),s.jsxDEV("div",{className:"chat-all-list",children:c.filter(e=>h==="inbox"?e.isInbox:e.isSent).map(e=>{const t=le(e),a=me(e),l=t?X(t.content,30):"No messages yet",d=t?de(t.timestamp):"";return s.jsxDEV("div",{className:`chat-sidebar-single ${u?.id===e.id?"active":""}`,onClick:()=>{z(e)},style:{cursor:"pointer"},children:[s.jsxDEV("div",{className:"img",children:s.jsxDEV("img",{src:e.avatar,alt:e.name},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:651,columnNumber:21},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:650,columnNumber:19},void 0),s.jsxDEV("div",{className:"info",children:[s.jsxDEV("h6",{className:"text-sm mb-1",children:e.name},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:654,columnNumber:21},void 0),s.jsxDEV("p",{className:"mb-0 text-xs",children:l},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:655,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:653,columnNumber:19},void 0),s.jsxDEV("div",{className:"action text-end",children:[s.jsxDEV("p",{className:"mb-0 text-neutral-400 text-xs lh-1",children:d},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:658,columnNumber:21},void 0),a>0&&s.jsxDEV("span",{className:"w-16-px h-16-px text-xs rounded-circle bg-warning-main text-white d-inline-flex align-items-center justify-content-center",children:a},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:660,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:657,columnNumber:19},void 0)]},e.id,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:642,columnNumber:17},void 0)})},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:630,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:566,columnNumber:7},void 0),s.jsxDEV("div",{className:"chat-main card",children:[u?s.jsxDEV(s.Fragment,{children:[s.jsxDEV("div",{className:"chat-sidebar-single active"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:675,columnNumber:13},void 0),s.jsxDEV("div",{className:"chat-message-list",style:{maxHeight:"400px",overflowY:"auto"}},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:678,columnNumber:13},void 0),s.jsxDEV("form",{className:"chat-message-box",onSubmit:oe},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:681,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:673,columnNumber:11},void 0):s.jsxDEV("div",{className:"d-flex flex-column align-items-center justify-content-center h-100 text-center",children:[s.jsxDEV(D,{icon:"fluent:chat-48-regular",className:"text-primary",style:{fontSize:"4rem"}},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:687,columnNumber:13},void 0),s.jsxDEV("h5",{className:"mt-3 mb-2",children:"Select a conversation"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:688,columnNumber:13},void 0),s.jsxDEV("p",{className:"text-muted",children:"Choose a contact from the sidebar to start messaging"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:689,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:686,columnNumber:11},void 0),I&&s.jsxDEV("div",{className:"modal-backdrop show",style:{zIndex:1050},children:s.jsxDEV("div",{className:"modal d-block",tabIndex:-1,role:"dialog",style:{zIndex:1060},children:s.jsxDEV("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:s.jsxDEV("div",{className:"modal-content",children:[s.jsxDEV("div",{className:"modal-header",children:[s.jsxDEV("h5",{className:"modal-title",children:"Compose New Message"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:699,columnNumber:21},void 0),s.jsxDEV("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>E(!1)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:700,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:698,columnNumber:19},void 0),s.jsxDEV("form",{onSubmit:async e=>{if(e.preventDefault(),!(!j.trim()||!C.trim())){Q(!0);try{await y.post("/api/messages",{to:j.trim(),subject:`Message from ${K}`,content:C.trim(),priority:"normal"}),T(""),q(""),E(!1),v.success("Message sent"),await k({silent:!0})}catch(t){v.error(t?.response?.data?.message||"Failed to send message")}finally{Q(!1)}}},children:[s.jsxDEV("div",{className:"modal-body",children:[s.jsxDEV("div",{className:"mb-3",children:[s.jsxDEV("label",{className:"form-label",children:"Recipient Email"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:728,columnNumber:25},void 0),s.jsxDEV("div",{style:{position:"relative"},children:[s.jsxDEV("input",{type:"email",className:"form-control",value:j,onChange:e=>{T(e.target.value),_(e.target.value),V(!0)},onFocus:()=>V(!0),onBlur:()=>setTimeout(()=>V(!1),150),autoComplete:"off",required:!0},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:730,columnNumber:27},void 0),ne&&S.trim()&&s.jsxDEV("div",{style:{position:"absolute",zIndex:100,top:"100%",left:0,right:0,background:"#fff",border:"1px solid #ddd",maxHeight:200,overflowY:"auto",borderRadius:4},children:[W.filter(e=>e.email&&e.email.toLowerCase().includes(S.toLowerCase())||e.name&&e.name.toLowerCase().includes(S.toLowerCase())).slice(0,10).map((e,t)=>s.jsxDEV("div",{style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid #eee"},onMouseDown:()=>{T(e.email),_(e.email),V(!1)},children:[s.jsxDEV("span",{style:{fontWeight:500},children:e.name},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:762,columnNumber:37},void 0),s.jsxDEV("span",{style:{color:"#888",marginLeft:8},children:e.email},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:763,columnNumber:37},void 0),s.jsxDEV("span",{style:{color:"#aaa",marginLeft:8,fontSize:"0.9em"},children:["(",e.role,")"]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:764,columnNumber:37},void 0)]},e.email+t,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:753,columnNumber:35},void 0)),W.filter(e=>e.email&&e.email.toLowerCase().includes(S.toLowerCase())||e.name&&e.name.toLowerCase().includes(S.toLowerCase())).length===0&&s.jsxDEV("div",{style:{padding:"8px 12px",color:"#888"},children:"No matches found"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:771,columnNumber:33},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:745,columnNumber:29},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:729,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:727,columnNumber:23},void 0),s.jsxDEV("div",{className:"mb-3",children:[s.jsxDEV("label",{className:"form-label",children:"Message"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:778,columnNumber:25},void 0),s.jsxDEV("textarea",{className:"form-control",rows:4,value:C,onChange:e=>q(e.target.value),required:!0},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:779,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:777,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:726,columnNumber:21},void 0),s.jsxDEV("div",{className:"modal-footer",children:[s.jsxDEV("button",{type:"button",className:"btn btn-secondary",onClick:()=>E(!1),children:"Cancel"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:789,columnNumber:23},void 0),s.jsxDEV("button",{type:"submit",className:"btn btn-primary",disabled:H||!j.trim()||!C.trim(),children:H?"Sending...":"Send"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:792,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:788,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:702,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:697,columnNumber:17},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:696,columnNumber:15},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:695,columnNumber:13},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:694,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:671,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:565,columnNumber:5},void 0)};export{ve as M};
