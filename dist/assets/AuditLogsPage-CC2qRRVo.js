import{a as C,h as T,j as e,M as F}from"./index-DJJlGgdb.js";import{B as R}from"./Breadcrumb-6Y_3hKYU.js";import{r as t}from"./vendor-C0neu5ZX.js";import"./firebase-C3VX9oMN.js";import"./utils-B2rxisVD.js";function O(){const[A,E]=t.useState([]),[l,g]=t.useState(!0),[b,L]=t.useState(!1),[P,v]=t.useState(""),[o,D]=t.useState(""),[f,j]=t.useState(""),[h,k]=t.useState(""),[c,V]=t.useState(""),[m,M]=t.useState(""),[N,X]=t.useState(()=>sessionStorage.getItem("tenantId")||"vendor"),[S,y]=t.useState([{id:"vendor",name:"Vendor"}]);t.useEffect(()=>{let s=!0;return(async()=>{try{const{data:i}=await C.get("/api/tenants"),r=Array.isArray(i)?i:[],p=[{id:"vendor",name:"Vendor"},...r.map(a=>typeof a=="string"?{id:a,name:a}:{id:a?.id,name:a?.name||a?.id}).map(a=>a.id==="public"?{...a,id:"vendor",name:a.name||"Vendor"}:a)].filter(a=>a&&a.id),n=Object.values(p.reduce((a,d)=>(a[d.id]=d,a),{}));s&&y(n)}catch{s&&y([{id:"vendor",name:"Vendor"}])}})(),()=>{s=!1}},[]);const x=t.useCallback(async({silent:s}={})=>{s?L(!0):g(!0),v("");try{const i=await T({search:o.trim(),userEmail:f.trim()||void 0,action:h.trim()||void 0,dateFrom:c?new Date(c):void 0,dateTo:m?new Date(m):void 0,limit:250,tenantId:N});E(i)}catch(i){v(i?.message||"Failed to load audit logs")}finally{s?L(!1):g(!1)}},[h,c,m,o,N,f]);t.useEffect(()=>{x({silent:!1}).catch(()=>{})},[]);const u=t.useMemo(()=>{const s=o.trim().toLowerCase();return A.filter(i=>s?[i.userEmail,i.action,i.targetType,i.targetId,i.ip].filter(Boolean).some(r=>String(r).toLowerCase().includes(s)):!0)},[A,o]);function I(){const i=[["timestamp","userEmail","userId","action","targetType","targetId","ip","tenantId"].join(",")];u.forEach(a=>{const d=[a.timestamp?new Date(a.timestamp).toISOString():"",a.userEmail||"",a.userId||"",a.action||"",a.targetType||"",a.targetId||"",a.ip||"",a.tenantId||""];i.push(d.map(w=>`"${String(w).replaceAll('"','""')}"`).join(","))});const r=new Blob(["\uFEFF"+i.join(`
`)],{type:"text/csv;charset=utf-8;"}),p=URL.createObjectURL(r),n=document.createElement("a");n.href=p,n.download=`audit-logs-${new Date().toISOString().slice(0,10)}.csv`,n.click(),URL.revokeObjectURL(p)}return e.jsxDEV("div",{className:"card",children:e.jsxDEV("div",{className:"card-body",children:[e.jsxDEV("div",{className:"d-flex flex-wrap gap-2 align-items-end mb-3",children:[e.jsxDEV("div",{className:"me-auto",children:[e.jsxDEV("h5",{className:"mb-0",children:"Audit Logs"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:121,columnNumber:13},this),e.jsxDEV("small",{className:"text-secondary",children:"Centralized user activity across tenants"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:122,columnNumber:13},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:120,columnNumber:11},this),e.jsxDEV("div",{className:"d-flex flex-wrap gap-2",children:[e.jsxDEV("select",{className:"form-select",value:N,onChange:s=>X(s.target.value),title:"Tenant scope",children:S.map(s=>e.jsxDEV("option",{value:s.id,children:s.name||s.id},s.id,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:133,columnNumber:17},this))},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:126,columnNumber:13},this),e.jsxDEV("input",{className:"form-control",placeholder:"Search email, action, target",value:o,onChange:s=>D(s.target.value)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:136,columnNumber:13},this),e.jsxDEV("input",{className:"form-control",placeholder:"Filter by user email",value:f,onChange:s=>j(s.target.value)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:142,columnNumber:13},this),e.jsxDEV("input",{className:"form-control",placeholder:"Filter by action (e.g., LOGIN, CREATE)",value:h,onChange:s=>k(s.target.value)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:148,columnNumber:13},this),e.jsxDEV("input",{type:"date",className:"form-control",value:c,onChange:s=>V(s.target.value),"aria-label":"From date"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:154,columnNumber:13},this),e.jsxDEV("input",{type:"date",className:"form-control",value:m,onChange:s=>M(s.target.value),"aria-label":"To date"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:161,columnNumber:13},this),e.jsxDEV("button",{className:"btn btn-secondary",onClick:()=>x({silent:!1}),disabled:l||b,children:l?"Loading…":"Apply"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:168,columnNumber:13},this),e.jsxDEV("button",{className:"btn btn-outline-secondary",onClick:()=>x({silent:!0}),disabled:l||b,children:b?"Refreshing…":"Refresh"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:175,columnNumber:13},this),e.jsxDEV("button",{className:"btn btn-outline-primary",onClick:I,disabled:!u.length,children:"Export CSV"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:182,columnNumber:13},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:125,columnNumber:11},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:119,columnNumber:9},this),P&&e.jsxDEV("div",{className:"alert alert-danger",role:"alert",children:P},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:189,columnNumber:11},this),!l&&!u.length?e.jsxDEV("div",{className:"text-center text-secondary py-5",children:"No audit events found."},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:195,columnNumber:11},this):null,e.jsxDEV("div",{className:"table-responsive border rounded",children:e.jsxDEV("table",{className:"table align-middle mb-0",children:[e.jsxDEV("thead",{className:"table-light",children:e.jsxDEV("tr",{children:[e.jsxDEV("th",{style:{minWidth:160},children:"Timestamp"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:202,columnNumber:17},this),e.jsxDEV("th",{children:"User"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:203,columnNumber:17},this),e.jsxDEV("th",{children:"Action"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:204,columnNumber:17},this),e.jsxDEV("th",{children:"Target"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:205,columnNumber:17},this),e.jsxDEV("th",{children:"IP"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:206,columnNumber:17},this),e.jsxDEV("th",{children:"Tenant"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:207,columnNumber:17},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:201,columnNumber:15},this)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:200,columnNumber:13},this),e.jsxDEV("tbody",{children:[u.map(s=>e.jsxDEV("tr",{children:[e.jsxDEV("td",{children:s.timestamp?e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"fw-semibold",children:new Date(s.timestamp).toLocaleString()},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:216,columnNumber:25},this),e.jsxDEV("div",{className:"text-secondary small",children:new Date(s.timestamp).toISOString()},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:219,columnNumber:25},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:215,columnNumber:23},this):e.jsxDEV("span",{className:"text-secondary",children:"—"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:224,columnNumber:23},this)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:213,columnNumber:19},this),e.jsxDEV("td",{children:[e.jsxDEV("div",{className:"fw-semibold",children:s.userEmail||s.userId||"—"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:228,columnNumber:21},this),s.userId&&e.jsxDEV("div",{className:"text-secondary small",children:s.userId},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:229,columnNumber:34},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:227,columnNumber:19},this),e.jsxDEV("td",{children:e.jsxDEV("span",{className:"badge text-bg-secondary",children:s.action||"—"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:232,columnNumber:21},this)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:231,columnNumber:19},this),e.jsxDEV("td",{children:s.targetType||s.targetId?e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"fw-semibold",children:s.targetType||"—"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:237,columnNumber:25},this),s.targetId&&e.jsxDEV("div",{className:"text-secondary small",children:s.targetId},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:238,columnNumber:40},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:236,columnNumber:23},this):e.jsxDEV("span",{className:"text-secondary",children:"—"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:241,columnNumber:23},this)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:234,columnNumber:19},this),e.jsxDEV("td",{children:s.ip||"—"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:244,columnNumber:19},this),e.jsxDEV("td",{children:s.tenantId||"vendor"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:245,columnNumber:19},this)]},s.id,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:212,columnNumber:17},this)),l&&e.jsxDEV("tr",{children:e.jsxDEV("td",{colSpan:6,className:"text-center text-secondary py-4",children:"Loading logs…"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:250,columnNumber:19},this)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:249,columnNumber:17},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:210,columnNumber:13},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:199,columnNumber:11},this)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:198,columnNumber:9},this)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:118,columnNumber:7},this)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/AuditLogsLayer.tsx",lineNumber:117,columnNumber:5},this)}const G=()=>e.jsxDEV(F,{children:[e.jsxDEV(R,{title:"Audit Logs"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/AuditLogsPage.tsx",lineNumber:8,columnNumber:7},void 0),e.jsxDEV(O,{},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/AuditLogsPage.tsx",lineNumber:9,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/pages/AuditLogsPage.tsx",lineNumber:7,columnNumber:5},void 0);export{G as default};
