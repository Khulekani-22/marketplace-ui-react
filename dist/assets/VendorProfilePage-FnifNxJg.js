import{q as ue,r as b,o as p,l as $,j as a,w as he}from"./index-BsOh-tAE.js";import{M as pe}from"./MasterLayout-BVEjpXnC.js";import{a as re}from"./appData-DzAG2zN5.js";import"./iconify-BmV4o_YB.js";import"./ThemeToggleButton-DJ1aWpop.js";const E="/api/lms",B="vendor_profile_working_v1",F="vendor_profile_undo_v1",ne="vendor_profile_history_cache_v1";function J(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return null}}function M(e){return JSON.parse(JSON.stringify(e))}function le(){return Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,8)}function ie(e){const l=new Date(e);return isNaN(l)?"—":l.toLocaleString()}function ge(e){var f,u,N,j,n,A;const l=((e==null?void 0:e.contactEmail)||(e==null?void 0:e.email)||"").toLowerCase();return{id:String((e==null?void 0:e.vendorId)||(e==null?void 0:e.id)||""),name:(e==null?void 0:e.name)||"",contactEmail:l,ownerUid:(e==null?void 0:e.ownerUid)||"",phone:(e==null?void 0:e.phone)||"",website:(e==null?void 0:e.website)||"",description:(e==null?void 0:e.description)||"",logoUrl:(e==null?void 0:e.logoUrl)||(e==null?void 0:e.logo)||"",bannerUrl:(e==null?void 0:e.bannerUrl)||"",country:(e==null?void 0:e.country)||"",city:(e==null?void 0:e.city)||"",addressLine:(e==null?void 0:e.addressLine)||"",socials:{twitter:((f=e==null?void 0:e.socials)==null?void 0:f.twitter)||"",linkedin:((u=e==null?void 0:e.socials)==null?void 0:u.linkedin)||"",facebook:((N=e==null?void 0:e.socials)==null?void 0:N.facebook)||"",instagram:((j=e==null?void 0:e.socials)==null?void 0:j.instagram)||"",youtube:((n=e==null?void 0:e.socials)==null?void 0:n.youtube)||"",github:((A=e==null?void 0:e.socials)==null?void 0:A.github)||""},categories:Array.isArray(e==null?void 0:e.categories)?e.categories:[],tags:Array.isArray(e==null?void 0:e.tags)?e.tags:[],foundedYear:(e==null?void 0:e.foundedYear)||"",teamSize:(e==null?void 0:e.teamSize)||"",registrationNo:(e==null?void 0:e.registrationNo)||"",status:((e==null?void 0:e.status)||"pending").toLowerCase(),kycStatus:(e==null?void 0:e.kycStatus)||"pending"}}function H(e,l={}){const f=((e==null?void 0:e.email)||(e==null?void 0:e.contactEmail)||l.email||"").toLowerCase(),u=(e==null?void 0:e.socials)??{};return{id:String((e==null?void 0:e.id)??(e==null?void 0:e.vendorId)??l.vendorId??le()),vendorId:String((e==null?void 0:e.vendorId)??(e==null?void 0:e.id)??l.vendorId??""),name:(e==null?void 0:e.name)??(e==null?void 0:e.companyName)??(e==null?void 0:e.vendor)??l.name??"",contactEmail:f,ownerUid:(e==null?void 0:e.ownerUid)??(e==null?void 0:e.uid)??l.uid??"",website:(e==null?void 0:e.website)??"",phone:(e==null?void 0:e.phone)??"",country:(e==null?void 0:e.country)??"",city:(e==null?void 0:e.city)??"",addressLine:(e==null?void 0:e.addressLine)??"",logoUrl:(e==null?void 0:e.logoUrl)??(e==null?void 0:e.logo)??"",bannerUrl:(e==null?void 0:e.bannerUrl)??"",description:(e==null?void 0:e.description)??"",categories:Array.isArray(e==null?void 0:e.categories)?e.categories:[],tags:Array.isArray(e==null?void 0:e.tags)?e.tags:[],foundedYear:(e==null?void 0:e.foundedYear)??"",teamSize:(e==null?void 0:e.teamSize)??"",registrationNo:(e==null?void 0:e.registrationNo)??"",status:((e==null?void 0:e.status)||"pending").toLowerCase(),socials:{twitter:u.twitter??"",linkedin:u.linkedin??"",facebook:u.facebook??"",instagram:u.instagram??"",youtube:u.youtube??"",github:u.github??""},lastUpdated:(e==null?void 0:e.lastUpdated)??""}}function xe(e,l){if(!e)return null;const f=((l==null?void 0:l.email)||"").toLowerCase(),u=[Array.isArray(e.startups)&&e.startups,Array.isArray(e.vendors)&&e.vendors,Array.isArray(e.companies)&&e.companies,Array.isArray(e.profiles)&&e.profiles].filter(Boolean);for(const N of u){const j=N.find(n=>(n==null?void 0:n.ownerUid)&&n.ownerUid===(l==null?void 0:l.uid)||(n==null?void 0:n.email)&&String(n.email).toLowerCase()===f||(n==null?void 0:n.contactEmail)&&String(n.contactEmail).toLowerCase()===f||(l==null?void 0:l.vendorId)&&(String(n==null?void 0:n.vendorId)===String(l.vendorId)||String(n==null?void 0:n.id)===String(l.vendorId)));if(j)return H(j,l)}return null}function we(){var v,ee,ae,se,te;const{vendor:e,ensureVendorId:l,refresh:f}=ue(),u=b.useMemo(()=>sessionStorage.getItem("tenantId")||"public",[]),[N,j]=b.useState(()=>J(localStorage.getItem(B))??re),[n,A]=b.useState(()=>J(localStorage.getItem(ne))??[]),[y,L]=b.useState(!1),[q,U]=b.useState(""),[G,T]=b.useState(""),[K,V]=b.useState(""),[W,oe]=b.useState(!0),k=b.useRef([]);function Q(s){const t=[s,...k.current||[]].slice(0,10);k.current=t,localStorage.setItem(F,JSON.stringify(t))}function X(){var i;const s=(i=k.current)!=null&&i.length?k.current:J(localStorage.getItem(F))??[];if(!s.length)return;const t=s.shift();k.current=s,localStorage.setItem(F,JSON.stringify(s)),j(t),localStorage.setItem(B,JSON.stringify(t))}function _(s){Q(N),j(s),localStorage.setItem(B,JSON.stringify(s))}b.useEffect(()=>{let s=!0;return(async()=>{var t,i;L(!0);try{await l();let c=re;try{const h=await((i=(t=p.currentUser)==null?void 0:t.getIdToken)==null?void 0:i.call(t)),d=await fetch(`${E}/live`,{headers:{"x-tenant-id":u,"cache-control":"no-cache",...h?{Authorization:`Bearer ${h}`}:{}}});s&&d.ok&&(c=await d.json())}catch{}try{const h=await $.get("/api/data/vendors").then(w=>w.data||[]),d=M(c);d.startups=Array.isArray(d.startups)?d.startups:[],h.forEach(w=>{const S=H(w),C=d.startups.findIndex(I=>String(I.vendorId||I.id)===S.vendorId);C>=0?d.startups[C]={...d.startups[C],...S}:d.startups.push(S)}),c=d}catch{}_(c),await P()}catch{}finally{s&&L(!1)}})(),()=>{s=!1}},[u]);async function P(){var s,t;try{const i=await((t=(s=p.currentUser)==null?void 0:s.getIdToken)==null?void 0:t.call(s)),h=(await fetch(`${E}/checkpoints`,{headers:{"x-tenant-id":u,...i?{Authorization:`Bearer ${i}`}:{}}}).then(d=>d.ok?d.json():{items:[]})).items??[];A(h),localStorage.setItem(ne,JSON.stringify(h.slice(0,2)))}catch{}}const g=b.useMemo(()=>{var t,i,c;const s={uid:(t=p.currentUser)==null?void 0:t.uid,email:((i=p.currentUser)==null?void 0:i.email)||(e==null?void 0:e.email)||"",name:((c=p.currentUser)==null?void 0:c.displayName)||(e==null?void 0:e.name)||"",vendorId:(e==null?void 0:e.vendorId)||""};return xe(N,s)||H({},s)},[N,e==null?void 0:e.vendorId,(v=p.currentUser)==null?void 0:v.uid,(ee=p.currentUser)==null?void 0:ee.email]),[r,Y]=b.useState(()=>g);b.useEffect(()=>{Y(g)},[g==null?void 0:g.vendorId]);const o=!p.currentUser,O=((g==null?void 0:g.status)||"").toLowerCase(),D=((g==null?void 0:g.kycStatus)||"").toLowerCase(),R=O==="active"||D==="approved",ce=O==="pending"||D==="pending",z=O==="suspended"||D==="rejected";function x(s,t){Y(i=>({...i,[s]:t}))}function de(s,t){Y(i=>({...i,socials:{...i.socials,[s]:t}}))}async function me(s){var t,i;try{const c=await((i=(t=p.currentUser)==null?void 0:t.getIdToken)==null?void 0:i.call(t)),h=await fetch(`${E}/checkpoints`,{method:"POST",headers:{"Content-Type":"application/json","x-tenant-id":u,...c?{Authorization:`Bearer ${c}`}:{}},body:JSON.stringify({message:s||"Vendor profile update",data:N})});if(!h.ok)throw new Error(await h.text());T("Checkpoint saved"),await P(),V("")}catch(c){U((c==null?void 0:c.message)||"Failed to save checkpoint")}}async function Z(){var w,S,C,I;if(U(""),T(""),o){U("You need to sign in first.");return}if(!r.name.trim()){U("Vendor name is required.");return}const s=M(N);Q(s);const t=M(N);t.startups=Array.isArray(t.startups)?t.startups:[];const i=String(r.vendorId||r.id||(e==null?void 0:e.vendorId)||((w=p.currentUser)==null?void 0:w.uid)||le()),c=(r.contactEmail||((S=p.currentUser)==null?void 0:S.email)||"").toLowerCase(),h={...r,id:i,vendorId:i,ownerUid:((C=p.currentUser)==null?void 0:C.uid)||r.ownerUid||"",contactEmail:c,email:c,lastUpdated:new Date().toISOString()},d=t.startups.findIndex(m=>String(m.vendorId)===i||String(m.id)===i||m.email&&String(m.email).toLowerCase()===c);d>=0?t.startups[d]={...t.startups[d],...h}:t.startups.push(h),W&&Array.isArray(t.services)&&(t.services=t.services.map(m=>String(m.vendorId||"")===i?{...m,vendor:h.name}:m));try{L(!0);const m=ge(h);m.id?await $.put(`/api/data/vendors/${encodeURIComponent(m.id)}`,m):await $.post("/api/data/vendors",m);try{await he({action:"VENDOR_UPSERT",userEmail:(I=p.currentUser)==null?void 0:I.email,targetType:"vendor",targetId:i,metadata:{name:h.name}})}catch{}_(t),T("Profile saved to live."),await(f==null?void 0:f()),await P(),window.scrollTo({top:0,behavior:"smooth"})}catch(m){U((m==null?void 0:m.message)||"Save failed"),_(s)}finally{L(!1)}}return a.jsx(pe,{children:a.jsxs("div",{className:"container py-4",style:{maxWidth:980},children:[a.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"h4 mb-0",children:"My Vendor Profile"}),a.jsxs("div",{className:"text-muted small",children:["Signed in as"," ",a.jsx("strong",{children:g.name||((ae=p.currentUser)==null?void 0:ae.displayName)||"Vendor"})," ","· ",g.contactEmail||((se=p.currentUser)==null?void 0:se.email)||"email not set",a.jsx("span",{className:`badge ms-2 text-bg-${R?"success":z?"danger":"warning"}`,children:R?"Approved":z?"Suspended":"Pending"})]}),a.jsxs("div",{className:"text-muted small",children:["Vendor ID:"," ",g.vendorId?a.jsx("code",{children:g.vendorId}):"pending"]}),R&&a.jsxs("div",{className:"alert alert-success mt-3 mb-0",children:["Your vendor account is approved. You can now submit listings to the marketplace.",a.jsxs("div",{className:"mt-2 d-flex gap-2",children:[a.jsx("a",{className:"btn btn-primary btn-sm",href:"/listings-vendors",children:"+ Submit new listing"}),a.jsx("a",{className:"btn btn-outline-secondary btn-sm",href:"/listings-vendors-mine",children:"View my listings"})]})]}),ce&&a.jsx("div",{className:"alert alert-warning mt-3 mb-0",children:"Your vendor account is pending approval. Please complete your profile details and wait for an admin to approve your account. You’ll be able to submit listings once approved."}),z&&a.jsx("div",{className:"alert alert-danger mt-3 mb-0",children:"Your vendor account is suspended. You cannot submit listings. Please contact support if you believe this is an error."})]}),a.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[a.jsx("button",{className:"btn btn-outline-secondary",onClick:X,disabled:y,children:"Undo"}),a.jsx("button",{className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:Z,disabled:y||o,title:"Save changes to live",children:y?"Saving…":"Save changes"})]})]}),o&&a.jsx("div",{className:"alert alert-warning",children:"Please sign in to manage your vendor profile."}),q&&a.jsx("div",{className:"alert alert-danger",children:q}),G&&a.jsx("div",{className:"alert alert-success",children:G}),a.jsxs("div",{className:"row g-3",children:[a.jsx("div",{className:"col-lg-8",children:a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"card-header fw-semibold",children:"Company details"}),a.jsx("div",{className:"card-body",children:a.jsxs("div",{className:"row g-3",children:[a.jsxs("div",{className:"col-md-8",children:[a.jsx("label",{className:"form-label",children:"Company / Vendor name"}),a.jsx("input",{className:"form-control",value:r.name,onChange:s=>x("name",s.target.value),placeholder:"e.g., Acme Studio",disabled:o,required:!0})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsx("label",{className:"form-label",children:"Contact email"}),a.jsx("input",{className:"form-control",value:r.contactEmail,onChange:s=>x("contactEmail",s.target.value.toLowerCase()),placeholder:"you@company.com",disabled:o})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Website"}),a.jsx("input",{className:"form-control",value:r.website,onChange:s=>x("website",s.target.value),placeholder:"https://…",disabled:o})]}),a.jsxs("div",{className:"col-md-3",children:[a.jsx("label",{className:"form-label",children:"Phone"}),a.jsx("input",{className:"form-control",value:r.phone,onChange:s=>x("phone",s.target.value),placeholder:"+27…",disabled:o})]}),a.jsxs("div",{className:"col-md-3",children:[a.jsx("label",{className:"form-label",children:"Founded (year)"}),a.jsx("input",{className:"form-control",value:r.foundedYear,onChange:s=>x("foundedYear",s.target.value),placeholder:"2021",disabled:o})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsx("label",{className:"form-label",children:"Country"}),a.jsx("input",{className:"form-control",value:r.country,onChange:s=>x("country",s.target.value),placeholder:"South Africa",disabled:o})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsx("label",{className:"form-label",children:"City"}),a.jsx("input",{className:"form-control",value:r.city,onChange:s=>x("city",s.target.value),placeholder:"Cape Town",disabled:o})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsx("label",{className:"form-label",children:"Team size"}),a.jsx("input",{className:"form-control",value:r.teamSize,onChange:s=>x("teamSize",s.target.value),placeholder:"1–10",disabled:o})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Company reg. number"}),a.jsx("input",{className:"form-control",value:r.registrationNo,onChange:s=>x("registrationNo",s.target.value),placeholder:"(optional)",disabled:o})]}),a.jsxs("div",{className:"col-md-6 d-none",children:[a.jsx("label",{className:"form-label",children:"Status"}),a.jsxs("select",{className:"form-select",value:r.status,onChange:s=>x("status",s.target.value),disabled:o,children:[a.jsx("option",{value:"active",children:"active"}),a.jsx("option",{value:"pending",children:"pending"}),a.jsx("option",{value:"suspended",children:"suspended"})]})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Logo URL"}),a.jsx("input",{className:"form-control",value:r.logoUrl,onChange:s=>x("logoUrl",s.target.value),placeholder:"https://…",disabled:o})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Banner URL"}),a.jsx("input",{className:"form-control",value:r.bannerUrl,onChange:s=>x("bannerUrl",s.target.value),placeholder:"https://…",disabled:o})]}),a.jsxs("div",{className:"col-12",children:[a.jsx("label",{className:"form-label",children:"Description"}),a.jsx("textarea",{className:"form-control",rows:4,value:r.description,onChange:s=>x("description",s.target.value),placeholder:"Tell buyers what you do, problems you solve, and why you're different.",disabled:o})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Categories (comma-separated)"}),a.jsx("input",{className:"form-control",value:r.categories.join(", "),onChange:s=>x("categories",s.target.value.split(",").map(t=>t.trim()).filter(Boolean)),placeholder:"Design, Branding",disabled:o})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Tags (comma-separated)"}),a.jsx("input",{className:"form-control",value:r.tags.join(", "),onChange:s=>x("tags",s.target.value.split(",").map(t=>t.trim()).filter(Boolean)),placeholder:"logos, identity, saas",disabled:o})]}),a.jsx("div",{className:"col-12",children:a.jsx("div",{className:"row g-3",children:[["twitter","Twitter"],["linkedin","LinkedIn"],["facebook","Facebook"],["instagram","Instagram"],["youtube","YouTube"],["github","GitHub"]].map(([s,t])=>a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:t}),a.jsx("input",{className:"form-control",value:r.socials[s],onChange:i=>de(s,i.target.value),placeholder:`https://${s}.com/...`,disabled:o})]},s))})}),a.jsxs("div",{className:"col-12 d-flex align-items-center gap-2",children:[a.jsx("input",{id:"propagateName",type:"checkbox",className:"form-check-input",checked:W,onChange:s=>oe(!!s.target.checked),disabled:o}),a.jsx("label",{htmlFor:"propagateName",className:"form-check-label",children:"Update my display name on all existing listings"})]}),a.jsxs("div",{className:"col-12 d-flex gap-2 mt-2",children:[a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:X,disabled:y,children:"Undo"}),a.jsx("button",{type:"button",className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:Z,disabled:y||o,children:y?"Saving…":"Save changes"})]}),r.lastUpdated&&a.jsxs("div",{className:"form-text mt-1",children:["Last updated: ",ie(r.lastUpdated)]})]})})]})}),a.jsxs("div",{className:"col-lg-4",children:[a.jsxs("div",{className:"card mb-3",children:[a.jsx("div",{className:"card-header fw-semibold",children:"Preview"}),a.jsxs("div",{className:"card-body",children:[a.jsxs("div",{className:"d-flex align-items-center gap-3",children:[a.jsx("img",{src:r.logoUrl||"/assets/images/placeholder-1x1.png",alt:"logo",style:{width:64,height:64,objectFit:"cover",borderRadius:8}}),a.jsxs("div",{children:[a.jsx("div",{className:"fw-semibold",children:r.name||"Vendor"}),a.jsx("div",{className:"text-muted small",children:r.contactEmail||((te=p.currentUser)==null?void 0:te.email)||"email"}),a.jsx("div",{className:"small",children:r.website?a.jsx("a",{href:r.website,target:"_blank",rel:"noreferrer",children:r.website}):"website"})]})]}),r.bannerUrl&&a.jsx("div",{className:"mt-3",children:a.jsx("img",{src:r.bannerUrl,alt:"banner",className:"w-100",style:{maxHeight:140,objectFit:"cover",borderRadius:8}})}),a.jsxs("div",{className:"mt-3 small text-muted",children:["Categories: ",r.categories.join(", ")||"—",a.jsx("br",{}),"Tags: ",r.tags.join(", ")||"—"]})]})]}),a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"card-header fw-semibold d-flex align-items-center justify-content-between",children:a.jsx("span",{children:"Version control"})}),a.jsxs("div",{className:"card-body",children:[a.jsxs("div",{className:"d-flex gap-2 mb-2",children:[a.jsx("input",{className:"form-control",placeholder:"Checkpoint message",value:K,onChange:s=>V(s.target.value)}),a.jsx("button",{className:"btn btn-outline-primary",onClick:()=>me(K),disabled:y||o,children:"Save checkpoint"})]}),a.jsxs("div",{className:"list-group list-group-flush",children:[!(n!=null&&n.length)&&a.jsx("div",{className:"text-muted small",children:"No checkpoints yet. Create one after saving changes."}),n==null?void 0:n.slice(0,6).map(s=>a.jsxs("div",{className:"list-group-item",children:[a.jsx("div",{className:"fw-semibold",children:s.message||"(no message)"}),a.jsx("div",{className:"text-muted small",children:ie(s.ts)}),a.jsx("div",{className:"d-flex gap-2 mt-1",children:a.jsx("a",{className:"btn btn-sm btn-outline-secondary",href:`${E}/checkpoints/${s.id}`,target:"_blank",rel:"noreferrer",children:"Download snapshot"})})]},s.id))]}),a.jsx("div",{className:"form-text mt-2",children:"Checkpoints snapshot the whole marketplace data (including your profile) on the server."})]})]})]})]})]})})}export{we as default};
