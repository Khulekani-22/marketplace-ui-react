import{r as a,b as S,j as e}from"./index-CA0CEW2v.js";import{M as w}from"./MasterLayout-DmY1NVaa.js";import{B as M}from"./Breadcrumb-B5Z4qd_D.js";import{u as L}from"./useAppSync-C6gKe1DY.js";import{f as R,u as A}from"./subscriptions-BpzQLJOa.js";import"./iconify-DgbGXnnR.js";function B(){const[u,b]=a.useState(!0),[f,l]=a.useState([]),[x,h]=a.useState(""),[p,j]=a.useState({}),[y,g]=a.useState(!1),v=a.useMemo(()=>sessionStorage.getItem("tenantId")||"vendor",[]),{appData:c}=L(),d=a.useCallback(async({silent:s,signal:t}={})=>{s?g(!0):b(!0),h("");try{if(!S.currentUser){t!=null&&t.aborted||l([]);return}const i=await R(),o=new Set(i.filter(n=>(n.type||"service")==="service").map(n=>String(n.serviceId))),m=(Array.isArray(c==null?void 0:c.services)?c.services:[]).filter(n=>o.has(String(n.id)));t!=null&&t.aborted||l(m)}catch(i){t!=null&&t.aborted||h((i==null?void 0:i.message)||"Failed to load subscriptions")}finally{(t==null?void 0:t.aborted)||(s?g(!1):b(!1))}},[c]);a.useEffect(()=>{const s=new AbortController;return d({silent:!1,signal:s.signal}),()=>{s.abort()}},[d,v]);async function N(s){var i,o;const t=String(s);j(r=>({...r,[t]:!0}));try{await A(t),l(r=>r.filter(m=>String(m.id)!==t))}catch(r){alert(((o=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:o.message)||(r==null?void 0:r.message)||"Failed to unsubscribe")}finally{j(r=>({...r,[t]:!1}))}}return e.jsxs(w,{children:[e.jsx(M,{title:"My Subscriptions"}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header border-bottom py-16 px-24 d-flex align-items-center justify-content-between gap-3 flex-wrap",children:[e.jsx("h6",{className:"mb-0",children:"Active Subscriptions"}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>d({silent:!0}),disabled:u||y,children:y?"Refreshing…":"Refresh"})]}),e.jsxs("div",{className:"card-body",children:[x&&e.jsx("div",{className:"alert alert-danger",children:x}),u?e.jsx("div",{children:"Loading…"}):e.jsxs("div",{className:"row g-3",children:[f.length===0&&e.jsx("div",{className:"col-12 text-secondary",children:"No subscriptions yet."}),f.map(s=>e.jsx("div",{className:"col-12 col-md-6 col-lg-4",children:e.jsxs("div",{className:"card h-100",children:[e.jsx("img",{src:s.imageUrl||"/assets/images/services/placeholder.png",className:"card-img-top",alt:s.title||"Listing",style:{maxHeight:160,objectFit:"cover"}}),e.jsxs("div",{className:"card-body d-flex flex-column",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsx("h6",{className:"card-title mb-1",children:s.title||"Listing"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-secondary",title:"Notifications (soon)",disabled:!0,children:e.jsx("i",{className:"ri-notification-3-line"})})]}),e.jsxs("div",{className:"text-muted small mb-2",children:[s.category||"General"," · ",s.vendor||""]}),s.description&&e.jsxs("p",{className:"flex-grow-1 text-secondary small",children:[s.description.slice(0,140),s.description.length>140?"…":""]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-auto",children:[e.jsxs("strong",{children:["R ",Number(s.price||0).toLocaleString()]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("span",{className:"badge bg-neutral-200 text-neutral-900",children:["★ ",Number(s.rating||0).toFixed(1)]}),e.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>N(s.id),disabled:!!p[String(s.id)],children:p[String(s.id)]?"Removing…":"Unsubscribe"})]})]})]})]})},String(s.id)))]})]})]})]})}export{B as default};
