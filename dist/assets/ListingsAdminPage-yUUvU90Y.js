const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BannerInnerTwo-HfBnvnry.js","assets/index-BsOh-tAE.js","assets/index-CUHJT0fJ.css"])))=>i.map(i=>d[i]);
import{r as p,l as ve,o as v,j as e,R as ae,w as C,_ as Ne}from"./index-BsOh-tAE.js";import{a as je}from"./appData-DzAG2zN5.js";import{S as ye}from"./SideNavAdmin-CwL1RRy1.js";import"./iconify-BmV4o_YB.js";import"./ThemeToggleButton-DJ1aWpop.js";const E="/api/lms",we=ae.lazy(()=>Ne(()=>import("./BannerInnerTwo-HfBnvnry.js"),__vite__mapDeps([0,1,2]))),W="listings_admin_draft_v1",G="listings_admin_undo_v1",ee="listings_admin_history_cache_v1";function J(a){try{return typeof a=="string"?JSON.parse(a):a}catch{return null}}function F(a){return JSON.parse(JSON.stringify(a))}function X(){return Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,8)}function Se(a){return new Date(a).toLocaleString()}function Ie(a=[]){const c=a.length,d=a.reduce((x,w)=>{const S=(w.status||"unknown").toLowerCase();return x[S]=(x[S]||0)+1,x},{}),m=a.filter(x=>!!x.isFeatured).length,j=new Set(a.map(x=>(x.category||"").trim()).filter(Boolean)).size;return{total:c,featured:m,categories:j,byStatus:d}}function te(a){const c=a.vendorId||a.id||a.uid||(a.email?a.email.toLowerCase():X());return{id:c,vendorId:a.vendorId||c,companyName:a.companyName||a.name||a.displayName||"",name:a.name||a.companyName||"",email:(a.email||a.contactEmail||"").toLowerCase(),website:a.website||"",phone:a.phone||a.phoneNumber||"",avatar:a.avatar||a.logoUrl||"",raw:a}}function Ce(a=[]){const c={},d={};return a.forEach(m=>{c[m.vendorId]=m,m.email&&(d[m.email]=m)}),{byId:c,byEmail:d}}function Q(a){var c;return{id:a.id??X(),title:a.title??"",category:a.category??"",vendor:a.vendor??a.vendorName??"",vendorId:a.vendorId??"",contactEmail:(a.contactEmail||a.email||"").toLowerCase(),price:typeof a.price=="number"?a.price:Number(a.price||0),rating:typeof a.rating=="number"?a.rating:Number(a.rating||0),reviewCount:typeof a.reviewCount=="number"?a.reviewCount:Number(a.reviewCount||((c=a.reviews)==null?void 0:c.length)||0),imageUrl:a.imageUrl??a.thumbnail??"",aiHint:a.aiHint??"",listingType:a.listingType??"service",status:a.status??"approved",isFeatured:!!a.isFeatured,description:a.description??"",reviews:Array.isArray(a.reviews)?a.reviews:[]}}function De(){var Z;const a=p.useMemo(()=>sessionStorage.getItem("tenantId")||"public",[]),[c,d]=p.useState(()=>J(localStorage.getItem(W))??je),m=p.useMemo(()=>((c==null?void 0:c.services)||[]).map(Q),[c]),[j,x]=p.useState(()=>((c==null?void 0:c.startups)||[]).map(te));p.useEffect(()=>{let t=!0;return(async()=>{try{const s=await ve.get("/api/data/vendors").then(i=>i.data||[]),n=Array.isArray(s)?s.map(te):[];t&&n.length&&x(n)}catch{}})(),()=>{t=!1}},[a]);const{byId:w,byEmail:S}=p.useMemo(()=>Ce(j),[j]);c!=null&&c.startups;const[k,A]=p.useState(()=>JSON.stringify(c,null,2)),[R,H]=p.useState("visual"),[B,I]=p.useState(!1),[V,M]=p.useState(null),[u,y]=p.useState(null),L=p.useRef([]),[K,f]=p.useState(()=>J(localStorage.getItem(ee))??[]),Y=p.useMemo(()=>["All",...Array.from(new Set(m.map(s=>(s.category||"").trim()).filter(Boolean)))],[m]),[O,N]=p.useState("All"),[r,b]=p.useState("All"),[U,se]=p.useState(""),[q,_]=p.useState(((Z=m[0])==null?void 0:Z.id)||""),re=p.useMemo(()=>m.filter(t=>!(O!=="All"&&(t.category||"").trim()!==O||r!=="All"&&(t.status||"").toLowerCase()!==r||U&&!`${t.title} ${t.vendor} ${t.vendorId} ${t.contactEmail} ${t.category}`.toLowerCase().includes(U.toLowerCase()))),[m,O,r,U]),g=p.useMemo(()=>m.find(t=>t.id===q),[m,q]);function T(t){M(t),setTimeout(()=>M(null),2500)}function ne(t){const s=J(localStorage.getItem(G))??[];s.unshift(t);const n=s.slice(0,10);localStorage.setItem(G,JSON.stringify(n)),L.current=n}function $(t){ne(c),d(t),A(JSON.stringify(t,null,2)),localStorage.setItem(W,JSON.stringify(t))}function ie(t){var i,l;if(!g)return;const s=F(c),n=s.services.findIndex(o=>o.id===g.id);if(n>=0){s.services[n]={...Q(s.services[n]),...t},$(s);try{const o=g.status;typeof t.status<"u"&&t.status!==o?C({action:"LISTING_STATUS_CHANGE",userEmail:(i=v.currentUser)==null?void 0:i.email,targetType:"listing",targetId:g.id,metadata:{from:o,to:t.status,title:g.title}}):C({action:"LISTING_UPDATE",userEmail:(l=v.currentUser)==null?void 0:l.email,targetType:"listing",targetId:g.id,metadata:{patch:t}})}catch{}}}function le(){var i;const t=prompt("Service title?");if(!t)return;const s=F(c),n=Math.max(0,...s.services.map(l=>Number(l.id)).filter(l=>!Number.isNaN(l)))+1;s.services.push(Q({id:String(n),title:t,vendor:"",vendorId:"",contactEmail:"",category:"",price:0,rating:0,reviewCount:0,imageUrl:"",listingType:"service",status:"approved",isFeatured:!1,description:"",aiHint:"",reviews:[]})),$(s),_(String(n));try{C({action:"LISTING_CREATE",userEmail:(i=v.currentUser)==null?void 0:i.email,targetType:"listing",targetId:String(n),metadata:{title:t}})}catch{}}function ce(){var n;if(!g)return;const t=F(c),s=F(g);s.id=X(),s.title=`${s.title} (Copy)`,t.services.push(s),$(t),_(s.id);try{C({action:"LISTING_DUPLICATE",userEmail:(n=v.currentUser)==null?void 0:n.email,targetType:"listing",targetId:s.id,metadata:{sourceId:g.id,title:s.title}})}catch{}}function oe(){var s,n;if(!g||!window.confirm(`Delete "${g.title}"?`))return;const t=F(c);t.services=t.services.filter(i=>i.id!==g.id),$(t),_(((s=t.services[0])==null?void 0:s.id)||"");try{C({action:"LISTING_DELETE",userEmail:(n=v.currentUser)==null?void 0:n.email,targetType:"listing",targetId:g.id,metadata:{title:g.title}})}catch{}}function de(){const t=L.current.length>0?L.current:J(localStorage.getItem(G))??[];if(!t.length)return;const s=t.shift();L.current=t,localStorage.setItem(G,JSON.stringify(t)),d(s),A(JSON.stringify(s,null,2))}p.useEffect(()=>{(async()=>{var t,s,n,i;I(!0);try{const l=await((s=(t=v.currentUser)==null?void 0:t.getIdToken)==null?void 0:s.call(t)),o=await fetch(`${E}/live`,{headers:{"x-tenant-id":a,...l?{Authorization:`Bearer ${l}`}:{}}});if(o.ok){const h=await o.json();d(h),A(JSON.stringify(h,null,2)),localStorage.setItem(W,JSON.stringify(h)),_(((i=(n=h==null?void 0:h.services)==null?void 0:n[0])==null?void 0:i.id)||"")}await P()}catch{}finally{I(!1)}})()},[]);async function P(){var t,s;try{const n=await((s=(t=v.currentUser)==null?void 0:t.getIdToken)==null?void 0:s.call(t)),l=(await fetch(`${E}/checkpoints`,{headers:{"x-tenant-id":a,...n?{Authorization:`Bearer ${n}`}:{}}}).then(o=>o.ok?o.json():{items:[]})).items??[];f(l),localStorage.setItem(ee,JSON.stringify(l.slice(0,2)))}catch{}}async function me(){var t,s,n;y(null),I(!0);try{const i=await((s=(t=v.currentUser)==null?void 0:t.getIdToken)==null?void 0:s.call(t)),l=await fetch(`${E}/publish`,{method:"PUT",headers:{"Content-Type":"application/json","x-tenant-id":a,...i?{Authorization:`Bearer ${i}`}:{}},body:JSON.stringify({data:c})});if(!l.ok)throw new Error(await l.text());T("Published listings to live");try{await C({action:"LISTINGS_PUBLISH",userEmail:(n=v.currentUser)==null?void 0:n.email,targetType:"appData",targetId:"services",metadata:{count:m.length}})}catch{}await P()}catch(i){y(i.message||"Publish failed")}finally{I(!1)}}async function ue(t){var s,n,i;try{const l=await((n=(s=v.currentUser)==null?void 0:s.getIdToken)==null?void 0:n.call(s)),o=await fetch(`${E}/checkpoints`,{method:"POST",headers:{"Content-Type":"application/json","x-tenant-id":a,...l?{Authorization:`Bearer ${l}`}:{}},body:JSON.stringify({message:t||"",data:c})});if(!o.ok)throw new Error(await o.text());T("Checkpoint saved");try{await C({action:"LISTINGS_CHECKPOINT",userEmail:(i=v.currentUser)==null?void 0:i.email,targetType:"services",targetId:"checkpoint",metadata:{message:t||""}})}catch{}await P()}catch(l){y(l.message||"Failed to save checkpoint")}}async function he(t){var s,n;if(window.confirm("Restore this snapshot to LIVE appData.json?"))try{const i=await((n=(s=v.currentUser)==null?void 0:s.getIdToken)==null?void 0:n.call(s)),l=await fetch(`${E}/restore/${t}`,{method:"POST",headers:{"x-tenant-id":a,...i?{Authorization:`Bearer ${i}`}:{}}});if(!l.ok)throw new Error(await l.text());T("Restored snapshot"),await P();const o=await fetch(`${E}/live`).then(h=>h.json());$(o)}catch(i){y(i.message||"Restore failed")}}async function pe(){var t,s,n;if(window.confirm("Delete ALL checkpoints on the server?"))try{const i=await((s=(t=v.currentUser)==null?void 0:t.getIdToken)==null?void 0:s.call(t)),l=await fetch(`${E}/checkpoints`,{method:"DELETE",headers:{"x-tenant-id":a,...i?{Authorization:`Bearer ${i}`}:{}}});if(!l.ok)throw new Error(await l.text());T("Cleared history");try{await C({action:"LISTINGS_HISTORY_CLEAR",userEmail:(n=v.currentUser)==null?void 0:n.email,targetType:"services",targetId:"history"})}catch{}await P()}catch(i){y(i.message||"Failed to clear")}}const D=Ie(m);function xe(t){const s=t.vendorId&&w[t.vendorId],n=t.contactEmail&&S[t.contactEmail],i=s||n||null,l=(i==null?void 0:i.companyName)||(i==null?void 0:i.name)||t.vendor||t.contactEmail||"â€”",o=(i==null?void 0:i.email)||t.contactEmail||"",h=(i==null?void 0:i.vendorId)||t.vendorId||"",z=h?`/profile-vendor?vendorId=${encodeURIComponent(h)}`:null;return{v:i,name:l,email:o,vendorId:h,profileHref:z}}function ge(t){return!t||typeof t!="object"?"File is not valid JSON.":Array.isArray(t.services)?null:"JSON must include an array: services[]."}async function fe(t){var n,i,l;y(null);const s=(n=t.target.files)==null?void 0:n[0];if(s)try{const o=await s.text(),h=J(o),z=ge(h);if(z){y(z);return}$(h),_(((l=(i=h==null?void 0:h.services)==null?void 0:i[0])==null?void 0:l.id)||""),T(`Imported ${s.name}`)}catch(o){y("Import failed: "+((o==null?void 0:o.message)||"unknown error"))}finally{t.target.value=""}}function be(){try{const t=new Blob([JSON.stringify(c,null,2)],{type:"application/json;charset=utf-8"}),s=URL.createObjectURL(t),n=document.createElement("a");n.href=s;const i=new Date().toISOString().replace(/[:.]/g,"-");n.download=`appData-${a}-${i}.json`,document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(s),T("Exported current working copy")}catch(t){y("Export failed: "+((t==null?void 0:t.message)||"unknown error"))}}return e.jsx(ye,{children:e.jsxs("div",{className:"container py-4",children:[e.jsx(ae.Suspense,{fallback:null,children:e.jsx("div",{className:"row mb-3",children:e.jsx(we,{})})}),e.jsxs("div",{className:"row g-3 mb-3",children:[e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 bg-animated-gradient text-center p-3",children:[e.jsx("i",{className:"bi bi-bag-check text-primary fs-3 mb-2"}),e.jsx("h6",{className:"fw-bold mb-0",children:D.total}),e.jsx("small",{className:"text-muted",children:"Services"})]})}),e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 text-center p-3",children:[e.jsx("i",{className:"bi bi-grid text-success fs-3 mb-2"}),e.jsx("h6",{className:"fw-bold mb-0",children:D.categories}),e.jsx("small",{className:"text-muted",children:"Categories"})]})}),e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 text-center p-3",children:[e.jsx("i",{className:"bi bi-star-fill text-warning fs-3 mb-2"}),e.jsx("h6",{className:"fw-bold mb-0",children:D.featured}),e.jsx("small",{className:"text-muted",children:"Featured"})]})}),e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 p-3",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-flag text-danger fs-4","aria-hidden":"true"}),e.jsx("div",{className:"fw-semibold",children:"Status"})]}),e.jsxs("span",{className:"badge text-bg-light",children:[Object.values(D.byStatus||{}).reduce((t,s)=>t+s,0)," total"]})]}),(()=>{var i;const t=l=>l==="approved"?"success":l==="pending"?"warning":l==="rejected"?"danger":"secondary",s=Object.entries(D.byStatus||{}),n=s.reduce((l,[,o])=>l+o,0);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"progress",style:{height:10},"aria-label":"Status proportions",children:s.map(([l,o])=>{const h=n?Math.round(o/n*100):0;return e.jsx("div",{className:`progress-bar bg-${t(l)}`,role:"progressbar",style:{width:`${h}%`},"aria-label":`${l} ${h}%`,"aria-valuenow":h,"aria-valuemin":0,"aria-valuemax":100,title:`${l}: ${o} (${h}%)`},l)})}),e.jsx("div",{className:"d-flex flex-wrap gap-2 mt-3",children:s.length?s.map(([l,o])=>e.jsxs("span",{className:`d-inline-flex align-items-center gap-2 px-2 py-1 rounded-pill border border-${t(l)} text-${t(l)} bg-${t(l)}-subtle small`,title:`${l}: ${o}`,"aria-label":`${l}: ${o}`,children:[e.jsx("i",{className:`bi ${l==="approved"?"bi-check-circle":l==="pending"?"bi-hourglass-split":l==="rejected"?"bi-x-octagon":"bi-dot"} `,"aria-hidden":"true"}),e.jsx("span",{className:"text-capitalize",children:l}),e.jsx("span",{className:"badge text-bg-light",children:o})]},l)):e.jsx("span",{className:"text-muted small",children:"No status data"})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsx("small",{className:"text-muted",children:"Total Approved: "}),e.jsxs("span",{className:"fw-semibold",children:[n?Math.round((((i=D.byStatus)==null?void 0:i.approved)??0)/n*100):0,"%"]})]})]})})()]})})]}),e.jsxs("div",{className:"pt-4 d-flex gap-2 mb-3",children:[e.jsxs("label",{className:"btn btn-light mb-0 d-none",children:["Import JSON",e.jsx("input",{type:"file",accept:"application/json",hidden:!0,onChange:fe})]}),e.jsx("button",{className:"btn rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-primary-700 text-hover-white",onClick:be,children:"Export Current"}),e.jsx("button",{className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:me,disabled:B,title:"Write working copy to live appData.json on the server",children:B?"Publishingâ€¦":"Publish to live"})]}),V&&e.jsx("div",{className:"alert alert-success py-2",children:V}),u&&e.jsx("div",{className:"alert alert-danger py-2",children:u}),e.jsx(Ee,{onSave:ue,onClear:pe,onUndo:de,disabled:B}),e.jsxs("div",{className:"d-flex gap-3",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("ul",{className:"nav nav-tabs mb-3",children:[e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${R==="visual"?"active":""}`,onClick:()=>H("visual"),children:"Visual editor"})}),e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${R==="json"?"active":""}`,onClick:()=>H("json"),children:"JSON editor"})})]}),R==="json"?e.jsx(ke,{text:k,setText:A,onApply:()=>{const t=J(k);if(!t){y("Invalid JSON");return}$(t),T("Applied JSON to working copy")}}):e.jsx(Te,{services:m,vendors:j,vendorsById:w,vendorsByEmail:S,resolveVendor:xe,category:O,setCategory:N,status:r,setStatus:b,allCategories:Y,search:U,setSearch:se,filtered:re,selectedId:q,setSelectedId:_,selected:g,addService:le,duplicateService:ce,deleteService:oe,updateService:ie})]}),e.jsx("div",{style:{width:380},children:e.jsx($e,{items:K,onRestore:he})})]})]})})}function Ee({onSave:a,onClear:c,onUndo:d,disabled:m}){const[j,x]=p.useState("");return e.jsxs("div",{className:"d-flex align-items-center gap-2 mb-3",children:[e.jsx("input",{className:"form-control",placeholder:"Checkpoint message (e.g. 'Tweaked pricing & featured items')",value:j,onChange:w=>x(w.target.value)}),e.jsx("button",{className:"btn btn-sm rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:()=>a(j),disabled:m,children:"Save checkpoint"}),e.jsx("button",{className:"btn btn-sm rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-danger-700 text-hover-white",onClick:c,children:"Clear history"}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:d,children:"Undo"})]})}function ke({text:a,setText:c,onApply:d}){return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header fw-semibold",children:"Working copy (JSON)"}),e.jsxs("div",{className:"card-body",children:[e.jsx("textarea",{value:a,onChange:m=>c(m.target.value),rows:22,spellCheck:!1,className:"form-control font-monospace"}),e.jsxs("div",{className:"d-flex justify-content-between mt-2",children:[e.jsxs("small",{className:"text-muted",children:["Tip: Press ",e.jsx("kbd",{children:"âŒ˜/Ctrl"}),"+",e.jsx("kbd",{children:"A"})," then ",e.jsx("kbd",{children:"âŒ˜/Ctrl"}),"+",e.jsx("kbd",{children:"C"})," to copy."]}),e.jsx("button",{className:"btn btn-outline-primary",onClick:d,children:"Apply JSON"})]})]})]})}function Te(a){const{services:c,vendors:d,vendorsById:m,vendorsByEmail:j,resolveVendor:x,category:w,setCategory:S,status:k,setStatus:A,allCategories:R,search:H,setSearch:B,filtered:I,selectedId:V,setSelectedId:M,selected:u,addService:y,duplicateService:L,deleteService:K,updateService:f}=a,Y=p.useMemo(()=>d.map(r=>({id:r.vendorId,label:`${r.companyName||r.name||"(unnamed)"}${r.email?" â€” "+r.email:""}`})),[d]);function O(r){const b=m[r];f({vendorId:r||"",vendor:b&&(b.companyName||b.name)||"",contactEmail:(b==null?void 0:b.email)||(u==null?void 0:u.contactEmail)||""})}const N=u?x(u):null;return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"fw-semibold",children:"Visual editor"}),e.jsx("span",{className:"text-muted small",children:"CRUD for services (listings)"})]}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row g-2 align-items-end mb-3",children:[e.jsxs("div",{className:"col-12 col-md-3",children:[e.jsx("label",{className:"form-label",children:"Category"}),e.jsx("select",{className:"form-select",value:w,onChange:r=>S(r.target.value),children:R.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{className:"col-12 col-md-3",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsx("select",{className:"form-select",value:k,onChange:r=>A(r.target.value),children:["All","approved","pending","rejected"].map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{className:"col",children:[e.jsx("label",{className:"form-label",children:"Search"}),e.jsx("input",{className:"form-control",placeholder:"Title, vendor, email, vendorId, categoryâ€¦",value:H,onChange:r=>B(r.target.value)})]}),e.jsx("div",{className:"col-auto",children:e.jsx("button",{className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6 w-100",onClick:y,children:"+ Add service"})}),e.jsx("div",{className:"col-auto",children:e.jsx("button",{className:"btn rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-primary-700 text-hover-white w-100",onClick:L,disabled:!u,children:"Duplicate"})}),e.jsx("div",{className:"col-auto",children:e.jsx("button",{className:"btn btn-danger-500 rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-danger-700 text-hover-white w-100",onClick:K,disabled:!u,children:"Delete"})})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-4",children:[e.jsxs("div",{className:"list-group mb-2",style:{maxHeight:420,overflow:"auto"},children:[I.map(r=>{const b=x(r);return e.jsxs("button",{className:"list-group-item list-group-item-action d-flex justify-content-between align-items-center "+(V===r.id?"active":""),onClick:()=>M(r.id),title:b.email||"",children:[e.jsxs("span",{className:"text-truncate",children:[r.title,e.jsx("span",{className:"text-muted",children:" Â· "}),e.jsx("span",{className:"text-truncate",children:b.name})]}),b.profileHref?e.jsx("a",{className:"badge bg-light text-dark text-decoration-none",href:b.profileHref,target:"_blank",rel:"noreferrer",onClick:U=>U.stopPropagation(),title:"Open vendor profile",children:b.vendorId}):e.jsx("span",{className:"badge bg-light text-dark",children:r.category||"â€”"})]},r.id)}),!I.length&&e.jsx("div",{className:"text-muted small p-2",children:"No services match your filters."})]}),e.jsxs("div",{className:"small text-muted",children:["Showing ",I.length," of ",c.length]})]}),e.jsx("div",{className:"col",children:u?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Title"}),e.jsx("input",{className:"form-control",value:u.title,onChange:r=>f({title:r.target.value})})]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Category"}),e.jsx("input",{className:"form-control",value:u.category||"",onChange:r=>f({category:r.target.value})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Listing type"}),e.jsxs("select",{className:"form-select",value:u.listingType||"service",onChange:r=>f({listingType:r.target.value}),children:[e.jsx("option",{value:"service",children:"Service"}),e.jsx("option",{value:"saas",children:"SaaS"})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsxs("select",{className:"form-select",value:u.status||"approved",onChange:r=>f({status:r.target.value}),children:[e.jsx("option",{value:"approved",children:"approved"}),e.jsx("option",{value:"pending",children:"pending"}),e.jsx("option",{value:"rejected",children:"rejected"})]})]})]}),e.jsxs("div",{className:"row g-3 mt-1",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Bind to vendor (by company or email)"}),e.jsxs("select",{className:"form-select",value:u.vendorId||"",onChange:r=>O(r.target.value),children:[e.jsx("option",{value:"",children:"â€”"}),Y.map(r=>e.jsx("option",{value:r.id,children:r.label},r.id))]}),e.jsxs("div",{className:"form-text",children:["Saves both ",e.jsx("code",{children:"vendorId"})," and display"," ",e.jsx("code",{children:"vendor"})," name on the listing."]})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Contact email"}),e.jsx("input",{className:"form-control",value:u.contactEmail||"",onChange:r=>f({contactEmail:r.target.value.toLowerCase()})})]}),e.jsx("div",{className:"col-md-3 d-flex align-items-end",children:N!=null&&N.profileHref?e.jsx("a",{className:"btn btn-outline-primary w-100",href:N.profileHref,target:"_blank",rel:"noreferrer",title:"Open vendor profile",children:"View profile"}):e.jsx("button",{className:"btn btn-outline-secondary w-100",disabled:!0,children:"No profile linked"})})]}),e.jsxs("div",{className:"row g-3 mt-1",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Price (R)"}),e.jsx("input",{type:"number",min:"0",className:"form-control",value:Number(u.price||0),onChange:r=>f({price:Number(r.target.value||0)})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Rating (0â€“5)"}),e.jsx("input",{type:"number",min:"0",max:"5",step:"0.1",className:"form-control",value:Number(u.rating||0),onChange:r=>f({rating:Number(r.target.value||0)})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Review count"}),e.jsx("input",{type:"number",min:"0",className:"form-control",value:Number(u.reviewCount||0),onChange:r=>f({reviewCount:Number(r.target.value||0)})})]})]}),e.jsxs("div",{className:"row g-3 mt-1",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsx("label",{className:"form-label",children:"Image URL"}),e.jsx("input",{className:"form-control",value:u.imageUrl||"",onChange:r=>f({imageUrl:r.target.value})})]}),e.jsx("div",{className:"col-md-4 d-flex align-items-end gap-3",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{id:"isFeatured",type:"checkbox",className:"form-check-input",checked:!!u.isFeatured,onChange:r=>f({isFeatured:!!r.target.checked})}),e.jsx("label",{htmlFor:"isFeatured",className:"form-check-label",children:"Featured"})]})})]}),e.jsxs("div",{className:"mb-3 mt-2",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("textarea",{className:"form-control",rows:4,value:u.description||"",onChange:r=>f({description:r.target.value})})]}),e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("div",{className:"text-muted small mb-1",children:"Card preview"}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("img",{src:u.imageUrl||"/assets/images/placeholder-4x3.png",alt:"",style:{width:120,height:72,objectFit:"cover",borderRadius:6}}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:u.title||"Untitled service"}),e.jsxs("div",{className:"text-muted small",children:[(N==null?void 0:N.name)||"Vendor",N!=null&&N.email?` Â· ${N.email}`:""]}),e.jsxs("div",{className:"small",children:["R",Number(u.price||0).toLocaleString()," Â· â˜…"," ",Number(u.rating||0).toFixed(1)]})]})]})]})]}):e.jsx("div",{className:"text-muted mt-2",children:"Select a service to edit details."})})]})]})]})}function $e({items:a,onRestore:c}){return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header fw-semibold d-flex justify-content-between",children:[e.jsx("span",{children:"Version history"}),e.jsx("span",{className:"text-muted small",children:"Latest checkpoints"})]}),e.jsxs("div",{className:"list-group list-group-flush",children:[!(a!=null&&a.length)&&e.jsxs("div",{className:"list-group-item text-muted small",children:["No checkpoints yet.",e.jsx("div",{className:"mt-1",children:"Offline cache keeps the two most recent checkpoints."})]}),a==null?void 0:a.map(d=>{var m,j,x,w,S,k;return e.jsx("div",{className:"list-group-item",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:d.message||"(no message)"}),e.jsx("div",{className:"text-muted small",children:Se(d.ts)}),e.jsxs("div",{className:"text-muted small",children:["Î” Cohorts: ",((m=d.delta)==null?void 0:m.cohorts)>=0?"+":"",((j=d.delta)==null?void 0:j.cohorts)??0," Â· Î” Courses:"," ",((x=d.delta)==null?void 0:x.courses)>=0?"+":"",((w=d.delta)==null?void 0:w.courses)??0," Â· Î” Lessons:"," ",((S=d.delta)==null?void 0:S.lessons)>=0?"+":"",((k=d.delta)==null?void 0:k.lessons)??0]})]}),e.jsxs("div",{className:"d-flex align-items-start gap-2",children:[e.jsx("button",{className:"btn btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6 btn-sm",title:"Restore snapshot to LIVE",onClick:()=>c(d.id),children:"Restore"}),e.jsx("a",{className:"btn btn-outline-secondary btn-sm",title:"Download snapshot JSON",href:`${E}/checkpoints/${d.id}`,target:"_blank",rel:"noreferrer",children:"Download"})]})]})},d.id)})]})]})}export{De as default};
