import{d as Se,e as Le,b as h,f as k,B as d,j as e,I as t,M as Ue}from"./index-Bn5LcKgl.js";import{B as Fe}from"./Breadcrumb-B3g6Xnkc.js";import{r as i,L as ce}from"./vendor-DW3XjTa1.js";import{W as Ee,a as oe,T as de,A as Re,f as C}from"./WalletNavigation-BrA_QL_O.js";import"./firebase-BBiW2ZCr.js";import"./utils-B2rxisVD.js";function De(){const{loading:me,eligible:_,wallet:j,redeemCredits:he,grantCredits:xe,refresh:I}=Se(),{isAdmin:o}=Le(),[q,J]=i.useState(""),[E,K]=i.useState(""),[R,D]=i.useState({type:"",message:""}),[$,X]=i.useState(!1),[ue,pe]=i.useState([]),[V,Y]=i.useState(!1),[f,je]=i.useState(""),[T,G]=i.useState(null),[Z,ee]=i.useState(""),[ge,M]=i.useState(""),[y,B]=i.useState(!1),[p,be]=i.useState(""),[Ne,se]=i.useState([]),[v,ae]=i.useState(!1),[te,W]=i.useState(""),[A,ne]=i.useState(""),[Q,$e]=i.useState(50),le=i.useRef(!1),[u,O]=i.useState([]),[c,g]=i.useState({userEmail:"",type:"",dateFrom:"",dateTo:"",minAmount:"",maxAmount:""}),[P,re]=i.useState(!1),[x,S]=i.useState(1),[b]=i.useState(20),[L,fe]=i.useState(!0),z=i.useCallback(async(s=!0)=>{W(""),ae(!0);try{const a={search:p,pageSize:Q};!s&&A&&(a.pageToken=A);const{data:r}=await h.get("/api/users/all",{params:a}),n=Array.isArray(r?.items)?r.items:[];se(l=>s?n:[...l,...n]),ne(r?.nextPageToken||"")}catch(a){const r=a?.response?.status;if(r===401||r===403)try{await k();const n={search:p,pageSize:Q};!s&&A&&(n.pageToken=A);const{data:l}=await h.get("/api/users/all",{params:n}),m=Array.isArray(l?.items)?l.items:[];se(Ae=>s?m:[...Ae,...m]),ne(l?.nextPageToken||""),W("");return}catch(n){W(n?.response?.data?.message||n?.message||"Failed to search platform users")}else W(a?.response?.data?.message||a?.message||"Failed to search platform users")}finally{ae(!1)}},[p,Q,A]),w=i.useCallback(async()=>{if(o)try{Y(!0);const r=((await h.get("/api/users")).data||[]).map(n=>({...n,walletBalance:n.walletBalance||0,lastActivity:n.lastActivity||new Date().toISOString(),avatar:n.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(n.name||n.email)}&background=6366f1&color=fff`}));pe(r)}catch(s){console.error("Error loading users:",s),d.error("Failed to load user data")}finally{Y(!1)}},[o]),H=i.useCallback(async s=>{try{const{data:a}=await h.get("/api/wallets/admin/lookup",{params:{email:s.trim().toLowerCase()}});G(a?.wallet||null),ee(s)}catch(a){console.error("Error looking up user wallet:",a),G(null),d.error("Failed to lookup user wallet")}},[]),N=i.useCallback(async()=>{if(o)try{re(!0),console.log("Loading transactions with filters:",c),await k();try{const{data:s}=await h.get("/api/wallets/admin/transactions",{params:{userEmail:c.userEmail||void 0,type:c.type||void 0,dateFrom:c.dateFrom||void 0,dateTo:c.dateTo||void 0,minAmount:c.minAmount||void 0,maxAmount:c.maxAmount||void 0,page:x,limit:b}});console.log("Received transaction data from dedicated endpoint:",s),O(s?.transactions||[]),s?.transactions?.length>0?d.success(`Loaded ${s.transactions.length} transactions`):d.info("No transactions found")}catch(s){console.warn("Dedicated transactions endpoint failed, trying fallback approach:",s);const{data:a}=await h.get("/api/wallets",{suppressToast:!0,suppressErrorLog:!0});console.log("Received wallets data for transaction extraction:",a);let r=[];Array.isArray(a)&&a.forEach(l=>{l&&l.transactions&&Array.isArray(l.transactions)&&l.transactions.forEach(m=>{r.push({...m,userEmail:l.userEmail||l.email||"Unknown",userName:l.userName||l.name,userRole:l.role,userTenant:l.tenantId,walletBalance:l.balance})})});let n=r;if(c.userEmail){const l=c.userEmail.toLowerCase();n=n.filter(m=>m.userEmail.toLowerCase().includes(l))}if(c.type&&(n=n.filter(l=>l.type===c.type)),c.dateFrom){const l=new Date(c.dateFrom);n=n.filter(m=>new Date(m.createdAt)>=l)}if(c.dateTo){const l=new Date(c.dateTo);l.setHours(23,59,59,999),n=n.filter(m=>new Date(m.createdAt)<=l)}if(c.minAmount){const l=Number(c.minAmount);Number.isFinite(l)&&(n=n.filter(m=>m.amount>=l))}if(c.maxAmount){const l=Number(c.maxAmount);Number.isFinite(l)&&(n=n.filter(m=>m.amount<=l))}n.sort((l,m)=>new Date(m.createdAt).getTime()-new Date(l.createdAt).getTime()),console.log("Extracted and filtered transactions:",n),O(n),n.length>0?d.success(`Loaded ${n.length} transactions (fallback method)`):d.info("No transactions found in any wallets")}}catch(s){console.error("Error loading transactions:",s);const a=s.response?.data?.message||s.message||"Failed to load transaction history",r=s.response?.status;r===404?d.error("Transaction endpoint not found. Please check if backend is running with latest code."):r===401||r===403?d.error("Authentication required. Please sign in again."):d.error(`Failed to load transaction history: ${a}`),O([])}finally{re(!1)}},[o,c,x,b]),ye=i.useCallback(()=>{g({userEmail:"",type:"",dateFrom:"",dateTo:"",minAmount:"",maxAmount:""}),S(1)},[]),ve=i.useCallback(()=>{S(1),N()},[N]),we=async()=>{if(!y)try{B(!0),await h.post("/api/admin/wallet/normalize-appdata"),d.success("Successfully normalized app data"),await w(),await I()}catch(s){console.error("Error normalizing data:",s);const a=s.response?.data?.message||"Failed to normalize app data";d.error(a)}finally{B(!1)}},ke=async()=>{if(!y)try{B(!0);const s=["mncubekhulekani@gmail.com","ruthmaphosa2024@gmail.com","zinhlesloane@gmail.com","khulekani@gecafrica.co","22onsloanedigitalteam@gmail.com","khulekani@22onsloane.co"],a=await h.post("/api/admin/wallet/sync-firebase-users",{promoteVendors:s,defaultRole:"member",defaultTenant:"vendor"});d.success(`Successfully synced ${a.data.synced} Firebase users`),await w()}catch(s){console.error("Error syncing Firebase users:",s);const a=s.response?.data?.message||"Failed to sync Firebase users";d.error(a)}finally{B(!1)}};i.useEffect(()=>{if(!o||le.current)return;le.current=!0;let s=!0;return(async()=>{try{if(await k(),!s||(await z(!0),!s))return;await w()}catch(a){console.error("Failed to auto-load users:",a)}})(),()=>{s=!1}},[o,z,w]),i.useEffect(()=>{o&&L&&u.length===0&&N()},[o,L,N,u.length]);const Ce=async s=>{if(s.preventDefault(),!j)return;D({type:"",message:""});const a=Number(q.replace(/[^0-9.]/g,""));if(!Number.isFinite(a)||a<=0){D({type:"danger",message:"Enter a valid voucher amount to record."});return}X(!0);try{const r=await he(a,{description:E?`Manual redemption: ${E.trim()}`:"Manual voucher redemption",metadata:{source:"my-wallet",note:E.trim()||void 0},reference:"manual-redemption"});if(!r.ok){D({type:"danger",message:r.error||"Unable to record voucher usage."});return}J(""),K(""),D({type:"success",message:`Voucher usage recorded. Remaining balance: ${C(r.wallet?.balance)} credits.`})}finally{X(!1)}},ie=ue.filter(s=>s.email.toLowerCase().includes(f.toLowerCase())||s.name?.toLowerCase().includes(f.toLowerCase())||s.role.toLowerCase().includes(f.toLowerCase())),U=Ne.filter(s=>s.email?.toLowerCase().includes(p.toLowerCase())||s.displayName?.toLowerCase().includes(p.toLowerCase())),Te=u.slice((x-1)*b,x*b),F=Math.ceil(u.length/b);return e.jsxs("div",{className:"row gy-4",children:[o&&e.jsx("div",{className:"col-12",children:e.jsx(Ee,{})}),e.jsx("div",{className:"col-12 col-lg-8",children:e.jsx(oe,{wallet:j,loading:me,eligible:_,onRefresh:I,showActions:!o})}),o&&e.jsx("div",{className:"col-12 col-lg-4",children:e.jsxs("div",{className:"card p-24 radius-12 h-100",children:[e.jsxs("h5",{className:"mb-3",children:[e.jsx(t,{icon:"mdi:shield-crown",className:"text-xl text-primary-600 me-2"}),"Admin Actions"]}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsx("button",{className:"btn btn-outline-primary btn-sm",onClick:we,disabled:y,children:y?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Normalizing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(t,{icon:"mdi:database-sync",className:"me-2"}),"Normalize Data"]})}),e.jsx("button",{className:"btn btn-outline-secondary btn-sm",onClick:ke,disabled:y,children:y?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Syncing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(t,{icon:"mdi:account-sync",className:"me-2"}),"Sync Firebase Users"]})}),e.jsxs(ce,{to:"/admin/wallet-credits",className:"btn btn-outline-warning btn-sm",children:[e.jsx(t,{icon:"mdi:wallet-plus",className:"me-2"}),"Legacy Admin"]}),e.jsxs(ce,{to:"/dashboard",className:"btn btn-outline-info btn-sm",children:[e.jsx(t,{icon:"mdi:view-dashboard",className:"me-2"}),"Dashboard"]})]})]})}),(!o||j)&&e.jsx("div",{className:o?"col-12 col-lg-6":"col-12 col-lg-4",children:e.jsxs("div",{className:"card p-24 radius-12 h-100",children:[e.jsxs("h5",{className:"mb-3",children:[e.jsx(t,{icon:"mdi:receipt-text-plus",className:"text-xl text-primary-600 me-2"}),"Record Usage"]}),e.jsx("p",{className:"text-secondary-light mb-3",children:"Manually record voucher usage for offline transactions or services not yet integrated with the marketplace."}),_&&j&&e.jsxs("form",{onSubmit:Ce,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label text-sm text-secondary-light",children:"Amount"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:"R"}),e.jsx("input",{type:"text",className:"form-control",value:q,onChange:s=>J(s.target.value),placeholder:"e.g. 150",disabled:$})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label text-sm text-secondary-light",children:"Description (optional)"}),e.jsx("input",{type:"text",className:"form-control",value:E,onChange:s=>K(s.target.value),placeholder:"What was this used for?",disabled:$})]}),e.jsx("button",{type:"submit",className:"btn btn-primary w-100",disabled:$||!q,children:$?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Recording..."]}):e.jsxs(e.Fragment,{children:[e.jsx(t,{icon:"mdi:plus-circle",className:"me-2"}),"Record Usage"]})})]}),R.message&&e.jsxs("div",{className:`alert alert-${R.type||"info"} mt-3 mb-0`,children:[e.jsx(t,{icon:R.type==="success"?"mdi:check-circle":"mdi:alert-circle",className:"me-2"}),R.message]})]})}),o&&T&&e.jsx("div",{className:"col-12 col-lg-6",children:e.jsxs("div",{className:"card p-24 radius-12",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(t,{icon:"mdi:account-cash",className:"text-xl text-primary-600 me-2"}),"User Wallet: ",Z]}),e.jsx("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>{G(null),ee("")},children:e.jsx(t,{icon:"mdi:close"})})]}),e.jsx(oe,{wallet:T,loading:!1,eligible:!0,onRefresh:()=>H(Z),showActions:!1,compact:!0}),T.transactions&&T.transactions.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h6",{className:"mb-2",children:"Recent Transactions"}),e.jsx(de,{transactions:T.transactions.slice(0,5),compact:!0})]})]})}),j&&e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card p-24 radius-12",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(t,{icon:"mdi:history",className:"text-xl text-primary-600 me-2"}),o?"My Transaction History":"Transaction History"]}),o&&e.jsxs("div",{className:"text-sm text-secondary",children:["Total Transactions: ",j.transactions?.length||0]})]}),e.jsx(de,{transactions:j.transactions||[]})]})}),o&&e.jsx("div",{className:"col-12",children:e.jsx(Re,{grantCredits:xe,onRefresh:async()=>{await w(),await I()},compact:!1,showUserLookup:!0,selectedUserEmail:ge,onEmailChange:M})}),o&&e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card p-24 radius-12",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(t,{icon:"mdi:account-group",className:"text-xl text-primary-600 me-2"}),"Platform Users Transaction Tracking"]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>{const s=!L;fe(s),s&&u.length===0&&N()},children:[e.jsx(t,{icon:"mdi:history",className:"me-1"}),L?"Hide":"Show"," Transaction History"]}),e.jsx("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>z(!0),disabled:v,children:v?e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}):e.jsx(t,{icon:"mdi:refresh"})})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:e.jsx(t,{icon:"mdi:magnify"})}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Search platform users by name or email...",value:p,onChange:s=>be(s.target.value)})]})}),e.jsx("div",{className:"col-12 col-md-6",children:e.jsx("button",{className:"btn btn-primary w-100",onClick:()=>z(!0),disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Searching..."]}):e.jsxs(e.Fragment,{children:[e.jsx(t,{icon:"mdi:magnify",className:"me-2"}),"Search Users"]})})})]}),te&&e.jsxs("div",{className:"alert alert-warning mb-3",children:[e.jsx(t,{icon:"mdi:alert-circle",className:"me-2"}),te]}),!v&&U.length>0&&e.jsxs("div",{className:"table-responsive",children:[e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Last Sign In"}),e.jsx("th",{children:"Provider"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:U.slice(0,20).map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("img",{src:s.photoURL||`https://ui-avatars.com/api/?name=${encodeURIComponent(s.displayName||s.email)}&background=6366f1&color=fff`,alt:s.displayName||s.email,className:"rounded-circle me-2",width:"32",height:"32"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:s.displayName||"No Name"}),e.jsx("div",{className:"text-xs text-secondary",children:s.uid})]})]})}),e.jsx("td",{children:s.email}),e.jsx("td",{children:e.jsx("span",{className:"text-sm",children:s.metadata?.lastSignInTime?new Date(s.metadata.lastSignInTime).toLocaleDateString():"Never"})}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-light text-dark",children:s.providerData?.[0]?.providerId||"Unknown"})}),e.jsx("td",{children:e.jsxs("div",{className:"btn-group btn-group-sm",children:[e.jsx("button",{className:"btn btn-outline-primary",onClick:()=>{M(s.email)},title:"Grant credits to this user",children:e.jsx(t,{icon:"mdi:wallet-plus"})}),e.jsx("button",{className:"btn btn-outline-info",onClick:()=>H(s.email),title:"View user's transaction history",children:e.jsx(t,{icon:"mdi:history"})})]})})]},s.uid))})]}),U.length>20&&e.jsx("div",{className:"text-center pt-3",children:e.jsxs("small",{className:"text-secondary",children:["Showing 20 of ",U.length," users. Use search to narrow results."]})})]}),!v&&U.length===0&&p&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(t,{icon:"mdi:account-search",className:"text-4xl text-secondary-light mb-2"}),e.jsxs("p",{className:"text-secondary",children:['No users found matching "',p,'"']})]})]})}),o&&L&&e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card p-24 radius-12",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(t,{icon:"mdi:chart-line",className:"text-xl text-primary-600 me-2"}),"Platform Transaction History"]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-outline-primary btn-sm",onClick:N,disabled:P,children:P?e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}):e.jsx(t,{icon:"mdi:refresh"})}),e.jsxs("button",{className:"btn btn-outline-success btn-sm",onClick:async()=>{try{console.log("Testing basic wallets endpoints..."),await k();const s=await h.get("/api/wallets");console.log("Wallets endpoint works:",s.data);const a=await h.get("/api/wallets/admin/debug/wallets");console.log("Debug endpoint works:",a.data),d.success("Basic wallet endpoints work!")}catch(s){console.error("Basic endpoints test failed:",s);const a=s.response?.status,r=s.response?.data?.message||s.message;d.error(`Basic endpoints failed (${a}): ${r}`)}},children:[e.jsx(t,{icon:"mdi:check-circle",className:"me-1"}),"Test Basic"]}),e.jsxs("button",{className:"btn btn-outline-warning btn-sm",onClick:async()=>{try{console.log("Testing transaction endpoint directly..."),console.log("Current API base URL:",h.defaults.baseURL),await k();const s=`${h.defaults.baseURL||""}/api/wallets/admin/transactions`;console.log("Full URL being called:",s);const a=await h.get("/api/wallets/admin/transactions",{params:{limit:10}});console.log("Transaction endpoint test response:",a),d.success(`Transaction endpoint works! Found ${a.data?.transactions?.length||0} transactions`)}catch(s){console.error("Transaction endpoint test failed:",s),console.error("Request config:",s.config),console.error("Request URL:",s.config?.url),console.error("Full request details:",{baseURL:s.config?.baseURL,url:s.config?.url,method:s.config?.method,headers:s.config?.headers});const a=s.response?.status,r=s.response?.data?.message||s.message;d.error(`Transaction endpoint failed (${a}): ${r}`)}},children:[e.jsx(t,{icon:"mdi:database-search",className:"me-1"}),"Test Transactions"]}),e.jsxs("button",{className:"btn btn-outline-info btn-sm",onClick:async()=>{try{const s=await h.get("/api/health");console.log("Health check:",s.data);const r=await(await fetch("http://localhost:5055/api/health")).json();console.log("Direct health check:",r),await k();const n=await h.get("/api/wallets/admin/debug/wallets");console.log("Debug response:",n.data),d.success("Backend connection successful!")}catch(s){console.error("Backend connection failed:",s);const a=s.response?.status,r=s.response?.data?.message||s.message;a===404?d.error("Endpoint not found (404). Check backend routes."):a===401||a===403?d.error("Authentication failed. Please sign in again."):d.error(`Backend connection failed: ${r}`)}},children:[e.jsx(t,{icon:"mdi:bug",className:"me-1"}),"Test Backend"]}),e.jsxs("button",{className:"btn btn-outline-secondary btn-sm",onClick:ye,children:[e.jsx(t,{icon:"mdi:filter-off",className:"me-1"}),"Clear Filters"]})]})]}),e.jsxs("div",{className:"row g-3 mb-4 p-3 bg-light rounded",children:[e.jsx("div",{className:"col-12",children:e.jsxs("h6",{className:"mb-2",children:[e.jsx(t,{icon:"mdi:filter",className:"me-1"}),"Transaction Filters"]})}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-3",children:[e.jsx("label",{className:"form-label text-sm",children:"User Email"}),e.jsx("input",{type:"email",className:"form-control form-control-sm",placeholder:"Filter by user email...",value:c.userEmail,onChange:s=>g(a=>({...a,userEmail:s.target.value}))})]}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-2",children:[e.jsx("label",{className:"form-label text-sm",children:"Transaction Type"}),e.jsxs("select",{className:"form-select form-select-sm",value:c.type,onChange:s=>g(a=>({...a,type:s.target.value})),children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"credit",children:"Credit"}),e.jsx("option",{value:"debit",children:"Debit"}),e.jsx("option",{value:"adjustment",children:"Adjustment"})]})]}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-2",children:[e.jsx("label",{className:"form-label text-sm",children:"Date From"}),e.jsx("input",{type:"date",className:"form-control form-control-sm",value:c.dateFrom,onChange:s=>g(a=>({...a,dateFrom:s.target.value}))})]}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-2",children:[e.jsx("label",{className:"form-label text-sm",children:"Date To"}),e.jsx("input",{type:"date",className:"form-control form-control-sm",value:c.dateTo,onChange:s=>g(a=>({...a,dateTo:s.target.value}))})]}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-1",children:[e.jsx("label",{className:"form-label text-sm",children:"Min Amount"}),e.jsx("input",{type:"number",className:"form-control form-control-sm",placeholder:"0",value:c.minAmount,onChange:s=>g(a=>({...a,minAmount:s.target.value}))})]}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-2",children:[e.jsx("label",{className:"form-label text-sm",children:"Max Amount"}),e.jsxs("div",{className:"d-flex gap-1",children:[e.jsx("input",{type:"number",className:"form-control form-control-sm",placeholder:"âˆž",value:c.maxAmount,onChange:s=>g(a=>({...a,maxAmount:s.target.value}))}),e.jsx("button",{className:"btn btn-primary btn-sm",onClick:ve,disabled:P,children:e.jsx(t,{icon:"mdi:magnify"})})]})]})]}),u.length>0&&e.jsxs("div",{className:"row g-3 mb-4",children:[e.jsx("div",{className:"col-6 col-md-3",children:e.jsxs("div",{className:"bg-primary-50 p-3 rounded text-center",children:[e.jsx("div",{className:"text-sm text-secondary",children:"Total Transactions"}),e.jsx("div",{className:"h5 text-primary mb-0",children:u.length})]})}),e.jsx("div",{className:"col-6 col-md-3",children:e.jsxs("div",{className:"bg-success-50 p-3 rounded text-center",children:[e.jsx("div",{className:"text-sm text-secondary",children:"Total Credits"}),e.jsxs("div",{className:"h5 text-success mb-0",children:["R ",C(u.filter(s=>s.type==="credit").reduce((s,a)=>s+(a.amount||0),0))]})]})}),e.jsx("div",{className:"col-6 col-md-3",children:e.jsxs("div",{className:"bg-danger-50 p-3 rounded text-center",children:[e.jsx("div",{className:"text-sm text-secondary",children:"Total Debits"}),e.jsxs("div",{className:"h5 text-danger mb-0",children:["R ",C(u.filter(s=>s.type==="debit").reduce((s,a)=>s+(a.amount||0),0))]})]})}),e.jsx("div",{className:"col-6 col-md-3",children:e.jsxs("div",{className:"bg-info-50 p-3 rounded text-center",children:[e.jsx("div",{className:"text-sm text-secondary",children:"Unique Users"}),e.jsx("div",{className:"h5 text-info mb-0",children:new Set(u.map(s=>s.userEmail)).size})]})})]}),P?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-secondary mt-2",children:"Loading transaction history..."})]}):u.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"User"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Description"}),e.jsx("th",{className:"text-end",children:"Amount"}),e.jsx("th",{className:"text-end",children:"Balance After"}),e.jsx("th",{children:"Reference"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:Te.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("span",{className:"text-sm",children:[new Date(s.createdAt).toLocaleDateString(),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:new Date(s.createdAt).toLocaleTimeString()})]})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("img",{src:`https://ui-avatars.com/api/?name=${encodeURIComponent(s.userEmail||"Unknown")}&background=6366f1&color=fff&size=24`,alt:s.userEmail,className:"rounded-circle me-2",width:"24",height:"24"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm fw-medium",children:s.userEmail}),s.userName&&e.jsx("small",{className:"text-muted",children:s.userName})]})]})}),e.jsx("td",{children:e.jsxs("span",{className:`badge ${s.type==="credit"?"bg-success":s.type==="debit"?"bg-danger":"bg-warning"}`,children:[e.jsx(t,{icon:s.type==="credit"?"mdi:plus-circle":s.type==="debit"?"mdi:minus-circle":"mdi:circle-edit-outline",className:"me-1"}),s.type]})}),e.jsxs("td",{children:[e.jsx("span",{className:"text-sm",children:s.description}),s.metadata&&e.jsxs("div",{className:"text-xs text-muted",children:[s.metadata.source&&`Source: ${s.metadata.source}`,s.metadata.note&&` | ${s.metadata.note}`]})]}),e.jsx("td",{className:"text-end",children:e.jsxs("span",{className:`text-sm fw-medium ${s.type==="credit"?"text-success":"text-danger"}`,children:[s.type==="credit"?"+":"-","R ",C(s.amount)]})}),e.jsx("td",{className:"text-end",children:e.jsxs("span",{className:"text-sm",children:["R ",C(s.balanceAfter)]})}),e.jsx("td",{children:s.reference&&e.jsx("small",{className:"text-muted font-monospace",children:s.reference})}),e.jsx("td",{children:e.jsxs("div",{className:"btn-group btn-group-sm",children:[e.jsx("button",{className:"btn btn-outline-info",onClick:()=>H(s.userEmail),title:"View user's full wallet",children:e.jsx(t,{icon:"mdi:wallet"})}),e.jsx("button",{className:"btn btn-outline-primary",onClick:()=>{M(s.userEmail)},title:"Grant credits to this user",children:e.jsx(t,{icon:"mdi:wallet-plus"})})]})})]},s.id))})]})}),F>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsxs("div",{className:"text-sm text-secondary",children:["Showing ",(x-1)*b+1," to ",Math.min(x*b,u.length)," of ",u.length," transactions"]}),e.jsx("nav",{children:e.jsxs("ul",{className:"pagination pagination-sm mb-0",children:[e.jsx("li",{className:`page-item ${x===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>S(x-1),disabled:x===1,children:e.jsx(t,{icon:"mdi:chevron-left"})})}),Array.from({length:Math.min(5,F)},(s,a)=>{const r=Math.max(1,Math.min(F-4,x-2))+a;return e.jsx("li",{className:`page-item ${r===x?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>S(r),children:r})},r)}),e.jsx("li",{className:`page-item ${x===F?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>S(x+1),disabled:x===F,children:e.jsx(t,{icon:"mdi:chevron-right"})})})]})})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(t,{icon:"mdi:chart-line-variant",className:"text-4xl text-secondary-light mb-2"}),e.jsx("p",{className:"text-secondary",children:"No transactions found matching the current filters."}),e.jsxs("button",{className:"btn btn-outline-primary btn-sm",onClick:N,children:[e.jsx(t,{icon:"mdi:refresh",className:"me-1"}),"Load Transaction History"]})]})]})}),o&&e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card p-24 radius-12",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(t,{icon:"mdi:account-group",className:"text-xl text-primary-600 me-2"}),"Local Users & Wallets"]}),e.jsx("button",{className:"btn btn-outline-secondary btn-sm",onClick:w,disabled:V,children:V?e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}):e.jsx(t,{icon:"mdi:refresh"})})]}),e.jsx("div",{className:"row mb-3",children:e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:e.jsx(t,{icon:"mdi:magnify"})}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Search local users...",value:f,onChange:s=>je(s.target.value)})]})})}),V?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-secondary mt-2",children:"Loading users..."})]}):ie.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Tenant"}),e.jsx("th",{children:"Wallet Balance"}),e.jsx("th",{children:"Last Activity"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:ie.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("img",{src:s.avatar,alt:s.name,className:"rounded-circle me-2",width:"32",height:"32"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:s.name}),e.jsx("div",{className:"text-xs text-secondary",children:s.email})]})]})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.role==="admin"?"bg-danger":s.role==="vendor"?"bg-warning":"bg-secondary"}`,children:s.role})}),e.jsx("td",{children:s.tenantId}),e.jsx("td",{children:e.jsxs("span",{className:"fw-medium",children:["R ",C(s.walletBalance)]})}),e.jsx("td",{children:e.jsx("span",{className:"text-sm",children:new Date(s.lastActivity).toLocaleDateString()})}),e.jsx("td",{children:e.jsxs("div",{className:"btn-group btn-group-sm",children:[e.jsx("button",{className:"btn btn-outline-primary",onClick:()=>{M(s.email)},title:"Grant credits to this user",children:e.jsx(t,{icon:"mdi:wallet-plus"})}),e.jsx("button",{className:"btn btn-outline-info",onClick:()=>H(s.email),title:"View user's transaction history",children:e.jsx(t,{icon:"mdi:history"})})]})})]},s.uid))})]})}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(t,{icon:"mdi:account-search",className:"text-4xl text-secondary-light mb-2"}),e.jsx("p",{className:"text-secondary",children:f?`No users found matching "${f}"`:"No users found"})]})]})})]})}const Ie=()=>e.jsx(e.Fragment,{children:e.jsxs(Ue,{children:[e.jsx(Fe,{title:"My Wallet"}),e.jsx(De,{})]})});export{Ie as default};
