const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BannerInnerTwo-Ll2Xc1x-.js","assets/index-DaarVqB8.js","assets/index-BXSesTeZ.css"])))=>i.map(i=>d[i]);
import{r as x,a as E,j as e,R as se,w as $,b as O,_ as Ne}from"./index-DaarVqB8.js";import{a as ye}from"./appData-vWFasogN.js";import{M as we}from"./MasterLayout-2uOgNMve.js";import"./iconify-CVdOCQR-.js";const Se="/api/lms",Ce=se.lazy(()=>Ne(()=>import("./BannerInnerTwo-Ll2Xc1x-.js"),__vite__mapDeps([0,1,2]))),te="listings_admin_draft_v1",X="listings_admin_undo_v1",ie="listings_admin_history_cache_v1";function B(s){try{return typeof s=="string"?JSON.parse(s):s}catch{return null}}function U(s){return JSON.parse(JSON.stringify(s))}function re(){return Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,8)}function Ie(s){return new Date(s).toLocaleString()}function Ee(s=[]){const c=s.length,u=s.reduce((f,I)=>{const k=(I.status||"unknown").toLowerCase();return f[k]=(f[k]||0)+1,f},{}),h=s.filter(f=>!!f.isFeatured).length,y=new Set(s.map(f=>(f.category||"").trim()).filter(Boolean)).size;return{total:c,featured:h,categories:y,byStatus:u}}function le(s){const c=s.vendorId||s.id||s.uid||(s.email?s.email.toLowerCase():re());return{id:c,vendorId:s.vendorId||c,companyName:s.companyName||s.name||s.displayName||"",name:s.name||s.companyName||"",email:(s.email||s.contactEmail||"").toLowerCase(),website:s.website||"",phone:s.phone||s.phoneNumber||"",avatar:s.avatar||s.logoUrl||"",raw:s}}function ke(s=[]){const c={},u={};return s.forEach(h=>{c[h.vendorId]=h,h.email&&(u[h.email]=h)}),{byId:c,byEmail:u}}function ae(s){var c;return{id:s.id??re(),title:s.title??"",category:s.category??"",vendor:s.vendor??s.vendorName??"",vendorId:s.vendorId??"",contactEmail:(s.contactEmail||s.email||"").toLowerCase(),price:typeof s.price=="number"?s.price:Number(s.price||0),rating:typeof s.rating=="number"?s.rating:Number(s.rating||0),reviewCount:typeof s.reviewCount=="number"?s.reviewCount:Number(s.reviewCount||((c=s.reviews)==null?void 0:c.length)||0),imageUrl:s.imageUrl??s.thumbnail??"",aiHint:s.aiHint??"",listingType:s.listingType??"service",status:s.status??"approved",isFeatured:!!s.isFeatured,description:s.description??"",reviews:Array.isArray(s.reviews)?s.reviews:[]}}function Me(){var ne;const s=x.useMemo(()=>sessionStorage.getItem("tenantId")||"vendor",[]),[c,u]=x.useState(()=>B(localStorage.getItem(te))??ye),h=x.useMemo(()=>((c==null?void 0:c.services)||[]).map(ae),[c]),[y,f]=x.useState(()=>((c==null?void 0:c.startups)||[]).map(le));x.useEffect(()=>{let t=!0;return(async()=>{try{const r=await E.get("/api/data/vendors").then(l=>l.data||[]),n=Array.isArray(r)?r.map(le):[];t&&n.length&&f(n)}catch{}})(),()=>{t=!1}},[s]);const{byId:I,byEmail:k}=x.useMemo(()=>ke(y),[y]);c!=null&&c.startups;const[_,D]=x.useState(()=>JSON.stringify(c,null,2)),[G,W]=x.useState("visual"),[M,A]=x.useState(!1),[Y,q]=x.useState(null),[o,j]=x.useState(null),J=x.useRef([]),[Z,N]=x.useState(()=>B(localStorage.getItem(ie))??[]),ee=x.useMemo(()=>["All",...Array.from(new Set(h.map(r=>(r.category||"").trim()).filter(Boolean)))],[h]),[F,d]=x.useState("All"),[v,L]=x.useState("All"),[R,H]=x.useState(""),[z,a]=x.useState(((ne=h[0])==null?void 0:ne.id)||""),g=x.useMemo(()=>h.filter(t=>!(F!=="All"&&(t.category||"").trim()!==F||v!=="All"&&(t.status||"").toLowerCase()!==v||R&&!`${t.title} ${t.vendor} ${t.vendorId} ${t.contactEmail} ${t.category}`.toLowerCase().includes(R.toLowerCase()))),[h,F,v,R]),m=x.useMemo(()=>h.find(t=>t.id===z),[h,z]);function T(t){q(t),setTimeout(()=>q(null),2500)}function Q(t){const r=B(localStorage.getItem(X))??[];r.unshift(t);const n=r.slice(0,10);localStorage.setItem(X,JSON.stringify(n)),J.current=n}function w(t){Q(c),u(t),D(JSON.stringify(t,null,2)),localStorage.setItem(te,JSON.stringify(t))}function ce(t){var l,i;if(!m)return;const r=U(c),n=r.services.findIndex(p=>p.id===m.id);if(n>=0){r.services[n]={...ae(r.services[n]),...t},w(r);try{const p=m.status;typeof t.status<"u"&&t.status!==p?$({action:"LISTING_STATUS_CHANGE",userEmail:(l=O.currentUser)==null?void 0:l.email,targetType:"listing",targetId:m.id,metadata:{from:p,to:t.status,title:m.title}}):$({action:"LISTING_UPDATE",userEmail:(i=O.currentUser)==null?void 0:i.email,targetType:"listing",targetId:m.id,metadata:{patch:t}})}catch{}}}function oe(){var l;const t=prompt("Service title?");if(!t)return;const r=U(c),n=Math.max(0,...r.services.map(i=>Number(i.id)).filter(i=>!Number.isNaN(i)))+1;r.services.push(ae({id:String(n),title:t,vendor:"",vendorId:"",contactEmail:"",category:"",price:0,rating:0,reviewCount:0,imageUrl:"",listingType:"service",status:"approved",isFeatured:!1,description:"",aiHint:"",reviews:[]})),w(r),a(String(n));try{$({action:"LISTING_CREATE",userEmail:(l=O.currentUser)==null?void 0:l.email,targetType:"listing",targetId:String(n),metadata:{title:t}})}catch{}}function de(){var n;if(!m)return;const t=U(c),r=U(m);r.id=re(),r.title=`${r.title} (Copy)`,t.services.push(r),w(t),a(r.id);try{$({action:"LISTING_DUPLICATE",userEmail:(n=O.currentUser)==null?void 0:n.email,targetType:"listing",targetId:r.id,metadata:{sourceId:m.id,title:r.title}})}catch{}}function me(){var r,n;if(!m||!window.confirm(`Delete "${m.title}"?`))return;const t=U(c);t.services=t.services.filter(l=>l.id!==m.id),w(t),a(((r=t.services[0])==null?void 0:r.id)||"");try{$({action:"LISTING_DELETE",userEmail:(n=O.currentUser)==null?void 0:n.email,targetType:"listing",targetId:m.id,metadata:{title:m.title}})}catch{}}function ue(){const t=J.current.length>0?J.current:B(localStorage.getItem(X))??[];if(!t.length)return;const r=t.shift();J.current=t,localStorage.setItem(X,JSON.stringify(t)),u(r),D(JSON.stringify(r,null,2))}x.useEffect(()=>{(async()=>{var t,r;A(!0);try{const{data:n}=await E.get("/api/lms/live");u(n),D(JSON.stringify(n,null,2)),localStorage.setItem(te,JSON.stringify(n)),a(((r=(t=n==null?void 0:n.services)==null?void 0:t[0])==null?void 0:r.id)||""),await K()}catch{}finally{A(!1)}})()},[]);async function K(){try{const r=(await E.get("/api/lms/checkpoints").then(n=>n.data)).items??[];N(r),localStorage.setItem(ie,JSON.stringify(r.slice(0,2)))}catch{}}async function he(){var t,r,n;j(null),A(!0);try{const l=await((r=(t=O.currentUser)==null?void 0:t.getIdToken)==null?void 0:r.call(t));let i=c;try{const p=await E.get("/api/lms/live").then(S=>S.data),b=U(c),P=Object.fromEntries(((p==null?void 0:p.services)||[]).map(S=>[String(S.id),S]));b.services=(b.services||[]).map(S=>{const C=P[String(S.id)];return C?{...S,reviews:Array.isArray(C.reviews)?C.reviews:S.reviews,reviewCount:typeof C.reviewCount=="number"?C.reviewCount:Number(C.reviewCount||(Array.isArray(C.reviews)?C.reviews.length:0)||S.reviewCount||0),rating:typeof C.rating=="number"?C.rating:Number(C.rating||S.rating||0),lastReviewedAt:C.lastReviewedAt||S.lastReviewedAt}:S}),i=b,w(b)}catch{}await E.put("/api/lms/publish",{data:i}),T("Published listings to live");try{await $({action:"LISTINGS_PUBLISH",userEmail:(n=O.currentUser)==null?void 0:n.email,targetType:"appData",targetId:"services",metadata:{count:h.length}})}catch{}await K()}catch(l){j(l.message||"Publish failed")}finally{A(!1)}}async function pe(t){var r;try{await E.post("/api/lms/checkpoints",{message:t||"",data:c}),T("Checkpoint saved");try{await $({action:"LISTINGS_CHECKPOINT",userEmail:(r=O.currentUser)==null?void 0:r.email,targetType:"services",targetId:"checkpoint",metadata:{message:t||""}})}catch{}await K()}catch(n){j(n.message||"Failed to save checkpoint")}}async function ge(t){if(window.confirm("Restore this snapshot to LIVE appData.json?"))try{await E.post(`/api/lms/restore/${t}`),T("Restored snapshot"),await K();const r=await E.get("/api/lms/live").then(n=>n.data);w(r)}catch(r){j(r.message||"Restore failed")}}async function xe(){var t;if(window.confirm("Delete ALL checkpoints on the server?"))try{await E.delete("/api/lms/checkpoints"),T("Cleared history");try{await $({action:"LISTINGS_HISTORY_CLEAR",userEmail:(t=O.currentUser)==null?void 0:t.email,targetType:"services",targetId:"history"})}catch{}await K()}catch(r){j(r.message||"Failed to clear")}}const V=Ee(h);function be(t){const r=t.vendorId&&I[t.vendorId],n=t.contactEmail&&k[t.contactEmail],l=r||n||null,i=(l==null?void 0:l.companyName)||(l==null?void 0:l.name)||t.vendor||t.contactEmail||"â€”",p=(l==null?void 0:l.email)||t.contactEmail||"",b=(l==null?void 0:l.vendorId)||t.vendorId||"",P=b?`/profile-vendor?vendorId=${encodeURIComponent(b)}`:null;return{v:l,name:i,email:p,vendorId:b,profileHref:P}}function ve(t){return!t||typeof t!="object"?"File is not valid JSON.":Array.isArray(t.services)?null:"JSON must include an array: services[]."}async function fe(t){var n,l,i;j(null);const r=(n=t.target.files)==null?void 0:n[0];if(r)try{const p=await r.text(),b=B(p),P=ve(b);if(P){j(P);return}w(b),a(((i=(l=b==null?void 0:b.services)==null?void 0:l[0])==null?void 0:i.id)||""),T(`Imported ${r.name}`)}catch(p){j("Import failed: "+((p==null?void 0:p.message)||"unknown error"))}finally{t.target.value=""}}function je(){try{const t=new Blob([JSON.stringify(c,null,2)],{type:"application/json;charset=utf-8"}),r=URL.createObjectURL(t),n=document.createElement("a");n.href=r;const l=new Date().toISOString().replace(/[:.]/g,"-");n.download=`appData-${s}-${l}.json`,document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(r),T("Exported current working copy")}catch(t){j("Export failed: "+((t==null?void 0:t.message)||"unknown error"))}}return e.jsx(we,{children:e.jsxs("div",{className:"container py-4",children:[e.jsx(se.Suspense,{fallback:null,children:e.jsx("div",{className:"row mb-3",children:e.jsx(Ce,{})})}),e.jsxs("div",{className:"row g-3 mb-3",children:[e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 bg-animated-gradient text-center p-3",children:[e.jsx("i",{className:"bi bi-bag-check text-primary fs-3 mb-2"}),e.jsx("h6",{className:"fw-bold mb-0",children:V.total}),e.jsx("small",{className:"text-muted",children:"Services"})]})}),e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 text-center p-3",children:[e.jsx("i",{className:"bi bi-grid text-success fs-3 mb-2"}),e.jsx("h6",{className:"fw-bold mb-0",children:V.categories}),e.jsx("small",{className:"text-muted",children:"Categories"})]})}),e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 text-center p-3",children:[e.jsx("i",{className:"bi bi-star-fill text-warning fs-3 mb-2"}),e.jsx("h6",{className:"fw-bold mb-0",children:V.featured}),e.jsx("small",{className:"text-muted",children:"Featured"})]})}),e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 p-3",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-flag text-danger fs-4","aria-hidden":"true"}),e.jsx("div",{className:"fw-semibold",children:"Status"})]}),e.jsxs("span",{className:"badge text-bg-light",children:[Object.values(V.byStatus||{}).reduce((t,r)=>t+r,0)," total"]})]}),(()=>{var l;const t=i=>i==="approved"?"success":i==="pending"?"warning":i==="rejected"?"danger":"secondary",r=Object.entries(V.byStatus||{}),n=r.reduce((i,[,p])=>i+p,0);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"progress",style:{height:10},"aria-label":"Status proportions",children:r.map(([i,p])=>{const b=n?Math.round(p/n*100):0;return e.jsx("div",{className:`progress-bar bg-${t(i)}`,role:"progressbar",style:{width:`${b}%`},"aria-label":`${i} ${b}%`,"aria-valuenow":b,"aria-valuemin":0,"aria-valuemax":100,title:`${i}: ${p} (${b}%)`},i)})}),e.jsx("div",{className:"d-flex flex-wrap gap-2 mt-3",children:r.length?r.map(([i,p])=>e.jsxs("span",{className:`d-inline-flex align-items-center gap-2 px-2 py-1 rounded-pill border border-${t(i)} text-${t(i)} bg-${t(i)}-subtle small`,title:`${i}: ${p}`,"aria-label":`${i}: ${p}`,children:[e.jsx("i",{className:`bi ${i==="approved"?"bi-check-circle":i==="pending"?"bi-hourglass-split":i==="rejected"?"bi-x-octagon":"bi-dot"} `,"aria-hidden":"true"}),e.jsx("span",{className:"text-capitalize",children:i}),e.jsx("span",{className:"badge text-bg-light",children:p})]},i)):e.jsx("span",{className:"text-muted small",children:"No status data"})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsx("small",{className:"text-muted",children:"Total Approved: "}),e.jsxs("span",{className:"fw-semibold",children:[n?Math.round((((l=V.byStatus)==null?void 0:l.approved)??0)/n*100):0,"%"]})]})]})})()]})})]}),e.jsxs("div",{className:"pt-4 d-flex gap-2 mb-3",children:[e.jsxs("label",{className:"btn btn-light mb-0 d-none",children:["Import JSON",e.jsx("input",{type:"file",accept:"application/json",hidden:!0,onChange:fe})]}),e.jsx("button",{className:"btn rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-primary-700 text-hover-white",onClick:je,children:"Export Current"}),e.jsx("button",{className:"btn rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-primary-700 text-hover-white",disabled:M,onClick:async()=>{j(null),A(!0);try{const t=await E.get("/api/lms/live").then(l=>l.data),r=U(c),n=Object.fromEntries(((t==null?void 0:t.services)||[]).map(l=>[String(l.id),l]));r.services=(r.services||[]).map(l=>{const i=n[String(l.id)];return i?{...l,reviews:Array.isArray(i.reviews)?i.reviews:l.reviews,reviewCount:typeof i.reviewCount=="number"?i.reviewCount:Number(i.reviewCount||(Array.isArray(i.reviews)?i.reviews.length:0)||l.reviewCount||0),rating:typeof i.rating=="number"?i.rating:Number(i.rating||l.rating||0),lastReviewedAt:i.lastReviewedAt||l.lastReviewedAt}:l}),w(r),T("Synced reviews from live")}catch(t){j(t.message||"Failed to sync reviews")}finally{A(!1)}},title:"Fetch live data and merge review counts and lists",children:"Sync reviews from live"}),e.jsx("button",{className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:he,disabled:M,title:"Write working copy to live appData.json on the server",children:M?"Publishingâ€¦":"Publish to live"})]}),Y&&e.jsx("div",{className:"alert alert-success py-2",children:Y}),o&&e.jsx("div",{className:"alert alert-danger py-2",children:o}),e.jsx(Ae,{onSave:pe,onClear:xe,onUndo:ue,disabled:M}),e.jsxs("div",{className:"d-flex gap-3",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("ul",{className:"nav nav-tabs mb-3",children:[e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${G==="visual"?"active":""}`,onClick:()=>W("visual"),children:"Visual editor"})}),e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${G==="json"?"active":""}`,onClick:()=>W("json"),children:"JSON editor"})})]}),G==="json"?e.jsx(Te,{text:_,setText:D,onApply:()=>{const t=B(_);if(!t){j("Invalid JSON");return}w(t),T("Applied JSON to working copy")}}):e.jsx(Le,{services:h,vendors:y,vendorsById:I,vendorsByEmail:k,resolveVendor:be,category:F,setCategory:d,status:v,setStatus:L,allCategories:ee,search:R,setSearch:H,filtered:g,selectedId:z,setSelectedId:a,selected:m,addService:oe,duplicateService:de,deleteService:me,updateService:ce})]}),e.jsx("div",{style:{width:380},children:e.jsx(Oe,{items:Z,onRestore:ge})})]})]})})}function Ae({onSave:s,onClear:c,onUndo:u,disabled:h}){const[y,f]=x.useState("");return e.jsxs("div",{className:"d-flex align-items-center gap-2 mb-3",children:[e.jsx("input",{className:"form-control",placeholder:"Checkpoint message (e.g. 'Tweaked pricing & featured items')",value:y,onChange:I=>f(I.target.value)}),e.jsx("button",{className:"btn btn-sm rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:()=>s(y),disabled:h,children:"Save checkpoint"}),e.jsx("button",{className:"btn btn-sm rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-danger-700 text-hover-white",onClick:c,children:"Clear history"}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:u,children:"Undo"})]})}function Te({text:s,setText:c,onApply:u}){return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header fw-semibold",children:"Working copy (JSON)"}),e.jsxs("div",{className:"card-body",children:[e.jsx("textarea",{value:s,onChange:h=>c(h.target.value),rows:22,spellCheck:!1,className:"form-control font-monospace"}),e.jsxs("div",{className:"d-flex justify-content-between mt-2",children:[e.jsxs("small",{className:"text-muted",children:["Tip: Press ",e.jsx("kbd",{children:"âŒ˜/Ctrl"}),"+",e.jsx("kbd",{children:"A"})," then ",e.jsx("kbd",{children:"âŒ˜/Ctrl"}),"+",e.jsx("kbd",{children:"C"})," to copy."]}),e.jsx("button",{className:"btn btn-outline-primary",onClick:u,children:"Apply JSON"})]})]})]})}function Le(s){const{services:c,vendors:u,vendorsById:h,vendorsByEmail:y,resolveVendor:f,category:I,setCategory:k,status:_,setStatus:D,allCategories:G,search:W,setSearch:M,filtered:A,selectedId:Y,setSelectedId:q,selected:o,addService:j,duplicateService:J,deleteService:Z,updateService:N}=s,ee=x.useMemo(()=>u.map(a=>({id:a.vendorId,label:`${a.companyName||a.name||"(unnamed)"}${a.email?" â€” "+a.email:""}`})),[u]);function F(a){const g=h[a];N({vendorId:a||"",vendor:g&&(g.companyName||g.name)||"",contactEmail:(g==null?void 0:g.email)||(o==null?void 0:o.contactEmail)||""})}const d=o?f(o):null,[v,L]=se.useState({open:!1,subject:"",content:"",sending:!1,err:null,done:!1});function R(){if(!o)return;const a=`Listing feedback: ${o.title}`,g=`Hello ${(d==null?void 0:d.name)||"Vendor"},

Regarding your listing "${o.title}" (ID: ${o.id}).

Reason / guidance:
- 

Please update and resubmit when ready.

Regards,
Admin`;L({open:!0,subject:a,content:g,sending:!1,err:null,done:!1})}function H(){L({open:!1,subject:"",content:"",sending:!1,err:null,done:!1})}async function z(a){var g;if((g=a==null?void 0:a.preventDefault)==null||g.call(a),!(!o||!v.content.trim())){L(m=>({...m,sending:!0,err:null}));try{await E.post("/api/messages",{listingId:o.id,listingTitle:o.title,vendorId:o.vendorId||"",vendorEmail:(d==null?void 0:d.email)||"",subject:v.subject,content:v.content}),L(m=>({...m,sending:!1,done:!0})),setTimeout(()=>H(),1200)}catch(m){L(T=>{var Q,w;return{...T,sending:!1,err:((w=(Q=m==null?void 0:m.response)==null?void 0:Q.data)==null?void 0:w.message)||(m==null?void 0:m.message)||"Failed to send"}})}}}return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"fw-semibold",children:"Visual editor"}),e.jsx("span",{className:"text-muted small",children:"CRUD for services (listings)"})]}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row g-2 align-items-end mb-3",children:[e.jsxs("div",{className:"col-12 col-md-3",children:[e.jsx("label",{className:"form-label",children:"Category"}),e.jsx("select",{className:"form-select",value:I,onChange:a=>k(a.target.value),children:G.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"col-12 col-md-3",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsx("select",{className:"form-select",value:_,onChange:a=>D(a.target.value),children:["All","approved","pending","rejected"].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"col",children:[e.jsx("label",{className:"form-label",children:"Search"}),e.jsx("input",{className:"form-control",placeholder:"Title, vendor, email, vendorId, categoryâ€¦",value:W,onChange:a=>M(a.target.value)})]}),e.jsx("div",{className:"col-auto",children:e.jsx("button",{className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6 w-100",onClick:j,children:"+ Add service"})}),e.jsx("div",{className:"col-auto",children:e.jsx("button",{className:"btn rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-primary-700 text-hover-white w-100",onClick:J,disabled:!o,children:"Duplicate"})}),e.jsx("div",{className:"col-auto",children:e.jsx("button",{className:"btn btn-danger-500 rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-danger-700 text-hover-white w-100",onClick:Z,disabled:!o,children:"Delete"})})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-4",children:[e.jsxs("div",{className:"list-group mb-2",style:{maxHeight:420,overflow:"auto"},children:[A.map(a=>{const g=f(a);return e.jsxs("button",{className:"list-group-item list-group-item-action d-flex justify-content-between align-items-center "+(Y===a.id?"active":""),onClick:()=>q(a.id),title:g.email||"",children:[e.jsxs("span",{className:"text-truncate",children:[a.title,e.jsx("span",{className:"text-muted",children:" Â· "}),e.jsx("span",{className:"text-truncate",children:g.name})]}),g.profileHref?e.jsx("a",{className:"badge bg-light text-dark text-decoration-none",href:g.profileHref,target:"_blank",rel:"noreferrer",onClick:m=>m.stopPropagation(),title:"Open vendor profile",children:g.vendorId}):e.jsx("span",{className:"badge bg-light text-dark",children:a.category||"â€”"})]},a.id)}),!A.length&&e.jsx("div",{className:"text-muted small p-2",children:"No services match your filters."})]}),e.jsxs("div",{className:"small text-muted",children:["Showing ",A.length," of ",c.length]})]}),e.jsx("div",{className:"col",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Title"}),e.jsx("input",{className:"form-control",value:o.title,onChange:a=>N({title:a.target.value})})]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Category"}),e.jsx("input",{className:"form-control",value:o.category||"",onChange:a=>N({category:a.target.value})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Listing type"}),e.jsxs("select",{className:"form-select",value:o.listingType||"service",onChange:a=>N({listingType:a.target.value}),children:[e.jsx("option",{value:"service",children:"Service"}),e.jsx("option",{value:"saas",children:"SaaS"})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsxs("select",{className:"form-select",value:o.status||"approved",onChange:a=>N({status:a.target.value}),children:[e.jsx("option",{value:"approved",children:"approved"}),e.jsx("option",{value:"pending",children:"pending"}),e.jsx("option",{value:"rejected",children:"rejected"})]})]})]}),e.jsxs("div",{className:"row g-3 mt-1",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Bind to vendor (by company or email)"}),e.jsxs("select",{className:"form-select",value:o.vendorId||"",onChange:a=>F(a.target.value),children:[e.jsx("option",{value:"",children:"â€”"}),ee.map(a=>e.jsx("option",{value:a.id,children:a.label},a.id))]}),e.jsxs("div",{className:"form-text",children:["Saves both ",e.jsx("code",{children:"vendorId"})," and display"," ",e.jsx("code",{children:"vendor"})," name on the listing."]})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Contact email"}),e.jsx("input",{className:"form-control",value:o.contactEmail||"",onChange:a=>N({contactEmail:a.target.value.toLowerCase()})})]}),e.jsx("div",{className:"col-md-3 d-flex align-items-end",children:d!=null&&d.profileHref?e.jsx("a",{className:"btn btn-outline-primary w-100",href:d.profileHref,target:"_blank",rel:"noreferrer",title:"Open vendor profile",children:"View profile"}):e.jsx("button",{className:"btn btn-outline-secondary w-100",disabled:!0,children:"No profile linked"})})]}),e.jsxs("div",{className:"row g-3 mt-1",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Price (R)"}),e.jsx("input",{type:"number",min:"0",className:"form-control",value:Number(o.price||0),onChange:a=>N({price:Number(a.target.value||0)})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Rating (0â€“5)"}),e.jsx("input",{type:"number",min:"0",max:"5",step:"0.1",className:"form-control",value:Number(o.rating||0),onChange:a=>N({rating:Number(a.target.value||0)})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Review count"}),e.jsx("input",{type:"number",min:"0",className:"form-control",value:Number(o.reviewCount||0),onChange:a=>N({reviewCount:Number(a.target.value||0)})})]})]}),e.jsxs("div",{className:"row g-3 mt-1",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsx("label",{className:"form-label",children:"Image URL"}),e.jsx("input",{className:"form-control",value:o.imageUrl||"",onChange:a=>N({imageUrl:a.target.value})})]}),e.jsx("div",{className:"col-md-4 d-flex align-items-end gap-3",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{id:"isFeatured",type:"checkbox",className:"form-check-input",checked:!!o.isFeatured,onChange:a=>N({isFeatured:!!a.target.checked})}),e.jsx("label",{htmlFor:"isFeatured",className:"form-check-label",children:"Featured"})]})})]}),e.jsxs("div",{className:"mb-3 mt-2",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("textarea",{className:"form-control",rows:4,value:o.description||"",onChange:a=>N({description:a.target.value})})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("div",{className:"text-secondary small",children:["Vendor: ",e.jsx("strong",{children:(d==null?void 0:d.name)||"Unknown"}),d!=null&&d.email?` Â· ${d.email}`:""]}),e.jsx("div",{children:e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:R,disabled:!(d!=null&&d.email)&&!(o!=null&&o.vendorId),children:"Message Vendor"})})]}),e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("div",{className:"text-muted small mb-1",children:"Card preview"}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("img",{src:o.imageUrl||"/assets/images/placeholder-4x3.png",alt:"",style:{width:120,height:72,objectFit:"cover",borderRadius:6}}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:o.title||"Untitled service"}),e.jsxs("div",{className:"text-muted small",children:[(d==null?void 0:d.name)||"Vendor",d!=null&&d.email?` Â· ${d.email}`:""]}),e.jsxs("div",{className:"small",children:["R",Number(o.price||0).toLocaleString()," Â· â˜…"," ",Number(o.rating||0).toFixed(1)]})]})]})]})]}):e.jsx("div",{className:"text-muted mt-2",children:"Select a service to edit details."})})]})]}),v.open&&e.jsx("div",{className:"position-fixed top-0 start-0 w-100 h-100",style:{background:"rgba(0,0,0,0.5)",zIndex:1070},onClick:a=>a.target===a.currentTarget&&H(),children:e.jsxs("div",{className:"card",style:{maxWidth:560,margin:"10vh auto"},children:[e.jsxs("div",{className:"card-header d-flex align-items-center justify-content-between",children:[e.jsx("h6",{className:"mb-0",children:"Message Vendor"}),e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:H,children:"Close"})]}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"card-body",children:[v.err&&e.jsx("div",{className:"alert alert-danger py-2 mb-2",children:v.err}),v.done&&e.jsx("div",{className:"alert alert-success py-2 mb-2",children:"Sent"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Subject"}),e.jsx("input",{className:"form-control",value:v.subject,onChange:a=>L(g=>({...g,subject:a.target.value}))})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Message"}),e.jsx("textarea",{className:"form-control",rows:6,value:v.content,onChange:a=>L(g=>({...g,content:a.target.value}))}),e.jsxs("div",{className:"text-secondary small mt-1",children:["To: ",(d==null?void 0:d.email)||(o==null?void 0:o.vendorId)||"Vendor"]})]})]}),e.jsxs("div",{className:"card-footer d-flex justify-content-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:H,disabled:v.sending,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:v.sending||!v.content.trim(),children:v.sending?"Sendingâ€¦":"Send"})]})]})]})})]})}function Oe({items:s,onRestore:c}){return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header fw-semibold d-flex justify-content-between",children:[e.jsx("span",{children:"Version history"}),e.jsx("span",{className:"text-muted small",children:"Latest checkpoints"})]}),e.jsxs("div",{className:"list-group list-group-flush",children:[!(s!=null&&s.length)&&e.jsxs("div",{className:"list-group-item text-muted small",children:["No checkpoints yet.",e.jsx("div",{className:"mt-1",children:"Offline cache keeps the two most recent checkpoints."})]}),s==null?void 0:s.map(u=>{var h,y,f,I,k,_;return e.jsx("div",{className:"list-group-item",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:u.message||"(no message)"}),e.jsx("div",{className:"text-muted small",children:Ie(u.ts)}),e.jsxs("div",{className:"text-muted small",children:["Î” Cohorts: ",((h=u.delta)==null?void 0:h.cohorts)>=0?"+":"",((y=u.delta)==null?void 0:y.cohorts)??0," Â· Î” Courses:"," ",((f=u.delta)==null?void 0:f.courses)>=0?"+":"",((I=u.delta)==null?void 0:I.courses)??0," Â· Î” Lessons:"," ",((k=u.delta)==null?void 0:k.lessons)>=0?"+":"",((_=u.delta)==null?void 0:_.lessons)??0]})]}),e.jsxs("div",{className:"d-flex align-items-start gap-2",children:[e.jsx("button",{className:"btn btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6 btn-sm",title:"Restore snapshot to LIVE",onClick:()=>c(u.id),children:"Restore"}),e.jsx("a",{className:"btn btn-outline-secondary btn-sm",title:"Download snapshot JSON",href:`${Se}/checkpoints/${u.id}`,target:"_blank",rel:"noreferrer",children:"Download"})]})]})},u.id)})]})]})}export{Me as default};
