import{d as $e,r as i,b as g,C as U,B as u,j as e,L as pe}from"./index-CDEs_jt0.js";import{M as Me}from"./MasterLayout-9VLNCxgL.js";import{B as Be}from"./Breadcrumb-DA5GMbv3.js";import{I as l}from"./iconify-oJsv78Ep.js";import{u as We}from"./useWallet-DN1Oz1sr.js";import{W as Pe,a as je,T as ge,A as ze,f as F}from"./WalletNavigation-DMP-vVLa.js";function He(){var ue;const{loading:be,eligible:ee,wallet:y,redeemCredits:Ne,grantCredits:fe,refresh:_}=We(),{isAdmin:x}=$e(),[J,se]=i.useState(""),[W,ae]=i.useState(""),[P,z]=i.useState({type:"",message:""}),[H,te]=i.useState(!1),[ye,ve]=i.useState([]),[K,ne]=i.useState(!1),[C,we]=i.useState(""),[E,X]=i.useState(null),[le,re]=i.useState(""),[ke,I]=i.useState(""),[T,q]=i.useState(!1),[f,Ce]=i.useState(""),[Te,ie]=i.useState([]),[A,ce]=i.useState(!1),[oe,V]=i.useState(""),[R,de]=i.useState(""),[Y,Ie]=i.useState(50),me=i.useRef(!1),[N,Z]=i.useState([]),[d,v]=i.useState({userEmail:"",type:"",dateFrom:"",dateTo:"",minAmount:"",maxAmount:""}),[G,he]=i.useState(!1),[b,D]=i.useState(1),[w]=i.useState(20),[$,Ae]=i.useState(!0),Q=i.useCallback(async(s=!0)=>{var a,r,n,o,p;V(""),ce(!0);try{const h={search:f,pageSize:Y};!s&&R&&(h.pageToken=R);const{data:c}=await g.get("/api/users/all",{params:h}),t=Array.isArray(c==null?void 0:c.items)?c.items:[];ie(m=>s?t:[...m,...t]),de((c==null?void 0:c.nextPageToken)||"")}catch(h){const c=(a=h==null?void 0:h.response)==null?void 0:a.status;if(c===401||c===403)try{await U();const t={search:f,pageSize:Y};!s&&R&&(t.pageToken=R);const{data:m}=await g.get("/api/users/all",{params:t}),j=Array.isArray(m==null?void 0:m.items)?m.items:[];ie(L=>s?j:[...L,...j]),de((m==null?void 0:m.nextPageToken)||""),V("");return}catch(t){V(((n=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:n.message)||(t==null?void 0:t.message)||"Failed to search platform users")}else V(((p=(o=h==null?void 0:h.response)==null?void 0:o.data)==null?void 0:p.message)||(h==null?void 0:h.message)||"Failed to search platform users")}finally{ce(!1)}},[f,Y,R]),S=i.useCallback(async()=>{if(x)try{ne(!0);const r=((await g.get("/api/users")).data||[]).map(n=>({...n,walletBalance:n.walletBalance||0,lastActivity:n.lastActivity||new Date().toISOString(),avatar:n.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(n.name||n.email)}&background=6366f1&color=fff`}));ve(r)}catch(s){console.error("Error loading users:",s),u.error("Failed to load user data")}finally{ne(!1)}},[x]),O=i.useCallback(async s=>{try{const{data:a}=await g.get("/api/wallets/admin/lookup",{params:{email:s.trim().toLowerCase()}});X((a==null?void 0:a.wallet)||null),re(s)}catch(a){console.error("Error looking up user wallet:",a),X(null),u.error("Failed to lookup user wallet")}},[]),k=i.useCallback(async()=>{var s,a,r,n;if(x)try{he(!0),console.log("Loading transactions with filters:",d),await U();try{const{data:o}=await g.get("/api/wallets/admin/transactions",{params:{userEmail:d.userEmail||void 0,type:d.type||void 0,dateFrom:d.dateFrom||void 0,dateTo:d.dateTo||void 0,minAmount:d.minAmount||void 0,maxAmount:d.maxAmount||void 0,page:b,limit:w}});console.log("Received transaction data from dedicated endpoint:",o),Z((o==null?void 0:o.transactions)||[]),((s=o==null?void 0:o.transactions)==null?void 0:s.length)>0?u.success(`Loaded ${o.transactions.length} transactions`):u.info("No transactions found")}catch(o){console.warn("Dedicated transactions endpoint failed, trying fallback approach:",o);const{data:p}=await g.get("/api/wallets",{suppressToast:!0,suppressErrorLog:!0});console.log("Received wallets data for transaction extraction:",p);let h=[];Array.isArray(p)&&p.forEach(t=>{t&&t.transactions&&Array.isArray(t.transactions)&&t.transactions.forEach(m=>{h.push({...m,userEmail:t.userEmail||t.email||"Unknown",userName:t.userName||t.name,userRole:t.role,userTenant:t.tenantId,walletBalance:t.balance})})});let c=h;if(d.userEmail){const t=d.userEmail.toLowerCase();c=c.filter(m=>m.userEmail.toLowerCase().includes(t))}if(d.type&&(c=c.filter(t=>t.type===d.type)),d.dateFrom){const t=new Date(d.dateFrom);c=c.filter(m=>new Date(m.createdAt)>=t)}if(d.dateTo){const t=new Date(d.dateTo);t.setHours(23,59,59,999),c=c.filter(m=>new Date(m.createdAt)<=t)}if(d.minAmount){const t=Number(d.minAmount);Number.isFinite(t)&&(c=c.filter(m=>m.amount>=t))}if(d.maxAmount){const t=Number(d.maxAmount);Number.isFinite(t)&&(c=c.filter(m=>m.amount<=t))}c.sort((t,m)=>new Date(m.createdAt).getTime()-new Date(t.createdAt).getTime()),console.log("Extracted and filtered transactions:",c),Z(c),c.length>0?u.success(`Loaded ${c.length} transactions (fallback method)`):u.info("No transactions found in any wallets")}}catch(o){console.error("Error loading transactions:",o);const p=((r=(a=o.response)==null?void 0:a.data)==null?void 0:r.message)||o.message||"Failed to load transaction history",h=(n=o.response)==null?void 0:n.status;h===404?u.error("Transaction endpoint not found. Please check if backend is running with latest code."):h===401||h===403?u.error("Authentication required. Please sign in again."):u.error(`Failed to load transaction history: ${p}`),Z([])}finally{he(!1)}},[x,d,b,w]),Se=i.useCallback(()=>{v({userEmail:"",type:"",dateFrom:"",dateTo:"",minAmount:"",maxAmount:""}),D(1)},[]),Le=i.useCallback(()=>{D(1),k()},[k]),Ue=async()=>{var s,a;if(!T)try{q(!0),await g.post("/api/admin/wallet/normalize-appdata"),u.success("Successfully normalized app data"),await S(),await _()}catch(r){console.error("Error normalizing data:",r);const n=((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to normalize app data";u.error(n)}finally{q(!1)}},Fe=async()=>{var s,a;if(!T)try{q(!0);const r=["mncubekhulekani@gmail.com","ruthmaphosa2024@gmail.com","zinhlesloane@gmail.com","khulekani@gecafrica.co","22onsloanedigitalteam@gmail.com","khulekani@22onsloane.co"],n=await g.post("/api/admin/wallet/sync-firebase-users",{promoteVendors:r,defaultRole:"member",defaultTenant:"vendor"});u.success(`Successfully synced ${n.data.synced} Firebase users`),await S()}catch(r){console.error("Error syncing Firebase users:",r);const n=((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to sync Firebase users";u.error(n)}finally{q(!1)}};i.useEffect(()=>{if(!x||me.current)return;me.current=!0;let s=!0;return(async()=>{try{if(await U(),!s||(await Q(!0),!s))return;await S()}catch(a){console.error("Failed to auto-load users:",a)}})(),()=>{s=!1}},[x,Q,S]),i.useEffect(()=>{x&&$&&N.length===0&&k()},[x,$,k,N.length]);const Ee=async s=>{var r;if(s.preventDefault(),!y)return;z({type:"",message:""});const a=Number(J.replace(/[^0-9.]/g,""));if(!Number.isFinite(a)||a<=0){z({type:"danger",message:"Enter a valid voucher amount to record."});return}te(!0);try{const n=await Ne(a,{description:W?`Manual redemption: ${W.trim()}`:"Manual voucher redemption",metadata:{source:"my-wallet",note:W.trim()||void 0},reference:"manual-redemption"});if(!n.ok){z({type:"danger",message:n.error||"Unable to record voucher usage."});return}se(""),ae(""),z({type:"success",message:`Voucher usage recorded. Remaining balance: ${F((r=n.wallet)==null?void 0:r.balance)} credits.`})}finally{te(!1)}},xe=ye.filter(s=>{var a;return s.email.toLowerCase().includes(C.toLowerCase())||((a=s.name)==null?void 0:a.toLowerCase().includes(C.toLowerCase()))||s.role.toLowerCase().includes(C.toLowerCase())}),M=Te.filter(s=>{var a,r;return((a=s.email)==null?void 0:a.toLowerCase().includes(f.toLowerCase()))||((r=s.displayName)==null?void 0:r.toLowerCase().includes(f.toLowerCase()))}),Re=N.slice((b-1)*w,b*w),B=Math.ceil(N.length/w);return e.jsxs("div",{className:"row gy-4",children:[x&&e.jsx("div",{className:"col-12",children:e.jsx(Pe,{})}),e.jsx("div",{className:"col-12 col-lg-8",children:e.jsx(je,{wallet:y,loading:be,eligible:ee,onRefresh:_,showActions:!x})}),x&&e.jsx("div",{className:"col-12 col-lg-4",children:e.jsxs("div",{className:"card p-24 radius-12 h-100",children:[e.jsxs("h5",{className:"mb-3",children:[e.jsx(l,{icon:"mdi:shield-crown",className:"text-xl text-primary-600 me-2"}),"Admin Actions"]}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsx("button",{className:"btn btn-outline-primary btn-sm",onClick:Ue,disabled:T,children:T?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Normalizing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(l,{icon:"mdi:database-sync",className:"me-2"}),"Normalize Data"]})}),e.jsx("button",{className:"btn btn-outline-secondary btn-sm",onClick:Fe,disabled:T,children:T?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Syncing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(l,{icon:"mdi:account-sync",className:"me-2"}),"Sync Firebase Users"]})}),e.jsxs(pe,{to:"/admin/wallet-credits",className:"btn btn-outline-warning btn-sm",children:[e.jsx(l,{icon:"mdi:wallet-plus",className:"me-2"}),"Legacy Admin"]}),e.jsxs(pe,{to:"/dashboard",className:"btn btn-outline-info btn-sm",children:[e.jsx(l,{icon:"mdi:view-dashboard",className:"me-2"}),"Dashboard"]})]})]})}),(!x||y)&&e.jsx("div",{className:x?"col-12 col-lg-6":"col-12 col-lg-4",children:e.jsxs("div",{className:"card p-24 radius-12 h-100",children:[e.jsxs("h5",{className:"mb-3",children:[e.jsx(l,{icon:"mdi:receipt-text-plus",className:"text-xl text-primary-600 me-2"}),"Record Usage"]}),e.jsx("p",{className:"text-secondary-light mb-3",children:"Manually record voucher usage for offline transactions or services not yet integrated with the marketplace."}),ee&&y&&e.jsxs("form",{onSubmit:Ee,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label text-sm text-secondary-light",children:"Amount"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:"R"}),e.jsx("input",{type:"text",className:"form-control",value:J,onChange:s=>se(s.target.value),placeholder:"e.g. 150",disabled:H})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label text-sm text-secondary-light",children:"Description (optional)"}),e.jsx("input",{type:"text",className:"form-control",value:W,onChange:s=>ae(s.target.value),placeholder:"What was this used for?",disabled:H})]}),e.jsx("button",{type:"submit",className:"btn btn-primary w-100",disabled:H||!J,children:H?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Recording..."]}):e.jsxs(e.Fragment,{children:[e.jsx(l,{icon:"mdi:plus-circle",className:"me-2"}),"Record Usage"]})})]}),P.message&&e.jsxs("div",{className:`alert alert-${P.type||"info"} mt-3 mb-0`,children:[e.jsx(l,{icon:P.type==="success"?"mdi:check-circle":"mdi:alert-circle",className:"me-2"}),P.message]})]})}),x&&E&&e.jsx("div",{className:"col-12 col-lg-6",children:e.jsxs("div",{className:"card p-24 radius-12",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(l,{icon:"mdi:account-cash",className:"text-xl text-primary-600 me-2"}),"User Wallet: ",le]}),e.jsx("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>{X(null),re("")},children:e.jsx(l,{icon:"mdi:close"})})]}),e.jsx(je,{wallet:E,loading:!1,eligible:!0,onRefresh:()=>O(le),showActions:!1,compact:!0}),E.transactions&&E.transactions.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h6",{className:"mb-2",children:"Recent Transactions"}),e.jsx(ge,{transactions:E.transactions.slice(0,5),compact:!0})]})]})}),y&&e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card p-24 radius-12",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(l,{icon:"mdi:history",className:"text-xl text-primary-600 me-2"}),x?"My Transaction History":"Transaction History"]}),x&&e.jsxs("div",{className:"text-sm text-secondary",children:["Total Transactions: ",((ue=y.transactions)==null?void 0:ue.length)||0]})]}),e.jsx(ge,{transactions:y.transactions||[]})]})}),x&&e.jsx("div",{className:"col-12",children:e.jsx(ze,{grantCredits:fe,onRefresh:async()=>{await S(),await _()},compact:!1,showUserLookup:!0,selectedUserEmail:ke,onEmailChange:I})}),x&&e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card p-24 radius-12",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(l,{icon:"mdi:account-group",className:"text-xl text-primary-600 me-2"}),"Platform Users Transaction Tracking"]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>{const s=!$;Ae(s),s&&N.length===0&&k()},children:[e.jsx(l,{icon:"mdi:history",className:"me-1"}),$?"Hide":"Show"," Transaction History"]}),e.jsx("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>Q(!0),disabled:A,children:A?e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}):e.jsx(l,{icon:"mdi:refresh"})})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:e.jsx(l,{icon:"mdi:magnify"})}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Search platform users by name or email...",value:f,onChange:s=>Ce(s.target.value)})]})}),e.jsx("div",{className:"col-12 col-md-6",children:e.jsx("button",{className:"btn btn-primary w-100",onClick:()=>Q(!0),disabled:A,children:A?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Searching..."]}):e.jsxs(e.Fragment,{children:[e.jsx(l,{icon:"mdi:magnify",className:"me-2"}),"Search Users"]})})})]}),oe&&e.jsxs("div",{className:"alert alert-warning mb-3",children:[e.jsx(l,{icon:"mdi:alert-circle",className:"me-2"}),oe]}),!A&&M.length>0&&e.jsxs("div",{className:"table-responsive",children:[e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Last Sign In"}),e.jsx("th",{children:"Provider"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:M.slice(0,20).map(s=>{var a,r,n;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("img",{src:s.photoURL||`https://ui-avatars.com/api/?name=${encodeURIComponent(s.displayName||s.email)}&background=6366f1&color=fff`,alt:s.displayName||s.email,className:"rounded-circle me-2",width:"32",height:"32"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:s.displayName||"No Name"}),e.jsx("div",{className:"text-xs text-secondary",children:s.uid})]})]})}),e.jsx("td",{children:s.email}),e.jsx("td",{children:e.jsx("span",{className:"text-sm",children:(a=s.metadata)!=null&&a.lastSignInTime?new Date(s.metadata.lastSignInTime).toLocaleDateString():"Never"})}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-light text-dark",children:((n=(r=s.providerData)==null?void 0:r[0])==null?void 0:n.providerId)||"Unknown"})}),e.jsx("td",{children:e.jsxs("div",{className:"btn-group btn-group-sm",children:[e.jsx("button",{className:"btn btn-outline-primary",onClick:()=>{I(s.email)},title:"Grant credits to this user",children:e.jsx(l,{icon:"mdi:wallet-plus"})}),e.jsx("button",{className:"btn btn-outline-info",onClick:()=>O(s.email),title:"View user's transaction history",children:e.jsx(l,{icon:"mdi:history"})})]})})]},s.uid)})})]}),M.length>20&&e.jsx("div",{className:"text-center pt-3",children:e.jsxs("small",{className:"text-secondary",children:["Showing 20 of ",M.length," users. Use search to narrow results."]})})]}),!A&&M.length===0&&f&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(l,{icon:"mdi:account-search",className:"text-4xl text-secondary-light mb-2"}),e.jsxs("p",{className:"text-secondary",children:['No users found matching "',f,'"']})]})]})}),x&&$&&e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card p-24 radius-12",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(l,{icon:"mdi:chart-line",className:"text-xl text-primary-600 me-2"}),"Platform Transaction History"]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-outline-primary btn-sm",onClick:k,disabled:G,children:G?e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}):e.jsx(l,{icon:"mdi:refresh"})}),e.jsxs("button",{className:"btn btn-outline-success btn-sm",onClick:async()=>{var s,a,r;try{console.log("Testing basic wallets endpoints..."),await U();const n=await g.get("/api/wallets");console.log("Wallets endpoint works:",n.data);const o=await g.get("/api/wallets/admin/debug/wallets");console.log("Debug endpoint works:",o.data),u.success("Basic wallet endpoints work!")}catch(n){console.error("Basic endpoints test failed:",n);const o=(s=n.response)==null?void 0:s.status,p=((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.message)||n.message;u.error(`Basic endpoints failed (${o}): ${p}`)}},children:[e.jsx(l,{icon:"mdi:check-circle",className:"me-1"}),"Test Basic"]}),e.jsxs("button",{className:"btn btn-outline-warning btn-sm",onClick:async()=>{var s,a,r,n,o,p,h,c,t,m;try{console.log("Testing transaction endpoint directly..."),console.log("Current API base URL:",g.defaults.baseURL),await U();const j=`${g.defaults.baseURL||""}/api/wallets/admin/transactions`;console.log("Full URL being called:",j);const L=await g.get("/api/wallets/admin/transactions",{params:{limit:10}});console.log("Transaction endpoint test response:",L),u.success(`Transaction endpoint works! Found ${((a=(s=L.data)==null?void 0:s.transactions)==null?void 0:a.length)||0} transactions`)}catch(j){console.error("Transaction endpoint test failed:",j),console.error("Request config:",j.config),console.error("Request URL:",(r=j.config)==null?void 0:r.url),console.error("Full request details:",{baseURL:(n=j.config)==null?void 0:n.baseURL,url:(o=j.config)==null?void 0:o.url,method:(p=j.config)==null?void 0:p.method,headers:(h=j.config)==null?void 0:h.headers});const L=(c=j.response)==null?void 0:c.status,De=((m=(t=j.response)==null?void 0:t.data)==null?void 0:m.message)||j.message;u.error(`Transaction endpoint failed (${L}): ${De}`)}},children:[e.jsx(l,{icon:"mdi:database-search",className:"me-1"}),"Test Transactions"]}),e.jsxs("button",{className:"btn btn-outline-info btn-sm",onClick:async()=>{var s,a,r;try{const n=await g.get("/api/health");console.log("Health check:",n.data);const p=await(await fetch("http://localhost:5055/api/health")).json();console.log("Direct health check:",p),await U();const h=await g.get("/api/wallets/admin/debug/wallets");console.log("Debug response:",h.data),u.success("Backend connection successful!")}catch(n){console.error("Backend connection failed:",n);const o=(s=n.response)==null?void 0:s.status,p=((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.message)||n.message;o===404?u.error("Endpoint not found (404). Check backend routes."):o===401||o===403?u.error("Authentication failed. Please sign in again."):u.error(`Backend connection failed: ${p}`)}},children:[e.jsx(l,{icon:"mdi:bug",className:"me-1"}),"Test Backend"]}),e.jsxs("button",{className:"btn btn-outline-secondary btn-sm",onClick:Se,children:[e.jsx(l,{icon:"mdi:filter-off",className:"me-1"}),"Clear Filters"]})]})]}),e.jsxs("div",{className:"row g-3 mb-4 p-3 bg-light rounded",children:[e.jsx("div",{className:"col-12",children:e.jsxs("h6",{className:"mb-2",children:[e.jsx(l,{icon:"mdi:filter",className:"me-1"}),"Transaction Filters"]})}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-3",children:[e.jsx("label",{className:"form-label text-sm",children:"User Email"}),e.jsx("input",{type:"email",className:"form-control form-control-sm",placeholder:"Filter by user email...",value:d.userEmail,onChange:s=>v(a=>({...a,userEmail:s.target.value}))})]}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-2",children:[e.jsx("label",{className:"form-label text-sm",children:"Transaction Type"}),e.jsxs("select",{className:"form-select form-select-sm",value:d.type,onChange:s=>v(a=>({...a,type:s.target.value})),children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"credit",children:"Credit"}),e.jsx("option",{value:"debit",children:"Debit"}),e.jsx("option",{value:"adjustment",children:"Adjustment"})]})]}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-2",children:[e.jsx("label",{className:"form-label text-sm",children:"Date From"}),e.jsx("input",{type:"date",className:"form-control form-control-sm",value:d.dateFrom,onChange:s=>v(a=>({...a,dateFrom:s.target.value}))})]}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-2",children:[e.jsx("label",{className:"form-label text-sm",children:"Date To"}),e.jsx("input",{type:"date",className:"form-control form-control-sm",value:d.dateTo,onChange:s=>v(a=>({...a,dateTo:s.target.value}))})]}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-1",children:[e.jsx("label",{className:"form-label text-sm",children:"Min Amount"}),e.jsx("input",{type:"number",className:"form-control form-control-sm",placeholder:"0",value:d.minAmount,onChange:s=>v(a=>({...a,minAmount:s.target.value}))})]}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-2",children:[e.jsx("label",{className:"form-label text-sm",children:"Max Amount"}),e.jsxs("div",{className:"d-flex gap-1",children:[e.jsx("input",{type:"number",className:"form-control form-control-sm",placeholder:"âˆž",value:d.maxAmount,onChange:s=>v(a=>({...a,maxAmount:s.target.value}))}),e.jsx("button",{className:"btn btn-primary btn-sm",onClick:Le,disabled:G,children:e.jsx(l,{icon:"mdi:magnify"})})]})]})]}),N.length>0&&e.jsxs("div",{className:"row g-3 mb-4",children:[e.jsx("div",{className:"col-6 col-md-3",children:e.jsxs("div",{className:"bg-primary-50 p-3 rounded text-center",children:[e.jsx("div",{className:"text-sm text-secondary",children:"Total Transactions"}),e.jsx("div",{className:"h5 text-primary mb-0",children:N.length})]})}),e.jsx("div",{className:"col-6 col-md-3",children:e.jsxs("div",{className:"bg-success-50 p-3 rounded text-center",children:[e.jsx("div",{className:"text-sm text-secondary",children:"Total Credits"}),e.jsxs("div",{className:"h5 text-success mb-0",children:["R ",F(N.filter(s=>s.type==="credit").reduce((s,a)=>s+(a.amount||0),0))]})]})}),e.jsx("div",{className:"col-6 col-md-3",children:e.jsxs("div",{className:"bg-danger-50 p-3 rounded text-center",children:[e.jsx("div",{className:"text-sm text-secondary",children:"Total Debits"}),e.jsxs("div",{className:"h5 text-danger mb-0",children:["R ",F(N.filter(s=>s.type==="debit").reduce((s,a)=>s+(a.amount||0),0))]})]})}),e.jsx("div",{className:"col-6 col-md-3",children:e.jsxs("div",{className:"bg-info-50 p-3 rounded text-center",children:[e.jsx("div",{className:"text-sm text-secondary",children:"Unique Users"}),e.jsx("div",{className:"h5 text-info mb-0",children:new Set(N.map(s=>s.userEmail)).size})]})})]}),G?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-secondary mt-2",children:"Loading transaction history..."})]}):N.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"User"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Description"}),e.jsx("th",{className:"text-end",children:"Amount"}),e.jsx("th",{className:"text-end",children:"Balance After"}),e.jsx("th",{children:"Reference"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:Re.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("span",{className:"text-sm",children:[new Date(s.createdAt).toLocaleDateString(),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:new Date(s.createdAt).toLocaleTimeString()})]})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("img",{src:`https://ui-avatars.com/api/?name=${encodeURIComponent(s.userEmail||"Unknown")}&background=6366f1&color=fff&size=24`,alt:s.userEmail,className:"rounded-circle me-2",width:"24",height:"24"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm fw-medium",children:s.userEmail}),s.userName&&e.jsx("small",{className:"text-muted",children:s.userName})]})]})}),e.jsx("td",{children:e.jsxs("span",{className:`badge ${s.type==="credit"?"bg-success":s.type==="debit"?"bg-danger":"bg-warning"}`,children:[e.jsx(l,{icon:s.type==="credit"?"mdi:plus-circle":s.type==="debit"?"mdi:minus-circle":"mdi:circle-edit-outline",className:"me-1"}),s.type]})}),e.jsxs("td",{children:[e.jsx("span",{className:"text-sm",children:s.description}),s.metadata&&e.jsxs("div",{className:"text-xs text-muted",children:[s.metadata.source&&`Source: ${s.metadata.source}`,s.metadata.note&&` | ${s.metadata.note}`]})]}),e.jsx("td",{className:"text-end",children:e.jsxs("span",{className:`text-sm fw-medium ${s.type==="credit"?"text-success":"text-danger"}`,children:[s.type==="credit"?"+":"-","R ",F(s.amount)]})}),e.jsx("td",{className:"text-end",children:e.jsxs("span",{className:"text-sm",children:["R ",F(s.balanceAfter)]})}),e.jsx("td",{children:s.reference&&e.jsx("small",{className:"text-muted font-monospace",children:s.reference})}),e.jsx("td",{children:e.jsxs("div",{className:"btn-group btn-group-sm",children:[e.jsx("button",{className:"btn btn-outline-info",onClick:()=>O(s.userEmail),title:"View user's full wallet",children:e.jsx(l,{icon:"mdi:wallet"})}),e.jsx("button",{className:"btn btn-outline-primary",onClick:()=>{I(s.userEmail)},title:"Grant credits to this user",children:e.jsx(l,{icon:"mdi:wallet-plus"})})]})})]},s.id))})]})}),B>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsxs("div",{className:"text-sm text-secondary",children:["Showing ",(b-1)*w+1," to ",Math.min(b*w,N.length)," of ",N.length," transactions"]}),e.jsx("nav",{children:e.jsxs("ul",{className:"pagination pagination-sm mb-0",children:[e.jsx("li",{className:`page-item ${b===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>D(b-1),disabled:b===1,children:e.jsx(l,{icon:"mdi:chevron-left"})})}),Array.from({length:Math.min(5,B)},(s,a)=>{const r=Math.max(1,Math.min(B-4,b-2))+a;return e.jsx("li",{className:`page-item ${r===b?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>D(r),children:r})},r)}),e.jsx("li",{className:`page-item ${b===B?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>D(b+1),disabled:b===B,children:e.jsx(l,{icon:"mdi:chevron-right"})})})]})})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(l,{icon:"mdi:chart-line-variant",className:"text-4xl text-secondary-light mb-2"}),e.jsx("p",{className:"text-secondary",children:"No transactions found matching the current filters."}),e.jsxs("button",{className:"btn btn-outline-primary btn-sm",onClick:k,children:[e.jsx(l,{icon:"mdi:refresh",className:"me-1"}),"Load Transaction History"]})]})]})}),x&&e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card p-24 radius-12",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(l,{icon:"mdi:account-group",className:"text-xl text-primary-600 me-2"}),"Local Users & Wallets"]}),e.jsx("button",{className:"btn btn-outline-secondary btn-sm",onClick:S,disabled:K,children:K?e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}):e.jsx(l,{icon:"mdi:refresh"})})]}),e.jsx("div",{className:"row mb-3",children:e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:e.jsx(l,{icon:"mdi:magnify"})}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Search local users...",value:C,onChange:s=>we(s.target.value)})]})})}),K?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-secondary mt-2",children:"Loading users..."})]}):xe.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Tenant"}),e.jsx("th",{children:"Wallet Balance"}),e.jsx("th",{children:"Last Activity"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:xe.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("img",{src:s.avatar,alt:s.name,className:"rounded-circle me-2",width:"32",height:"32"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:s.name}),e.jsx("div",{className:"text-xs text-secondary",children:s.email})]})]})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.role==="admin"?"bg-danger":s.role==="vendor"?"bg-warning":"bg-secondary"}`,children:s.role})}),e.jsx("td",{children:s.tenantId}),e.jsx("td",{children:e.jsxs("span",{className:"fw-medium",children:["R ",F(s.walletBalance)]})}),e.jsx("td",{children:e.jsx("span",{className:"text-sm",children:new Date(s.lastActivity).toLocaleDateString()})}),e.jsx("td",{children:e.jsxs("div",{className:"btn-group btn-group-sm",children:[e.jsx("button",{className:"btn btn-outline-primary",onClick:()=>{I(s.email)},title:"Grant credits to this user",children:e.jsx(l,{icon:"mdi:wallet-plus"})}),e.jsx("button",{className:"btn btn-outline-info",onClick:()=>O(s.email),title:"View user's transaction history",children:e.jsx(l,{icon:"mdi:history"})})]})})]},s.uid))})]})}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(l,{icon:"mdi:account-search",className:"text-4xl text-secondary-light mb-2"}),e.jsx("p",{className:"text-secondary",children:C?`No users found matching "${C}"`:"No users found"})]})]})})]})}const Je=()=>e.jsx(e.Fragment,{children:e.jsxs(Me,{children:[e.jsx(Be,{title:"My Wallet"}),e.jsx(He,{})]})});export{Je as default};
