import{c as o,b as S}from"./index-CmOqa4Kr.js";const h="sl_subscriptions_cache_v1";function g(t){if(!t)return[];try{const e=JSON.parse(t);return Array.isArray(e)?e:[]}catch{return[]}}function a(){if(typeof window>"u")return null;try{const t=S.currentUser,e=((t==null?void 0:t.email)||window.sessionStorage.getItem("userEmail")||"").toLowerCase(),n=(t==null?void 0:t.uid)||window.sessionStorage.getItem("userId")||"";return!e&&!n?null:`${h}:${n||e}`}catch{return null}}function u(t){if(!t||typeof window>"u")return[];try{return g(window.localStorage.getItem(t))}catch{return[]}}function d(t,e){if(!(!t||typeof window>"u"))try{window.localStorage.setItem(t,JSON.stringify(e))}catch{}}function v(t){if(!(!t||typeof window>"u"))try{window.localStorage.removeItem(t)}catch{}}function f(t){if(!t||typeof t!="object")return null;const e={...t};return e.type=(e.type||"service").toString(),e.email&&(e.email=e.email.toLowerCase()),e.serviceId=e.serviceId!=null?String(e.serviceId):e.serviceId,e.tenantId=(e.tenantId||"public").toString(),e}function I(t,e){const n=f(e);if(!t||!n)return;const r=u(t),i=(n.email||"").toLowerCase(),l=String(n.serviceId||""),p=n.type||"service",c=r.findIndex(s=>{const m=(s.email||"").toLowerCase(),w=String(s.serviceId||""),y=s.type||"service";return m===i&&w===l&&y===p});c>=0?r[c]={...r[c],...n,canceledAt:void 0}:r.push(n),d(t,r)}function b(t,e){if(!t)return;const n=String(e||""),r=u(t).filter(i=>String(i.serviceId||"")!==n);d(t,r)}async function L(){var e;const t=a();try{const{data:n}=await o.get("/api/subscriptions/my"),i=(Array.isArray(n)?n:[]).map(f).filter(Boolean);return t&&d(t,i),i}catch(n){const r=(e=n==null?void 0:n.response)==null?void 0:e.status;if(r===401||r===403||r===404)return v(t),[];const i=u(t);return i.length?i:[]}}async function A(t,e={}){const n={serviceId:t,...e},{data:r}=await o.post("/api/subscriptions/service",n),i=a();return I(i,r||{serviceId:t,...e,type:"service"}),r}async function K(t){await o.put("/api/subscriptions/service/cancel",{serviceId:t});const e=a();return b(e,t),!0}export{L as f,A as s,K as u};
