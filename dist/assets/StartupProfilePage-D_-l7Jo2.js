import{u as U,r as d,a as x,b as f,j as e,L as T,w}from"./index-7-v0jUWh.js";import{M as B}from"./MasterLayout-SmJzx4r8.js";import{B as F}from"./Breadcrumb-BBtNR4li.js";import"./iconify-BSamAZK7.js";const C="/api/data/startups";function _(){const E=U(),[p,h]=d.useState(!1),[y,m]=d.useState(""),[b,v]=d.useState(""),j=d.useMemo(()=>sessionStorage.getItem("tenantId")||"vendor",[]),[S,N]=d.useState(!1),[s,g]=d.useState({id:"",name:"",elevatorPitch:"",productsServices:"",employeeCount:0,contactEmail:"",phone:"",website:"",country:"",city:"",addressLine:"",categories:[],tags:[]});function n(a,l){g(o=>({...o,[a]:l}))}d.useEffect(()=>{(async()=>{var o,c;m("");const a=x.currentUser,l=((a==null?void 0:a.email)||"").toLowerCase();if(l)try{const t=(await f.get(C).then(i=>i.data||[])).find(i=>i.ownerUid&&i.ownerUid===a.uid||(i.contactEmail||i.email||"").toLowerCase()===l);g(t?{id:t.id||"",name:t.name||"",elevatorPitch:t.elevatorPitch||"",productsServices:t.productsServices||"",employeeCount:Number(t.employeeCount||0),contactEmail:(t.contactEmail||l).toLowerCase(),phone:t.phone||"",website:t.website||"",country:t.country||"",city:t.city||"",addressLine:t.addressLine||"",categories:Array.isArray(t.categories)?t.categories:[],tags:Array.isArray(t.tags)?t.tags:[]}:i=>({...i,contactEmail:l}));try{const A=(await f.get("/api/data/vendors").then(u=>u.data||[])).find(u=>u.ownerUid&&u.ownerUid===a.uid||(u.contactEmail||u.email||"").toLowerCase()===l);N(!!A)}catch{}}catch(r){m(((c=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:c.message)||(r==null?void 0:r.message)||"Failed to load startup profile")}})()},[j]);async function P(a){var l,o,c;(l=a==null?void 0:a.preventDefault)==null||l.call(a),h(!0),m(""),v("");try{const r=x.currentUser;if(!r)throw new Error("Please sign in");const t={id:s.id||r.uid,name:s.name,elevatorPitch:s.elevatorPitch,productsServices:s.productsServices,employeeCount:Number(s.employeeCount||0),contactEmail:(s.contactEmail||r.email||"").toLowerCase(),ownerUid:r.uid,phone:s.phone,website:s.website,country:s.country,city:s.city,addressLine:s.addressLine,categories:s.categories,tags:s.tags};if(!t.name)throw new Error("Business name is required");await f.post(C,t),v("Saved");try{await w({action:"STARTUP_UPDATE",userEmail:t.contactEmail,targetType:"startup",targetId:t.id})}catch{}g(i=>({...i,id:t.id}))}catch(r){m(((c=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:c.message)||(r==null?void 0:r.message)||"Failed to save")}finally{h(!1)}}async function L(){var a,l;m(""),v(""),h(!0);try{const o=x.currentUser;if(!o)throw new Error("Please sign in");const c=(s.contactEmail||o.email||"").toLowerCase(),r=[s.elevatorPitch||"",s.productsServices||""].filter(Boolean).join(`

`),t={id:o.uid,name:s.name,contactEmail:c,ownerUid:o.uid,phone:s.phone,website:s.website,description:r,country:s.country,city:s.city,addressLine:s.addressLine,categories:s.categories,tags:s.tags,status:"pending",kycStatus:"pending"};if(!t.name)throw new Error("Business name is required to create a vendor.");await f.post("/api/data/vendors",t);try{await w({action:"VENDOR_CREATE_FROM_STARTUP",userEmail:c,targetType:"vendor",targetId:o.uid})}catch{}v("Vendor profile created. Redirecting…"),N(!0),setTimeout(()=>E("/profile-vendor",{replace:!0}),600)}catch(o){m(((l=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:l.message)||(o==null?void 0:o.message)||"Failed to create vendor from startup")}finally{h(!1)}}return e.jsxs(B,{children:[e.jsx(F,{title:"Startup Profile"}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("div",{className:"small text-muted",children:["Tenant: ",e.jsx("code",{children:j})]}),e.jsx("div",{className:"d-flex gap-2",children:S?e.jsx(T,{to:"/profile-vendor",className:"btn btn-sm btn-outline-primary",children:"Go to Vendor Profile"}):e.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:L,disabled:p,children:p?"Creating…":"Create Vendor from Startup"})})]}),y&&e.jsx("div",{className:"alert alert-danger",children:y}),b&&e.jsx("div",{className:"alert alert-success",children:b}),e.jsxs("form",{onSubmit:P,className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Business name"}),e.jsx("input",{className:"form-control",value:s.name,onChange:a=>n("name",a.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Website"}),e.jsx("input",{className:"form-control",value:s.website,onChange:a=>n("website",a.target.value)})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"Elevator pitch"}),e.jsx("textarea",{className:"form-control",rows:3,value:s.elevatorPitch,onChange:a=>n("elevatorPitch",a.target.value)})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"Products / Services"}),e.jsx("textarea",{className:"form-control",rows:4,value:s.productsServices,onChange:a=>n("productsServices",a.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Employees"}),e.jsx("input",{type:"number",min:0,className:"form-control",value:s.employeeCount,onChange:a=>n("employeeCount",a.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Phone"}),e.jsx("input",{className:"form-control",value:s.phone,onChange:a=>n("phone",a.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Contact email"}),e.jsx("input",{type:"email",className:"form-control",value:s.contactEmail,onChange:a=>n("contactEmail",a.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Country"}),e.jsx("input",{className:"form-control",value:s.country,onChange:a=>n("country",a.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"City"}),e.jsx("input",{className:"form-control",value:s.city,onChange:a=>n("city",a.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Address"}),e.jsx("input",{className:"form-control",value:s.addressLine,onChange:a=>n("addressLine",a.target.value)})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"Categories (comma separated)"}),e.jsx("input",{className:"form-control",value:(s.categories||[]).join(", "),onChange:a=>n("categories",a.target.value.split(",").map(l=>l.trim()).filter(Boolean))})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"Tags (comma separated)"}),e.jsx("input",{className:"form-control",value:(s.tags||[]).join(", "),onChange:a=>n("tags",a.target.value.split(",").map(l=>l.trim()).filter(Boolean))})]}),e.jsx("div",{className:"col-12 d-flex gap-2",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:p,children:p?"Saving…":"Save profile"})})]})]})})]})}export{_ as default};
