import{c as f,a as g,j as e,M as A,w as N}from"./index-BuQ02B8O.js";import{b as U,r as i,L as T}from"./vendor-DW3XjTa1.js";import{B}from"./Breadcrumb-DEgLa9As.js";import"./firebase-ARhtPVQA.js";import"./utils-B2rxisVD.js";const w="/api/data/startups";function M(){const C=U(),[m,u]=i.useState(!1),[y,c]=i.useState(""),[x,p]=i.useState(""),b=i.useMemo(()=>sessionStorage.getItem("tenantId")||"vendor",[]),[E,j]=i.useState(!1),[s,h]=i.useState({id:"",name:"",elevatorPitch:"",productsServices:"",employeeCount:0,contactEmail:"",phone:"",website:"",country:"",city:"",addressLine:"",categories:[],tags:[]});function n(a,t){h(r=>({...r,[a]:t}))}i.useEffect(()=>{(async()=>{c("");const a=f.currentUser,t=(a?.email||"").toLowerCase();if(t)try{const r=await g.get(w),o=(Array.isArray(r.data)?r.data:r.data?.items||[]).find(l=>l.ownerUid&&l.ownerUid===a.uid||(l.contactEmail||l.email||"").toLowerCase()===t);h(o?{id:o.id||"",name:o.name||"",elevatorPitch:o.elevatorPitch||"",productsServices:o.productsServices||"",employeeCount:Number(o.employeeCount||0),contactEmail:(o.contactEmail||t).toLowerCase(),phone:o.phone||"",website:o.website||"",country:o.country||"",city:o.city||"",addressLine:o.addressLine||"",categories:Array.isArray(o.categories)?o.categories:[],tags:Array.isArray(o.tags)?o.tags:[]}:l=>({...l,contactEmail:t}));try{const l=await g.get("/api/data/vendors"),L=(Array.isArray(l.data)?l.data:l.data?.items||[]).find(v=>v.ownerUid&&v.ownerUid===a.uid||(v.contactEmail||v.email||"").toLowerCase()===t);j(!!L)}catch{}}catch(r){c(r?.response?.data?.message||r?.message||"Failed to load startup profile")}})()},[b]);async function S(a){a?.preventDefault?.(),u(!0),c(""),p("");try{const t=f.currentUser;if(!t)throw new Error("Please sign in");const r={id:s.id||t.uid,name:s.name,elevatorPitch:s.elevatorPitch,productsServices:s.productsServices,employeeCount:Number(s.employeeCount||0),contactEmail:(s.contactEmail||t.email||"").toLowerCase(),ownerUid:t.uid,phone:s.phone,website:s.website,country:s.country,city:s.city,addressLine:s.addressLine,categories:s.categories,tags:s.tags};if(!r.name)throw new Error("Business name is required");await g.post(w,r),p("Saved");try{await N({action:"STARTUP_UPDATE",userEmail:r.contactEmail,targetType:"startup",targetId:r.id})}catch{}h(d=>({...d,id:r.id}))}catch(t){c(t?.response?.data?.message||t?.message||"Failed to save")}finally{u(!1)}}async function P(){c(""),p(""),u(!0);try{const a=f.currentUser;if(!a)throw new Error("Please sign in");const t=(s.contactEmail||a.email||"").toLowerCase(),r=[s.elevatorPitch||"",s.productsServices||""].filter(Boolean).join(`

`),d={id:a.uid,name:s.name,contactEmail:t,ownerUid:a.uid,phone:s.phone,website:s.website,description:r,country:s.country,city:s.city,addressLine:s.addressLine,categories:s.categories,tags:s.tags,status:"pending",kycStatus:"pending"};if(!d.name)throw new Error("Business name is required to create a vendor.");await g.post("/api/data/vendors",d);try{await N({action:"VENDOR_CREATE_FROM_STARTUP",userEmail:t,targetType:"vendor",targetId:a.uid})}catch{}p("Vendor profile created. Redirecting…"),j(!0),setTimeout(()=>C("/profile-vendor",{replace:!0}),600)}catch(a){c(a?.response?.data?.message||a?.message||"Failed to create vendor from startup")}finally{u(!1)}}return e.jsxs(A,{children:[e.jsx(B,{title:"Startup Profile"}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("div",{className:"small text-muted",children:["Tenant: ",e.jsx("code",{children:b})]}),e.jsx("div",{className:"d-flex gap-2",children:E?e.jsx(T,{to:"/profile-vendor",className:"btn btn-sm btn-outline-primary",children:"Go to Vendor Profile"}):e.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:P,disabled:m,children:m?"Creating…":"Create Vendor from Startup"})})]}),y&&e.jsx("div",{className:"alert alert-danger",children:y}),x&&e.jsx("div",{className:"alert alert-success",children:x}),e.jsxs("form",{onSubmit:S,className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Business name"}),e.jsx("input",{className:"form-control",value:s.name,onChange:a=>n("name",a.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Website"}),e.jsx("input",{className:"form-control",value:s.website,onChange:a=>n("website",a.target.value)})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"Elevator pitch"}),e.jsx("textarea",{className:"form-control",rows:3,value:s.elevatorPitch,onChange:a=>n("elevatorPitch",a.target.value)})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"Products / Services"}),e.jsx("textarea",{className:"form-control",rows:4,value:s.productsServices,onChange:a=>n("productsServices",a.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Employees"}),e.jsx("input",{type:"number",min:0,className:"form-control",value:s.employeeCount,onChange:a=>n("employeeCount",a.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Phone"}),e.jsx("input",{className:"form-control",value:s.phone,onChange:a=>n("phone",a.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Contact email"}),e.jsx("input",{type:"email",className:"form-control",value:s.contactEmail,onChange:a=>n("contactEmail",a.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Country"}),e.jsx("input",{className:"form-control",value:s.country,onChange:a=>n("country",a.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"City"}),e.jsx("input",{className:"form-control",value:s.city,onChange:a=>n("city",a.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Address"}),e.jsx("input",{className:"form-control",value:s.addressLine,onChange:a=>n("addressLine",a.target.value)})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"Categories (comma separated)"}),e.jsx("input",{className:"form-control",value:(s.categories||[]).join(", "),onChange:a=>n("categories",a.target.value.split(",").map(t=>t.trim()).filter(Boolean))})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"Tags (comma separated)"}),e.jsx("input",{className:"form-control",value:(s.tags||[]).join(", "),onChange:a=>n("tags",a.target.value.split(",").map(t=>t.trim()).filter(Boolean))})]}),e.jsx("div",{className:"col-12 d-flex gap-2",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:m,children:m?"Saving…":"Save profile"})})]})]})})]})}export{M as default};
