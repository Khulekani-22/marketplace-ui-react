const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BannerInnerTwo-CFvZTN5k.js","assets/index-DGewQ82u.js","assets/index-BXSesTeZ.css"])))=>i.map(i=>d[i]);
import{r as x,a as ye,c as A,j as e,R as Q,w as T,b as O,_ as Ne}from"./index-DGewQ82u.js";import{M as we,u as Se}from"./MasterLayout-XUilH42m.js";import{u as Ce}from"./useAppSync-DNmMczzp.js";import"./iconify-Ccvq_BdY.js";const Ie="/api/lms",Ee=Q.lazy(()=>Ne(()=>import("./BannerInnerTwo-CFvZTN5k.js"),__vite__mapDeps([0,1,2]))),se="listings_admin_draft_v1",q="listings_admin_undo_v1",oe="listings_admin_history_cache_v1";function R(t){try{return typeof t=="string"?JSON.parse(t):t}catch{return null}}function _(t){return JSON.parse(JSON.stringify(t))}function ie(){return Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,8)}function Ae(t){return new Date(t).toLocaleString()}function ke(t=[]){const o=t.length,h=t.reduce((v,C)=>{const y=(C.status||"unknown").toLowerCase();return v[y]=(v[y]||0)+1,v},{}),p=t.filter(v=>!!v.isFeatured).length,j=new Set(t.map(v=>(v.category||"").trim()).filter(Boolean)).size;return{total:o,featured:p,categories:j,byStatus:h}}function de(t){const o=t.vendorId||t.id||t.uid||(t.email?t.email.toLowerCase():ie());return{id:o,vendorId:t.vendorId||o,companyName:t.companyName||t.name||t.displayName||"",name:t.name||t.companyName||"",email:(t.email||t.contactEmail||"").toLowerCase(),website:t.website||"",phone:t.phone||t.phoneNumber||"",avatar:t.avatar||t.logoUrl||"",status:(t.status||"").toLowerCase(),kycStatus:(t.kycStatus||"").toLowerCase(),raw:t}}function Le(t){const o=[Array.isArray(t==null?void 0:t.startups)&&t.startups,Array.isArray(t==null?void 0:t.vendors)&&t.vendors,Array.isArray(t==null?void 0:t.companies)&&t.companies,Array.isArray(t==null?void 0:t.profiles)&&t.profiles].filter(Boolean);return ne(o.flat().map(de))}function ne(t=[]){const o=new Map;return t.forEach(h=>{const p=(h.email||"").toLowerCase()||h.vendorId||h.id;if(p)if(!o.has(p))o.set(p,h);else{const v={...o.get(p)};for(const[C,y]of Object.entries(h))y==null||y===""||(v[C]=y);o.set(p,v)}}),Array.from(o.values())}function Te(t=[]){const o={},h={};return t.forEach(p=>{o[p.vendorId]=p,p.email&&(h[p.email]=p)}),{byId:o,byEmail:h}}function re(t){var o;return{id:t.id??ie(),title:t.title??"",category:t.category??"",vendor:t.vendor??t.vendorName??"",vendorId:t.vendorId??"",contactEmail:(t.contactEmail||t.email||"").toLowerCase(),price:typeof t.price=="number"?t.price:Number(t.price||0),rating:typeof t.rating=="number"?t.rating:Number(t.rating||0),reviewCount:typeof t.reviewCount=="number"?t.reviewCount:Number(t.reviewCount||((o=t.reviews)==null?void 0:o.length)||0),imageUrl:t.imageUrl??t.thumbnail??"",aiHint:t.aiHint??"",listingType:t.listingType??"service",status:t.status??"approved",isFeatured:!!t.isFeatured,description:t.description??"",reviews:Array.isArray(t.reviews)?t.reviews:[]}}function Ve(){var ce;const t=x.useMemo(()=>sessionStorage.getItem("tenantId")||"vendor",[]),[o,h]=x.useState(()=>R(localStorage.getItem(se))??ye),p=x.useMemo(()=>((o==null?void 0:o.services)||[]).map(re),[o]),[j,v]=x.useState(()=>Le(o));x.useEffect(()=>{let a=!0;return(async()=>{try{const r=await A.get("/api/data/vendors").then(i=>i.data||[]),n=Array.isArray(r)?ne(r.map(de)):[];a&&v(i=>ne([...i||[],...n]))}catch{}})(),()=>{a=!1}},[t]);const{byId:C,byEmail:y}=x.useMemo(()=>Te(j),[j]),[k,U]=x.useState(()=>JSON.stringify(o,null,2)),[H,B]=x.useState("visual"),[M,E]=x.useState(!1),[G,z]=x.useState(null),[l,w]=x.useState(null),D=x.useRef([]),[X,S]=x.useState(()=>R(localStorage.getItem(oe))??[]),Z=x.useMemo(()=>["All",...Array.from(new Set(p.map(r=>(r.category||"").trim()).filter(Boolean)))],[p]),[$,ee]=x.useState("All"),[m,N]=x.useState("All"),[I,te]=x.useState(""),[P,L]=x.useState(((ce=p[0])==null?void 0:ce.id)||""),F=x.useMemo(()=>p.filter(a=>!($!=="All"&&(a.category||"").trim()!==$||m!=="All"&&(a.status||"").toLowerCase()!==m||I&&!`${a.title} ${a.vendor} ${a.vendorId} ${a.contactEmail} ${a.category}`.toLowerCase().includes(I.toLowerCase()))),[p,$,m,I]),f=x.useMemo(()=>p.find(a=>a.id===P),[p,P]);function s(a){z(a),setTimeout(()=>z(null),2500)}function d(a){const r=R(localStorage.getItem(q))??[];r.unshift(a);const n=r.slice(0,10);localStorage.setItem(q,JSON.stringify(n)),D.current=n}function b(a){d(o),h(a),U(JSON.stringify(a,null,2)),localStorage.setItem(se,JSON.stringify(a))}function ae(a){var i,c;if(!f)return;const r=_(o),n=r.services.findIndex(u=>u.id===f.id);if(n>=0){r.services[n]={...re(r.services[n]),...a},b(r);try{const u=f.status;typeof a.status<"u"&&a.status!==u?T({action:"LISTING_STATUS_CHANGE",userEmail:(i=O.currentUser)==null?void 0:i.email,targetType:"listing",targetId:f.id,metadata:{from:u,to:a.status,title:f.title}}):T({action:"LISTING_UPDATE",userEmail:(c=O.currentUser)==null?void 0:c.email,targetType:"listing",targetId:f.id,metadata:{patch:a}})}catch{}}}function K(){var i;const a=prompt("Service title?");if(!a)return;const r=_(o),n=Math.max(0,...r.services.map(c=>Number(c.id)).filter(c=>!Number.isNaN(c)))+1;r.services.push(re({id:String(n),title:a,vendor:"",vendorId:"",contactEmail:"",category:"",price:0,rating:0,reviewCount:0,imageUrl:"",listingType:"service",status:"approved",isFeatured:!1,description:"",aiHint:"",reviews:[]})),b(r),L(String(n));try{T({action:"LISTING_CREATE",userEmail:(i=O.currentUser)==null?void 0:i.email,targetType:"listing",targetId:String(n),metadata:{title:a}})}catch{}}function W(){var n;if(!f)return;const a=_(o),r=_(f);r.id=ie(),r.title=`${r.title} (Copy)`,a.services.push(r),b(a),L(r.id);try{T({action:"LISTING_DUPLICATE",userEmail:(n=O.currentUser)==null?void 0:n.email,targetType:"listing",targetId:r.id,metadata:{sourceId:f.id,title:r.title}})}catch{}}function me(){var r,n;if(!f||!window.confirm(`Delete "${f.title}"?`))return;const a=_(o);a.services=a.services.filter(i=>i.id!==f.id),b(a),L(((r=a.services[0])==null?void 0:r.id)||"");try{T({action:"LISTING_DELETE",userEmail:(n=O.currentUser)==null?void 0:n.email,targetType:"listing",targetId:f.id,metadata:{title:f.title}})}catch{}}function ue(){const a=D.current.length>0?D.current:R(localStorage.getItem(q))??[];if(!a.length)return;const r=a.shift();D.current=a,localStorage.setItem(q,JSON.stringify(a)),h(r),U(JSON.stringify(r,null,2))}const{appData:le}=Ce();x.useEffect(()=>{(async()=>{var a,r;E(!0);try{const n=le;n&&Object.keys(n).length&&(h(n),U(JSON.stringify(n,null,2)),localStorage.setItem(se,JSON.stringify(n)),L(((r=(a=n==null?void 0:n.services)==null?void 0:a[0])==null?void 0:r.id)||"")),await J()}catch{}finally{E(!1)}})()},[le,J]);const J=x.useCallback(async()=>{try{const r=(await A.get("/api/lms/checkpoints").then(n=>n.data)).items??[];S(r),localStorage.setItem(oe,JSON.stringify(r.slice(0,2)))}catch{}},[]);async function he(){var a;w(null),E(!0);try{let r=o;try{const n=await A.get("/api/lms/live").then(u=>u.data),i=_(o),c=Object.fromEntries(((n==null?void 0:n.services)||[]).map(u=>[String(u.id),u]));i.services=(i.services||[]).map(u=>{const g=c[String(u.id)];return g?{...u,reviews:Array.isArray(g.reviews)?g.reviews:u.reviews,reviewCount:typeof g.reviewCount=="number"?g.reviewCount:Number(g.reviewCount||(Array.isArray(g.reviews)?g.reviews.length:0)||u.reviewCount||0),rating:typeof g.rating=="number"?g.rating:Number(g.rating||u.rating||0),lastReviewedAt:g.lastReviewedAt||u.lastReviewedAt}:u}),r=i,b(i)}catch{}await A.put("/api/lms/publish",{data:r}),s("Published listings to live");try{await T({action:"LISTINGS_PUBLISH",userEmail:(a=O.currentUser)==null?void 0:a.email,targetType:"appData",targetId:"services",metadata:{count:p.length}})}catch{}await J()}catch(r){w(r.message||"Publish failed")}finally{E(!1)}}async function pe(a){var r;try{await A.post("/api/lms/checkpoints",{message:a||"",data:o}),s("Checkpoint saved");try{await T({action:"LISTINGS_CHECKPOINT",userEmail:(r=O.currentUser)==null?void 0:r.email,targetType:"services",targetId:"checkpoint",metadata:{message:a||""}})}catch{}await J()}catch(n){w(n.message||"Failed to save checkpoint")}}async function ge(a){if(window.confirm("Restore this snapshot to LIVE appData.json?"))try{await A.post(`/api/lms/restore/${a}`),s("Restored snapshot"),await J();const r=await A.get("/api/lms/live").then(n=>n.data);b(r)}catch(r){w(r.message||"Restore failed")}}async function xe(){var a;if(window.confirm("Delete ALL checkpoints on the server?"))try{await A.delete("/api/lms/checkpoints"),s("Cleared history");try{await T({action:"LISTINGS_HISTORY_CLEAR",userEmail:(a=O.currentUser)==null?void 0:a.email,targetType:"services",targetId:"history"})}catch{}await J()}catch(r){w(r.message||"Failed to clear")}}const V=ke(p);function be(a){const r=a.vendorId&&C[a.vendorId],n=a.contactEmail&&y[a.contactEmail],i=r||n||null,c=(i==null?void 0:i.companyName)||(i==null?void 0:i.name)||a.vendor||a.contactEmail||"â€”",u=(i==null?void 0:i.email)||a.contactEmail||"",g=(i==null?void 0:i.vendorId)||a.vendorId||"",Y=g?`/profile-vendor?vendorId=${encodeURIComponent(g)}`:null;return{v:i,name:c,email:u,vendorId:g,profileHref:Y}}function ve(a){return!a||typeof a!="object"?"File is not valid JSON.":Array.isArray(a.services)?null:"JSON must include an array: services[]."}async function fe(a){var n,i,c;w(null);const r=(n=a.target.files)==null?void 0:n[0];if(r)try{const u=await r.text(),g=R(u),Y=ve(g);if(Y){w(Y);return}b(g),L(((c=(i=g==null?void 0:g.services)==null?void 0:i[0])==null?void 0:c.id)||""),s(`Imported ${r.name}`)}catch(u){w("Import failed: "+((u==null?void 0:u.message)||"unknown error"))}finally{a.target.value=""}}function je(){try{const a=new Blob([JSON.stringify(o,null,2)],{type:"application/json;charset=utf-8"}),r=URL.createObjectURL(a),n=document.createElement("a");n.href=r;const i=new Date().toISOString().replace(/[:.]/g,"-");n.download=`appData-${t}-${i}.json`,document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(r),s("Exported current working copy")}catch(a){w("Export failed: "+((a==null?void 0:a.message)||"unknown error"))}}return e.jsx(we,{children:e.jsxs("div",{className:"container py-4",children:[e.jsx(Q.Suspense,{fallback:null,children:e.jsx("div",{className:"row mb-3",children:e.jsx(Ee,{})})}),e.jsxs("div",{className:"row g-3 mb-3",children:[e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 bg-animated-gradient text-center p-3",children:[e.jsx("i",{className:"bi bi-bag-check text-primary fs-3 mb-2"}),e.jsx("h6",{className:"fw-bold mb-0",children:V.total}),e.jsx("small",{className:"text-muted",children:"Services"})]})}),e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 text-center p-3",children:[e.jsx("i",{className:"bi bi-grid text-success fs-3 mb-2"}),e.jsx("h6",{className:"fw-bold mb-0",children:V.categories}),e.jsx("small",{className:"text-muted",children:"Categories"})]})}),e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 text-center p-3",children:[e.jsx("i",{className:"bi bi-star-fill text-warning fs-3 mb-2"}),e.jsx("h6",{className:"fw-bold mb-0",children:V.featured}),e.jsx("small",{className:"text-muted",children:"Featured"})]})}),e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 p-3",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-flag text-danger fs-4","aria-hidden":"true"}),e.jsx("div",{className:"fw-semibold",children:"Status"})]}),e.jsxs("span",{className:"badge text-bg-light",children:[Object.values(V.byStatus||{}).reduce((a,r)=>a+r,0)," total"]})]}),(()=>{var i;const a=c=>c==="approved"?"success":c==="pending"?"warning":c==="rejected"?"danger":"secondary",r=Object.entries(V.byStatus||{}),n=r.reduce((c,[,u])=>c+u,0);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"progress",style:{height:10},"aria-label":"Status proportions",children:r.map(([c,u])=>{const g=n?Math.round(u/n*100):0;return e.jsx("div",{className:`progress-bar bg-${a(c)}`,role:"progressbar",style:{width:`${g}%`},"aria-label":`${c} ${g}%`,"aria-valuenow":g,"aria-valuemin":0,"aria-valuemax":100,title:`${c}: ${u} (${g}%)`},c)})}),e.jsx("div",{className:"d-flex flex-wrap gap-2 mt-3",children:r.length?r.map(([c,u])=>e.jsxs("span",{className:`d-inline-flex align-items-center gap-2 px-2 py-1 rounded-pill border border-${a(c)} text-${a(c)} bg-${a(c)}-subtle small`,title:`${c}: ${u}`,"aria-label":`${c}: ${u}`,children:[e.jsx("i",{className:`bi ${c==="approved"?"bi-check-circle":c==="pending"?"bi-hourglass-split":c==="rejected"?"bi-x-octagon":"bi-dot"} `,"aria-hidden":"true"}),e.jsx("span",{className:"text-capitalize",children:c}),e.jsx("span",{className:"badge text-bg-light",children:u})]},c)):e.jsx("span",{className:"text-muted small",children:"No status data"})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsx("small",{className:"text-muted",children:"Total Approved: "}),e.jsxs("span",{className:"fw-semibold",children:[n?Math.round((((i=V.byStatus)==null?void 0:i.approved)??0)/n*100):0,"%"]})]})]})})()]})})]}),e.jsxs("div",{className:"pt-4 d-flex gap-2 mb-3",children:[e.jsxs("label",{className:"btn btn-light mb-0 d-none",children:["Import JSON",e.jsx("input",{type:"file",accept:"application/json",hidden:!0,onChange:fe})]}),e.jsx("button",{className:"btn rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-primary-700 text-hover-white",onClick:je,children:"Export Current"}),e.jsx("button",{className:"btn rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-primary-700 text-hover-white",disabled:M,onClick:async()=>{w(null),E(!0);try{const a=await A.get("/api/lms/live").then(i=>i.data),r=_(o),n=Object.fromEntries(((a==null?void 0:a.services)||[]).map(i=>[String(i.id),i]));r.services=(r.services||[]).map(i=>{const c=n[String(i.id)];return c?{...i,reviews:Array.isArray(c.reviews)?c.reviews:i.reviews,reviewCount:typeof c.reviewCount=="number"?c.reviewCount:Number(c.reviewCount||(Array.isArray(c.reviews)?c.reviews.length:0)||i.reviewCount||0),rating:typeof c.rating=="number"?c.rating:Number(c.rating||i.rating||0),lastReviewedAt:c.lastReviewedAt||i.lastReviewedAt}:i}),b(r),s("Synced reviews from live")}catch(a){w(a.message||"Failed to sync reviews")}finally{E(!1)}},title:"Fetch live data and merge review counts and lists",children:"Sync reviews from live"}),e.jsx("button",{className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:he,disabled:M,title:"Write working copy to live appData.json on the server",children:M?"Publishingâ€¦":"Publish to live"})]}),G&&e.jsx("div",{className:"alert alert-success py-2",children:G}),l&&e.jsx("div",{className:"alert alert-danger py-2",children:l}),e.jsx(Oe,{onSave:pe,onClear:xe,onUndo:ue,disabled:M}),e.jsxs("div",{className:"d-flex gap-3",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("ul",{className:"nav nav-tabs mb-3",children:[e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${H==="visual"?"active":""}`,onClick:()=>B("visual"),children:"Visual editor"})}),e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${H==="json"?"active":""}`,onClick:()=>B("json"),children:"JSON editor"})})]}),H==="json"?e.jsx($e,{text:k,setText:U,onApply:()=>{const a=R(k);if(!a){w("Invalid JSON");return}b(a),s("Applied JSON to working copy")}}):e.jsx(_e,{services:p,vendors:j,vendorsById:C,vendorsByEmail:y,resolveVendor:be,category:$,setCategory:ee,status:m,setStatus:N,allCategories:Z,search:I,setSearch:te,filtered:F,selectedId:P,setSelectedId:L,selected:f,addService:K,duplicateService:W,deleteService:me,updateService:ae})]}),e.jsx("div",{style:{width:380},children:e.jsx(Ue,{items:X,onRestore:ge})})]})]})})}function Oe({onSave:t,onClear:o,onUndo:h,disabled:p}){const[j,v]=x.useState("");return e.jsxs("div",{className:"d-flex align-items-center gap-2 mb-3",children:[e.jsx("input",{className:"form-control",placeholder:"Checkpoint message (e.g. 'Tweaked pricing & featured items')",value:j,onChange:C=>v(C.target.value)}),e.jsx("button",{className:"btn btn-sm rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:()=>t(j),disabled:p,children:"Save checkpoint"}),e.jsx("button",{className:"btn btn-sm rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-danger-700 text-hover-white",onClick:o,children:"Clear history"}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:h,children:"Undo"})]})}function $e({text:t,setText:o,onApply:h}){return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header fw-semibold",children:"Working copy (JSON)"}),e.jsxs("div",{className:"card-body",children:[e.jsx("textarea",{value:t,onChange:p=>o(p.target.value),rows:22,spellCheck:!1,className:"form-control font-monospace"}),e.jsxs("div",{className:"d-flex justify-content-between mt-2",children:[e.jsxs("small",{className:"text-muted",children:["Tip: Press ",e.jsx("kbd",{children:"âŒ˜/Ctrl"}),"+",e.jsx("kbd",{children:"A"})," then ",e.jsx("kbd",{children:"âŒ˜/Ctrl"}),"+",e.jsx("kbd",{children:"C"})," to copy."]}),e.jsx("button",{className:"btn btn-outline-primary",onClick:h,children:"Apply JSON"})]})]})]})}function _e(t){const{services:o,vendors:h,vendorsById:p,vendorsByEmail:j,resolveVendor:v,category:C,setCategory:y,status:k,setStatus:U,allCategories:H,search:B,setSearch:M,filtered:E,selectedId:G,setSelectedId:z,selected:l,addService:w,duplicateService:D,deleteService:X,updateService:S}=t,Z=x.useMemo(()=>{const s=d=>d.status==="active"||d.kycStatus==="approved";return h.filter(s).map(d=>({id:d.vendorId,label:`${d.companyName||d.name||"(unnamed)"}${d.email?" â€” "+d.email:""}`}))},[h]);function $(s){const d=p[s];S({vendorId:s||"",vendor:d&&(d.companyName||d.name)||"",contactEmail:(d==null?void 0:d.email)||(l==null?void 0:l.contactEmail)||""})}const ee=Q.useMemo(()=>{if(!l)return"";if(l.vendorId)return l.vendorId;const s=(l.contactEmail||"").toLowerCase(),d=s?j[s]:null;return(d==null?void 0:d.vendorId)||""},[l,j]),m=l?v(l):null,[N,I]=Q.useState({open:!1,subject:"",content:"",sending:!1,err:null,done:!1}),{syncMessagesToLive:te,refresh:P}=Se();function L(){if(!l)return;const s=`Listing feedback: ${l.title}`,d=`Hello ${(m==null?void 0:m.name)||"Vendor"},

Regarding your listing "${l.title}" (ID: ${l.id}).

Reason / guidance:
- 

Please update and resubmit when ready.

Regards,
Admin`;I({open:!0,subject:s,content:d,sending:!1,err:null,done:!1})}function F(){I({open:!1,subject:"",content:"",sending:!1,err:null,done:!1})}async function f(s){var d;if((d=s==null?void 0:s.preventDefault)==null||d.call(s),!(!l||!N.content.trim())){I(b=>({...b,sending:!0,err:null}));try{await A.post("/api/messages",{listingId:l.id,listingTitle:l.title,vendorId:l.vendorId||"",vendorEmail:(m==null?void 0:m.email)||"",subject:N.subject,content:N.content}),I(b=>({...b,sending:!1,done:!0}));try{await P(),await te()}catch{}setTimeout(()=>F(),1200)}catch(b){I(ae=>{var K,W;return{...ae,sending:!1,err:((W=(K=b==null?void 0:b.response)==null?void 0:K.data)==null?void 0:W.message)||(b==null?void 0:b.message)||"Failed to send"}})}}}return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"fw-semibold",children:"Visual editor"}),e.jsx("span",{className:"text-muted small",children:"CRUD for services (listings)"})]}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row g-2 align-items-end mb-3",children:[e.jsxs("div",{className:"col-12 col-md-3",children:[e.jsx("label",{className:"form-label",children:"Category"}),e.jsx("select",{className:"form-select",value:C,onChange:s=>y(s.target.value),children:H.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"col-12 col-md-3",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsx("select",{className:"form-select",value:k,onChange:s=>U(s.target.value),children:["All","approved","pending","rejected"].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"col",children:[e.jsx("label",{className:"form-label",children:"Search"}),e.jsx("input",{className:"form-control",placeholder:"Title, vendor, email, vendorId, categoryâ€¦",value:B,onChange:s=>M(s.target.value)})]}),e.jsx("div",{className:"col-auto",children:e.jsx("button",{className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6 w-100",onClick:w,children:"+ Add service"})}),e.jsx("div",{className:"col-auto",children:e.jsx("button",{className:"btn rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-primary-700 text-hover-white w-100",onClick:D,disabled:!l,children:"Duplicate"})}),e.jsx("div",{className:"col-auto",children:e.jsx("button",{className:"btn btn-danger-500 rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-danger-700 text-hover-white w-100",onClick:X,disabled:!l,children:"Delete"})})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-4",children:[e.jsxs("div",{className:"list-group mb-2",style:{maxHeight:420,overflow:"auto"},children:[E.map(s=>{const d=v(s);return e.jsxs("button",{className:"list-group-item list-group-item-action d-flex justify-content-between align-items-center "+(G===s.id?"active":""),onClick:()=>z(s.id),title:d.email||"",children:[e.jsxs("span",{className:"text-truncate",children:[s.title,e.jsx("span",{className:"text-muted",children:" Â· "}),e.jsx("span",{className:"text-truncate",children:d.name})]}),d.profileHref?e.jsx("a",{className:"badge bg-light text-dark text-decoration-none",href:d.profileHref,target:"_blank",rel:"noreferrer",onClick:b=>b.stopPropagation(),title:"Open vendor profile",children:d.vendorId}):e.jsx("span",{className:"badge bg-light text-dark",children:s.category||"â€”"})]},s.id)}),!E.length&&e.jsx("div",{className:"text-muted small p-2",children:"No services match your filters."})]}),e.jsxs("div",{className:"small text-muted",children:["Showing ",E.length," of ",o.length]})]}),e.jsx("div",{className:"col",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Title"}),e.jsx("input",{className:"form-control",value:l.title,onChange:s=>S({title:s.target.value})})]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Category"}),e.jsx("input",{className:"form-control",value:l.category||"",onChange:s=>S({category:s.target.value})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Listing type"}),e.jsxs("select",{className:"form-select",value:l.listingType||"service",onChange:s=>S({listingType:s.target.value}),children:[e.jsx("option",{value:"service",children:"Service"}),e.jsx("option",{value:"saas",children:"SaaS"})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsxs("select",{className:"form-select",value:l.status||"approved",onChange:s=>S({status:s.target.value}),children:[e.jsx("option",{value:"approved",children:"approved"}),e.jsx("option",{value:"pending",children:"pending"}),e.jsx("option",{value:"rejected",children:"rejected"})]})]})]}),e.jsxs("div",{className:"row g-3 mt-1",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Bind to vendor (by company or email)"}),e.jsxs("select",{className:"form-select",value:ee,onChange:s=>$(s.target.value),children:[e.jsx("option",{value:"",children:"â€”"}),Z.map(s=>e.jsx("option",{value:s.id,children:s.label},s.id))]}),e.jsxs("div",{className:"form-text",children:["Saves both ",e.jsx("code",{children:"vendorId"})," and display"," ",e.jsx("code",{children:"vendor"})," name on the listing."]})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Contact email"}),e.jsx("input",{className:"form-control",value:l.contactEmail||"",onChange:s=>S({contactEmail:s.target.value.toLowerCase()}),onBlur:()=>{if(!l)return;const s=(l.contactEmail||"").toLowerCase(),d=s?j[s]:null;d&&l.vendorId!==d.vendorId&&$(d.vendorId)}})]}),e.jsx("div",{className:"col-md-3 d-flex align-items-end",children:m!=null&&m.profileHref?e.jsx("a",{className:"btn btn-outline-primary w-100",href:m.profileHref,target:"_blank",rel:"noreferrer",title:"Open vendor profile",children:"View profile"}):e.jsx("button",{className:"btn btn-outline-secondary w-100",disabled:!0,children:"No profile linked"})})]}),e.jsxs("div",{className:"row g-3 mt-1",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Price (R)"}),e.jsx("input",{type:"number",min:"0",className:"form-control",value:Number(l.price||0),onChange:s=>S({price:Number(s.target.value||0)})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Rating (0â€“5)"}),e.jsx("input",{type:"number",min:"0",max:"5",step:"0.1",className:"form-control",value:Number(l.rating||0),onChange:s=>S({rating:Number(s.target.value||0)})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Review count"}),e.jsx("input",{type:"number",min:"0",className:"form-control",value:Number(l.reviewCount||0),onChange:s=>S({reviewCount:Number(s.target.value||0)})})]})]}),e.jsxs("div",{className:"row g-3 mt-1",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsx("label",{className:"form-label",children:"Image URL"}),e.jsx("input",{className:"form-control",value:l.imageUrl||"",onChange:s=>S({imageUrl:s.target.value})})]}),e.jsx("div",{className:"col-md-4 d-flex align-items-end gap-3",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{id:"isFeatured",type:"checkbox",className:"form-check-input",checked:!!l.isFeatured,onChange:s=>S({isFeatured:!!s.target.checked})}),e.jsx("label",{htmlFor:"isFeatured",className:"form-check-label",children:"Featured"})]})})]}),e.jsxs("div",{className:"mb-3 mt-2",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("textarea",{className:"form-control",rows:4,value:l.description||"",onChange:s=>S({description:s.target.value})})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("div",{className:"text-secondary small",children:["Vendor: ",e.jsx("strong",{children:(m==null?void 0:m.name)||"Unknown"}),m!=null&&m.email?` Â· ${m.email}`:""]}),e.jsx("div",{children:e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:L,disabled:!(m!=null&&m.email)&&!(l!=null&&l.vendorId),children:"Message Vendor"})})]}),e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("div",{className:"text-muted small mb-1",children:"Card preview"}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("img",{src:l.imageUrl||"/assets/images/placeholder-4x3.png",alt:"",style:{width:120,height:72,objectFit:"cover",borderRadius:6}}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:l.title||"Untitled service"}),e.jsxs("div",{className:"text-muted small",children:[(m==null?void 0:m.name)||"Vendor",m!=null&&m.email?` Â· ${m.email}`:""]}),e.jsxs("div",{className:"small",children:["R",Number(l.price||0).toLocaleString()," Â· â˜…"," ",Number(l.rating||0).toFixed(1)]})]})]})]})]}):e.jsx("div",{className:"text-muted mt-2",children:"Select a service to edit details."})})]})]}),N.open&&e.jsx("div",{className:"position-fixed top-0 start-0 w-100 h-100",style:{background:"rgba(0,0,0,0.5)",zIndex:1070},onClick:s=>s.target===s.currentTarget&&F(),children:e.jsxs("div",{className:"card",style:{maxWidth:560,margin:"10vh auto"},children:[e.jsxs("div",{className:"card-header d-flex align-items-center justify-content-between",children:[e.jsx("h6",{className:"mb-0",children:"Message Vendor"}),e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:F,children:"Close"})]}),e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:"card-body",children:[N.err&&e.jsx("div",{className:"alert alert-danger py-2 mb-2",children:N.err}),N.done&&e.jsx("div",{className:"alert alert-success py-2 mb-2",children:"Sent"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Subject"}),e.jsx("input",{className:"form-control",value:N.subject,onChange:s=>I(d=>({...d,subject:s.target.value}))})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Message"}),e.jsx("textarea",{className:"form-control",rows:6,value:N.content,onChange:s=>I(d=>({...d,content:s.target.value}))}),e.jsxs("div",{className:"text-secondary small mt-1",children:["To: ",(m==null?void 0:m.email)||(l==null?void 0:l.vendorId)||"Vendor"]})]})]}),e.jsxs("div",{className:"card-footer d-flex justify-content-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:F,disabled:N.sending,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:N.sending||!N.content.trim(),children:N.sending?"Sendingâ€¦":"Send"})]})]})]})})]})}function Ue({items:t,onRestore:o}){return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header fw-semibold d-flex justify-content-between",children:[e.jsx("span",{children:"Version history"}),e.jsx("span",{className:"text-muted small",children:"Latest checkpoints"})]}),e.jsxs("div",{className:"list-group list-group-flush",children:[!(t!=null&&t.length)&&e.jsxs("div",{className:"list-group-item text-muted small",children:["No checkpoints yet.",e.jsx("div",{className:"mt-1",children:"Offline cache keeps the two most recent checkpoints."})]}),t==null?void 0:t.map(h=>{var p,j,v,C,y,k;return e.jsx("div",{className:"list-group-item",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:h.message||"(no message)"}),e.jsx("div",{className:"text-muted small",children:Ae(h.ts)}),e.jsxs("div",{className:"text-muted small",children:["Î” Cohorts: ",((p=h.delta)==null?void 0:p.cohorts)>=0?"+":"",((j=h.delta)==null?void 0:j.cohorts)??0," Â· Î” Courses:"," ",((v=h.delta)==null?void 0:v.courses)>=0?"+":"",((C=h.delta)==null?void 0:C.courses)??0," Â· Î” Lessons:"," ",((y=h.delta)==null?void 0:y.lessons)>=0?"+":"",((k=h.delta)==null?void 0:k.lessons)??0]})]}),e.jsxs("div",{className:"d-flex align-items-start gap-2",children:[e.jsx("button",{className:"btn btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6 btn-sm",title:"Restore snapshot to LIVE",onClick:()=>o(h.id),children:"Restore"}),e.jsx("a",{className:"btn btn-outline-secondary btn-sm",title:"Download snapshot JSON",href:`${Ie}/checkpoints/${h.id}`,target:"_blank",rel:"noreferrer",children:"Download"})]})]})},h.id)})]})]})}export{Ve as default};
