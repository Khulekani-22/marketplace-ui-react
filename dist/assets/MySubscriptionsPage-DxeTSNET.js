import{r as n,j as e,b as j,a as y}from"./index-DEDmLTnF.js";import{M as v}from"./MasterLayout-BIL_7LDZ.js";import{B as N}from"./Breadcrumb-V4NnE-RL.js";import{f as S,u as w}from"./subscriptions-B2ojLcQp.js";import"./iconify-Bdhvh65v.js";function U(){const[f,l]=n.useState(!0),[m,d]=n.useState([]),[u,g]=n.useState(""),[b,x]=n.useState({}),h=n.useMemo(()=>sessionStorage.getItem("tenantId")||"vendor",[]);n.useEffect(()=>{let s=!1;async function r(){l(!0),g("");try{if(!j.currentUser){d([]),l(!1);return}const a=await S(),c=new Set(a.filter(i=>(i.type||"service")==="service").map(i=>String(i.serviceId)));let t=[];try{const{data:i}=await y.get("/api/lms/live");t=Array.isArray(i==null?void 0:i.services)?i.services:[]}catch{t=[]}const o=t.filter(i=>c.has(String(i.id)));s||d(o)}catch(a){s||g((a==null?void 0:a.message)||"Failed to load subscriptions")}finally{s||l(!1)}}return r(),()=>{s=!0}},[h]);async function p(s){var a,c;const r=String(s);x(t=>({...t,[r]:!0}));try{await w(r),d(t=>t.filter(o=>String(o.id)!==r))}catch(t){alert(((c=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:c.message)||(t==null?void 0:t.message)||"Failed to unsubscribe")}finally{x(t=>({...t,[r]:!1}))}}return e.jsxs(v,{children:[e.jsx(N,{title:"My Subscriptions"}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[u&&e.jsx("div",{className:"alert alert-danger",children:u}),f?e.jsx("div",{children:"Loading…"}):e.jsxs("div",{className:"row g-3",children:[m.length===0&&e.jsx("div",{className:"col-12 text-secondary",children:"No subscriptions yet."}),m.map(s=>e.jsx("div",{className:"col-12 col-md-6 col-lg-4",children:e.jsxs("div",{className:"card h-100",children:[e.jsx("img",{src:s.imageUrl||"/assets/images/services/placeholder.png",className:"card-img-top",alt:s.title||"Listing",style:{maxHeight:160,objectFit:"cover"}}),e.jsxs("div",{className:"card-body d-flex flex-column",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsx("h6",{className:"card-title mb-1",children:s.title||"Listing"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-secondary",title:"Notifications (soon)",disabled:!0,children:e.jsx("i",{className:"ri-notification-3-line"})})]}),e.jsxs("div",{className:"text-muted small mb-2",children:[s.category||"General"," · ",s.vendor||""]}),s.description&&e.jsxs("p",{className:"flex-grow-1 text-secondary small",children:[s.description.slice(0,140),s.description.length>140?"…":""]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-auto",children:[e.jsxs("strong",{children:["R ",Number(s.price||0).toLocaleString()]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("span",{className:"badge bg-neutral-200 text-neutral-900",children:["★ ",Number(s.rating||0).toFixed(1)]}),e.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>p(s.id),disabled:!!b[String(s.id)],children:b[String(s.id)]?"Removing…":"Unsubscribe"})]})]})]})]})},String(s.id)))]})]})})]})}export{U as default};
