import{r as g,d as Le,c as Te,b as C,j as e,w as O,a as $,R as me}from"./index-HPcd39yI.js";import{M as Oe,u as $e}from"./MasterLayout-Ucxt6LSp.js";import"./iconify-D0q36GhI.js";const pe="/api/lms",ie="listings_admin_draft_v1",ae="listings_admin_undo_v1",ue="listings_admin_history_cache_v1";function P(t){try{return typeof t=="string"?JSON.parse(t):t}catch{return null}}function U(t){return JSON.parse(JSON.stringify(t))}function oe(){return Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,8)}function Ue(t){return new Date(t).toLocaleString()}function Me(t=[]){const p=t.length,d=t.reduce((v,S)=>{const j=(S.status||"unknown").toLowerCase();return v[j]=(v[j]||0)+1,v},{}),x=t.filter(v=>!!v.isFeatured).length,b=new Set(t.map(v=>(v.category||"").trim()).filter(Boolean)).size;return{total:p,featured:x,categories:b,byStatus:d}}function ge(t){const p=t.vendorId||t.id||t.uid||(t.email?t.email.toLowerCase():oe());return{id:p,vendorId:t.vendorId||p,companyName:t.companyName||t.name||t.displayName||"",name:t.name||t.companyName||"",email:(t.email||t.contactEmail||"").toLowerCase(),website:t.website||"",phone:t.phone||t.phoneNumber||"",avatar:t.avatar||t.logoUrl||"",status:(t.status||"").toLowerCase(),kycStatus:(t.kycStatus||"").toLowerCase(),raw:t}}function he(t){const p=[Array.isArray(t==null?void 0:t.startups)&&t.startups,Array.isArray(t==null?void 0:t.vendors)&&t.vendors,Array.isArray(t==null?void 0:t.companies)&&t.companies,Array.isArray(t==null?void 0:t.profiles)&&t.profiles].filter(Boolean);return ce(p.flat().map(ge))}function ce(t=[]){const p=new Map;return t.forEach(d=>{const x=(d.email||"").toLowerCase()||d.vendorId||d.id;if(x)if(!p.has(x))p.set(x,d);else{const v={...p.get(x)};for(const[S,j]of Object.entries(d))j==null||j===""||(v[S]=j);p.set(x,v)}}),Array.from(p.values())}function _e(t=[]){const p={},d={};return t.forEach(x=>{p[x.vendorId]=x,x.email&&(d[x.email]=x)}),{byId:p,byEmail:d}}function le(t){var p;return{id:t.id??oe(),title:t.title??"",category:t.category??"",vendor:t.vendor??t.vendorName??"",vendorId:t.vendorId??"",contactEmail:(t.contactEmail||t.email||"").toLowerCase(),price:typeof t.price=="number"?t.price:Number(t.price||0),rating:typeof t.rating=="number"?t.rating:Number(t.rating||0),reviewCount:typeof t.reviewCount=="number"?t.reviewCount:Number(t.reviewCount||((p=t.reviews)==null?void 0:p.length)||0),imageUrl:t.imageUrl??t.thumbnail??"",aiHint:t.aiHint??"",listingType:t.listingType??"service",status:t.status??"approved",isFeatured:!!t.isFeatured,description:t.description??"",reviews:Array.isArray(t.reviews)?t.reviews:[]}}function Be(){var de;const t=g.useMemo(()=>sessionStorage.getItem("tenantId")||"vendor",[]),{syncNow:p}=Le(),[d,x]=g.useState(()=>P(localStorage.getItem(ie))??Te),b=g.useMemo(()=>((d==null?void 0:d.services)||[]).map(le),[d]),[v,S]=g.useState(()=>he(d));g.useEffect(()=>{let a=!0;return(async()=>{try{const r=await C.get("/api/data/vendors",{suppressToast:!0,suppressErrorLog:!0}).then(n=>n.data||[]),c=Array.isArray(r)?ce(r.map(ge)):[];a&&S(n=>ce([...n||[],...c]))}catch{}})(),()=>{a=!1}},[t]);const{byId:j,byEmail:L}=g.useMemo(()=>_e(v),[v]),[K,_]=g.useState(()=>JSON.stringify(d,null,2)),[B,W]=g.useState("visual"),[I,Y]=g.useState(!0),[M,o]=g.useState(!1),[q,Q]=g.useState(""),[D,y]=g.useState(!1),[X,G]=g.useState(null),[Z,m]=g.useState(null),f=g.useRef([]),[E,se]=g.useState(()=>P(localStorage.getItem(ue))??[]),re=g.useMemo(()=>["All",...Array.from(new Set(b.map(r=>(r.category||"").trim()).filter(Boolean)))],[b]),[F,J]=g.useState("All"),[R,s]=g.useState("All"),[u,w]=g.useState(""),[z,A]=g.useState(((de=b[0])==null?void 0:de.id)||""),ee=g.useMemo(()=>b.filter(a=>!(F!=="All"&&(a.category||"").trim()!==F||R!=="All"&&(a.status||"").toLowerCase()!==R||u&&!`${a.title} ${a.vendor} ${a.vendorId} ${a.contactEmail} ${a.category}`.toLowerCase().includes(u.toLowerCase()))),[b,F,R,u]),N=g.useMemo(()=>b.find(a=>a.id===z),[b,z]);function T(a){G(a),setTimeout(()=>G(null),2500)}function xe(a){const r=P(localStorage.getItem(ae))??[];r.unshift(a);const c=r.slice(0,10);localStorage.setItem(ae,JSON.stringify(c)),f.current=c}function k(a){xe(d),x(a),_(JSON.stringify(a,null,2)),localStorage.setItem(ie,JSON.stringify(a))}function be(a){var n,l;if(!N)return;const r=U(d),c=r.services.findIndex(i=>i.id===N.id);if(c>=0){r.services[c]={...le(r.services[c]),...a},k(r);try{const i=N.status;typeof a.status<"u"&&a.status!==i?O({action:"LISTING_STATUS_CHANGE",userEmail:(n=$.currentUser)==null?void 0:n.email,targetType:"listing",targetId:N.id,metadata:{from:i,to:a.status,title:N.title}}):O({action:"LISTING_UPDATE",userEmail:(l=$.currentUser)==null?void 0:l.email,targetType:"listing",targetId:N.id,metadata:{patch:a}})}catch{}}}function ve(){var n;const a=prompt("Service title?");if(!a)return;const r=U(d),c=Math.max(0,...r.services.map(l=>Number(l.id)).filter(l=>!Number.isNaN(l)))+1;r.services.push(le({id:String(c),title:a,vendor:"",vendorId:"",contactEmail:"",category:"",price:0,rating:0,reviewCount:0,imageUrl:"",listingType:"service",status:"approved",isFeatured:!1,description:"",aiHint:"",reviews:[]})),k(r),A(String(c));try{O({action:"LISTING_CREATE",userEmail:(n=$.currentUser)==null?void 0:n.email,targetType:"listing",targetId:String(c),metadata:{title:a}})}catch{}}function fe(){var c;if(!N)return;const a=U(d),r=U(N);r.id=oe(),r.title=`${r.title} (Copy)`,a.services.push(r),k(a),A(r.id);try{O({action:"LISTING_DUPLICATE",userEmail:(c=$.currentUser)==null?void 0:c.email,targetType:"listing",targetId:r.id,metadata:{sourceId:N.id,title:r.title}})}catch{}}function ye(){var r,c;if(!N||!window.confirm(`Delete "${N.title}"?`))return;const a=U(d);a.services=a.services.filter(n=>n.id!==N.id),k(a),A(((r=a.services[0])==null?void 0:r.id)||"");try{O({action:"LISTING_DELETE",userEmail:(c=$.currentUser)==null?void 0:c.email,targetType:"listing",targetId:N.id,metadata:{title:N.title}})}catch{}}function je(){const a=f.current.length>0?f.current:P(localStorage.getItem(ae))??[];if(!a.length)return;const r=a.shift();f.current=a,localStorage.setItem(ae,JSON.stringify(a)),x(r),_(JSON.stringify(r,null,2))}const V=g.useCallback(async()=>{try{const r=(await C.get("/api/lms/checkpoints",{suppressToast:!0,suppressErrorLog:!0}).then(c=>c.data)).items??[];se(r),localStorage.setItem(ue,JSON.stringify(r.slice(0,2)))}catch{}},[]),ne=g.useCallback(async({silent:a}={})=>{var r,c,n;a?o(!0):Y(!0),Q("");try{let l=null;try{const{data:i}=await C.get(`${pe}/live`,{headers:{"x-tenant-id":t,"cache-control":"no-cache"},suppressToast:!0,suppressErrorLog:!0});i&&typeof i=="object"&&Object.keys(i).length&&(l=i)}catch(i){const h=((c=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:c.message)||(i==null?void 0:i.message)||"Failed to fetch latest listings";Q(h)}if(l){const i=U(l);x(i),_(JSON.stringify(i,null,2)),localStorage.setItem(ie,JSON.stringify(i));const h=(n=i==null?void 0:i.services)==null?void 0:n[0];A(h?String(h.id):""),S(he(i))}await V()}finally{a?o(!1):Y(!1)}},[t,V]);g.useEffect(()=>{ne({silent:!1}).catch(()=>{})},[ne]);async function Ne(){var a;m(null),y(!0);try{let r=d;try{const c=await C.get("/api/lms/live").then(i=>i.data),n=U(d),l=Object.fromEntries(((c==null?void 0:c.services)||[]).map(i=>[String(i.id),i]));n.services=(n.services||[]).map(i=>{const h=l[String(i.id)];return h?{...i,reviews:Array.isArray(h.reviews)?h.reviews:i.reviews,reviewCount:typeof h.reviewCount=="number"?h.reviewCount:Number(h.reviewCount||(Array.isArray(h.reviews)?h.reviews.length:0)||i.reviewCount||0),rating:typeof h.rating=="number"?h.rating:Number(h.rating||i.rating||0),lastReviewedAt:h.lastReviewedAt||i.lastReviewedAt}:i}),r=n,k(n)}catch{}await C.put("/api/lms/publish",{data:r});try{await p()}catch{}T("Published listings to live");try{await O({action:"LISTINGS_PUBLISH",userEmail:(a=$.currentUser)==null?void 0:a.email,targetType:"appData",targetId:"services",metadata:{count:b.length}})}catch{}await V()}catch(r){m(r.message||"Publish failed")}finally{y(!1)}}async function we(a){var r;try{await C.post("/api/lms/checkpoints",{message:a||"",data:d}),T("Checkpoint saved");try{await O({action:"LISTINGS_CHECKPOINT",userEmail:(r=$.currentUser)==null?void 0:r.email,targetType:"services",targetId:"checkpoint",metadata:{message:a||""}})}catch{}await V()}catch(c){m(c.message||"Failed to save checkpoint")}}async function Se(a){if(window.confirm("Restore this snapshot to LIVE appData.json?"))try{await C.post(`/api/lms/restore/${a}`),T("Restored snapshot"),await V();const r=await C.get("/api/lms/live").then(c=>c.data);k(r);try{await p()}catch{}}catch(r){m(r.message||"Restore failed")}}async function Ce(){var a;if(window.confirm("Delete ALL checkpoints on the server?"))try{await C.delete("/api/lms/checkpoints"),T("Cleared history");try{await O({action:"LISTINGS_HISTORY_CLEAR",userEmail:(a=$.currentUser)==null?void 0:a.email,targetType:"services",targetId:"history"})}catch{}await V()}catch(r){m(r.message||"Failed to clear")}}const H=Me(b);function Ie(a){const r=a.vendorId&&j[a.vendorId],c=a.contactEmail&&L[a.contactEmail],n=r||c||null,l=(n==null?void 0:n.companyName)||(n==null?void 0:n.name)||a.vendor||a.contactEmail||"—",i=(n==null?void 0:n.email)||a.contactEmail||"",h=(n==null?void 0:n.vendorId)||a.vendorId||"",te=h?`/profile-vendor?vendorId=${encodeURIComponent(h)}`:null;return{v:n,name:l,email:i,vendorId:h,profileHref:te}}function Ee(a){return!a||typeof a!="object"?"File is not valid JSON.":Array.isArray(a.services)?null:"JSON must include an array: services[]."}async function Ae(a){var c,n,l;m(null);const r=(c=a.target.files)==null?void 0:c[0];if(r)try{const i=await r.text(),h=P(i),te=Ee(h);if(te){m(te);return}k(h),A(((l=(n=h==null?void 0:h.services)==null?void 0:n[0])==null?void 0:l.id)||""),T(`Imported ${r.name}`)}catch(i){m("Import failed: "+((i==null?void 0:i.message)||"unknown error"))}finally{a.target.value=""}}function ke(){try{const a=new Blob([JSON.stringify(d,null,2)],{type:"application/json;charset=utf-8"}),r=URL.createObjectURL(a),c=document.createElement("a");c.href=r;const n=new Date().toISOString().replace(/[:.]/g,"-");c.download=`appData-${t}-${n}.json`,document.body.appendChild(c),c.click(),c.remove(),URL.revokeObjectURL(r),T("Exported current working copy")}catch(a){m("Export failed: "+((a==null?void 0:a.message)||"unknown error"))}}return e.jsx(Oe,{children:e.jsxs("div",{className:"container py-4",children:[e.jsxs("div",{className:"row g-3 mb-3",children:[e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 bg-animated-gradient text-center p-3",children:[e.jsx("i",{className:"bi bi-bag-check text-primary fs-3 mb-2"}),e.jsx("h6",{className:"fw-bold mb-0",children:H.total}),e.jsx("small",{className:"text-muted",children:"Services"})]})}),e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 text-center p-3",children:[e.jsx("i",{className:"bi bi-grid text-success fs-3 mb-2"}),e.jsx("h6",{className:"fw-bold mb-0",children:H.categories}),e.jsx("small",{className:"text-muted",children:"Categories"})]})}),e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 text-center p-3",children:[e.jsx("i",{className:"bi bi-star-fill text-warning fs-3 mb-2"}),e.jsx("h6",{className:"fw-bold mb-0",children:H.featured}),e.jsx("small",{className:"text-muted",children:"Featured"})]})}),e.jsx("div",{className:"col-md-3 col-sm-6",children:e.jsxs("div",{className:"card px-24 py-16 shadow-none radius-12 border h-100 bg-gradient-start-5 p-3",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-flag text-danger fs-4","aria-hidden":"true"}),e.jsx("div",{className:"fw-semibold",children:"Status"})]}),e.jsxs("span",{className:"badge text-bg-light",children:[Object.values(H.byStatus||{}).reduce((a,r)=>a+r,0)," total"]})]}),(()=>{var n;const a=l=>l==="approved"?"success":l==="pending"?"warning":l==="rejected"?"danger":"secondary",r=Object.entries(H.byStatus||{}),c=r.reduce((l,[,i])=>l+i,0);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"progress",style:{height:10},"aria-label":"Status proportions",children:r.map(([l,i])=>{const h=c?Math.round(i/c*100):0;return e.jsx("div",{className:`progress-bar bg-${a(l)}`,role:"progressbar",style:{width:`${h}%`},"aria-label":`${l} ${h}%`,"aria-valuenow":h,"aria-valuemin":0,"aria-valuemax":100,title:`${l}: ${i} (${h}%)`},l)})}),e.jsx("div",{className:"d-flex flex-wrap gap-2 mt-3",children:r.length?r.map(([l,i])=>e.jsxs("span",{className:`d-inline-flex align-items-center gap-2 px-2 py-1 rounded-pill border border-${a(l)} text-${a(l)} bg-${a(l)}-subtle small`,title:`${l}: ${i}`,"aria-label":`${l}: ${i}`,children:[e.jsx("i",{className:`bi ${l==="approved"?"bi-check-circle":l==="pending"?"bi-hourglass-split":l==="rejected"?"bi-x-octagon":"bi-dot"} `,"aria-hidden":"true"}),e.jsx("span",{className:"text-capitalize",children:l}),e.jsx("span",{className:"badge text-bg-light",children:i})]},l)):e.jsx("span",{className:"text-muted small",children:"No status data"})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsx("small",{className:"text-muted",children:"Total Approved: "}),e.jsxs("span",{className:"fw-semibold",children:[c?Math.round((((n=H.byStatus)==null?void 0:n.approved)??0)/c*100):0,"%"]})]})]})})()]})})]}),e.jsxs("div",{className:"pt-4 d-flex gap-2 mb-3",children:[e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>ne({silent:!0}),disabled:I||M,children:M?"Refreshing…":I?"Loading…":"Refresh data"}),e.jsxs("label",{className:"btn btn-light mb-0 d-none",children:["Import JSON",e.jsx("input",{type:"file",accept:"application/json",hidden:!0,onChange:Ae})]}),e.jsx("button",{className:"btn rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-primary-700 text-hover-white",onClick:ke,children:"Export Current"}),e.jsx("button",{className:"btn rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-primary-700 text-hover-white",disabled:D||I||M,onClick:async()=>{m(null),y(!0);try{const a=await C.get("/api/lms/live",{headers:{"x-tenant-id":t,"cache-control":"no-cache"},suppressToast:!0,suppressErrorLog:!0}).then(n=>n.data),r=U(d),c=Object.fromEntries(((a==null?void 0:a.services)||[]).map(n=>[String(n.id),n]));r.services=(r.services||[]).map(n=>{const l=c[String(n.id)];return l?{...n,reviews:Array.isArray(l.reviews)?l.reviews:n.reviews,reviewCount:typeof l.reviewCount=="number"?l.reviewCount:Number(l.reviewCount||(Array.isArray(l.reviews)?l.reviews.length:0)||n.reviewCount||0),rating:typeof l.rating=="number"?l.rating:Number(l.rating||n.rating||0),lastReviewedAt:l.lastReviewedAt||n.lastReviewedAt}:n}),k(r),T("Synced reviews from live")}catch(a){m(a.message||"Failed to sync reviews")}finally{y(!1)}},title:"Fetch live data and merge review counts and lists",children:"Sync reviews from live"}),e.jsx("button",{className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:Ne,disabled:D||I||M,title:"Write working copy to live appData.json on the server",children:D?"Publishing…":"Publish to live"})]}),q&&e.jsx("div",{className:"alert alert-warning py-2",children:q}),X&&e.jsx("div",{className:"alert alert-success py-2",children:X}),Z&&e.jsx("div",{className:"alert alert-danger py-2",children:Z}),e.jsx(De,{onSave:we,onClear:Ce,onUndo:je,disabled:D||I||M}),e.jsxs("div",{className:"d-flex gap-3",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("ul",{className:"nav nav-tabs mb-3",children:[e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${B==="visual"?"active":""}`,onClick:()=>W("visual"),children:"Visual editor"})}),e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${B==="json"?"active":""}`,onClick:()=>W("json"),children:"JSON editor"})})]}),B==="json"?e.jsx(Fe,{text:K,setText:_,onApply:()=>{const a=P(K);if(!a){m("Invalid JSON");return}k(a),T("Applied JSON to working copy")}}):e.jsx(Je,{services:b,vendors:v,vendorsById:j,vendorsByEmail:L,resolveVendor:Ie,category:F,setCategory:J,status:R,setStatus:s,allCategories:re,search:u,setSearch:w,filtered:ee,selectedId:z,setSelectedId:A,selected:N,addService:ve,duplicateService:fe,deleteService:ye,updateService:be})]}),e.jsx("div",{style:{width:380},children:e.jsx(Re,{items:E,onRestore:Se})})]})]})})}function De({onSave:t,onClear:p,onUndo:d,disabled:x}){const[b,v]=g.useState("");return e.jsxs("div",{className:"d-flex align-items-center gap-2 mb-3",children:[e.jsx("input",{className:"form-control",placeholder:"Checkpoint message (e.g. 'Tweaked pricing & featured items')",value:b,onChange:S=>v(S.target.value)}),e.jsx("button",{className:"btn btn-sm rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:()=>t(b),disabled:x,children:"Save checkpoint"}),e.jsx("button",{className:"btn btn-sm rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-danger-700 text-hover-white",onClick:p,children:"Clear history"}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:d,children:"Undo"})]})}function Fe({text:t,setText:p,onApply:d}){return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header fw-semibold",children:"Working copy (JSON)"}),e.jsxs("div",{className:"card-body",children:[e.jsx("textarea",{value:t,onChange:x=>p(x.target.value),rows:22,spellCheck:!1,className:"form-control font-monospace"}),e.jsxs("div",{className:"d-flex justify-content-between mt-2",children:[e.jsxs("small",{className:"text-muted",children:["Tip: Press ",e.jsx("kbd",{children:"⌘/Ctrl"}),"+",e.jsx("kbd",{children:"A"})," then ",e.jsx("kbd",{children:"⌘/Ctrl"}),"+",e.jsx("kbd",{children:"C"})," to copy."]}),e.jsx("button",{className:"btn btn-outline-primary",onClick:d,children:"Apply JSON"})]})]})]})}function Je(t){const{services:p,vendors:d,vendorsById:x,vendorsByEmail:b,resolveVendor:v,category:S,setCategory:j,status:L,setStatus:K,allCategories:_,search:B,setSearch:W,filtered:I,selectedId:Y,setSelectedId:M,selected:o,addService:q,duplicateService:Q,deleteService:D,updateService:y}=t,X=g.useMemo(()=>{const s=u=>u.status==="active"||u.kycStatus==="approved";return d.filter(s).map(u=>({id:u.vendorId,label:`${u.companyName||u.name||"(unnamed)"}${u.email?" — "+u.email:""}`}))},[d]);function G(s){const u=x[s];y({vendorId:s||"",vendor:u&&(u.companyName||u.name)||"",contactEmail:(u==null?void 0:u.email)||(o==null?void 0:o.contactEmail)||""})}const Z=me.useMemo(()=>{if(!o)return"";if(o.vendorId)return o.vendorId;const s=(o.contactEmail||"").toLowerCase(),u=s?b[s]:null;return(u==null?void 0:u.vendorId)||""},[o,b]),m=o?v(o):null,[f,E]=me.useState({open:!1,subject:"",content:"",sending:!1,err:null,done:!1}),{syncMessagesToLive:se,refresh:re}=$e();function F(){if(!o)return;const s=`Listing feedback: ${o.title}`,u=`Hello ${(m==null?void 0:m.name)||"Vendor"},

Regarding your listing "${o.title}" (ID: ${o.id}).

Reason / guidance:
- 

Please update and resubmit when ready.

Regards,
Admin`;E({open:!0,subject:s,content:u,sending:!1,err:null,done:!1})}function J(){E({open:!1,subject:"",content:"",sending:!1,err:null,done:!1})}async function R(s){var u;if((u=s==null?void 0:s.preventDefault)==null||u.call(s),!(!o||!f.content.trim())){E(w=>({...w,sending:!0,err:null}));try{await C.post("/api/messages",{listingId:o.id,listingTitle:o.title,vendorId:o.vendorId||"",vendorEmail:(m==null?void 0:m.email)||"",subject:f.subject,content:f.content}),E(w=>({...w,sending:!1,done:!0}));try{await re({force:!0}),await se()}catch{}setTimeout(()=>J(),1200)}catch(w){E(z=>{var A,ee;return{...z,sending:!1,err:((ee=(A=w==null?void 0:w.response)==null?void 0:A.data)==null?void 0:ee.message)||(w==null?void 0:w.message)||"Failed to send"}})}}}return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"fw-semibold",children:"Visual editor"}),e.jsx("span",{className:"text-muted small",children:"CRUD for services (listings)"})]}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row g-2 align-items-end mb-3",children:[e.jsxs("div",{className:"col-12 col-md-3",children:[e.jsx("label",{className:"form-label",children:"Category"}),e.jsx("select",{className:"form-select",value:S,onChange:s=>j(s.target.value),children:_.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"col-12 col-md-3",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsx("select",{className:"form-select",value:L,onChange:s=>K(s.target.value),children:["All","approved","pending","rejected"].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"col",children:[e.jsx("label",{className:"form-label",children:"Search"}),e.jsx("input",{className:"form-control",placeholder:"Title, vendor, email, vendorId, category…",value:B,onChange:s=>W(s.target.value)})]}),e.jsx("div",{className:"col-auto",children:e.jsx("button",{className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6 w-100",onClick:q,children:"+ Add service"})}),e.jsx("div",{className:"col-auto",children:e.jsx("button",{className:"btn rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-primary-700 text-hover-white w-100",onClick:Q,disabled:!o,children:"Duplicate"})}),e.jsx("div",{className:"col-auto",children:e.jsx("button",{className:"btn btn-danger-500 rounded-pill border text-neutral-500 border-neutral-700 radius-8 px-12 py-6 bg-hover-danger-700 text-hover-white w-100",onClick:D,disabled:!o,children:"Delete"})})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-4",children:[e.jsxs("div",{className:"list-group mb-2",style:{maxHeight:420,overflow:"auto"},children:[I.map(s=>{const u=v(s);return e.jsxs("button",{className:"list-group-item list-group-item-action d-flex justify-content-between align-items-center "+(Y===s.id?"active":""),onClick:()=>M(s.id),title:u.email||"",children:[e.jsxs("span",{className:"text-truncate",children:[s.title,e.jsx("span",{className:"text-muted",children:" · "}),e.jsx("span",{className:"text-truncate",children:u.name})]}),u.profileHref?e.jsx("a",{className:"badge bg-light text-dark text-decoration-none",href:u.profileHref,target:"_blank",rel:"noreferrer",onClick:w=>w.stopPropagation(),title:"Open vendor profile",children:u.vendorId}):e.jsx("span",{className:"badge bg-light text-dark",children:s.category||"—"})]},s.id)}),!I.length&&e.jsx("div",{className:"text-muted small p-2",children:"No services match your filters."})]}),e.jsxs("div",{className:"small text-muted",children:["Showing ",I.length," of ",p.length]})]}),e.jsx("div",{className:"col",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Title"}),e.jsx("input",{className:"form-control",value:o.title,onChange:s=>y({title:s.target.value})})]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Category"}),e.jsx("input",{className:"form-control",value:o.category||"",onChange:s=>y({category:s.target.value})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Listing type"}),e.jsxs("select",{className:"form-select",value:o.listingType||"service",onChange:s=>y({listingType:s.target.value}),children:[e.jsx("option",{value:"service",children:"Service"}),e.jsx("option",{value:"saas",children:"SaaS"})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsxs("select",{className:"form-select",value:o.status||"approved",onChange:s=>y({status:s.target.value}),children:[e.jsx("option",{value:"approved",children:"approved"}),e.jsx("option",{value:"pending",children:"pending"}),e.jsx("option",{value:"rejected",children:"rejected"})]})]})]}),e.jsxs("div",{className:"row g-3 mt-1",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Bind to vendor (by company or email)"}),e.jsxs("select",{className:"form-select",value:Z,onChange:s=>G(s.target.value),children:[e.jsx("option",{value:"",children:"—"}),X.map(s=>e.jsx("option",{value:s.id,children:s.label},s.id))]}),e.jsxs("div",{className:"form-text",children:["Saves both ",e.jsx("code",{children:"vendorId"})," and display"," ",e.jsx("code",{children:"vendor"})," name on the listing."]})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Contact email"}),e.jsx("input",{className:"form-control",value:o.contactEmail||"",onChange:s=>y({contactEmail:s.target.value.toLowerCase()}),onBlur:()=>{if(!o)return;const s=(o.contactEmail||"").toLowerCase(),u=s?b[s]:null;u&&o.vendorId!==u.vendorId&&G(u.vendorId)}})]}),e.jsx("div",{className:"col-md-3 d-flex align-items-end",children:m!=null&&m.profileHref?e.jsx("a",{className:"btn btn-outline-primary w-100",href:m.profileHref,target:"_blank",rel:"noreferrer",title:"Open vendor profile",children:"View profile"}):e.jsx("button",{className:"btn btn-outline-secondary w-100",disabled:!0,children:"No profile linked"})})]}),e.jsxs("div",{className:"row g-3 mt-1",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Price (R)"}),e.jsx("input",{type:"number",min:"0",className:"form-control",value:Number(o.price||0),onChange:s=>y({price:Number(s.target.value||0)})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Rating (0–5)"}),e.jsx("input",{type:"number",min:"0",max:"5",step:"0.1",className:"form-control",value:Number(o.rating||0),onChange:s=>y({rating:Number(s.target.value||0)})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Review count"}),e.jsx("input",{type:"number",min:"0",className:"form-control",value:Number(o.reviewCount||0),onChange:s=>y({reviewCount:Number(s.target.value||0)})})]})]}),e.jsxs("div",{className:"row g-3 mt-1",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsx("label",{className:"form-label",children:"Image URL"}),e.jsx("input",{className:"form-control",value:o.imageUrl||"",onChange:s=>y({imageUrl:s.target.value})})]}),e.jsx("div",{className:"col-md-4 d-flex align-items-end gap-3",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{id:"isFeatured",type:"checkbox",className:"form-check-input",checked:!!o.isFeatured,onChange:s=>y({isFeatured:!!s.target.checked})}),e.jsx("label",{htmlFor:"isFeatured",className:"form-check-label",children:"Featured"})]})})]}),e.jsxs("div",{className:"mb-3 mt-2",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("textarea",{className:"form-control",rows:4,value:o.description||"",onChange:s=>y({description:s.target.value})})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("div",{className:"text-secondary small",children:["Vendor: ",e.jsx("strong",{children:(m==null?void 0:m.name)||"Unknown"}),m!=null&&m.email?` · ${m.email}`:""]}),e.jsx("div",{children:e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:F,disabled:!(m!=null&&m.email)&&!(o!=null&&o.vendorId),children:"Message Vendor"})})]}),e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("div",{className:"text-muted small mb-1",children:"Card preview"}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("img",{src:o.imageUrl||"/assets/images/placeholder-4x3.png",alt:"",style:{width:120,height:72,objectFit:"cover",borderRadius:6}}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:o.title||"Untitled service"}),e.jsxs("div",{className:"text-muted small",children:[(m==null?void 0:m.name)||"Vendor",m!=null&&m.email?` · ${m.email}`:""]}),e.jsxs("div",{className:"small",children:["R",Number(o.price||0).toLocaleString()," · ★"," ",Number(o.rating||0).toFixed(1)]})]})]})]})]}):e.jsx("div",{className:"text-muted mt-2",children:"Select a service to edit details."})})]})]}),f.open&&e.jsx("div",{className:"position-fixed top-0 start-0 w-100 h-100",style:{background:"rgba(0,0,0,0.5)",zIndex:1070},onClick:s=>s.target===s.currentTarget&&J(),children:e.jsxs("div",{className:"card",style:{maxWidth:560,margin:"10vh auto"},children:[e.jsxs("div",{className:"card-header d-flex align-items-center justify-content-between",children:[e.jsx("h6",{className:"mb-0",children:"Message Vendor"}),e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:J,children:"Close"})]}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{className:"card-body",children:[f.err&&e.jsx("div",{className:"alert alert-danger py-2 mb-2",children:f.err}),f.done&&e.jsx("div",{className:"alert alert-success py-2 mb-2",children:"Sent"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Subject"}),e.jsx("input",{className:"form-control",value:f.subject,onChange:s=>E(u=>({...u,subject:s.target.value}))})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Message"}),e.jsx("textarea",{className:"form-control",rows:6,value:f.content,onChange:s=>E(u=>({...u,content:s.target.value}))}),e.jsxs("div",{className:"text-secondary small mt-1",children:["To: ",(m==null?void 0:m.email)||(o==null?void 0:o.vendorId)||"Vendor"]})]})]}),e.jsxs("div",{className:"card-footer d-flex justify-content-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:J,disabled:f.sending,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:f.sending||!f.content.trim(),children:f.sending?"Sending…":"Send"})]})]})]})})]})}function Re({items:t,onRestore:p}){return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header fw-semibold d-flex justify-content-between",children:[e.jsx("span",{children:"Version history"}),e.jsx("span",{className:"text-muted small",children:"Latest checkpoints"})]}),e.jsxs("div",{className:"list-group list-group-flush",children:[!(t!=null&&t.length)&&e.jsxs("div",{className:"list-group-item text-muted small",children:["No checkpoints yet.",e.jsx("div",{className:"mt-1",children:"Offline cache keeps the two most recent checkpoints."})]}),t==null?void 0:t.map(d=>{var x,b,v,S,j,L;return e.jsx("div",{className:"list-group-item",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:d.message||"(no message)"}),e.jsx("div",{className:"text-muted small",children:Ue(d.ts)}),e.jsxs("div",{className:"text-muted small",children:["Δ Cohorts: ",((x=d.delta)==null?void 0:x.cohorts)>=0?"+":"",((b=d.delta)==null?void 0:b.cohorts)??0," · Δ Courses:"," ",((v=d.delta)==null?void 0:v.courses)>=0?"+":"",((S=d.delta)==null?void 0:S.courses)??0," · Δ Lessons:"," ",((j=d.delta)==null?void 0:j.lessons)>=0?"+":"",((L=d.delta)==null?void 0:L.lessons)??0]})]}),e.jsxs("div",{className:"d-flex align-items-start gap-2",children:[e.jsx("button",{className:"btn btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6 btn-sm",title:"Restore snapshot to LIVE",onClick:()=>p(d.id),children:"Restore"}),e.jsx("a",{className:"btn btn-outline-secondary btn-sm",title:"Download snapshot JSON",href:`${pe}/checkpoints/${d.id}`,target:"_blank",rel:"noreferrer",children:"Download"})]})]})},d.id)})]})]})}export{Be as default};
