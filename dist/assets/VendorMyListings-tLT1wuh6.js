import{m as y,p as v,r,j as e,L as p}from"./index-ABHAGoNh.js";import{M as N}from"./MasterLayout-D28aQefB.js";import{a as w}from"./appData-Ck9xqmoN.js";import"./iconify-DPO5xaW3.js";const L="/api/lms";function C({s:c}){const t=(c||"unknown").toLowerCase(),l={approved:"success",pending:"warning",rejected:"danger",unknown:"secondary"};return e.jsx("span",{className:`badge text-bg-${l[t]||"secondary"}`,children:t})}function E(){const c=y(),{vendor:t,ensureVendorId:l}=v(),g=r.useMemo(()=>sessionStorage.getItem("tenantId")||"public",[]),[i,h]=r.useState([]),[o,j]=r.useState(!0);r.useEffect(()=>{if(t&&!t.isApproved){const s=encodeURIComponent("/listings-vendors-mine");c(`/profile-vendor?next=${s}`,{replace:!0})}},[t,c]),r.useEffect(()=>{l();let s=!1;return(async()=>{try{const n=await fetch(`${L}/live`,{headers:{"x-tenant-id":g}}),a=n.ok?await n.json():w,f=(Array.isArray(a==null?void 0:a.services)?a.services:[]).filter(d=>{var x,u;return d.vendorId&&(t==null?void 0:t.vendorId)&&d.vendorId===t.vendorId||!d.vendorId&&(((x=d.vendor)==null?void 0:x.toLowerCase())===((t==null?void 0:t.name)||"").toLowerCase()||((u=d.contactEmail)==null?void 0:u.toLowerCase())===((t==null?void 0:t.email)||"").toLowerCase())});s||h(f)}catch{s||h([])}finally{s||j(!1)}})(),()=>{s=!0}},[g,t,l]);const m=r.useMemo(()=>{const s={approved:0,pending:0,rejected:0};return i.forEach(n=>{var a;return s[a=(n.status||"pending").toLowerCase()]||(s[a]=0),s[(n.status||"pending").toLowerCase()]++}),s},[i]);function b(s){const n=encodeURIComponent(JSON.stringify({title:s.title,category:s.category,price:s.price,imageUrl:s.imageUrl,description:s.description,listingType:s.listingType||"service"}));c(`/listings-vendors?prefill=${n}`)}return e.jsx(N,{activeRoute:"/listings-vendors-mine",pageTitle:"My listings",children:e.jsxs("div",{className:"container py-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h1",{className:"h4 mb-0",children:"My listings"}),e.jsx("div",{className:"d-flex gap-2",children:e.jsx(p,{to:"/listings-vendors",className:"btn btn-primary",children:"+ Submit new listing"})})]}),e.jsxs("div",{className:"d-flex gap-2 flex-wrap mb-3",children:[e.jsxs("span",{className:"badge text-bg-success",children:["Approved: ",m.approved]}),e.jsxs("span",{className:"badge text-bg-warning",children:["Pending: ",m.pending]}),e.jsxs("span",{className:"badge text-bg-danger",children:["Rejected: ",m.rejected]}),e.jsxs("span",{className:"badge text-bg-secondary",children:["Total: ",i.length]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[o&&e.jsx("div",{className:"text-muted",children:"Loading…"}),!o&&!i.length&&e.jsxs("div",{className:"text-muted",children:["You haven’t submitted any listings yet."," ",e.jsx(p,{to:"/listings-vendors",children:"Create your first one."})]}),!o&&!!i.length&&e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:72}}),e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Status"}),e.jsx("th",{style:{width:220},children:"Actions"})]})}),e.jsx("tbody",{children:i.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("img",{src:s.imageUrl||"/assets/images/placeholder-4x3.png",alt:"",style:{width:64,height:40,objectFit:"cover",borderRadius:6}})}),e.jsx("td",{className:"fw-semibold",children:s.title}),e.jsx("td",{children:s.category||"—"}),e.jsxs("td",{children:["R",Number(s.price||0).toLocaleString()]}),e.jsx("td",{children:e.jsx(C,{s:s.status})}),e.jsxs("td",{className:"d-flex gap-2",children:[e.jsx(p,{className:"btn btn-outline-secondary btn-sm",to:`/marketplace-details?id=${encodeURIComponent(s.id)}`,children:"View"}),e.jsx("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>b(s),children:"Duplicate & edit"})]})]},s.id))})]})})]})})]})})}export{E as default};
