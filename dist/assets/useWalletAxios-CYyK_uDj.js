import{r}from"./vendor-5dkO6nAt.js";import{C as F,b as m,B as u}from"./index-CQbdUr3k.js";function v(){const{user:d}=F(),[p,c]=r.useState(null),[w,a]=r.useState(!0),[y,f]=r.useState(!1),[h,g]=r.useState(null),o=r.useCallback(async()=>{try{if(!d){console.log("⏭️ Skipping wallet fetch - user not authenticated"),a(!1),f(!1),c(null);return}a(!0),g(null);const e=await m.get("/api/wallets/me"),{eligible:s,wallet:t}=e.data;f(s),c(t)}catch(e){console.error("Error fetching wallet:",e),g(e),f(!1),c(null),e.response?.status!==403&&u.error("Failed to load wallet information")}finally{a(!1)}},[d]),b=r.useCallback(async(e,s={})=>{try{a(!0);const t={amount:parseFloat(String(e)),description:s.description||"Voucher redemption",reference:s.reference||null,metadata:s.metadata||null};console.log("🎫 Redeeming credits:",t);const n=await m.post("/api/wallets/me/redeem",t),{wallet:l}=n.data;return c(l),u.success(`Successfully redeemed ${e} credits`),{success:!0,wallet:l}}catch(t){console.error("Error redeeming credits:",t);const n=t.response?.data?.message||"Failed to redeem credits";return u.error(n),{success:!1,error:n}}finally{a(!1)}},[]),S=r.useCallback(async(e,s,t="Admin credit grant",n={})=>{try{a(!0);const l=typeof e=="string"?e.trim().toLowerCase():"",i={email:l||void 0,targetEmail:l||void 0,amount:parseFloat(String(s)),description:t,reference:n.reference||null,metadata:n.metadata||null};console.log("💰 Granting credits:",i);const E=await m.post("/api/wallets/grant",i),{wallet:k}=E.data;return u.success(`Successfully granted ${s} credits to ${e}`),await o(),{success:!0,wallet:k}}catch(l){console.error("Error granting credits:",l);const i=l.response?.data?.message||"Failed to grant credits";return u.error(i),{success:!1,error:i}}finally{a(!1)}},[o]),C=r.useCallback(()=>{o()},[o]);return r.useEffect(()=>{if(!d){a(!1),f(!1),c(null),g(null);return}o()},[d,o]),{wallet:p,loading:w,eligible:y,error:h,redeemCredits:b,grantCredits:S,refresh:C}}export{v as u};
