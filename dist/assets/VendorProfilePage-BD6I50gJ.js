import{d as pe,r as f,a as re,c as U,b as h,j as a,w as ge}from"./index-CmOqa4Kr.js";import{M as he}from"./MasterLayout-w0NEjqQ2.js";import"./iconify-Bjpih9DI.js";const Y="/api/lms",B="vendor_profile_working_v1",J="vendor_profile_undo_v1",ne="vendor_profile_history_cache_v1";function $(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return null}}function M(e){return JSON.parse(JSON.stringify(e))}function oe(){return Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,8)}function ie(e){const o=new Date(e);return isNaN(o)?"—":o.toLocaleString()}function be(e){var x,p,y,j,n,A;const o=((e==null?void 0:e.contactEmail)||(e==null?void 0:e.email)||"").toLowerCase();return{id:String((e==null?void 0:e.vendorId)||(e==null?void 0:e.id)||""),name:(e==null?void 0:e.name)||"",contactEmail:o,ownerUid:(e==null?void 0:e.ownerUid)||"",phone:(e==null?void 0:e.phone)||"",website:(e==null?void 0:e.website)||"",description:(e==null?void 0:e.description)||"",logoUrl:(e==null?void 0:e.logoUrl)||(e==null?void 0:e.logo)||"",bannerUrl:(e==null?void 0:e.bannerUrl)||"",country:(e==null?void 0:e.country)||"",city:(e==null?void 0:e.city)||"",addressLine:(e==null?void 0:e.addressLine)||"",socials:{twitter:((x=e==null?void 0:e.socials)==null?void 0:x.twitter)||"",linkedin:((p=e==null?void 0:e.socials)==null?void 0:p.linkedin)||"",facebook:((y=e==null?void 0:e.socials)==null?void 0:y.facebook)||"",instagram:((j=e==null?void 0:e.socials)==null?void 0:j.instagram)||"",youtube:((n=e==null?void 0:e.socials)==null?void 0:n.youtube)||"",github:((A=e==null?void 0:e.socials)==null?void 0:A.github)||""},categories:Array.isArray(e==null?void 0:e.categories)?e.categories:[],tags:Array.isArray(e==null?void 0:e.tags)?e.tags:[],foundedYear:(e==null?void 0:e.foundedYear)||"",teamSize:(e==null?void 0:e.teamSize)||"",registrationNo:(e==null?void 0:e.registrationNo)||"",status:((e==null?void 0:e.status)||"pending").toLowerCase(),kycStatus:(e==null?void 0:e.kycStatus)||"pending"}}function H(e,o={}){const x=((e==null?void 0:e.email)||(e==null?void 0:e.contactEmail)||o.email||"").toLowerCase(),p=(e==null?void 0:e.socials)??{};return{id:String((e==null?void 0:e.id)??(e==null?void 0:e.vendorId)??o.vendorId??oe()),vendorId:String((e==null?void 0:e.vendorId)??(e==null?void 0:e.id)??o.vendorId??""),name:(e==null?void 0:e.name)??(e==null?void 0:e.companyName)??(e==null?void 0:e.vendor)??o.name??"",contactEmail:x,ownerUid:(e==null?void 0:e.ownerUid)??(e==null?void 0:e.uid)??o.uid??"",website:(e==null?void 0:e.website)??"",phone:(e==null?void 0:e.phone)??"",country:(e==null?void 0:e.country)??"",city:(e==null?void 0:e.city)??"",addressLine:(e==null?void 0:e.addressLine)??"",logoUrl:(e==null?void 0:e.logoUrl)??(e==null?void 0:e.logo)??"",bannerUrl:(e==null?void 0:e.bannerUrl)??"",description:(e==null?void 0:e.description)??"",categories:Array.isArray(e==null?void 0:e.categories)?e.categories:[],tags:Array.isArray(e==null?void 0:e.tags)?e.tags:[],foundedYear:(e==null?void 0:e.foundedYear)??"",teamSize:(e==null?void 0:e.teamSize)??"",registrationNo:(e==null?void 0:e.registrationNo)??"",status:((e==null?void 0:e.status)||"pending").toLowerCase(),socials:{twitter:p.twitter??"",linkedin:p.linkedin??"",facebook:p.facebook??"",instagram:p.instagram??"",youtube:p.youtube??"",github:p.github??""},lastUpdated:(e==null?void 0:e.lastUpdated)??""}}function fe(e,o){if(!e)return null;const x=((o==null?void 0:o.email)||"").toLowerCase(),p=[Array.isArray(e.startups)&&e.startups,Array.isArray(e.vendors)&&e.vendors,Array.isArray(e.companies)&&e.companies,Array.isArray(e.profiles)&&e.profiles].filter(Boolean);for(const y of p){const j=y.find(n=>(n==null?void 0:n.ownerUid)&&n.ownerUid===(o==null?void 0:o.uid)||(n==null?void 0:n.email)&&String(n.email).toLowerCase()===x||(n==null?void 0:n.contactEmail)&&String(n.contactEmail).toLowerCase()===x||(o==null?void 0:o.vendorId)&&(String(n==null?void 0:n.vendorId)===String(o.vendorId)||String(n==null?void 0:n.id)===String(o.vendorId)));if(j)return H(j,o)}return null}function je(){var v,ee,ae,se,te;const{vendor:e,ensureVendorId:o,refresh:x}=pe(),p=f.useMemo(()=>sessionStorage.getItem("tenantId")||"vendor",[]),[y,j]=f.useState(()=>$(localStorage.getItem(B))??re),[n,A]=f.useState(()=>$(localStorage.getItem(ne))??[]),[w,L]=f.useState(!1),[V,S]=f.useState(""),[q,I]=f.useState(""),[G,K]=f.useState(""),[W,le]=f.useState(!0),k=f.useRef([]);function Q(s){const r=[s,...k.current||[]].slice(0,10);k.current=r,localStorage.setItem(J,JSON.stringify(r))}function X(){var i;const s=(i=k.current)!=null&&i.length?k.current:$(localStorage.getItem(J))??[];if(!s.length)return;const r=s.shift();k.current=s,localStorage.setItem(J,JSON.stringify(s)),j(r),localStorage.setItem(B,JSON.stringify(r))}function T(s){Q(y),j(s),localStorage.setItem(B,JSON.stringify(s))}f.useEffect(()=>{let s=!0;return(async()=>{L(!0);try{await o();let r=re;try{const{data:i}=await U.get(`${Y}/live`,{headers:{"x-tenant-id":p,"cache-control":"no-cache"}});s&&i&&(r=i)}catch{}try{const i=await U.get("/api/data/vendors").then(m=>m.data||[]),u=M(r);u.startups=Array.isArray(u.startups)?u.startups:[],i.forEach(m=>{const N=H(m),C=u.startups.findIndex(d=>String(d.vendorId||d.id)===N.vendorId);C>=0?u.startups[C]={...u.startups[C],...N}:u.startups.push(N)}),r=u}catch{}T(r),await D()}catch{}finally{s&&L(!1)}})(),()=>{s=!1}},[p]);async function D(){try{const{data:s}=await U.get(`${Y}/checkpoints`,{headers:{"x-tenant-id":p,"cache-control":"no-cache"}}),r=Array.isArray(s==null?void 0:s.items)?s.items:[];A(r),localStorage.setItem(ne,JSON.stringify(r.slice(0,2)))}catch{}}const b=f.useMemo(()=>{var r,i,u;const s={uid:(r=h.currentUser)==null?void 0:r.uid,email:((i=h.currentUser)==null?void 0:i.email)||(e==null?void 0:e.email)||"",name:((u=h.currentUser)==null?void 0:u.displayName)||(e==null?void 0:e.name)||"",vendorId:(e==null?void 0:e.vendorId)||""};return fe(y,s)||H({},s)},[y,e==null?void 0:e.vendorId,(v=h.currentUser)==null?void 0:v.uid,(ee=h.currentUser)==null?void 0:ee.email]),[t,E]=f.useState(()=>b);f.useEffect(()=>{E(b)},[b]);const c=!h.currentUser,O=((b==null?void 0:b.status)||"").toLowerCase(),R=((b==null?void 0:b.kycStatus)||"").toLowerCase(),z=O==="active"||R==="approved",ce=O==="pending"||R==="pending",F=O==="suspended"||R==="rejected";function g(s,r){E(i=>({...i,[s]:r}))}function de(s,r){E(i=>({...i,socials:{...i.socials,[s]:r}}))}async function me(s){try{await U.post(`${Y}/checkpoints`,{message:s||"Vendor profile update",data:y},{headers:{"Content-Type":"application/json","x-tenant-id":p}}),I("Checkpoint saved"),await D(),K("")}catch(r){S((r==null?void 0:r.message)||"Failed to save checkpoint")}}async function Z(){var C,d,_,P;if(S(""),I(""),c){S("You need to sign in first.");return}if(!t.name.trim()){S("Vendor name is required.");return}const s=M(y);Q(s);const r=M(y);r.startups=Array.isArray(r.startups)?r.startups:[];const i=String(t.vendorId||t.id||(e==null?void 0:e.vendorId)||((C=h.currentUser)==null?void 0:C.uid)||oe()),u=(t.contactEmail||((d=h.currentUser)==null?void 0:d.email)||"").toLowerCase(),m={...t,id:i,vendorId:i,ownerUid:((_=h.currentUser)==null?void 0:_.uid)||t.ownerUid||"",contactEmail:u,email:u,lastUpdated:new Date().toISOString()},N=r.startups.findIndex(l=>String(l.vendorId)===i||String(l.id)===i||l.email&&String(l.email).toLowerCase()===u);N>=0?r.startups[N]={...r.startups[N],...m}:r.startups.push(m),W&&Array.isArray(r.services)&&(r.services=r.services.map(l=>String(l.vendorId||"")===i?{...l,vendor:m.name}:l));try{L(!0);const l=be(m);l.id?await U.put(`/api/data/vendors/${encodeURIComponent(l.id)}`,l):await U.post("/api/data/vendors",l);try{await ge({action:"VENDOR_UPSERT",userEmail:(P=h.currentUser)==null?void 0:P.email,targetType:"vendor",targetId:i,metadata:{name:m.name}})}catch{}T(r),I("Profile saved to live."),await(x==null?void 0:x()),await D(),window.scrollTo({top:0,behavior:"smooth"})}catch(l){S((l==null?void 0:l.message)||"Save failed"),T(s)}finally{L(!1)}}async function ue(){var s,r,i,u;S(""),I("");try{const m=h.currentUser;if(!m)throw new Error("Please sign in");const N=(m.email||"").toLowerCase(),d=(await U.get("/api/data/startups").then(l=>l.data||[])).find(l=>l.ownerUid&&l.ownerUid===m.uid||(l.contactEmail||l.email||"").toLowerCase()===N);if(!d){S("No startup profile found to import.");return}const _=[d.elevatorPitch||"",d.productsServices||""].filter(Boolean).join(`

`),P={...t,name:t.name||d.name||"",description:t.description||_,contactEmail:(t.contactEmail||d.contactEmail||N).toLowerCase(),phone:t.phone||d.phone||"",website:t.website||d.website||"",country:t.country||d.country||"",city:t.city||d.city||"",addressLine:t.addressLine||d.addressLine||"",categories:(s=t.categories)!=null&&s.length?t.categories:Array.isArray(d.categories)?d.categories:[],tags:(r=t.tags)!=null&&r.length?t.tags:Array.isArray(d.tags)?d.tags:[],teamSize:t.teamSize||String(d.employeeCount||"")};E(P),I("Imported details from your Startup profile. Review and Save changes."),window.scrollTo({top:0,behavior:"smooth"})}catch(m){S(((u=(i=m==null?void 0:m.response)==null?void 0:i.data)==null?void 0:u.message)||(m==null?void 0:m.message)||"Import failed")}}return a.jsx(he,{children:a.jsxs("div",{className:"container py-4",style:{maxWidth:980},children:[a.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"h4 mb-0",children:"My Vendor Profile"}),a.jsxs("div",{className:"text-muted small",children:["Signed in as"," ",a.jsx("strong",{children:b.name||((ae=h.currentUser)==null?void 0:ae.displayName)||"Vendor"})," ","· ",b.contactEmail||((se=h.currentUser)==null?void 0:se.email)||"email not set",a.jsx("span",{className:`badge ms-2 text-bg-${z?"success":F?"danger":"warning"}`,children:z?"Approved":F?"Suspended":"Pending"})]}),a.jsxs("div",{className:"text-muted small",children:["Vendor ID:"," ",b.vendorId?a.jsx("code",{children:b.vendorId}):"pending"]}),z&&a.jsxs("div",{className:"alert alert-success mt-3 mb-0",children:["Your vendor account is approved. You can now submit listings to the marketplace.",a.jsxs("div",{className:"mt-2 d-flex gap-2",children:[a.jsx("a",{className:"btn btn-primary btn-sm",href:"/listings-vendors",children:"+ Submit new listing"}),a.jsx("a",{className:"btn btn-outline-secondary btn-sm",href:"/listings-vendors-mine",children:"View my listings"})]})]}),ce&&a.jsx("div",{className:"alert alert-warning mt-3 mb-0",children:"Your vendor account is pending approval. Please complete your profile details and wait for an admin to approve your account. You’ll be able to submit listings once approved."}),F&&a.jsx("div",{className:"alert alert-danger mt-3 mb-0",children:"Your vendor account is suspended. You cannot submit listings. Please contact support if you believe this is an error."})]}),a.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[a.jsx("button",{className:"btn btn-outline-secondary",onClick:X,disabled:w,children:"Undo"}),a.jsx("button",{className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:Z,disabled:w||c,title:"Save changes to live",children:w?"Saving…":"Save changes"})]})]}),c&&a.jsx("div",{className:"alert alert-warning",children:"Please sign in to manage your vendor profile."}),V&&a.jsx("div",{className:"alert alert-danger",children:V}),q&&a.jsx("div",{className:"alert alert-success",children:q}),a.jsxs("div",{className:"row g-3",children:[a.jsxs("div",{className:"col-lg-8",children:[a.jsx("div",{className:"d-flex justify-content-end mb-2",children:a.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:ue,disabled:w||c,title:"Import company details from your Startup profile",children:"Import from Startup Profile"})}),a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"card-header fw-semibold",children:"Company details"}),a.jsx("div",{className:"card-body",children:a.jsxs("div",{className:"row g-3",children:[a.jsxs("div",{className:"col-md-8",children:[a.jsx("label",{className:"form-label",children:"Company / Vendor name"}),a.jsx("input",{className:"form-control",value:t.name,onChange:s=>g("name",s.target.value),placeholder:"e.g., Acme Studio",disabled:c,required:!0})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsx("label",{className:"form-label",children:"Contact email"}),a.jsx("input",{className:"form-control",value:t.contactEmail,onChange:s=>g("contactEmail",s.target.value.toLowerCase()),placeholder:"you@company.com",disabled:c})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Website"}),a.jsx("input",{className:"form-control",value:t.website,onChange:s=>g("website",s.target.value),placeholder:"https://…",disabled:c})]}),a.jsxs("div",{className:"col-md-3",children:[a.jsx("label",{className:"form-label",children:"Phone"}),a.jsx("input",{className:"form-control",value:t.phone,onChange:s=>g("phone",s.target.value),placeholder:"+27…",disabled:c})]}),a.jsxs("div",{className:"col-md-3",children:[a.jsx("label",{className:"form-label",children:"Founded (year)"}),a.jsx("input",{className:"form-control",value:t.foundedYear,onChange:s=>g("foundedYear",s.target.value),placeholder:"2021",disabled:c})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsx("label",{className:"form-label",children:"Country"}),a.jsx("input",{className:"form-control",value:t.country,onChange:s=>g("country",s.target.value),placeholder:"South Africa",disabled:c})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsx("label",{className:"form-label",children:"City"}),a.jsx("input",{className:"form-control",value:t.city,onChange:s=>g("city",s.target.value),placeholder:"Cape Town",disabled:c})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsx("label",{className:"form-label",children:"Team size"}),a.jsx("input",{className:"form-control",value:t.teamSize,onChange:s=>g("teamSize",s.target.value),placeholder:"1–10",disabled:c})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Company reg. number"}),a.jsx("input",{className:"form-control",value:t.registrationNo,onChange:s=>g("registrationNo",s.target.value),placeholder:"(optional)",disabled:c})]}),a.jsxs("div",{className:"col-md-6 d-none",children:[a.jsx("label",{className:"form-label",children:"Status"}),a.jsxs("select",{className:"form-select",value:t.status,onChange:s=>g("status",s.target.value),disabled:c,children:[a.jsx("option",{value:"active",children:"active"}),a.jsx("option",{value:"pending",children:"pending"}),a.jsx("option",{value:"suspended",children:"suspended"})]})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Logo URL"}),a.jsx("input",{className:"form-control",value:t.logoUrl,onChange:s=>g("logoUrl",s.target.value),placeholder:"https://…",disabled:c})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Banner URL"}),a.jsx("input",{className:"form-control",value:t.bannerUrl,onChange:s=>g("bannerUrl",s.target.value),placeholder:"https://…",disabled:c})]}),a.jsxs("div",{className:"col-12",children:[a.jsx("label",{className:"form-label",children:"Description"}),a.jsx("textarea",{className:"form-control",rows:4,value:t.description,onChange:s=>g("description",s.target.value),placeholder:"Tell buyers what you do, problems you solve, and why you're different.",disabled:c})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Categories (comma-separated)"}),a.jsx("input",{className:"form-control",value:t.categories.join(", "),onChange:s=>g("categories",s.target.value.split(",").map(r=>r.trim()).filter(Boolean)),placeholder:"Design, Branding",disabled:c})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:"Tags (comma-separated)"}),a.jsx("input",{className:"form-control",value:t.tags.join(", "),onChange:s=>g("tags",s.target.value.split(",").map(r=>r.trim()).filter(Boolean)),placeholder:"logos, identity, saas",disabled:c})]}),a.jsx("div",{className:"col-12",children:a.jsx("div",{className:"row g-3",children:[["twitter","Twitter"],["linkedin","LinkedIn"],["facebook","Facebook"],["instagram","Instagram"],["youtube","YouTube"],["github","GitHub"]].map(([s,r])=>a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label",children:r}),a.jsx("input",{className:"form-control",value:t.socials[s],onChange:i=>de(s,i.target.value),placeholder:`https://${s}.com/...`,disabled:c})]},s))})}),a.jsxs("div",{className:"col-12 d-flex align-items-center gap-2",children:[a.jsx("input",{id:"propagateName",type:"checkbox",className:"form-check-input",checked:W,onChange:s=>le(!!s.target.checked),disabled:c}),a.jsx("label",{htmlFor:"propagateName",className:"form-check-label",children:"Update my display name on all existing listings"})]}),a.jsxs("div",{className:"col-12 d-flex gap-2 mt-2",children:[a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:X,disabled:w,children:"Undo"}),a.jsx("button",{type:"button",className:"btn rounded-pill text-primary-50 hover-text-primary-200 bg-primary-500 bg-hover-primary-800 radius-8 px-12 py-6",onClick:Z,disabled:w||c,children:w?"Saving…":"Save changes"})]}),t.lastUpdated&&a.jsxs("div",{className:"form-text mt-1",children:["Last updated: ",ie(t.lastUpdated)]})]})})]})]}),a.jsxs("div",{className:"col-lg-4",children:[a.jsxs("div",{className:"card mb-3",children:[a.jsx("div",{className:"card-header fw-semibold",children:"Preview"}),a.jsxs("div",{className:"card-body",children:[a.jsxs("div",{className:"d-flex align-items-center gap-3",children:[a.jsx("img",{src:t.logoUrl||"/assets/images/placeholder-1x1.png",alt:"logo",style:{width:64,height:64,objectFit:"cover",borderRadius:8}}),a.jsxs("div",{children:[a.jsx("div",{className:"fw-semibold",children:t.name||"Vendor"}),a.jsx("div",{className:"text-muted small",children:t.contactEmail||((te=h.currentUser)==null?void 0:te.email)||"email"}),a.jsx("div",{className:"small",children:t.website?a.jsx("a",{href:t.website,target:"_blank",rel:"noreferrer",children:t.website}):"website"})]})]}),t.bannerUrl&&a.jsx("div",{className:"mt-3",children:a.jsx("img",{src:t.bannerUrl,alt:"banner",className:"w-100",style:{maxHeight:140,objectFit:"cover",borderRadius:8}})}),a.jsxs("div",{className:"mt-3 small text-muted",children:["Categories: ",t.categories.join(", ")||"—",a.jsx("br",{}),"Tags: ",t.tags.join(", ")||"—"]})]})]}),a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"card-header fw-semibold d-flex align-items-center justify-content-between",children:a.jsx("span",{children:"Version control"})}),a.jsxs("div",{className:"card-body",children:[a.jsxs("div",{className:"d-flex gap-2 mb-2",children:[a.jsx("input",{className:"form-control",placeholder:"Checkpoint message",value:G,onChange:s=>K(s.target.value)}),a.jsx("button",{className:"btn btn-outline-primary",onClick:()=>me(G),disabled:w||c,children:"Save checkpoint"})]}),a.jsxs("div",{className:"list-group list-group-flush",children:[!(n!=null&&n.length)&&a.jsx("div",{className:"text-muted small",children:"No checkpoints yet. Create one after saving changes."}),n==null?void 0:n.slice(0,6).map(s=>a.jsxs("div",{className:"list-group-item",children:[a.jsx("div",{className:"fw-semibold",children:s.message||"(no message)"}),a.jsx("div",{className:"text-muted small",children:ie(s.ts)}),a.jsx("div",{className:"d-flex gap-2 mt-1",children:a.jsx("a",{className:"btn btn-sm btn-outline-secondary",href:`${Y}/checkpoints/${s.id}`,target:"_blank",rel:"noreferrer",children:"Download snapshot"})})]},s.id))]}),a.jsx("div",{className:"form-text mt-2",children:"Checkpoints snapshot the whole marketplace data (including your profile) on the server."})]})]})]})]})]})})}export{je as default};
