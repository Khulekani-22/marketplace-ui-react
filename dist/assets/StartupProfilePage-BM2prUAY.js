import{c as g,a as v,j as e,M as L,w as j}from"./index-D_DTgdmv.js";import{b as A,r as i,L as U}from"./vendor-DW3XjTa1.js";import{B as T}from"./Breadcrumb-BdVectq-.js";import"./firebase-ARhtPVQA.js";import"./utils-B2rxisVD.js";const N="/api/data/startups";function k(){const w=A(),[m,u]=i.useState(!1),[f,c]=i.useState(""),[x,p]=i.useState(""),y=i.useMemo(()=>sessionStorage.getItem("tenantId")||"vendor",[]),[C,b]=i.useState(!1),[s,h]=i.useState({id:"",name:"",elevatorPitch:"",productsServices:"",employeeCount:0,contactEmail:"",phone:"",website:"",country:"",city:"",addressLine:"",categories:[],tags:[]});function l(a,t){h(o=>({...o,[a]:t}))}i.useEffect(()=>{(async()=>{c("");const a=g.currentUser,t=(a?.email||"").toLowerCase();if(t)try{const r=(await v.get(N).then(n=>n.data||[])).find(n=>n.ownerUid&&n.ownerUid===a.uid||(n.contactEmail||n.email||"").toLowerCase()===t);h(r?{id:r.id||"",name:r.name||"",elevatorPitch:r.elevatorPitch||"",productsServices:r.productsServices||"",employeeCount:Number(r.employeeCount||0),contactEmail:(r.contactEmail||t).toLowerCase(),phone:r.phone||"",website:r.website||"",country:r.country||"",city:r.city||"",addressLine:r.addressLine||"",categories:Array.isArray(r.categories)?r.categories:[],tags:Array.isArray(r.tags)?r.tags:[]}:n=>({...n,contactEmail:t}));try{const P=(await v.get("/api/data/vendors").then(d=>d.data||[])).find(d=>d.ownerUid&&d.ownerUid===a.uid||(d.contactEmail||d.email||"").toLowerCase()===t);b(!!P)}catch{}}catch(o){c(o?.response?.data?.message||o?.message||"Failed to load startup profile")}})()},[y]);async function E(a){a?.preventDefault?.(),u(!0),c(""),p("");try{const t=g.currentUser;if(!t)throw new Error("Please sign in");const o={id:s.id||t.uid,name:s.name,elevatorPitch:s.elevatorPitch,productsServices:s.productsServices,employeeCount:Number(s.employeeCount||0),contactEmail:(s.contactEmail||t.email||"").toLowerCase(),ownerUid:t.uid,phone:s.phone,website:s.website,country:s.country,city:s.city,addressLine:s.addressLine,categories:s.categories,tags:s.tags};if(!o.name)throw new Error("Business name is required");await v.post(N,o),p("Saved");try{await j({action:"STARTUP_UPDATE",userEmail:o.contactEmail,targetType:"startup",targetId:o.id})}catch{}h(r=>({...r,id:o.id}))}catch(t){c(t?.response?.data?.message||t?.message||"Failed to save")}finally{u(!1)}}async function S(){c(""),p(""),u(!0);try{const a=g.currentUser;if(!a)throw new Error("Please sign in");const t=(s.contactEmail||a.email||"").toLowerCase(),o=[s.elevatorPitch||"",s.productsServices||""].filter(Boolean).join(`

`),r={id:a.uid,name:s.name,contactEmail:t,ownerUid:a.uid,phone:s.phone,website:s.website,description:o,country:s.country,city:s.city,addressLine:s.addressLine,categories:s.categories,tags:s.tags,status:"pending",kycStatus:"pending"};if(!r.name)throw new Error("Business name is required to create a vendor.");await v.post("/api/data/vendors",r);try{await j({action:"VENDOR_CREATE_FROM_STARTUP",userEmail:t,targetType:"vendor",targetId:a.uid})}catch{}p("Vendor profile created. Redirecting…"),b(!0),setTimeout(()=>w("/profile-vendor",{replace:!0}),600)}catch(a){c(a?.response?.data?.message||a?.message||"Failed to create vendor from startup")}finally{u(!1)}}return e.jsxs(L,{children:[e.jsx(T,{title:"Startup Profile"}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("div",{className:"small text-muted",children:["Tenant: ",e.jsx("code",{children:y})]}),e.jsx("div",{className:"d-flex gap-2",children:C?e.jsx(U,{to:"/profile-vendor",className:"btn btn-sm btn-outline-primary",children:"Go to Vendor Profile"}):e.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:S,disabled:m,children:m?"Creating…":"Create Vendor from Startup"})})]}),f&&e.jsx("div",{className:"alert alert-danger",children:f}),x&&e.jsx("div",{className:"alert alert-success",children:x}),e.jsxs("form",{onSubmit:E,className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Business name"}),e.jsx("input",{className:"form-control",value:s.name,onChange:a=>l("name",a.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Website"}),e.jsx("input",{className:"form-control",value:s.website,onChange:a=>l("website",a.target.value)})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"Elevator pitch"}),e.jsx("textarea",{className:"form-control",rows:3,value:s.elevatorPitch,onChange:a=>l("elevatorPitch",a.target.value)})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"Products / Services"}),e.jsx("textarea",{className:"form-control",rows:4,value:s.productsServices,onChange:a=>l("productsServices",a.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Employees"}),e.jsx("input",{type:"number",min:0,className:"form-control",value:s.employeeCount,onChange:a=>l("employeeCount",a.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Phone"}),e.jsx("input",{className:"form-control",value:s.phone,onChange:a=>l("phone",a.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Contact email"}),e.jsx("input",{type:"email",className:"form-control",value:s.contactEmail,onChange:a=>l("contactEmail",a.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Country"}),e.jsx("input",{className:"form-control",value:s.country,onChange:a=>l("country",a.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"City"}),e.jsx("input",{className:"form-control",value:s.city,onChange:a=>l("city",a.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Address"}),e.jsx("input",{className:"form-control",value:s.addressLine,onChange:a=>l("addressLine",a.target.value)})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"Categories (comma separated)"}),e.jsx("input",{className:"form-control",value:(s.categories||[]).join(", "),onChange:a=>l("categories",a.target.value.split(",").map(t=>t.trim()).filter(Boolean))})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"Tags (comma separated)"}),e.jsx("input",{className:"form-control",value:(s.tags||[]).join(", "),onChange:a=>l("tags",a.target.value.split(",").map(t=>t.trim()).filter(Boolean))})]}),e.jsx("div",{className:"col-12 d-flex gap-2",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:m,children:m?"Saving…":"Save profile"})})]})]})})]})}export{k as default};
