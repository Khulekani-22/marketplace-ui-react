import{g as fe,a as M,b as be,B as y,j as s,I as E}from"./index-SxOx_-GL.js";import{r,L as he}from"./vendor-C0neu5ZX.js";function C(n,c=80){return n?n.length>c?`${n.slice(0,c)}â€¦`:n:""}function K(n){return`https://ui-avatars.com/api/?name=${encodeURIComponent(n||"User")}&background=059669&color=fff`}function T(n){const c=n?.from||{},h=n?.timestamp||n?.date||new Date().toISOString();return{id:String(n?.id||h),senderId:c?.uid||c?.email,senderName:c?.name||c?.email||"User",senderEmail:c?.email,senderRole:c?.type,senderAvatar:c?.avatar,content:(n?.content??"").toString(),timestamp:h}}function z(n,c){const h=Array.isArray(n?.messages)?n.messages:[],p=n?.context||c||{},u=h.map(i=>{const m=i?.senderRole||i?.role;let b=i?.senderEmail||i?.email;if(!b){const o=(m||"").toLowerCase();o==="admin"&&p.adminEmail&&(b=p.adminEmail),o==="vendor"&&p.vendorEmail&&(b=p.vendorEmail),o==="subscriber"&&p.subscriberEmail&&(b=p.subscriberEmail)}const g=i?.date||i?.timestamp||i?.createdAt||new Date().toISOString();return{id:String(i?.id||i?.messageId||g),senderId:i?.senderId||i?.sender?.id,senderName:i?.senderName||i?.sender?.name||i?.senderId||"User",senderEmail:b,senderRole:m,senderAvatar:i?.senderAvatar||i?.sender?.avatar,content:(i?.content??i?.text??"").toString(),timestamp:g}});return u.sort((i,m)=>new Date(i.timestamp).getTime()-new Date(m.timestamp).getTime()),u}function Z(n){const c=new Map;n.forEach(p=>{if(!p)return;const u=String(p.threadId||p.id||p.subject||`legacy-${Date.now()}`);c.has(u)||c.set(u,[]),c.get(u).push(p)});const h=[];for(const[p,u]of c.entries()){u.sort((g,o)=>new Date(g?.timestamp||g?.date||0).getTime()-new Date(o?.timestamp||o?.date||0).getTime());const i=u[0],m=u[u.length-1]||i,b=[];i?.from&&b.push({id:i.from.uid||i.from.email||i.from.name,name:i.from.name||i.from.email,email:i.from.email,role:i.from.type}),i?.to&&b.push({id:i.to.uid||i.to.email||i.to.name,name:i.to.name||i.to.email,email:i.to.email,role:i.to.type}),h.push({id:p,kind:"legacy",subject:m?.subject||i?.subject||"Conversation",lastMessageSnippet:C(m?.content||""),lastMessageAt:m?.timestamp||m?.date,participants:b,legacy:{user1:b[0]?.email,user2:b[1]?.email},raw:u})}return h}function ge(n){const c=Array.isArray(n?.messages)?[...n.messages]:[],h=n?.lastMessage||c[c.length-1]||{},p=Array.isArray(n?.participants)?n.participants.map(o=>({id:o?.id||o?.email||o?.name,name:o?.name||o?.id||"Participant",email:o?.email,role:o?.role})):[],u=n?.context||{},i={id:String(n?.id||n?.threadId||u.threadId||`thread-${Date.now()}`),kind:"thread",subject:n?.subject||u.listingTitle||u.serviceTitle||"Conversation",lastMessageSnippet:C(n?.lastMessage?.snippet||h?.snippet||h?.content||""),lastMessageAt:h?.date||h?.timestamp||n?.updatedAt||n?.createdAt,unreadCount:typeof n?.unreadCount=="number"?n.unreadCount:void 0,participants:p,context:u,raw:n},m=u.vendorEmail,b=u.adminEmail,g=u.subscriberEmail;if(m){const o=i.participants.find(f=>(f?.role||"").toLowerCase()==="vendor"||(f?.id||"").startsWith("vendor:"));o&&!o.email&&(o.email=m)}if(b){const o=i.participants.find(f=>(f?.role||"").toLowerCase()==="admin");o&&!o.email&&(o.email=b)}if(g){const o=i.participants.find(f=>(f?.role||"").toLowerCase()==="subscriber");o&&!o.email&&(o.email=g)}return i}const Me=()=>{const[n,c]=r.useState([]),[h,p]=r.useState([]),[u,i]=r.useState("inbox"),[m,b]=r.useState(null),[g,o]=r.useState([]),[f,ee]=r.useState(()=>{try{return fe()}catch{return null}}),[se,R]=r.useState(!0),[U,$]=r.useState(!1),[V,ae]=r.useState(""),[X,k]=r.useState(!1),[D,L]=r.useState(""),[w,F]=r.useState(""),[B,O]=r.useState(!1),[q,H]=r.useState([]),[v,Q]=r.useState(""),[ie,j]=r.useState(!1);r.useEffect(()=>{X&&M.get("/api/users/all-contacts").then(e=>H(e.data.items||[])).catch(()=>H([]))},[X]);const te=r.useRef(null),W=r.useCallback(()=>{te.current?.scrollIntoView({behavior:"smooth"})},[]);r.useEffect(()=>{W()},[g,W]),r.useEffect(()=>{be().then(e=>ee(e)).catch(()=>{})},[]);const Y=r.useCallback(e=>{const t=(f?.email||"").toLowerCase();return e.map(a=>{const l=a.participants||[];let d=!1;a.raw&&Array.isArray(a.raw.messages)?d=a.raw.messages.some(x=>(x.senderEmail||x.email||"").toLowerCase()===t):Array.isArray(a.raw)&&(d=a.raw.some(x=>(x?.from?.email||"").toLowerCase()===t));const N=d,S=l.some(x=>(x.email||"").toLowerCase()===t);let A=l.find(x=>(x?.email||"").toLowerCase()!==t);!A&&l.length&&(A=l[0]);const G=A?.name||A?.email||a.subject||"Conversation",ue=A?.email||(a.legacy?[a.legacy.user1,a.legacy.user2].find(x=>(x||"").toLowerCase()!==t):void 0),de=K(G),J=(a.kind==="thread"?a.context?.type||"active":"legacy conversation").replace(/[-_]/g," ");return{id:`${a.kind}:${a.id}`,threadId:a.id,name:G,email:ue,avatar:de,status:J.charAt(0).toUpperCase()+J.slice(1),type:a.kind,lastMessageSnippet:C(a.lastMessageSnippet||""),lastMessageAt:a.lastMessageAt,unreadCount:a.unreadCount,thread:a,isInbox:S,isSent:N}}).sort((a,l)=>{const d=a.lastMessageAt?new Date(a.lastMessageAt).getTime():0;return(l.lastMessageAt?new Date(l.lastMessageAt).getTime():0)-d})},[f]),P=r.useCallback(async({silent:e=!1}={})=>{e||R(!0);try{const a=(await M.get("/api/messages",{params:{limit:100}})).data;let l=[];Array.isArray(a?.items)?l=a.items.map(ge):Array.isArray(a?.messages)?l=Z(a.messages):Array.isArray(a)&&(l=Z(a)),c(l);const d=Y(l);return p(d),d}catch(t){if(console.error("Error fetching messages:",t),!e){const a=t?.response?.data?.message||"Failed to load messages";y.error(a)}return c([]),p([]),[]}finally{e||R(!1)}},[Y]);r.useEffect(()=>{P()},[P]);const I=r.useCallback(async e=>{if(b(e),e.type==="thread")try{const t=await M.get(`/api/messages/${e.threadId}`),a=t.data&&t.data.id?t.data:e.thread.raw,l=z(a,e.thread.context);o(l)}catch(t){console.error("Error fetching thread conversation:",t);const a=z(e.thread.raw,e.thread.context);o(a),y.error("Unable to refresh conversation; showing cached messages.")}else{const t=e.thread.legacy?.user1,a=e.thread.legacy?.user2||e.email;if(!t||!a){o([]);return}try{const l=await M.get("/api/messages/conversation",{params:{user1:t,user2:a,limit:100}}),N=(Array.isArray(l.data?.conversation)?l.data.conversation:[]).map(T).sort((S,A)=>new Date(S.timestamp).getTime()-new Date(A.timestamp).getTime());o(N)}catch(l){console.error("Error fetching legacy conversation:",l),y.error("Unable to load conversation");const d=Array.isArray(e.thread.raw)?e.thread.raw.map(T):[];d.sort((N,S)=>new Date(N.timestamp).getTime()-new Date(S.timestamp).getTime()),o(d)}}},[]),ne=r.useCallback(async e=>{if(e.preventDefault(),!m||!V.trim()||U)return;const t=V.trim();$(!0);try{if(m.type==="thread")await M.post("/api/messages/reply",{threadId:m.threadId,content:t});else{const d=m.email||m.thread.legacy?.user2;if(!d)throw new Error("Missing recipient email");const N=m.thread.subject||`Message to ${m.name}`;await M.post("/api/messages",{to:d,subject:N,content:t,priority:"normal"})}ae("");const l=(await P({silent:!0})).find(d=>d.threadId===m.threadId&&d.type===m.type);l&&await I(l),y.success("Message sent")}catch(a){console.error("Error sending message:",a);const l=a?.response?.data?.message||a?.message||"Failed to send message";y.error(l)}finally{$(!1)}},[m,V,U,P,I]),re=r.useCallback(e=>{if(e.type==="thread"){const t=z(e.thread.raw,e.thread.context);return t.length?t[t.length-1]:null}if(Array.isArray(e.thread.raw)){const t=e.thread.raw.map(T).sort((a,l)=>new Date(a.timestamp).getTime()-new Date(l.timestamp).getTime());return t.length?t[t.length-1]:null}return null},[]),oe=r.useCallback(e=>e.unreadCount||0,[]),le=r.useMemo(()=>K(f?.email||"User"),[f]),_=r.useMemo(()=>f?.email||"User",[f]),me=r.useMemo(()=>f?.role||"member",[f]);r.useCallback(e=>{const t=(f?.email||"").toLowerCase();return t?!!(e.senderEmail&&e.senderEmail.toLowerCase()===t||e.senderId&&e.senderId.toLowerCase().includes(t)||e.senderRole?.toLowerCase()==="admin"&&f?.role==="admin"):!1},[f]);const ce=r.useCallback(e=>{if(!e)return"";const t=new Date(e);return Number.isFinite(t.getTime())?t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):""},[]);return se?s.jsxDEV("div",{className:"d-flex justify-content-center align-items-center",style:{height:"400px"},children:s.jsxDEV("div",{className:"spinner-border text-primary",role:"status",children:s.jsxDEV("span",{className:"visually-hidden",children:"Loading..."},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:514,columnNumber:11},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:513,columnNumber:9},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:512,columnNumber:7},void 0):s.jsxDEV("div",{className:"chat-wrapper",children:[s.jsxDEV("div",{className:"chat-sidebar card",children:[s.jsxDEV("div",{className:"chat-sidebar-single active top-profile",children:[s.jsxDEV("div",{className:"img",children:s.jsxDEV("img",{src:le,alt:"Current user"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:525,columnNumber:13},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:524,columnNumber:11},void 0),s.jsxDEV("div",{className:"info",children:[s.jsxDEV("h6",{className:"text-md mb-0",children:_},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:528,columnNumber:13},void 0),s.jsxDEV("p",{className:"mb-0 text-capitalize",children:me},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:529,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:527,columnNumber:11},void 0),s.jsxDEV("div",{className:"action d-flex flex-column align-items-end",children:[s.jsxDEV("button",{type:"button",className:"btn btn-primary btn-sm mb-2",onClick:()=>k(!0),children:[s.jsxDEV(E,{icon:"mdi:plus"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:537,columnNumber:15},void 0)," Compose"]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:532,columnNumber:13},void 0),s.jsxDEV("div",{className:"btn-group",children:[s.jsxDEV("button",{type:"button",className:"text-secondary-light text-xl","data-bs-toggle":"dropdown","data-bs-display":"static","aria-expanded":"false",children:s.jsxDEV(E,{icon:"bi:three-dots"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:547,columnNumber:17},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:540,columnNumber:15},void 0),s.jsxDEV("ul",{className:"dropdown-menu dropdown-menu-lg-end border",children:s.jsxDEV("li",{children:s.jsxDEV(he,{to:"/chat-profile",className:"dropdown-item rounded text-secondary-light bg-hover-neutral-200 text-hover-neutral-900 d-flex align-items-center gap-2",children:[s.jsxDEV(E,{icon:"fluent:person-32-regular"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:555,columnNumber:21},void 0),"Profile"]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:551,columnNumber:19},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:550,columnNumber:17},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:549,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:539,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:531,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:523,columnNumber:9},void 0),s.jsxDEV("div",{className:"d-flex justify-content-center my-2",children:[s.jsxDEV("button",{className:`btn btn-sm ${u==="inbox"?"btn-primary":"btn-outline-primary"} mx-1`,onClick:()=>i("inbox"),children:"Inbox"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:565,columnNumber:11},void 0),s.jsxDEV("button",{className:`btn btn-sm ${u==="sent"?"btn-primary":"btn-outline-primary"} mx-1`,onClick:()=>i("sent"),children:"Sent"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:571,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:564,columnNumber:9},void 0),s.jsxDEV("div",{className:"chat-search",children:s.jsxDEV("form",{children:[s.jsxDEV("input",{type:"text",name:"chatSearch",placeholder:"Search here..."},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:581,columnNumber:13},void 0),s.jsxDEV(E,{icon:"iconoir:search",className:"search-icon"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:582,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:580,columnNumber:11},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:579,columnNumber:9},void 0),s.jsxDEV("div",{className:"chat-all-list",children:h.filter(e=>u==="inbox"?e.isInbox:e.isSent).map(e=>{const t=re(e),a=oe(e),l=t?C(t.content,30):"No messages yet",d=t?ce(t.timestamp):"";return s.jsxDEV("div",{className:`chat-sidebar-single ${m?.id===e.id?"active":""}`,onClick:()=>{I(e)},style:{cursor:"pointer"},children:[s.jsxDEV("div",{className:"img",children:s.jsxDEV("img",{src:e.avatar,alt:e.name},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:607,columnNumber:21},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:606,columnNumber:19},void 0),s.jsxDEV("div",{className:"info",children:[s.jsxDEV("h6",{className:"text-sm mb-1",children:e.name},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:610,columnNumber:21},void 0),s.jsxDEV("p",{className:"mb-0 text-xs",children:l},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:611,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:609,columnNumber:19},void 0),s.jsxDEV("div",{className:"action text-end",children:[s.jsxDEV("p",{className:"mb-0 text-neutral-400 text-xs lh-1",children:d},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:614,columnNumber:21},void 0),a>0&&s.jsxDEV("span",{className:"w-16-px h-16-px text-xs rounded-circle bg-warning-main text-white d-inline-flex align-items-center justify-content-center",children:a},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:616,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:613,columnNumber:19},void 0)]},e.id,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:598,columnNumber:17},void 0)})},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:586,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:522,columnNumber:7},void 0),s.jsxDEV("div",{className:"chat-main card",children:[m?s.jsxDEV(s.Fragment,{children:[s.jsxDEV("div",{className:"chat-sidebar-single active"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:631,columnNumber:13},void 0),s.jsxDEV("div",{className:"chat-message-list",style:{maxHeight:"400px",overflowY:"auto"}},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:634,columnNumber:13},void 0),s.jsxDEV("form",{className:"chat-message-box",onSubmit:ne},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:637,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:629,columnNumber:11},void 0):s.jsxDEV("div",{className:"d-flex flex-column align-items-center justify-content-center h-100 text-center",children:[s.jsxDEV(E,{icon:"fluent:chat-48-regular",className:"text-primary",style:{fontSize:"4rem"}},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:643,columnNumber:13},void 0),s.jsxDEV("h5",{className:"mt-3 mb-2",children:"Select a conversation"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:644,columnNumber:13},void 0),s.jsxDEV("p",{className:"text-muted",children:"Choose a contact from the sidebar to start messaging"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:645,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:642,columnNumber:11},void 0),X&&s.jsxDEV("div",{className:"modal-backdrop show",style:{zIndex:1050},children:s.jsxDEV("div",{className:"modal d-block",tabIndex:-1,role:"dialog",style:{zIndex:1060},children:s.jsxDEV("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:s.jsxDEV("div",{className:"modal-content",children:[s.jsxDEV("div",{className:"modal-header",children:[s.jsxDEV("h5",{className:"modal-title",children:"Compose New Message"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:655,columnNumber:21},void 0),s.jsxDEV("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>k(!1)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:656,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:654,columnNumber:19},void 0),s.jsxDEV("form",{onSubmit:async e=>{if(e.preventDefault(),!(!D.trim()||!w.trim())){O(!0);try{await M.post("/api/messages",{to:D.trim(),subject:`Message from ${_}`,content:w.trim(),priority:"normal"}),L(""),F(""),k(!1),y.success("Message sent"),await P({silent:!0})}catch(t){y.error(t?.response?.data?.message||"Failed to send message")}finally{O(!1)}}},children:[s.jsxDEV("div",{className:"modal-body",children:[s.jsxDEV("div",{className:"mb-3",children:[s.jsxDEV("label",{className:"form-label",children:"Recipient Email"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:684,columnNumber:25},void 0),s.jsxDEV("div",{style:{position:"relative"},children:[s.jsxDEV("input",{type:"email",className:"form-control",value:D,onChange:e=>{L(e.target.value),Q(e.target.value),j(!0)},onFocus:()=>j(!0),onBlur:()=>setTimeout(()=>j(!1),150),autoComplete:"off",required:!0},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:686,columnNumber:27},void 0),ie&&v.trim()&&s.jsxDEV("div",{style:{position:"absolute",zIndex:100,top:"100%",left:0,right:0,background:"#fff",border:"1px solid #ddd",maxHeight:200,overflowY:"auto",borderRadius:4},children:[q.filter(e=>e.email&&e.email.toLowerCase().includes(v.toLowerCase())||e.name&&e.name.toLowerCase().includes(v.toLowerCase())).slice(0,10).map((e,t)=>s.jsxDEV("div",{style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid #eee"},onMouseDown:()=>{L(e.email),Q(e.email),j(!1)},children:[s.jsxDEV("span",{style:{fontWeight:500},children:e.name},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:718,columnNumber:37},void 0),s.jsxDEV("span",{style:{color:"#888",marginLeft:8},children:e.email},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:719,columnNumber:37},void 0),s.jsxDEV("span",{style:{color:"#aaa",marginLeft:8,fontSize:"0.9em"},children:["(",e.role,")"]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:720,columnNumber:37},void 0)]},e.email+t,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:709,columnNumber:35},void 0)),q.filter(e=>e.email&&e.email.toLowerCase().includes(v.toLowerCase())||e.name&&e.name.toLowerCase().includes(v.toLowerCase())).length===0&&s.jsxDEV("div",{style:{padding:"8px 12px",color:"#888"},children:"No matches found"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:727,columnNumber:33},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:701,columnNumber:29},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:685,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:683,columnNumber:23},void 0),s.jsxDEV("div",{className:"mb-3",children:[s.jsxDEV("label",{className:"form-label",children:"Message"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:734,columnNumber:25},void 0),s.jsxDEV("textarea",{className:"form-control",rows:4,value:w,onChange:e=>F(e.target.value),required:!0},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:735,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:733,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:682,columnNumber:21},void 0),s.jsxDEV("div",{className:"modal-footer",children:[s.jsxDEV("button",{type:"button",className:"btn btn-secondary",onClick:()=>k(!1),children:"Cancel"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:745,columnNumber:23},void 0),s.jsxDEV("button",{type:"submit",className:"btn btn-primary",disabled:B||!D.trim()||!w.trim(),children:B?"Sending...":"Send"},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:748,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:744,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:658,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:653,columnNumber:17},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:652,columnNumber:15},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:651,columnNumber:13},void 0)},void 0,!1,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:650,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:627,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Applications/XAMPP/xamppfiles/htdocs/firebase sloane hub/ui/marketplace-ui-react/src/components/MessagingSystem.tsx",lineNumber:521,columnNumber:5},void 0)};export{Me as M};
