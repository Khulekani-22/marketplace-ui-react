import{m as Y,f as Z,a as _,j as e,M as ee}from"./index-BEJvX3gE.js";import{r as c,L as S}from"./vendor-DW3XjTa1.js";import{B as se}from"./Breadcrumb-DZwViNlA.js";import{R as w}from"./react-apexcharts.min-BtpU0J2L.js";import"./firebase-ARhtPVQA.js";import"./utils-B2rxisVD.js";import"./index-MJ8GDmJ4.js";function de(){const{vendor:r}=Y?.()||{vendor:null};r?.vendorId||r?.id||r?.ownerUid||r?.email;const V=c.useMemo(()=>sessionStorage.getItem("tenantId")||"vendor",[]),[o,$]=c.useState(null),[D,T]=c.useState(""),[v,k]=c.useState(!1),[x,q]=c.useState([]),[L,z]=c.useState({}),[m,G]=c.useState({monthly:{},quarterly:{},annual:{}}),[R,H]=c.useState(6),{appData:P}=Z();c.useEffect(()=>{(async()=>{if(T(""),!!r){k(!0);try{const s=P||{startups:[],vendors:[],companies:[],services:[]},t=Array.isArray(s?.services)?s.services:[],d=r?.vendorId||r?.id||"",h=(r?.email||r?.contactEmail||"").toLowerCase(),i=(r?.name||"").toLowerCase(),a=t.filter(n=>{const l=String(n.vendorId||""),b=(n.contactEmail||n.email||"").toLowerCase(),f=(n.vendor||"").toLowerCase();return l&&d&&l===d||!l&&(f===i||!!h&&b===h)});q(a);const j=a.reduce((n,l)=>{const b=(l.status||"approved").toLowerCase();return n[b]=(n[b]||0)+1,n},{}),K=a.reduce((n,l)=>n+(Number(l.reviewCount||(Array.isArray(l.reviews)?l.reviews.length:0))||0),0),I=a.map(n=>Number(n.rating||0)).filter(n=>!Number.isNaN(n)),X=I.length?I.reduce((n,l)=>n+l,0)/I.length:0;$({listingStats:{total:a.length,byStatus:j},reviewStats:{totalReviews:K,avgRating:X},subscription:{plan:r?.subscriptionPlan||"Free",status:(r?.status||r?.kycStatus||"pending").toLowerCase()}});try{const n={email:(r?.email||r?.contactEmail||"").toLowerCase(),uid:r?.ownerUid||"",name:r?.name||""},l=r?.vendorId||r?.id||"me",f=(await _.get(`/api/data/vendors/${encodeURIComponent(l)}/stats`,{params:n,suppressToast:!0,suppressErrorLog:!0})).data||{};z(f?.subscriptionStats?.byService||{}),G(f?.salesTime||{monthly:{},quarterly:{},annual:{}})}catch{}}catch(s){T(s?.message||"Failed to load vendor listings")}finally{k(!1)}}})()},[V,r,P]);const C=o?.listingStats?.byStatus||{},Q=o?.listingStats?.total||0,W=o?.reviewStats?.totalReviews||0,M=Number(o?.reviewStats?.avgRating||0).toFixed(1),J=o?.subscription?.plan||"Free",A=o?.subscription?.status||"pending",u=(s,t)=>{try{return getComputedStyle(document.documentElement).getPropertyValue(s).trim()||t}catch{return t}},p=u("--primary-600","#487FFF"),g=u("--success-600","#45B369"),N=u("--warning-600","#FF9F29"),U=u("--neutral-400","#94A3B8"),y=u("--border-300","#D1D5DB"),F=c.useMemo(()=>{const s=Object.entries(m?.monthly||{});if(!s.length)return null;const t=s.sort((a,j)=>a[0]>j[0]?1:-1).slice(-R),d=t.map(([a])=>a),h=t.map(([,a])=>Number(a?.count||0)),i=t.map(([,a])=>Number(a?.revenue||0));return{categories:d,series:[{name:"Orders",type:"column",data:h},{name:"Revenue (R)",type:"line",data:i}],options:{chart:{id:"vendor-monthly-sales",stacked:!1,toolbar:{show:!1}},stroke:{width:[0,3]},dataLabels:{enabled:!1},xaxis:{categories:d},yaxis:[{title:{text:"Orders"},labels:{formatter:a=>Math.round(a)}},{opposite:!0,title:{text:"Revenue (R)"},labels:{formatter:a=>`R ${Number(a).toLocaleString()}`}}],colors:[p,g],tooltip:{shared:!0,y:{formatter:(a,{seriesIndex:j})=>j===0?`${Math.round(a)} orders`:`R ${Number(a).toLocaleString()}`}},legend:{position:"top"},grid:{borderColor:y,strokeDashArray:4}}}},[m?.monthly,R,p,g,y]),O=c.useMemo(()=>{const t=(x||[]).map(i=>({name:i.title||"Untitled",id:String(i.id),value:Number(L[String(i.id)]||0)})).filter(i=>i.value>0).sort((i,a)=>i.value<a.value?1:-1).slice(0,5);if(!t.length)return null;const d=t.map(i=>i.name),h=t.map(i=>i.value);return{categories:d,series:[{name:"Subscribers",data:h}],options:{chart:{id:"vendor-subs-by-service",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:6,horizontal:!0}},dataLabels:{enabled:!1},xaxis:{categories:d,labels:{formatter:i=>Math.round(Number(i))}},colors:[N],grid:{borderColor:y,strokeDashArray:4}}}},[x,L,N,y]),B=c.useMemo(()=>{const s=Number((o?.listingStats?.byStatus||{}).approved||0),t=Number((o?.listingStats?.byStatus||{}).pending||0),d=Number((o?.listingStats?.byStatus||{}).rejected||0);return s+t+d?{series:[s,t,d],options:{labels:["Approved","Pending","Rejected"],colors:[g,N,U],chart:{type:"donut",toolbar:{show:!1}},legend:{position:"bottom"},dataLabels:{enabled:!1}}}:null},[o?.listingStats?.byStatus,g,N,U]),E=c.useMemo(()=>{const s=Number(M||0);if(!s||Number.isNaN(s))return null;const t=Math.max(0,Math.min(100,s/5*100));return{series:[Number(t.toFixed(0))],options:{chart:{type:"radialBar",sparkline:{enabled:!0}},plotOptions:{radialBar:{hollow:{size:"65%"},dataLabels:{name:{show:!1},value:{formatter:()=>`${s.toFixed(1)}★`,fontSize:"18px"}}}},colors:[p]}}},[M,p]);return e.jsxs(ee,{children:[e.jsx(se,{title:"Vendor Home"}),!1,D&&e.jsx("div",{className:"alert alert-danger",children:D}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-4",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsx("h6",{className:"mb-0",children:"Listings"}),e.jsx(S,{to:"/listings-vendors-mine",className:"btn btn-sm btn-outline-primary",children:"View"})]}),e.jsx("div",{className:"display-6 fw-bold mt-2",children:Q}),e.jsxs("div",{className:"mt-2 text-secondary small",children:[e.jsxs("span",{className:"me-3",children:["Approved: ",e.jsx("strong",{children:C.approved||0})]}),e.jsxs("span",{className:"me-3",children:["Pending: ",e.jsx("strong",{children:C.pending||0})]}),e.jsxs("span",{children:["Rejected: ",e.jsx("strong",{children:C.rejected||0})]})]}),e.jsxs("div",{className:"mt-3 d-flex gap-2",children:[e.jsx(S,{to:"/listings-vendors",className:"btn btn-sm btn-primary",children:"Create listing"}),e.jsx(S,{to:"/profile-vendor",className:"btn btn-sm btn-outline-secondary",children:"Edit profile"})]})]})})}),e.jsx("div",{className:"col-md-4",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsx("h6",{className:"mb-0",children:"Reviews"}),e.jsxs("span",{className:"badge bg-primary-subtle text-primary-700",children:["Avg ",M,"★"]})]}),e.jsx("div",{className:"display-6 fw-bold mt-2",children:W}),e.jsx("div",{className:"mt-2 text-secondary small",children:"Total review count across your listings."})]})})}),e.jsx("div",{className:"col-md-4",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsx("h6",{className:"mb-0",children:"Subscription"}),e.jsx("span",{className:`badge text-bg-${A==="active"?"success":A==="pending"?"warning":"secondary"}`,children:A})]}),e.jsx("div",{className:"display-6 fw-bold mt-2",children:J}),e.jsx("div",{className:"mt-2 text-secondary small",children:"Upgrade coming soon."})]})})})]}),e.jsxs("div",{className:"row g-3 mt-3",children:[e.jsx("div",{className:"col-lg-8",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("h6",{className:"mb-0",children:"Monthly Sales"}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("span",{className:"text-secondary small",children:"Orders vs Revenue"}),e.jsxs("select",{className:"form-select form-select-sm w-auto bg-base border text-secondary-light",value:R,onChange:s=>H(Number(s.target.value)),"aria-label":"Select time range",children:[e.jsx("option",{value:3,children:"Last 3 months"}),e.jsx("option",{value:6,children:"Last 6 months"}),e.jsx("option",{value:12,children:"Last 12 months"})]})]})]}),F?e.jsx(w,{options:F.options,series:F.series,type:"line",height:300}):e.jsx("div",{className:"text-secondary",children:"No monthly sales yet."})]})})}),e.jsx("div",{className:"col-lg-4",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"mb-2",children:"Listing Status"}),B?e.jsx(w,{options:B.options,series:B.series,type:"donut",height:300}):e.jsx("div",{className:"text-secondary",children:"No listings yet."})]})})})]}),e.jsxs("div",{className:"row g-3 mt-3",children:[e.jsx("div",{className:"col-lg-8",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"mb-2",children:"Top Services by Subscribers"}),O?e.jsx(w,{options:O.options,series:O.series,type:"bar",height:300}):e.jsx("div",{className:"text-secondary",children:"No subscribers yet."})]})})}),e.jsx("div",{className:"col-lg-4",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body d-flex flex-column align-items-center justify-content-center",children:[e.jsx("h6",{className:"mb-2",children:"Average Rating"}),E?e.jsx(w,{options:E.options,series:E.series,type:"radialBar",height:250}):e.jsx("div",{className:"text-secondary",children:"No ratings yet."})]})})})]}),e.jsxs("div",{className:"card mt-3",children:[e.jsxs("div",{className:"card-header d-flex align-items-center justify-content-between",children:[e.jsx("h6",{className:"mb-0",children:"My Listings"}),e.jsx(S,{to:"/listings-vendors-mine",className:"btn btn-sm btn-outline-secondary",children:"See all"})]}),e.jsxs("div",{className:"card-body",children:[!v&&x.length===0&&e.jsx("div",{className:"text-secondary",children:"No listings yet. Create your first one."}),v&&e.jsx("div",{className:"text-secondary",children:"Loading listings…"}),!v&&x.length>0&&e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table mb-0 align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Rating"}),e.jsx("th",{children:"Reviews"}),e.jsx("th",{children:"Subscribers"})]})}),e.jsx("tbody",{children:x.slice(0,6).map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.title||"Untitled"}),e.jsx("td",{children:e.jsx("span",{className:"badge text-bg-light text-capitalize",children:(s.status||"approved").toLowerCase()})}),e.jsx("td",{children:s.category||"—"}),e.jsxs("td",{children:[Number(s.rating||0).toFixed(1),"★"]}),e.jsx("td",{children:Number(s.reviewCount||(Array.isArray(s.reviews)?s.reviews.length:0)||0)}),e.jsx("td",{children:Number(L[String(s.id)]||0)})]},s.id))})]})})]})]}),e.jsxs("div",{className:"row g-3 mt-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"mb-2",children:"Monthly Sales"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Month"}),e.jsx("th",{className:"text-end",children:"Orders"}),e.jsx("th",{className:"text-end",children:"Revenue (R)"})]})}),e.jsxs("tbody",{children:[Object.entries(m.monthly||{}).sort((s,t)=>s[0]<t[0]?1:-1).slice(0,6).map(([s,t])=>e.jsxs("tr",{children:[e.jsx("td",{children:s}),e.jsx("td",{className:"text-end",children:t.count||0}),e.jsx("td",{className:"text-end",children:Number(t.revenue||0).toLocaleString()})]},s)),Object.keys(m.monthly||{}).length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-secondary",children:"No completed sales yet."})})]})]})})]})})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"mb-2",children:"Quarterly Sales"}),e.jsxs("ul",{className:"list-unstyled mb-0",children:[Object.entries(m.quarterly||{}).sort((s,t)=>s[0]<t[0]?1:-1).slice(0,4).map(([s,t])=>e.jsxs("li",{className:"d-flex justify-content-between",children:[e.jsx("span",{children:s}),e.jsxs("span",{children:["R ",Number(t.revenue||0).toLocaleString()]})]},s)),Object.keys(m.quarterly||{}).length===0&&e.jsx("li",{className:"text-secondary",children:"No data"})]})]})})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"mb-2",children:"Annual Sales"}),e.jsxs("ul",{className:"list-unstyled mb-0",children:[Object.entries(m.annual||{}).sort((s,t)=>s[0]<t[0]?1:-1).slice(0,3).map(([s,t])=>e.jsxs("li",{className:"d-flex justify-content-between",children:[e.jsx("span",{children:s}),e.jsxs("span",{children:["R ",Number(t.revenue||0).toLocaleString()]})]},s)),Object.keys(m.annual||{}).length===0&&e.jsx("li",{className:"text-secondary",children:"No data"})]})]})})})]}),v&&e.jsx("div",{className:"text-secondary mt-3",children:"Loading stats…"})]})}export{de as default};
